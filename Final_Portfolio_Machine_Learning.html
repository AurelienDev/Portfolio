<!DOCTYPE html>

<html lang="en">
<head><meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Final_Portfolio_Machine_Learning JSON</title><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>
<style type="text/css">
    pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.highlight .hll { background-color: var(--jp-cell-editor-active-background) }
.highlight { background: var(--jp-cell-editor-background); color: var(--jp-mirror-editor-variable-color) }
.highlight .c { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment */
.highlight .err { color: var(--jp-mirror-editor-error-color) } /* Error */
.highlight .k { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword */
.highlight .o { color: var(--jp-mirror-editor-operator-color); font-weight: bold } /* Operator */
.highlight .p { color: var(--jp-mirror-editor-punctuation-color) } /* Punctuation */
.highlight .ch { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Hashbang */
.highlight .cm { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Multiline */
.highlight .cp { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Preproc */
.highlight .cpf { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.PreprocFile */
.highlight .c1 { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Single */
.highlight .cs { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Special */
.highlight .kc { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Type */
.highlight .m { color: var(--jp-mirror-editor-number-color) } /* Literal.Number */
.highlight .s { color: var(--jp-mirror-editor-string-color) } /* Literal.String */
.highlight .ow { color: var(--jp-mirror-editor-operator-color); font-weight: bold } /* Operator.Word */
.highlight .pm { color: var(--jp-mirror-editor-punctuation-color) } /* Punctuation.Marker */
.highlight .w { color: var(--jp-mirror-editor-variable-color) } /* Text.Whitespace */
.highlight .mb { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Bin */
.highlight .mf { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Float */
.highlight .mh { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Hex */
.highlight .mi { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Integer */
.highlight .mo { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Oct */
.highlight .sa { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Affix */
.highlight .sb { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Backtick */
.highlight .sc { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Char */
.highlight .dl { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Delimiter */
.highlight .sd { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Doc */
.highlight .s2 { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Double */
.highlight .se { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Escape */
.highlight .sh { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Heredoc */
.highlight .si { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Interpol */
.highlight .sx { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Other */
.highlight .sr { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Regex */
.highlight .s1 { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Single */
.highlight .ss { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Symbol */
.highlight .il { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Integer.Long */
  </style>
<style type="text/css">
/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/*
 * Mozilla scrollbar styling
 */

/* use standard opaque scrollbars for most nodes */
[data-jp-theme-scrollbars='true'] {
  scrollbar-color: rgb(var(--jp-scrollbar-thumb-color))
    var(--jp-scrollbar-background-color);
}

/* for code nodes, use a transparent style of scrollbar. These selectors
 * will match lower in the tree, and so will override the above */
[data-jp-theme-scrollbars='true'] .CodeMirror-hscrollbar,
[data-jp-theme-scrollbars='true'] .CodeMirror-vscrollbar {
  scrollbar-color: rgba(var(--jp-scrollbar-thumb-color), 0.5) transparent;
}

/* tiny scrollbar */

.jp-scrollbar-tiny {
  scrollbar-color: rgba(var(--jp-scrollbar-thumb-color), 0.5) transparent;
  scrollbar-width: thin;
}

/* tiny scrollbar */

.jp-scrollbar-tiny::-webkit-scrollbar,
.jp-scrollbar-tiny::-webkit-scrollbar-corner {
  background-color: transparent;
  height: 4px;
  width: 4px;
}

.jp-scrollbar-tiny::-webkit-scrollbar-thumb {
  background: rgba(var(--jp-scrollbar-thumb-color), 0.5);
}

.jp-scrollbar-tiny::-webkit-scrollbar-track:horizontal {
  border-left: 0 solid transparent;
  border-right: 0 solid transparent;
}

.jp-scrollbar-tiny::-webkit-scrollbar-track:vertical {
  border-top: 0 solid transparent;
  border-bottom: 0 solid transparent;
}

/*
 * Lumino
 */

.lm-ScrollBar[data-orientation='horizontal'] {
  min-height: 16px;
  max-height: 16px;
  min-width: 45px;
  border-top: 1px solid #a0a0a0;
}

.lm-ScrollBar[data-orientation='vertical'] {
  min-width: 16px;
  max-width: 16px;
  min-height: 45px;
  border-left: 1px solid #a0a0a0;
}

.lm-ScrollBar-button {
  background-color: #f0f0f0;
  background-position: center center;
  min-height: 15px;
  max-height: 15px;
  min-width: 15px;
  max-width: 15px;
}

.lm-ScrollBar-button:hover {
  background-color: #dadada;
}

.lm-ScrollBar-button.lm-mod-active {
  background-color: #cdcdcd;
}

.lm-ScrollBar-track {
  background: #f0f0f0;
}

.lm-ScrollBar-thumb {
  background: #cdcdcd;
}

.lm-ScrollBar-thumb:hover {
  background: #bababa;
}

.lm-ScrollBar-thumb.lm-mod-active {
  background: #a0a0a0;
}

.lm-ScrollBar[data-orientation='horizontal'] .lm-ScrollBar-thumb {
  height: 100%;
  min-width: 15px;
  border-left: 1px solid #a0a0a0;
  border-right: 1px solid #a0a0a0;
}

.lm-ScrollBar[data-orientation='vertical'] .lm-ScrollBar-thumb {
  width: 100%;
  min-height: 15px;
  border-top: 1px solid #a0a0a0;
  border-bottom: 1px solid #a0a0a0;
}

.lm-ScrollBar[data-orientation='horizontal']
  .lm-ScrollBar-button[data-action='decrement'] {
  background-image: var(--jp-icon-caret-left);
  background-size: 17px;
}

.lm-ScrollBar[data-orientation='horizontal']
  .lm-ScrollBar-button[data-action='increment'] {
  background-image: var(--jp-icon-caret-right);
  background-size: 17px;
}

.lm-ScrollBar[data-orientation='vertical']
  .lm-ScrollBar-button[data-action='decrement'] {
  background-image: var(--jp-icon-caret-up);
  background-size: 17px;
}

.lm-ScrollBar[data-orientation='vertical']
  .lm-ScrollBar-button[data-action='increment'] {
  background-image: var(--jp-icon-caret-down);
  background-size: 17px;
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Copyright (c) 2014-2017, PhosphorJS Contributors
|
| Distributed under the terms of the BSD 3-Clause License.
|
| The full license is in the file LICENSE, distributed with this software.
|----------------------------------------------------------------------------*/

.lm-Widget {
  box-sizing: border-box;
  position: relative;
  overflow: hidden;
}

.lm-Widget.lm-mod-hidden {
  display: none !important;
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

.lm-AccordionPanel[data-orientation='horizontal'] > .lm-AccordionPanel-title {
  /* Title is rotated for horizontal accordion panel using CSS */
  display: block;
  transform-origin: top left;
  transform: rotate(-90deg) translate(-100%);
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Copyright (c) 2014-2017, PhosphorJS Contributors
|
| Distributed under the terms of the BSD 3-Clause License.
|
| The full license is in the file LICENSE, distributed with this software.
|----------------------------------------------------------------------------*/

.lm-CommandPalette {
  display: flex;
  flex-direction: column;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.lm-CommandPalette-search {
  flex: 0 0 auto;
}

.lm-CommandPalette-content {
  flex: 1 1 auto;
  margin: 0;
  padding: 0;
  min-height: 0;
  overflow: auto;
  list-style-type: none;
}

.lm-CommandPalette-header {
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}

.lm-CommandPalette-item {
  display: flex;
  flex-direction: row;
}

.lm-CommandPalette-itemIcon {
  flex: 0 0 auto;
}

.lm-CommandPalette-itemContent {
  flex: 1 1 auto;
  overflow: hidden;
}

.lm-CommandPalette-itemShortcut {
  flex: 0 0 auto;
}

.lm-CommandPalette-itemLabel {
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}

.lm-close-icon {
  border: 1px solid transparent;
  background-color: transparent;
  position: absolute;
  z-index: 1;
  right: 3%;
  top: 0;
  bottom: 0;
  margin: auto;
  padding: 7px 0;
  display: none;
  vertical-align: middle;
  outline: 0;
  cursor: pointer;
}
.lm-close-icon:after {
  content: 'X';
  display: block;
  width: 15px;
  height: 15px;
  text-align: center;
  color: #000;
  font-weight: normal;
  font-size: 12px;
  cursor: pointer;
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Copyright (c) 2014-2017, PhosphorJS Contributors
|
| Distributed under the terms of the BSD 3-Clause License.
|
| The full license is in the file LICENSE, distributed with this software.
|----------------------------------------------------------------------------*/

.lm-DockPanel {
  z-index: 0;
}

.lm-DockPanel-widget {
  z-index: 0;
}

.lm-DockPanel-tabBar {
  z-index: 1;
}

.lm-DockPanel-handle {
  z-index: 2;
}

.lm-DockPanel-handle.lm-mod-hidden {
  display: none !important;
}

.lm-DockPanel-handle:after {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  content: '';
}

.lm-DockPanel-handle[data-orientation='horizontal'] {
  cursor: ew-resize;
}

.lm-DockPanel-handle[data-orientation='vertical'] {
  cursor: ns-resize;
}

.lm-DockPanel-handle[data-orientation='horizontal']:after {
  left: 50%;
  min-width: 8px;
  transform: translateX(-50%);
}

.lm-DockPanel-handle[data-orientation='vertical']:after {
  top: 50%;
  min-height: 8px;
  transform: translateY(-50%);
}

.lm-DockPanel-overlay {
  z-index: 3;
  box-sizing: border-box;
  pointer-events: none;
}

.lm-DockPanel-overlay.lm-mod-hidden {
  display: none !important;
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Copyright (c) 2014-2017, PhosphorJS Contributors
|
| Distributed under the terms of the BSD 3-Clause License.
|
| The full license is in the file LICENSE, distributed with this software.
|----------------------------------------------------------------------------*/

.lm-Menu {
  z-index: 10000;
  position: absolute;
  white-space: nowrap;
  overflow-x: hidden;
  overflow-y: auto;
  outline: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.lm-Menu-content {
  margin: 0;
  padding: 0;
  display: table;
  list-style-type: none;
}

.lm-Menu-item {
  display: table-row;
}

.lm-Menu-item.lm-mod-hidden,
.lm-Menu-item.lm-mod-collapsed {
  display: none !important;
}

.lm-Menu-itemIcon,
.lm-Menu-itemSubmenuIcon {
  display: table-cell;
  text-align: center;
}

.lm-Menu-itemLabel {
  display: table-cell;
  text-align: left;
}

.lm-Menu-itemShortcut {
  display: table-cell;
  text-align: right;
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Copyright (c) 2014-2017, PhosphorJS Contributors
|
| Distributed under the terms of the BSD 3-Clause License.
|
| The full license is in the file LICENSE, distributed with this software.
|----------------------------------------------------------------------------*/

.lm-MenuBar {
  outline: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.lm-MenuBar-content {
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: row;
  list-style-type: none;
}

.lm-MenuBar-item {
  box-sizing: border-box;
}

.lm-MenuBar-itemIcon,
.lm-MenuBar-itemLabel {
  display: inline-block;
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Copyright (c) 2014-2017, PhosphorJS Contributors
|
| Distributed under the terms of the BSD 3-Clause License.
|
| The full license is in the file LICENSE, distributed with this software.
|----------------------------------------------------------------------------*/

.lm-ScrollBar {
  display: flex;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.lm-ScrollBar[data-orientation='horizontal'] {
  flex-direction: row;
}

.lm-ScrollBar[data-orientation='vertical'] {
  flex-direction: column;
}

.lm-ScrollBar-button {
  box-sizing: border-box;
  flex: 0 0 auto;
}

.lm-ScrollBar-track {
  box-sizing: border-box;
  position: relative;
  overflow: hidden;
  flex: 1 1 auto;
}

.lm-ScrollBar-thumb {
  box-sizing: border-box;
  position: absolute;
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Copyright (c) 2014-2017, PhosphorJS Contributors
|
| Distributed under the terms of the BSD 3-Clause License.
|
| The full license is in the file LICENSE, distributed with this software.
|----------------------------------------------------------------------------*/

.lm-SplitPanel-child {
  z-index: 0;
}

.lm-SplitPanel-handle {
  z-index: 1;
}

.lm-SplitPanel-handle.lm-mod-hidden {
  display: none !important;
}

.lm-SplitPanel-handle:after {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  content: '';
}

.lm-SplitPanel[data-orientation='horizontal'] > .lm-SplitPanel-handle {
  cursor: ew-resize;
}

.lm-SplitPanel[data-orientation='vertical'] > .lm-SplitPanel-handle {
  cursor: ns-resize;
}

.lm-SplitPanel[data-orientation='horizontal'] > .lm-SplitPanel-handle:after {
  left: 50%;
  min-width: 8px;
  transform: translateX(-50%);
}

.lm-SplitPanel[data-orientation='vertical'] > .lm-SplitPanel-handle:after {
  top: 50%;
  min-height: 8px;
  transform: translateY(-50%);
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Copyright (c) 2014-2017, PhosphorJS Contributors
|
| Distributed under the terms of the BSD 3-Clause License.
|
| The full license is in the file LICENSE, distributed with this software.
|----------------------------------------------------------------------------*/

.lm-TabBar {
  display: flex;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.lm-TabBar[data-orientation='horizontal'] {
  flex-direction: row;
  align-items: flex-end;
}

.lm-TabBar[data-orientation='vertical'] {
  flex-direction: column;
  align-items: flex-end;
}

.lm-TabBar-content {
  margin: 0;
  padding: 0;
  display: flex;
  flex: 1 1 auto;
  list-style-type: none;
}

.lm-TabBar[data-orientation='horizontal'] > .lm-TabBar-content {
  flex-direction: row;
}

.lm-TabBar[data-orientation='vertical'] > .lm-TabBar-content {
  flex-direction: column;
}

.lm-TabBar-tab {
  display: flex;
  flex-direction: row;
  box-sizing: border-box;
  overflow: hidden;
  touch-action: none; /* Disable native Drag/Drop */
}

.lm-TabBar-tabIcon,
.lm-TabBar-tabCloseIcon {
  flex: 0 0 auto;
}

.lm-TabBar-tabLabel {
  flex: 1 1 auto;
  overflow: hidden;
  white-space: nowrap;
}

.lm-TabBar-tabInput {
  user-select: all;
  width: 100%;
  box-sizing: border-box;
}

.lm-TabBar-tab.lm-mod-hidden {
  display: none !important;
}

.lm-TabBar-addButton.lm-mod-hidden {
  display: none !important;
}

.lm-TabBar.lm-mod-dragging .lm-TabBar-tab {
  position: relative;
}

.lm-TabBar.lm-mod-dragging[data-orientation='horizontal'] .lm-TabBar-tab {
  left: 0;
  transition: left 150ms ease;
}

.lm-TabBar.lm-mod-dragging[data-orientation='vertical'] .lm-TabBar-tab {
  top: 0;
  transition: top 150ms ease;
}

.lm-TabBar.lm-mod-dragging .lm-TabBar-tab.lm-mod-dragging {
  transition: none;
}

.lm-TabBar-tabLabel .lm-TabBar-tabInput {
  user-select: all;
  width: 100%;
  box-sizing: border-box;
  background: inherit;
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Copyright (c) 2014-2017, PhosphorJS Contributors
|
| Distributed under the terms of the BSD 3-Clause License.
|
| The full license is in the file LICENSE, distributed with this software.
|----------------------------------------------------------------------------*/

.lm-TabPanel-tabBar {
  z-index: 1;
}

.lm-TabPanel-stackedPanel {
  z-index: 0;
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Copyright (c) 2014-2017, PhosphorJS Contributors
|
| Distributed under the terms of the BSD 3-Clause License.
|
| The full license is in the file LICENSE, distributed with this software.
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

.jp-Collapse {
  display: flex;
  flex-direction: column;
  align-items: stretch;
}

.jp-Collapse-header {
  padding: 1px 12px;
  background-color: var(--jp-layout-color1);
  border-bottom: solid var(--jp-border-width) var(--jp-border-color2);
  color: var(--jp-ui-font-color1);
  cursor: pointer;
  display: flex;
  align-items: center;
  font-size: var(--jp-ui-font-size0);
  font-weight: 600;
  text-transform: uppercase;
  user-select: none;
}

.jp-Collapser-icon {
  height: 16px;
}

.jp-Collapse-header-collapsed .jp-Collapser-icon {
  transform: rotate(-90deg);
  margin: auto 0;
}

.jp-Collapser-title {
  line-height: 25px;
}

.jp-Collapse-contents {
  padding: 0 12px;
  background-color: var(--jp-layout-color1);
  color: var(--jp-ui-font-color1);
  overflow: auto;
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/* This file was auto-generated by ensureUiComponents() in @jupyterlab/buildutils */

/**
 * (DEPRECATED) Support for consuming icons as CSS background images
 */

/* Icons urls */

:root {
  --jp-icon-add-above: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAxNCAxNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgY2xpcC1wYXRoPSJ1cmwoI2NsaXAwXzEzN18xOTQ5MikiPgo8cGF0aCBjbGFzcz0ianAtaWNvbjMiIGQ9Ik00Ljc1IDQuOTMwNjZINi42MjVWNi44MDU2NkM2LjYyNSA3LjAxMTkxIDYuNzkzNzUgNy4xODA2NiA3IDcuMTgwNjZDNy4yMDYyNSA3LjE4MDY2IDcuMzc1IDcuMDExOTEgNy4zNzUgNi44MDU2NlY0LjkzMDY2SDkuMjVDOS40NTYyNSA0LjkzMDY2IDkuNjI1IDQuNzYxOTEgOS42MjUgNC41NTU2NkM5LjYyNSA0LjM0OTQxIDkuNDU2MjUgNC4xODA2NiA5LjI1IDQuMTgwNjZINy4zNzVWMi4zMDU2NkM3LjM3NSAyLjA5OTQxIDcuMjA2MjUgMS45MzA2NiA3IDEuOTMwNjZDNi43OTM3NSAxLjkzMDY2IDYuNjI1IDIuMDk5NDEgNi42MjUgMi4zMDU2NlY0LjE4MDY2SDQuNzVDNC41NDM3NSA0LjE4MDY2IDQuMzc1IDQuMzQ5NDEgNC4zNzUgNC41NTU2NkM0LjM3NSA0Ljc2MTkxIDQuNTQzNzUgNC45MzA2NiA0Ljc1IDQuOTMwNjZaIiBmaWxsPSIjNjE2MTYxIiBzdHJva2U9IiM2MTYxNjEiIHN0cm9rZS13aWR0aD0iMC43Ii8+CjwvZz4KPHBhdGggY2xhc3M9ImpwLWljb24zIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTExLjUgOS41VjExLjVMMi41IDExLjVWOS41TDExLjUgOS41Wk0xMiA4QzEyLjU1MjMgOCAxMyA4LjQ0NzcyIDEzIDlWMTJDMTMgMTIuNTUyMyAxMi41NTIzIDEzIDEyIDEzTDIgMTNDMS40NDc3MiAxMyAxIDEyLjU1MjMgMSAxMlY5QzEgOC40NDc3MiAxLjQ0NzcxIDggMiA4TDEyIDhaIiBmaWxsPSIjNjE2MTYxIi8+CjxkZWZzPgo8Y2xpcFBhdGggaWQ9ImNsaXAwXzEzN18xOTQ5MiI+CjxyZWN0IGNsYXNzPSJqcC1pY29uMyIgd2lkdGg9IjYiIGhlaWdodD0iNiIgZmlsbD0id2hpdGUiIHRyYW5zZm9ybT0ibWF0cml4KC0xIDAgMCAxIDEwIDEuNTU1NjYpIi8+CjwvY2xpcFBhdGg+CjwvZGVmcz4KPC9zdmc+Cg==);
  --jp-icon-add-below: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAxNCAxNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgY2xpcC1wYXRoPSJ1cmwoI2NsaXAwXzEzN18xOTQ5OCkiPgo8cGF0aCBjbGFzcz0ianAtaWNvbjMiIGQ9Ik05LjI1IDEwLjA2OTNMNy4zNzUgMTAuMDY5M0w3LjM3NSA4LjE5NDM0QzcuMzc1IDcuOTg4MDkgNy4yMDYyNSA3LjgxOTM0IDcgNy44MTkzNEM2Ljc5Mzc1IDcuODE5MzQgNi42MjUgNy45ODgwOSA2LjYyNSA4LjE5NDM0TDYuNjI1IDEwLjA2OTNMNC43NSAxMC4wNjkzQzQuNTQzNzUgMTAuMDY5MyA0LjM3NSAxMC4yMzgxIDQuMzc1IDEwLjQ0NDNDNC4zNzUgMTAuNjUwNiA0LjU0Mzc1IDEwLjgxOTMgNC43NSAxMC44MTkzTDYuNjI1IDEwLjgxOTNMNi42MjUgMTIuNjk0M0M2LjYyNSAxMi45MDA2IDYuNzkzNzUgMTMuMDY5MyA3IDEzLjA2OTNDNy4yMDYyNSAxMy4wNjkzIDcuMzc1IDEyLjkwMDYgNy4zNzUgMTIuNjk0M0w3LjM3NSAxMC44MTkzTDkuMjUgMTAuODE5M0M5LjQ1NjI1IDEwLjgxOTMgOS42MjUgMTAuNjUwNiA5LjYyNSAxMC40NDQzQzkuNjI1IDEwLjIzODEgOS40NTYyNSAxMC4wNjkzIDkuMjUgMTAuMDY5M1oiIGZpbGw9IiM2MTYxNjEiIHN0cm9rZT0iIzYxNjE2MSIgc3Ryb2tlLXdpZHRoPSIwLjciLz4KPC9nPgo8cGF0aCBjbGFzcz0ianAtaWNvbjMiIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMi41IDUuNUwyLjUgMy41TDExLjUgMy41TDExLjUgNS41TDIuNSA1LjVaTTIgN0MxLjQ0NzcyIDcgMSA2LjU1MjI4IDEgNkwxIDNDMSAyLjQ0NzcyIDEuNDQ3NzIgMiAyIDJMMTIgMkMxMi41NTIzIDIgMTMgMi40NDc3MiAxMyAzTDEzIDZDMTMgNi41NTIyOSAxMi41NTIzIDcgMTIgN0wyIDdaIiBmaWxsPSIjNjE2MTYxIi8+CjxkZWZzPgo8Y2xpcFBhdGggaWQ9ImNsaXAwXzEzN18xOTQ5OCI+CjxyZWN0IGNsYXNzPSJqcC1pY29uMyIgd2lkdGg9IjYiIGhlaWdodD0iNiIgZmlsbD0id2hpdGUiIHRyYW5zZm9ybT0ibWF0cml4KDEgMS43NDg0NmUtMDcgMS43NDg0NmUtMDcgLTEgNCAxMy40NDQzKSIvPgo8L2NsaXBQYXRoPgo8L2RlZnM+Cjwvc3ZnPgo=);
  --jp-icon-add: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTTE5IDEzaC02djZoLTJ2LTZINXYtMmg2VjVoMnY2aDZ2MnoiLz4KICA8L2c+Cjwvc3ZnPgo=);
  --jp-icon-bell: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDE2IDE2IiB2ZXJzaW9uPSIxLjEiPgogICA8cGF0aCBjbGFzcz0ianAtaWNvbjIganAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjMzMzMzMzIgogICAgICBkPSJtOCAwLjI5Yy0xLjQgMC0yLjcgMC43My0zLjYgMS44LTEuMiAxLjUtMS40IDMuNC0xLjUgNS4yLTAuMTggMi4yLTAuNDQgNC0yLjMgNS4zbDAuMjggMS4zaDVjMC4wMjYgMC42NiAwLjMyIDEuMSAwLjcxIDEuNSAwLjg0IDAuNjEgMiAwLjYxIDIuOCAwIDAuNTItMC40IDAuNi0xIDAuNzEtMS41aDVsMC4yOC0xLjNjLTEuOS0wLjk3LTIuMi0zLjMtMi4zLTUuMy0wLjEzLTEuOC0wLjI2LTMuNy0xLjUtNS4yLTAuODUtMS0yLjItMS44LTMuNi0xLjh6bTAgMS40YzAuODggMCAxLjkgMC41NSAyLjUgMS4zIDAuODggMS4xIDEuMSAyLjcgMS4yIDQuNCAwLjEzIDEuNyAwLjIzIDMuNiAxLjMgNS4yaC0xMGMxLjEtMS42IDEuMi0zLjQgMS4zLTUuMiAwLjEzLTEuNyAwLjMtMy4zIDEuMi00LjQgMC41OS0wLjcyIDEuNi0xLjMgMi41LTEuM3ptLTAuNzQgMTJoMS41Yy0wLjAwMTUgMC4yOCAwLjAxNSAwLjc5LTAuNzQgMC43OS0wLjczIDAuMDAxNi0wLjcyLTAuNTMtMC43NC0wLjc5eiIgLz4KPC9zdmc+Cg==);
  --jp-icon-bug-dot: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxnIGNsYXNzPSJqcC1pY29uMyBqcC1pY29uLXNlbGVjdGFibGUiIGZpbGw9IiM2MTYxNjEiPgogICAgICAgIDxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMTcuMTkgOEgyMFYxMEgxNy45MUMxNy45NiAxMC4zMyAxOCAxMC42NiAxOCAxMVYxMkgyMFYxNEgxOC41SDE4VjE0LjAyNzVDMTUuNzUgMTQuMjc2MiAxNCAxNi4xODM3IDE0IDE4LjVDMTQgMTkuMjA4IDE0LjE2MzUgMTkuODc3OSAxNC40NTQ5IDIwLjQ3MzlDMTMuNzA2MyAyMC44MTE3IDEyLjg3NTcgMjEgMTIgMjFDOS43OCAyMSA3Ljg1IDE5Ljc5IDYuODEgMThINFYxNkg2LjA5QzYuMDQgMTUuNjcgNiAxNS4zNCA2IDE1VjE0SDRWMTJINlYxMUM2IDEwLjY2IDYuMDQgMTAuMzMgNi4wOSAxMEg0VjhINi44MUM3LjI2IDcuMjIgNy44OCA2LjU1IDguNjIgNi4wNEw3IDQuNDFMOC40MSAzTDEwLjU5IDUuMTdDMTEuMDQgNS4wNiAxMS41MSA1IDEyIDVDMTIuNDkgNSAxMi45NiA1LjA2IDEzLjQyIDUuMTdMMTUuNTkgM0wxNyA0LjQxTDE1LjM3IDYuMDRDMTYuMTIgNi41NSAxNi43NCA3LjIyIDE3LjE5IDhaTTEwIDE2SDE0VjE0SDEwVjE2Wk0xMCAxMkgxNFYxMEgxMFYxMloiIGZpbGw9IiM2MTYxNjEiLz4KICAgICAgICA8cGF0aCBkPSJNMjIgMTguNUMyMiAyMC40MzMgMjAuNDMzIDIyIDE4LjUgMjJDMTYuNTY3IDIyIDE1IDIwLjQzMyAxNSAxOC41QzE1IDE2LjU2NyAxNi41NjcgMTUgMTguNSAxNUMyMC40MzMgMTUgMjIgMTYuNTY3IDIyIDE4LjVaIiBmaWxsPSIjNjE2MTYxIi8+CiAgICA8L2c+Cjwvc3ZnPgo=);
  --jp-icon-bug: url(data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIxNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZyBjbGFzcz0ianAtaWNvbjMganAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjNjE2MTYxIj4KICAgIDxwYXRoIGQ9Ik0yMCA4aC0yLjgxYy0uNDUtLjc4LTEuMDctMS40NS0xLjgyLTEuOTZMMTcgNC40MSAxNS41OSAzbC0yLjE3IDIuMTdDMTIuOTYgNS4wNiAxMi40OSA1IDEyIDVjLS40OSAwLS45Ni4wNi0xLjQxLjE3TDguNDEgMyA3IDQuNDFsMS42MiAxLjYzQzcuODggNi41NSA3LjI2IDcuMjIgNi44MSA4SDR2MmgyLjA5Yy0uMDUuMzMtLjA5LjY2LS4wOSAxdjFINHYyaDJ2MWMwIC4zNC4wNC42Ny4wOSAxSDR2MmgyLjgxYzEuMDQgMS43OSAyLjk3IDMgNS4xOSAzczQuMTUtMS4yMSA1LjE5LTNIMjB2LTJoLTIuMDljLjA1LS4zMy4wOS0uNjYuMDktMXYtMWgydi0yaC0ydi0xYzAtLjM0LS4wNC0uNjctLjA5LTFIMjBWOHptLTYgOGgtNHYtMmg0djJ6bTAtNGgtNHYtMmg0djJ6Ii8+CiAgPC9nPgo8L3N2Zz4K);
  --jp-icon-build: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIHZpZXdCb3g9IjAgMCAyNCAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTTE0LjkgMTcuNDVDMTYuMjUgMTcuNDUgMTcuMzUgMTYuMzUgMTcuMzUgMTVDMTcuMzUgMTMuNjUgMTYuMjUgMTIuNTUgMTQuOSAxMi41NUMxMy41NCAxMi41NSAxMi40NSAxMy42NSAxMi40NSAxNUMxMi40NSAxNi4zNSAxMy41NCAxNy40NSAxNC45IDE3LjQ1Wk0yMC4xIDE1LjY4TDIxLjU4IDE2Ljg0QzIxLjcxIDE2Ljk1IDIxLjc1IDE3LjEzIDIxLjY2IDE3LjI5TDIwLjI2IDE5LjcxQzIwLjE3IDE5Ljg2IDIwIDE5LjkyIDE5LjgzIDE5Ljg2TDE4LjA5IDE5LjE2QzE3LjczIDE5LjQ0IDE3LjMzIDE5LjY3IDE2LjkxIDE5Ljg1TDE2LjY0IDIxLjdDMTYuNjIgMjEuODcgMTYuNDcgMjIgMTYuMyAyMkgxMy41QzEzLjMyIDIyIDEzLjE4IDIxLjg3IDEzLjE1IDIxLjdMMTIuODkgMTkuODVDMTIuNDYgMTkuNjcgMTIuMDcgMTkuNDQgMTEuNzEgMTkuMTZMOS45NjAwMiAxOS44NkM5LjgxMDAyIDE5LjkyIDkuNjIwMDIgMTkuODYgOS41NDAwMiAxOS43MUw4LjE0MDAyIDE3LjI5QzguMDUwMDIgMTcuMTMgOC4wOTAwMiAxNi45NSA4LjIyMDAyIDE2Ljg0TDkuNzAwMDIgMTUuNjhMOS42NTAwMSAxNUw5LjcwMDAyIDE0LjMxTDguMjIwMDIgMTMuMTZDOC4wOTAwMiAxMy4wNSA4LjA1MDAyIDEyLjg2IDguMTQwMDIgMTIuNzFMOS41NDAwMiAxMC4yOUM5LjYyMDAyIDEwLjEzIDkuODEwMDIgMTAuMDcgOS45NjAwMiAxMC4xM0wxMS43MSAxMC44NEMxMi4wNyAxMC41NiAxMi40NiAxMC4zMiAxMi44OSAxMC4xNUwxMy4xNSA4LjI4OTk4QzEzLjE4IDguMTI5OTggMTMuMzIgNy45OTk5OCAxMy41IDcuOTk5OThIMTYuM0MxNi40NyA3Ljk5OTk4IDE2LjYyIDguMTI5OTggMTYuNjQgOC4yODk5OEwxNi45MSAxMC4xNUMxNy4zMyAxMC4zMiAxNy43MyAxMC41NiAxOC4wOSAxMC44NEwxOS44MyAxMC4xM0MyMCAxMC4wNyAyMC4xNyAxMC4xMyAyMC4yNiAxMC4yOUwyMS42NiAxMi43MUMyMS43NSAxMi44NiAyMS43MSAxMy4wNSAyMS41OCAxMy4xNkwyMC4xIDE0LjMxTDIwLjE1IDE1TDIwLjEgMTUuNjhaIi8+CiAgICA8cGF0aCBkPSJNNy4zMjk2NiA3LjQ0NDU0QzguMDgzMSA3LjAwOTU0IDguMzM5MzIgNi4wNTMzMiA3LjkwNDMyIDUuMjk5ODhDNy40NjkzMiA0LjU0NjQzIDYuNTA4MSA0LjI4MTU2IDUuNzU0NjYgNC43MTY1NkM1LjM5MTc2IDQuOTI2MDggNS4xMjY5NSA1LjI3MTE4IDUuMDE4NDkgNS42NzU5NEM0LjkxMDA0IDYuMDgwNzEgNC45NjY4MiA2LjUxMTk4IDUuMTc2MzQgNi44NzQ4OEM1LjYxMTM0IDcuNjI4MzIgNi41NzYyMiA3Ljg3OTU0IDcuMzI5NjYgNy40NDQ1NFpNOS42NTcxOCA0Ljc5NTkzTDEwLjg2NzIgNC45NTE3OUMxMC45NjI4IDQuOTc3NDEgMTEuMDQwMiA1LjA3MTMzIDExLjAzODIgNS4xODc5M0wxMS4wMzg4IDYuOTg4OTNDMTEuMDQ1NSA3LjEwMDU0IDEwLjk2MTYgNy4xOTUxOCAxMC44NTUgNy4yMTA1NEw5LjY2MDAxIDcuMzgwODNMOS4yMzkxNSA4LjEzMTg4TDkuNjY5NjEgOS4yNTc0NUM5LjcwNzI5IDkuMzYyNzEgOS42NjkzNCA5LjQ3Njk5IDkuNTc0MDggOS41MzE5OUw4LjAxNTIzIDEwLjQzMkM3LjkxMTMxIDEwLjQ5MiA3Ljc5MzM3IDEwLjQ2NzcgNy43MjEwNSAxMC4zODI0TDYuOTg3NDggOS40MzE4OEw2LjEwOTMxIDkuNDMwODNMNS4zNDcwNCAxMC4zOTA1QzUuMjg5MDkgMTAuNDcwMiA1LjE3MzgzIDEwLjQ5MDUgNS4wNzE4NyAxMC40MzM5TDMuNTEyNDUgOS41MzI5M0MzLjQxMDQ5IDkuNDc2MzMgMy4zNzY0NyA5LjM1NzQxIDMuNDEwNzUgOS4yNTY3OUwzLjg2MzQ3IDguMTQwOTNMMy42MTc0OSA3Ljc3NDg4TDMuNDIzNDcgNy4zNzg4M0wyLjIzMDc1IDcuMjEyOTdDMi4xMjY0NyA3LjE5MjM1IDIuMDQwNDkgNy4xMDM0MiAyLjA0MjQ1IDYuOTg2ODJMMi4wNDE4NyA1LjE4NTgyQzIuMDQzODMgNS4wNjkyMiAyLjExOTA5IDQuOTc5NTggMi4yMTcwNCA0Ljk2OTIyTDMuNDIwNjUgNC43OTM5M0wzLjg2NzQ5IDQuMDI3ODhMMy40MTEwNSAyLjkxNzMxQzMuMzczMzcgMi44MTIwNCAzLjQxMTMxIDIuNjk3NzYgMy41MTUyMyAyLjYzNzc2TDUuMDc0MDggMS43Mzc3NkM1LjE2OTM0IDEuNjgyNzYgNS4yODcyOSAxLjcwNzA0IDUuMzU5NjEgMS43OTIzMUw2LjExOTE1IDIuNzI3ODhMNi45ODAwMSAyLjczODkzTDcuNzI0OTYgMS43ODkyMkM3Ljc5MTU2IDEuNzA0NTggNy45MTU0OCAxLjY3OTIyIDguMDA4NzkgMS43NDA4Mkw5LjU2ODIxIDIuNjQxODJDOS42NzAxNyAyLjY5ODQyIDkuNzEyODUgMi44MTIzNCA5LjY4NzIzIDIuOTA3OTdMOS4yMTcxOCA0LjAzMzgzTDkuNDYzMTYgNC4zOTk4OEw5LjY1NzE4IDQuNzk1OTNaIi8+CiAgPC9nPgo8L3N2Zz4K);
  --jp-icon-caret-down-empty-thin: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDIwIDIwIj4KCTxnIGNsYXNzPSJqcC1pY29uMyIgZmlsbD0iIzYxNjE2MSIgc2hhcGUtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iPgoJCTxwb2x5Z29uIGNsYXNzPSJzdDEiIHBvaW50cz0iOS45LDEzLjYgMy42LDcuNCA0LjQsNi42IDkuOSwxMi4yIDE1LjQsNi43IDE2LjEsNy40ICIvPgoJPC9nPgo8L3N2Zz4K);
  --jp-icon-caret-down-empty: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDE4IDE4Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiIHNoYXBlLXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIj4KICAgIDxwYXRoIGQ9Ik01LjIsNS45TDksOS43bDMuOC0zLjhsMS4yLDEuMmwtNC45LDVsLTQuOS01TDUuMiw1Ljl6Ii8+CiAgPC9nPgo8L3N2Zz4K);
  --jp-icon-caret-down: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDE4IDE4Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiIHNoYXBlLXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIj4KICAgIDxwYXRoIGQ9Ik01LjIsNy41TDksMTEuMmwzLjgtMy44SDUuMnoiLz4KICA8L2c+Cjwvc3ZnPgo=);
  --jp-icon-caret-left: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDE4IDE4Ij4KCTxnIGNsYXNzPSJqcC1pY29uMyIgZmlsbD0iIzYxNjE2MSIgc2hhcGUtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iPgoJCTxwYXRoIGQ9Ik0xMC44LDEyLjhMNy4xLDlsMy44LTMuOGwwLDcuNkgxMC44eiIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-caret-right: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDE4IDE4Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiIHNoYXBlLXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIj4KICAgIDxwYXRoIGQ9Ik03LjIsNS4yTDEwLjksOWwtMy44LDMuOFY1LjJINy4yeiIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-caret-up-empty-thin: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDIwIDIwIj4KCTxnIGNsYXNzPSJqcC1pY29uMyIgZmlsbD0iIzYxNjE2MSIgc2hhcGUtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iPgoJCTxwb2x5Z29uIGNsYXNzPSJzdDEiIHBvaW50cz0iMTUuNCwxMy4zIDkuOSw3LjcgNC40LDEzLjIgMy42LDEyLjUgOS45LDYuMyAxNi4xLDEyLjYgIi8+Cgk8L2c+Cjwvc3ZnPgo=);
  --jp-icon-caret-up: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDE4IDE4Ij4KCTxnIGNsYXNzPSJqcC1pY29uMyIgZmlsbD0iIzYxNjE2MSIgc2hhcGUtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iPgoJCTxwYXRoIGQ9Ik01LjIsMTAuNUw5LDYuOGwzLjgsMy44SDUuMnoiLz4KICA8L2c+Cjwvc3ZnPgo=);
  --jp-icon-case-sensitive: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDIwIDIwIj4KICA8ZyBjbGFzcz0ianAtaWNvbjIiIGZpbGw9IiM0MTQxNDEiPgogICAgPHJlY3QgeD0iMiIgeT0iMiIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2Ii8+CiAgPC9nPgogIDxnIGNsYXNzPSJqcC1pY29uLWFjY2VudDIiIGZpbGw9IiNGRkYiPgogICAgPHBhdGggZD0iTTcuNiw4aDAuOWwzLjUsOGgtMS4xTDEwLDE0SDZsLTAuOSwySDRMNy42LDh6IE04LDkuMUw2LjQsMTNoMy4yTDgsOS4xeiIvPgogICAgPHBhdGggZD0iTTE2LjYsOS44Yy0wLjIsMC4xLTAuNCwwLjEtMC43LDAuMWMtMC4yLDAtMC40LTAuMS0wLjYtMC4yYy0wLjEtMC4xLTAuMi0wLjQtMC4yLTAuNyBjLTAuMywwLjMtMC42LDAuNS0wLjksMC43Yy0wLjMsMC4xLTAuNywwLjItMS4xLDAuMmMtMC4zLDAtMC41LDAtMC43LTAuMWMtMC4yLTAuMS0wLjQtMC4yLTAuNi0wLjNjLTAuMi0wLjEtMC4zLTAuMy0wLjQtMC41IGMtMC4xLTAuMi0wLjEtMC40LTAuMS0wLjdjMC0wLjMsMC4xLTAuNiwwLjItMC44YzAuMS0wLjIsMC4zLTAuNCwwLjQtMC41QzEyLDcsMTIuMiw2LjksMTIuNSw2LjhjMC4yLTAuMSwwLjUtMC4xLDAuNy0wLjIgYzAuMy0wLjEsMC41LTAuMSwwLjctMC4xYzAuMiwwLDAuNC0wLjEsMC42LTAuMWMwLjIsMCwwLjMtMC4xLDAuNC0wLjJjMC4xLTAuMSwwLjItMC4yLDAuMi0wLjRjMC0xLTEuMS0xLTEuMy0xIGMtMC40LDAtMS40LDAtMS40LDEuMmgtMC45YzAtMC40LDAuMS0wLjcsMC4yLTFjMC4xLTAuMiwwLjMtMC40LDAuNS0wLjZjMC4yLTAuMiwwLjUtMC4zLDAuOC0wLjNDMTMuMyw0LDEzLjYsNCwxMy45LDQgYzAuMywwLDAuNSwwLDAuOCwwLjFjMC4zLDAsMC41LDAuMSwwLjcsMC4yYzAuMiwwLjEsMC40LDAuMywwLjUsMC41QzE2LDUsMTYsNS4yLDE2LDUuNnYyLjljMCwwLjIsMCwwLjQsMCwwLjUgYzAsMC4xLDAuMSwwLjIsMC4zLDAuMmMwLjEsMCwwLjIsMCwwLjMsMFY5Ljh6IE0xNS4yLDYuOWMtMS4yLDAuNi0zLjEsMC4yLTMuMSwxLjRjMCwxLjQsMy4xLDEsMy4xLTAuNVY2Ljl6Ii8+CiAgPC9nPgo8L3N2Zz4K);
  --jp-icon-check: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjMganAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjNjE2MTYxIj4KICAgIDxwYXRoIGQ9Ik05IDE2LjE3TDQuODMgMTJsLTEuNDIgMS40MUw5IDE5IDIxIDdsLTEuNDEtMS40MXoiLz4KICA8L2c+Cjwvc3ZnPgo=);
  --jp-icon-circle-empty: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTTEyIDJDNi40NyAyIDIgNi40NyAyIDEyczQuNDcgMTAgMTAgMTAgMTAtNC40NyAxMC0xMFMxNy41MyAyIDEyIDJ6bTAgMThjLTQuNDEgMC04LTMuNTktOC04czMuNTktOCA4LTggOCAzLjU5IDggOC0zLjU5IDgtOCA4eiIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-circle: url(data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMTggMTgiIHdpZHRoPSIxNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPGNpcmNsZSBjeD0iOSIgY3k9IjkiIHI9IjgiLz4KICA8L2c+Cjwvc3ZnPgo=);
  --jp-icon-clear: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8bWFzayBpZD0iZG9udXRIb2xlIj4KICAgIDxyZWN0IHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgZmlsbD0id2hpdGUiIC8+CiAgICA8Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSI4IiBmaWxsPSJibGFjayIvPgogIDwvbWFzaz4KCiAgPGcgY2xhc3M9ImpwLWljb24zIiBmaWxsPSIjNjE2MTYxIj4KICAgIDxyZWN0IGhlaWdodD0iMTgiIHdpZHRoPSIyIiB4PSIxMSIgeT0iMyIgdHJhbnNmb3JtPSJyb3RhdGUoMzE1LCAxMiwgMTIpIi8+CiAgICA8Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIxMCIgbWFzaz0idXJsKCNkb251dEhvbGUpIi8+CiAgPC9nPgo8L3N2Zz4K);
  --jp-icon-close: url(data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIxNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZyBjbGFzcz0ianAtaWNvbi1ub25lIGpwLWljb24tc2VsZWN0YWJsZS1pbnZlcnNlIGpwLWljb24zLWhvdmVyIiBmaWxsPSJub25lIj4KICAgIDxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjExIi8+CiAgPC9nPgoKICA8ZyBjbGFzcz0ianAtaWNvbjMganAtaWNvbi1zZWxlY3RhYmxlIGpwLWljb24tYWNjZW50Mi1ob3ZlciIgZmlsbD0iIzYxNjE2MSI+CiAgICA8cGF0aCBkPSJNMTkgNi40MUwxNy41OSA1IDEyIDEwLjU5IDYuNDEgNSA1IDYuNDEgMTAuNTkgMTIgNSAxNy41OSA2LjQxIDE5IDEyIDEzLjQxIDE3LjU5IDE5IDE5IDE3LjU5IDEzLjQxIDEyeiIvPgogIDwvZz4KCiAgPGcgY2xhc3M9ImpwLWljb24tbm9uZSBqcC1pY29uLWJ1c3kiIGZpbGw9Im5vbmUiPgogICAgPGNpcmNsZSBjeD0iMTIiIGN5PSIxMiIgcj0iNyIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-code-check: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjMganAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjNjE2MTYxIiBzaGFwZS1yZW5kZXJpbmc9Imdlb21ldHJpY1ByZWNpc2lvbiI+CiAgICA8cGF0aCBkPSJNNi41OSwzLjQxTDIsOEw2LjU5LDEyLjZMOCwxMS4xOEw0LjgyLDhMOCw0LjgyTDYuNTksMy40MU0xMi40MSwzLjQxTDExLDQuODJMMTQuMTgsOEwxMSwxMS4xOEwxMi40MSwxMi42TDE3LDhMMTIuNDEsMy40MU0yMS41OSwxMS41OUwxMy41LDE5LjY4TDkuODMsMTZMOC40MiwxNy40MUwxMy41LDIyLjVMMjMsMTNMMjEuNTksMTEuNTlaIiAvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-code: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjIiIGhlaWdodD0iMjIiIHZpZXdCb3g9IjAgMCAyOCAyOCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KCTxnIGNsYXNzPSJqcC1pY29uMyIgZmlsbD0iIzYxNjE2MSI+CgkJPHBhdGggZD0iTTExLjQgMTguNkw2LjggMTRMMTEuNCA5LjRMMTAgOEw0IDE0TDEwIDIwTDExLjQgMTguNlpNMTYuNiAxOC42TDIxLjIgMTRMMTYuNiA5LjRMMTggOEwyNCAxNEwxOCAyMEwxNi42IDE4LjZWMTguNloiLz4KCTwvZz4KPC9zdmc+Cg==);
  --jp-icon-collapse-all: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICAgIDxnIGNsYXNzPSJqcC1pY29uMyIgZmlsbD0iIzYxNjE2MSI+CiAgICAgICAgPHBhdGgKICAgICAgICAgICAgZD0iTTggMmMxIDAgMTEgMCAxMiAwczIgMSAyIDJjMCAxIDAgMTEgMCAxMnMwIDItMiAyQzIwIDE0IDIwIDQgMjAgNFMxMCA0IDYgNGMwLTIgMS0yIDItMnoiIC8+CiAgICAgICAgPHBhdGgKICAgICAgICAgICAgZD0iTTE4IDhjMC0xLTEtMi0yLTJTNSA2IDQgNnMtMiAxLTIgMmMwIDEgMCAxMSAwIDEyczEgMiAyIDJjMSAwIDExIDAgMTIgMHMyLTEgMi0yYzAtMSAwLTExIDAtMTJ6bS0yIDB2MTJINFY4eiIgLz4KICAgICAgICA8cGF0aCBkPSJNNiAxM3YyaDh2LTJ6IiAvPgogICAgPC9nPgo8L3N2Zz4K);
  --jp-icon-console: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDIwMCAyMDAiPgogIDxnIGNsYXNzPSJqcC1jb25zb2xlLWljb24tYmFja2dyb3VuZC1jb2xvciBqcC1pY29uLXNlbGVjdGFibGUiIGZpbGw9IiMwMjg4RDEiPgogICAgPHBhdGggZD0iTTIwIDE5LjhoMTYwdjE1OS45SDIweiIvPgogIDwvZz4KICA8ZyBjbGFzcz0ianAtY29uc29sZS1pY29uLWNvbG9yIGpwLWljb24tc2VsZWN0YWJsZS1pbnZlcnNlIiBmaWxsPSIjZmZmIj4KICAgIDxwYXRoIGQ9Ik0xMDUgMTI3LjNoNDB2MTIuOGgtNDB6TTUxLjEgNzdMNzQgOTkuOWwtMjMuMyAyMy4zIDEwLjUgMTAuNSAyMy4zLTIzLjNMOTUgOTkuOSA4NC41IDg5LjQgNjEuNiA2Ni41eiIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-copy: url(data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMTggMTgiIHdpZHRoPSIxNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTTExLjksMUgzLjJDMi40LDEsMS43LDEuNywxLjcsMi41djEwLjJoMS41VjIuNWg4LjdWMXogTTE0LjEsMy45aC04Yy0wLjgsMC0xLjUsMC43LTEuNSwxLjV2MTAuMmMwLDAuOCwwLjcsMS41LDEuNSwxLjVoOCBjMC44LDAsMS41LTAuNywxLjUtMS41VjUuNEMxNS41LDQuNiwxNC45LDMuOSwxNC4xLDMuOXogTTE0LjEsMTUuNWgtOFY1LjRoOFYxNS41eiIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-copyright: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDI0IDI0IiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCI+CiAgPGcgY2xhc3M9ImpwLWljb24zIiBmaWxsPSIjNjE2MTYxIj4KICAgIDxwYXRoIGQ9Ik0xMS44OCw5LjE0YzEuMjgsMC4wNiwxLjYxLDEuMTUsMS42MywxLjY2aDEuNzljLTAuMDgtMS45OC0xLjQ5LTMuMTktMy40NS0zLjE5QzkuNjQsNy42MSw4LDksOCwxMi4xNCBjMCwxLjk0LDAuOTMsNC4yNCwzLjg0LDQuMjRjMi4yMiwwLDMuNDEtMS42NSwzLjQ0LTIuOTVoLTEuNzljLTAuMDMsMC41OS0wLjQ1LDEuMzgtMS42MywxLjQ0QzEwLjU1LDE0LjgzLDEwLDEzLjgxLDEwLDEyLjE0IEMxMCw5LjI1LDExLjI4LDkuMTYsMTEuODgsOS4xNHogTTEyLDJDNi40OCwyLDIsNi40OCwyLDEyczQuNDgsMTAsMTAsMTBzMTAtNC40OCwxMC0xMFMxNy41MiwyLDEyLDJ6IE0xMiwyMGMtNC40MSwwLTgtMy41OS04LTggczMuNTktOCw4LThzOCwzLjU5LDgsOFMxNi40MSwyMCwxMiwyMHoiLz4KICA8L2c+Cjwvc3ZnPgo=);
  --jp-icon-cut: url(data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIxNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTTkuNjQgNy42NGMuMjMtLjUuMzYtMS4wNS4zNi0xLjY0IDAtMi4yMS0xLjc5LTQtNC00UzIgMy43OSAyIDZzMS43OSA0IDQgNGMuNTkgMCAxLjE0LS4xMyAxLjY0LS4zNkwxMCAxMmwtMi4zNiAyLjM2QzcuMTQgMTQuMTMgNi41OSAxNCA2IDE0Yy0yLjIxIDAtNCAxLjc5LTQgNHMxLjc5IDQgNCA0IDQtMS43OSA0LTRjMC0uNTktLjEzLTEuMTQtLjM2LTEuNjRMMTIgMTRsNyA3aDN2LTFMOS42NCA3LjY0ek02IDhjLTEuMSAwLTItLjg5LTItMnMuOS0yIDItMiAyIC44OSAyIDItLjkgMi0yIDJ6bTAgMTJjLTEuMSAwLTItLjg5LTItMnMuOS0yIDItMiAyIC44OSAyIDItLjkgMi0yIDJ6bTYtNy41Yy0uMjggMC0uNS0uMjItLjUtLjVzLjIyLS41LjUtLjUuNS4yMi41LjUtLjIyLjUtLjUuNXpNMTkgM2wtNiA2IDIgMiA3LTdWM3oiLz4KICA8L2c+Cjwvc3ZnPgo=);
  --jp-icon-delete: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjE2cHgiIGhlaWdodD0iMTZweCI+CiAgICA8cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIiAvPgogICAgPHBhdGggY2xhc3M9ImpwLWljb24zIiBmaWxsPSIjNjI2MjYyIiBkPSJNNiAxOWMwIDEuMS45IDIgMiAyaDhjMS4xIDAgMi0uOSAyLTJWN0g2djEyek0xOSA0aC0zLjVsLTEtMWgtNWwtMSAxSDV2MmgxNFY0eiIgLz4KPC9zdmc+Cg==);
  --jp-icon-download: url(data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIxNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTTE5IDloLTRWM0g5djZINWw3IDcgNy03ek01IDE4djJoMTR2LTJINXoiLz4KICA8L2c+Cjwvc3ZnPgo=);
  --jp-icon-duplicate: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAxNCAxNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggY2xhc3M9ImpwLWljb24zIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTIuNzk5OTggMC44NzVIOC44OTU4MkM5LjIwMDYxIDAuODc1IDkuNDQ5OTggMS4xMzkxNCA5LjQ0OTk4IDEuNDYxOThDOS40NDk5OCAxLjc4NDgyIDkuMjAwNjEgMi4wNDg5NiA4Ljg5NTgyIDIuMDQ4OTZIMy4zNTQxNUMzLjA0OTM2IDIuMDQ4OTYgMi43OTk5OCAyLjMxMzEgMi43OTk5OCAyLjYzNTk0VjkuNjc5NjlDMi43OTk5OCAxMC4wMDI1IDIuNTUwNjEgMTAuMjY2NyAyLjI0NTgyIDEwLjI2NjdDMS45NDEwMyAxMC4yNjY3IDEuNjkxNjUgMTAuMDAyNSAxLjY5MTY1IDkuNjc5NjlWMi4wNDg5NkMxLjY5MTY1IDEuNDAzMjggMi4xOTA0IDAuODc1IDIuNzk5OTggMC44NzVaTTUuMzY2NjUgMTEuOVY0LjU1SDExLjA4MzNWMTEuOUg1LjM2NjY1Wk00LjE0MTY1IDQuMTQxNjdDNC4xNDE2NSAzLjY5MDYzIDQuNTA3MjggMy4zMjUgNC45NTgzMiAzLjMyNUgxMS40OTE3QzExLjk0MjcgMy4zMjUgMTIuMzA4MyAzLjY5MDYzIDEyLjMwODMgNC4xNDE2N1YxMi4zMDgzQzEyLjMwODMgMTIuNzU5NCAxMS45NDI3IDEzLjEyNSAxMS40OTE3IDEzLjEyNUg0Ljk1ODMyQzQuNTA3MjggMTMuMTI1IDQuMTQxNjUgMTIuNzU5NCA0LjE0MTY1IDEyLjMwODNWNC4xNDE2N1oiIGZpbGw9IiM2MTYxNjEiLz4KPHBhdGggY2xhc3M9ImpwLWljb24zIiBkPSJNOS40MzU3NCA4LjI2NTA3SDguMzY0MzFWOS4zMzY1QzguMzY0MzEgOS40NTQzNSA4LjI2Nzg4IDkuNTUwNzggOC4xNTAwMiA5LjU1MDc4QzguMDMyMTcgOS41NTA3OCA3LjkzNTc0IDkuNDU0MzUgNy45MzU3NCA5LjMzNjVWOC4yNjUwN0g2Ljg2NDMxQzYuNzQ2NDUgOC4yNjUwNyA2LjY1MDAyIDguMTY4NjQgNi42NTAwMiA4LjA1MDc4QzYuNjUwMDIgNy45MzI5MiA2Ljc0NjQ1IDcuODM2NSA2Ljg2NDMxIDcuODM2NUg3LjkzNTc0VjYuNzY1MDdDNy45MzU3NCA2LjY0NzIxIDguMDMyMTcgNi41NTA3OCA4LjE1MDAyIDYuNTUwNzhDOC4yNjc4OCA2LjU1MDc4IDguMzY0MzEgNi42NDcyMSA4LjM2NDMxIDYuNzY1MDdWNy44MzY1SDkuNDM1NzRDOS41NTM2IDcuODM2NSA5LjY1MDAyIDcuOTMyOTIgOS42NTAwMiA4LjA1MDc4QzkuNjUwMDIgOC4xNjg2NCA5LjU1MzYgOC4yNjUwNyA5LjQzNTc0IDguMjY1MDdaIiBmaWxsPSIjNjE2MTYxIiBzdHJva2U9IiM2MTYxNjEiIHN0cm9rZS13aWR0aD0iMC41Ii8+Cjwvc3ZnPgo=);
  --jp-icon-edit: url(data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIxNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTTMgMTcuMjVWMjFoMy43NUwxNy44MSA5Ljk0bC0zLjc1LTMuNzVMMyAxNy4yNXpNMjAuNzEgNy4wNGMuMzktLjM5LjM5LTEuMDIgMC0xLjQxbC0yLjM0LTIuMzRjLS4zOS0uMzktMS4wMi0uMzktMS40MSAwbC0xLjgzIDEuODMgMy43NSAzLjc1IDEuODMtMS44M3oiLz4KICA8L2c+Cjwvc3ZnPgo=);
  --jp-icon-ellipses: url(data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIxNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPGNpcmNsZSBjeD0iNSIgY3k9IjEyIiByPSIyIi8+CiAgICA8Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIyIi8+CiAgICA8Y2lyY2xlIGN4PSIxOSIgY3k9IjEyIiByPSIyIi8+CiAgPC9nPgo8L3N2Zz4K);
  --jp-icon-error: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KPGcgY2xhc3M9ImpwLWljb24zIiBmaWxsPSIjNjE2MTYxIj48Y2lyY2xlIGN4PSIxMiIgY3k9IjE5IiByPSIyIi8+PHBhdGggZD0iTTEwIDNoNHYxMmgtNHoiLz48L2c+CjxwYXRoIGZpbGw9Im5vbmUiIGQ9Ik0wIDBoMjR2MjRIMHoiLz4KPC9zdmc+Cg==);
  --jp-icon-expand-all: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICAgIDxnIGNsYXNzPSJqcC1pY29uMyIgZmlsbD0iIzYxNjE2MSI+CiAgICAgICAgPHBhdGgKICAgICAgICAgICAgZD0iTTggMmMxIDAgMTEgMCAxMiAwczIgMSAyIDJjMCAxIDAgMTEgMCAxMnMwIDItMiAyQzIwIDE0IDIwIDQgMjAgNFMxMCA0IDYgNGMwLTIgMS0yIDItMnoiIC8+CiAgICAgICAgPHBhdGgKICAgICAgICAgICAgZD0iTTE4IDhjMC0xLTEtMi0yLTJTNSA2IDQgNnMtMiAxLTIgMmMwIDEgMCAxMSAwIDEyczEgMiAyIDJjMSAwIDExIDAgMTIgMHMyLTEgMi0yYzAtMSAwLTExIDAtMTJ6bS0yIDB2MTJINFY4eiIgLz4KICAgICAgICA8cGF0aCBkPSJNMTEgMTBIOXYzSDZ2MmgzdjNoMnYtM2gzdi0yaC0zeiIgLz4KICAgIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-extension: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTTIwLjUgMTFIMTlWN2MwLTEuMS0uOS0yLTItMmgtNFYzLjVDMTMgMi4xMiAxMS44OCAxIDEwLjUgMVM4IDIuMTIgOCAzLjVWNUg0Yy0xLjEgMC0xLjk5LjktMS45OSAydjMuOEgzLjVjMS40OSAwIDIuNyAxLjIxIDIuNyAyLjdzLTEuMjEgMi43LTIuNyAyLjdIMlYyMGMwIDEuMS45IDIgMiAyaDMuOHYtMS41YzAtMS40OSAxLjIxLTIuNyAyLjctMi43IDEuNDkgMCAyLjcgMS4yMSAyLjcgMi43VjIySDE3YzEuMSAwIDItLjkgMi0ydi00aDEuNWMxLjM4IDAgMi41LTEuMTIgMi41LTIuNVMyMS44OCAxMSAyMC41IDExeiIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-fast-forward: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICAgIDxnIGNsYXNzPSJqcC1pY29uMyIgZmlsbD0iIzYxNjE2MSI+CiAgICAgICAgPHBhdGggZD0iTTQgMThsOC41LTZMNCA2djEyem05LTEydjEybDguNS02TDEzIDZ6Ii8+CiAgICA8L2c+Cjwvc3ZnPgo=);
  --jp-icon-file-upload: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTTkgMTZoNnYtNmg0bC03LTctNyA3aDR6bS00IDJoMTR2Mkg1eiIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-file: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDIyIDIyIj4KICA8cGF0aCBjbGFzcz0ianAtaWNvbjMganAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjNjE2MTYxIiBkPSJNMTkuMyA4LjJsLTUuNS01LjVjLS4zLS4zLS43LS41LTEuMi0uNUgzLjljLS44LjEtMS42LjktMS42IDEuOHYxNC4xYzAgLjkuNyAxLjYgMS42IDEuNmgxNC4yYy45IDAgMS42LS43IDEuNi0xLjZWOS40Yy4xLS41LS4xLS45LS40LTEuMnptLTUuOC0zLjNsMy40IDMuNmgtMy40VjQuOXptMy45IDEyLjdINC43Yy0uMSAwLS4yIDAtLjItLjJWNC43YzAtLjIuMS0uMy4yLS4zaDcuMnY0LjRzMCAuOC4zIDEuMWMuMy4zIDEuMS4zIDEuMS4zaDQuM3Y3LjJzLS4xLjItLjIuMnoiLz4KPC9zdmc+Cg==);
  --jp-icon-filter-dot: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiNGRkYiPgogICAgPHBhdGggZD0iTTE0LDEyVjE5Ljg4QzE0LjA0LDIwLjE4IDEzLjk0LDIwLjUgMTMuNzEsMjAuNzFDMTMuMzIsMjEuMSAxMi42OSwyMS4xIDEyLjMsMjAuNzFMMTAuMjksMTguN0MxMC4wNiwxOC40NyA5Ljk2LDE4LjE2IDEwLDE3Ljg3VjEySDkuOTdMNC4yMSw0LjYyQzMuODcsNC4xOSAzLjk1LDMuNTYgNC4zOCwzLjIyQzQuNTcsMy4wOCA0Ljc4LDMgNSwzVjNIMTlWM0MxOS4yMiwzIDE5LjQzLDMuMDggMTkuNjIsMy4yMkMyMC4wNSwzLjU2IDIwLjEzLDQuMTkgMTkuNzksNC42MkwxNC4wMywxMkgxNFoiIC8+CiAgPC9nPgogIDxnIGNsYXNzPSJqcC1pY29uLWRvdCIgZmlsbD0iI0ZGRiI+CiAgICA8Y2lyY2xlIGN4PSIxOCIgY3k9IjE3IiByPSIzIj48L2NpcmNsZT4KICA8L2c+Cjwvc3ZnPgo=);
  --jp-icon-filter-list: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTTEwIDE4aDR2LTJoLTR2MnpNMyA2djJoMThWNkgzem0zIDdoMTJ2LTJINnYyeiIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-filter: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiNGRkYiPgogICAgPHBhdGggZD0iTTE0LDEyVjE5Ljg4QzE0LjA0LDIwLjE4IDEzLjk0LDIwLjUgMTMuNzEsMjAuNzFDMTMuMzIsMjEuMSAxMi42OSwyMS4xIDEyLjMsMjAuNzFMMTAuMjksMTguN0MxMC4wNiwxOC40NyA5Ljk2LDE4LjE2IDEwLDE3Ljg3VjEySDkuOTdMNC4yMSw0LjYyQzMuODcsNC4xOSAzLjk1LDMuNTYgNC4zOCwzLjIyQzQuNTcsMy4wOCA0Ljc4LDMgNSwzVjNIMTlWM0MxOS4yMiwzIDE5LjQzLDMuMDggMTkuNjIsMy4yMkMyMC4wNSwzLjU2IDIwLjEzLDQuMTkgMTkuNzksNC42MkwxNC4wMywxMkgxNFoiIC8+CiAgPC9nPgo8L3N2Zz4K);
  --jp-icon-folder-favorite: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjRweCIgdmlld0JveD0iMCAwIDI0IDI0IiB3aWR0aD0iMjRweCIgZmlsbD0iIzAwMDAwMCI+CiAgPHBhdGggZD0iTTAgMGgyNHYyNEgwVjB6IiBmaWxsPSJub25lIi8+PHBhdGggY2xhc3M9ImpwLWljb24zIGpwLWljb24tc2VsZWN0YWJsZSIgZmlsbD0iIzYxNjE2MSIgZD0iTTIwIDZoLThsLTItMkg0Yy0xLjEgMC0yIC45LTIgMnYxMmMwIDEuMS45IDIgMiAyaDE2YzEuMSAwIDItLjkgMi0yVjhjMC0xLjEtLjktMi0yLTJ6bS0yLjA2IDExTDE1IDE1LjI4IDEyLjA2IDE3bC43OC0zLjMzLTIuNTktMi4yNCAzLjQxLS4yOUwxNSA4bDEuMzQgMy4xNCAzLjQxLjI5LTIuNTkgMi4yNC43OCAzLjMzeiIvPgo8L3N2Zz4K);
  --jp-icon-folder: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8cGF0aCBjbGFzcz0ianAtaWNvbjMganAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjNjE2MTYxIiBkPSJNMTAgNEg0Yy0xLjEgMC0xLjk5LjktMS45OSAyTDIgMThjMCAxLjEuOSAyIDIgMmgxNmMxLjEgMCAyLS45IDItMlY4YzAtMS4xLS45LTItMi0yaC04bC0yLTJ6Ii8+Cjwvc3ZnPgo=);
  --jp-icon-home: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjRweCIgdmlld0JveD0iMCAwIDI0IDI0IiB3aWR0aD0iMjRweCIgZmlsbD0iIzAwMDAwMCI+CiAgPHBhdGggZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPjxwYXRoIGNsYXNzPSJqcC1pY29uMyBqcC1pY29uLXNlbGVjdGFibGUiIGZpbGw9IiM2MTYxNjEiIGQ9Ik0xMCAyMHYtNmg0djZoNXYtOGgzTDEyIDMgMiAxMmgzdjh6Ii8+Cjwvc3ZnPgo=);
  --jp-icon-html5: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDUxMiA1MTIiPgogIDxwYXRoIGNsYXNzPSJqcC1pY29uMCBqcC1pY29uLXNlbGVjdGFibGUiIGZpbGw9IiMwMDAiIGQ9Ik0xMDguNCAwaDIzdjIyLjhoMjEuMlYwaDIzdjY5aC0yM1Y0NmgtMjF2MjNoLTIzLjJNMjA2IDIzaC0yMC4zVjBoNjMuN3YyM0gyMjl2NDZoLTIzbTUzLjUtNjloMjQuMWwxNC44IDI0LjNMMzEzLjIgMGgyNC4xdjY5aC0yM1YzNC44bC0xNi4xIDI0LjgtMTYuMS0yNC44VjY5aC0yMi42bTg5LjItNjloMjN2NDYuMmgzMi42VjY5aC01NS42Ii8+CiAgPHBhdGggY2xhc3M9ImpwLWljb24tc2VsZWN0YWJsZSIgZmlsbD0iI2U0NGQyNiIgZD0iTTEwNy42IDQ3MWwtMzMtMzcwLjRoMzYyLjhsLTMzIDM3MC4yTDI1NS43IDUxMiIvPgogIDxwYXRoIGNsYXNzPSJqcC1pY29uLXNlbGVjdGFibGUiIGZpbGw9IiNmMTY1MjkiIGQ9Ik0yNTYgNDgwLjVWMTMxaDE0OC4zTDM3NiA0NDciLz4KICA8cGF0aCBjbGFzcz0ianAtaWNvbi1zZWxlY3RhYmxlLWludmVyc2UiIGZpbGw9IiNlYmViZWIiIGQ9Ik0xNDIgMTc2LjNoMTE0djQ1LjRoLTY0LjJsNC4yIDQ2LjVoNjB2NDUuM0gxNTQuNG0yIDIyLjhIMjAybDMuMiAzNi4zIDUwLjggMTMuNnY0Ny40bC05My4yLTI2Ii8+CiAgPHBhdGggY2xhc3M9ImpwLWljb24tc2VsZWN0YWJsZS1pbnZlcnNlIiBmaWxsPSIjZmZmIiBkPSJNMzY5LjYgMTc2LjNIMjU1Ljh2NDUuNGgxMDkuNm0tNC4xIDQ2LjVIMjU1Ljh2NDUuNGg1NmwtNS4zIDU5LTUwLjcgMTMuNnY0Ny4ybDkzLTI1LjgiLz4KPC9zdmc+Cg==);
  --jp-icon-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDIyIDIyIj4KICA8cGF0aCBjbGFzcz0ianAtaWNvbi1icmFuZDQganAtaWNvbi1zZWxlY3RhYmxlLWludmVyc2UiIGZpbGw9IiNGRkYiIGQ9Ik0yLjIgMi4yaDE3LjV2MTcuNUgyLjJ6Ii8+CiAgPHBhdGggY2xhc3M9ImpwLWljb24tYnJhbmQwIGpwLWljb24tc2VsZWN0YWJsZSIgZmlsbD0iIzNGNTFCNSIgZD0iTTIuMiAyLjJ2MTcuNWgxNy41bC4xLTE3LjVIMi4yem0xMi4xIDIuMmMxLjIgMCAyLjIgMSAyLjIgMi4ycy0xIDIuMi0yLjIgMi4yLTIuMi0xLTIuMi0yLjIgMS0yLjIgMi4yLTIuMnpNNC40IDE3LjZsMy4zLTguOCAzLjMgNi42IDIuMi0zLjIgNC40IDUuNEg0LjR6Ii8+Cjwvc3ZnPgo=);
  --jp-icon-info: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDUwLjk3OCA1MC45NzgiPgoJPGcgY2xhc3M9ImpwLWljb24zIiBmaWxsPSIjNjE2MTYxIj4KCQk8cGF0aCBkPSJNNDMuNTIsNy40NThDMzguNzExLDIuNjQ4LDMyLjMwNywwLDI1LjQ4OSwwQzE4LjY3LDAsMTIuMjY2LDIuNjQ4LDcuNDU4LDcuNDU4CgkJCWMtOS45NDMsOS45NDEtOS45NDMsMjYuMTE5LDAsMzYuMDYyYzQuODA5LDQuODA5LDExLjIxMiw3LjQ1NiwxOC4wMzEsNy40NThjMCwwLDAuMDAxLDAsMC4wMDIsMAoJCQljNi44MTYsMCwxMy4yMjEtMi42NDgsMTguMDI5LTcuNDU4YzQuODA5LTQuODA5LDcuNDU3LTExLjIxMiw3LjQ1Ny0xOC4wM0M1MC45NzcsMTguNjcsNDguMzI4LDEyLjI2Niw0My41Miw3LjQ1OHoKCQkJIE00Mi4xMDYsNDIuMTA1Yy00LjQzMiw0LjQzMS0xMC4zMzIsNi44NzItMTYuNjE1LDYuODcyaC0wLjAwMmMtNi4yODUtMC4wMDEtMTIuMTg3LTIuNDQxLTE2LjYxNy02Ljg3MgoJCQljLTkuMTYyLTkuMTYzLTkuMTYyLTI0LjA3MSwwLTMzLjIzM0MxMy4zMDMsNC40NCwxOS4yMDQsMiwyNS40ODksMmM2LjI4NCwwLDEyLjE4NiwyLjQ0LDE2LjYxNyw2Ljg3MgoJCQljNC40MzEsNC40MzEsNi44NzEsMTAuMzMyLDYuODcxLDE2LjYxN0M0OC45NzcsMzEuNzcyLDQ2LjUzNiwzNy42NzUsNDIuMTA2LDQyLjEwNXoiLz4KCQk8cGF0aCBkPSJNMjMuNTc4LDMyLjIxOGMtMC4wMjMtMS43MzQsMC4xNDMtMy4wNTksMC40OTYtMy45NzJjMC4zNTMtMC45MTMsMS4xMS0xLjk5NywyLjI3Mi0zLjI1MwoJCQljMC40NjgtMC41MzYsMC45MjMtMS4wNjIsMS4zNjctMS41NzVjMC42MjYtMC43NTMsMS4xMDQtMS40NzgsMS40MzYtMi4xNzVjMC4zMzEtMC43MDcsMC40OTUtMS41NDEsMC40OTUtMi41CgkJCWMwLTEuMDk2LTAuMjYtMi4wODgtMC43NzktMi45NzljLTAuNTY1LTAuODc5LTEuNTAxLTEuMzM2LTIuODA2LTEuMzY5Yy0xLjgwMiwwLjA1Ny0yLjk4NSwwLjY2Ny0zLjU1LDEuODMyCgkJCWMtMC4zMDEsMC41MzUtMC41MDMsMS4xNDEtMC42MDcsMS44MTRjLTAuMTM5LDAuNzA3LTAuMjA3LDEuNDMyLTAuMjA3LDIuMTc0aC0yLjkzN2MtMC4wOTEtMi4yMDgsMC40MDctNC4xMTQsMS40OTMtNS43MTkKCQkJYzEuMDYyLTEuNjQsMi44NTUtMi40ODEsNS4zNzgtMi41MjdjMi4xNiwwLjAyMywzLjg3NCwwLjYwOCw1LjE0MSwxLjc1OGMxLjI3OCwxLjE2LDEuOTI5LDIuNzY0LDEuOTUsNC44MTEKCQkJYzAsMS4xNDItMC4xMzcsMi4xMTEtMC40MSwyLjkxMWMtMC4zMDksMC44NDUtMC43MzEsMS41OTMtMS4yNjgsMi4yNDNjLTAuNDkyLDAuNjUtMS4wNjgsMS4zMTgtMS43MywyLjAwMgoJCQljLTAuNjUsMC42OTctMS4zMTMsMS40NzktMS45ODcsMi4zNDZjLTAuMjM5LDAuMzc3LTAuNDI5LDAuNzc3LTAuNTY1LDEuMTk5Yy0wLjE2LDAuOTU5LTAuMjE3LDEuOTUxLTAuMTcxLDIuOTc5CgkJCUMyNi41ODksMzIuMjE4LDIzLjU3OCwzMi4yMTgsMjMuNTc4LDMyLjIxOHogTTIzLjU3OCwzOC4yMnYtMy40ODRoMy4wNzZ2My40ODRIMjMuNTc4eiIvPgoJPC9nPgo8L3N2Zz4K);
  --jp-icon-inspector: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8cGF0aCBjbGFzcz0ianAtaW5zcGVjdG9yLWljb24tY29sb3IganAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjNjE2MTYxIiBkPSJNMjAgNEg0Yy0xLjEgMC0xLjk5LjktMS45OSAyTDIgMThjMCAxLjEuOSAyIDIgMmgxNmMxLjEgMCAyLS45IDItMlY2YzAtMS4xLS45LTItMi0yem0tNSAxNEg0di00aDExdjR6bTAtNUg0VjloMTF2NHptNSA1aC00VjloNHY5eiIvPgo8L3N2Zz4K);
  --jp-icon-json: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDIyIDIyIj4KICA8ZyBjbGFzcz0ianAtanNvbi1pY29uLWNvbG9yIGpwLWljb24tc2VsZWN0YWJsZSIgZmlsbD0iI0Y5QTgyNSI+CiAgICA8cGF0aCBkPSJNMjAuMiAxMS44Yy0xLjYgMC0xLjcuNS0xLjcgMSAwIC40LjEuOS4xIDEuMy4xLjUuMS45LjEgMS4zIDAgMS43LTEuNCAyLjMtMy41IDIuM2gtLjl2LTEuOWguNWMxLjEgMCAxLjQgMCAxLjQtLjggMC0uMyAwLS42LS4xLTEgMC0uNC0uMS0uOC0uMS0xLjIgMC0xLjMgMC0xLjggMS4zLTItMS4zLS4yLTEuMy0uNy0xLjMtMiAwLS40LjEtLjguMS0xLjIuMS0uNC4xLS43LjEtMSAwLS44LS40LS43LTEuNC0uOGgtLjVWNC4xaC45YzIuMiAwIDMuNS43IDMuNSAyLjMgMCAuNC0uMS45LS4xIDEuMy0uMS41LS4xLjktLjEgMS4zIDAgLjUuMiAxIDEuNyAxdjEuOHpNMS44IDEwLjFjMS42IDAgMS43LS41IDEuNy0xIDAtLjQtLjEtLjktLjEtMS4zLS4xLS41LS4xLS45LS4xLTEuMyAwLTEuNiAxLjQtMi4zIDMuNS0yLjNoLjl2MS45aC0uNWMtMSAwLTEuNCAwLTEuNC44IDAgLjMgMCAuNi4xIDEgMCAuMi4xLjYuMSAxIDAgMS4zIDAgMS44LTEuMyAyQzYgMTEuMiA2IDExLjcgNiAxM2MwIC40LS4xLjgtLjEgMS4yLS4xLjMtLjEuNy0uMSAxIDAgLjguMy44IDEuNC44aC41djEuOWgtLjljLTIuMSAwLTMuNS0uNi0zLjUtMi4zIDAtLjQuMS0uOS4xLTEuMy4xLS41LjEtLjkuMS0xLjMgMC0uNS0uMi0xLTEuNy0xdi0xLjl6Ii8+CiAgICA8Y2lyY2xlIGN4PSIxMSIgY3k9IjEzLjgiIHI9IjIuMSIvPgogICAgPGNpcmNsZSBjeD0iMTEiIGN5PSI4LjIiIHI9IjIuMSIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-julia: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDMyNSAzMDAiPgogIDxnIGNsYXNzPSJqcC1icmFuZDAganAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjY2IzYzMzIj4KICAgIDxwYXRoIGQ9Ik0gMTUwLjg5ODQzOCAyMjUgQyAxNTAuODk4NDM4IDI2Ni40MjE4NzUgMTE3LjMyMDMxMiAzMDAgNzUuODk4NDM4IDMwMCBDIDM0LjQ3NjU2MiAzMDAgMC44OTg0MzggMjY2LjQyMTg3NSAwLjg5ODQzOCAyMjUgQyAwLjg5ODQzOCAxODMuNTc4MTI1IDM0LjQ3NjU2MiAxNTAgNzUuODk4NDM4IDE1MCBDIDExNy4zMjAzMTIgMTUwIDE1MC44OTg0MzggMTgzLjU3ODEyNSAxNTAuODk4NDM4IDIyNSIvPgogIDwvZz4KICA8ZyBjbGFzcz0ianAtYnJhbmQwIGpwLWljb24tc2VsZWN0YWJsZSIgZmlsbD0iIzM4OTgyNiI+CiAgICA8cGF0aCBkPSJNIDIzNy41IDc1IEMgMjM3LjUgMTE2LjQyMTg3NSAyMDMuOTIxODc1IDE1MCAxNjIuNSAxNTAgQyAxMjEuMDc4MTI1IDE1MCA4Ny41IDExNi40MjE4NzUgODcuNSA3NSBDIDg3LjUgMzMuNTc4MTI1IDEyMS4wNzgxMjUgMCAxNjIuNSAwIEMgMjAzLjkyMTg3NSAwIDIzNy41IDMzLjU3ODEyNSAyMzcuNSA3NSIvPgogIDwvZz4KICA8ZyBjbGFzcz0ianAtYnJhbmQwIGpwLWljb24tc2VsZWN0YWJsZSIgZmlsbD0iIzk1NThiMiI+CiAgICA8cGF0aCBkPSJNIDMyNC4xMDE1NjIgMjI1IEMgMzI0LjEwMTU2MiAyNjYuNDIxODc1IDI5MC41MjM0MzggMzAwIDI0OS4xMDE1NjIgMzAwIEMgMjA3LjY3OTY4OCAzMDAgMTc0LjEwMTU2MiAyNjYuNDIxODc1IDE3NC4xMDE1NjIgMjI1IEMgMTc0LjEwMTU2MiAxODMuNTc4MTI1IDIwNy42Nzk2ODggMTUwIDI0OS4xMDE1NjIgMTUwIEMgMjkwLjUyMzQzOCAxNTAgMzI0LjEwMTU2MiAxODMuNTc4MTI1IDMyNC4xMDE1NjIgMjI1Ii8+CiAgPC9nPgo8L3N2Zz4K);
  --jp-icon-jupyter-favicon: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUyIiBoZWlnaHQ9IjE2NSIgdmlld0JveD0iMCAwIDE1MiAxNjUiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgPGcgY2xhc3M9ImpwLWp1cHl0ZXItaWNvbi1jb2xvciIgZmlsbD0iI0YzNzcyNiI+CiAgICA8cGF0aCB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLjA3ODk0NywgMTEwLjU4MjkyNykiIGQ9Ik03NS45NDIyODQyLDI5LjU4MDQ1NjEgQzQzLjMwMjM5NDcsMjkuNTgwNDU2MSAxNC43OTY3ODMyLDE3LjY1MzQ2MzQgMCwwIEM1LjUxMDgzMjExLDE1Ljg0MDY4MjkgMTUuNzgxNTM4OSwyOS41NjY3NzMyIDI5LjM5MDQ5NDcsMzkuMjc4NDE3MSBDNDIuOTk5Nyw0OC45ODk4NTM3IDU5LjI3MzcsNTQuMjA2NzgwNSA3NS45NjA1Nzg5LDU0LjIwNjc4MDUgQzkyLjY0NzQ1NzksNTQuMjA2NzgwNSAxMDguOTIxNDU4LDQ4Ljk4OTg1MzcgMTIyLjUzMDY2MywzOS4yNzg0MTcxIEMxMzYuMTM5NDUzLDI5LjU2Njc3MzIgMTQ2LjQxMDI4NCwxNS44NDA2ODI5IDE1MS45MjExNTgsMCBDMTM3LjA4Nzg2OCwxNy42NTM0NjM0IDEwOC41ODI1ODksMjkuNTgwNDU2MSA3NS45NDIyODQyLDI5LjU4MDQ1NjEgTDc1Ljk0MjI4NDIsMjkuNTgwNDU2MSBaIiAvPgogICAgPHBhdGggdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMC4wMzczNjgsIDAuNzA0ODc4KSIgZD0iTTc1Ljk3ODQ1NzksMjQuNjI2NDA3MyBDMTA4LjYxODc2MywyNC42MjY0MDczIDEzNy4xMjQ0NTgsMzYuNTUzNDQxNSAxNTEuOTIxMTU4LDU0LjIwNjc4MDUgQzE0Ni40MTAyODQsMzguMzY2MjIyIDEzNi4xMzk0NTMsMjQuNjQwMTMxNyAxMjIuNTMwNjYzLDE0LjkyODQ4NzggQzEwOC45MjE0NTgsNS4yMTY4NDM5IDkyLjY0NzQ1NzksMCA3NS45NjA1Nzg5LDAgQzU5LjI3MzcsMCA0Mi45OTk3LDUuMjE2ODQzOSAyOS4zOTA0OTQ3LDE0LjkyODQ4NzggQzE1Ljc4MTUzODksMjQuNjQwMTMxNyA1LjUxMDgzMjExLDM4LjM2NjIyMiAwLDU0LjIwNjc4MDUgQzE0LjgzMzA4MTYsMzYuNTg5OTI5MyA0My4zMzg1Njg0LDI0LjYyNjQwNzMgNzUuOTc4NDU3OSwyNC42MjY0MDczIEw3NS45Nzg0NTc5LDI0LjYyNjQwNzMgWiIgLz4KICA8L2c+Cjwvc3ZnPgo=);
  --jp-icon-jupyter: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzkiIGhlaWdodD0iNTEiIHZpZXdCb3g9IjAgMCAzOSA1MSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTYzOCAtMjI4MSkiPgogICAgIDxnIGNsYXNzPSJqcC1qdXB5dGVyLWljb24tY29sb3IiIGZpbGw9IiNGMzc3MjYiPgogICAgICA8cGF0aCB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNjM5Ljc0IDIzMTEuOTgpIiBkPSJNIDE4LjI2NDYgNy4xMzQxMUMgMTAuNDE0NSA3LjEzNDExIDMuNTU4NzIgNC4yNTc2IDAgMEMgMS4zMjUzOSAzLjgyMDQgMy43OTU1NiA3LjEzMDgxIDcuMDY4NiA5LjQ3MzAzQyAxMC4zNDE3IDExLjgxNTIgMTQuMjU1NyAxMy4wNzM0IDE4LjI2OSAxMy4wNzM0QyAyMi4yODIzIDEzLjA3MzQgMjYuMTk2MyAxMS44MTUyIDI5LjQ2OTQgOS40NzMwM0MgMzIuNzQyNCA3LjEzMDgxIDM1LjIxMjYgMy44MjA0IDM2LjUzOCAwQyAzMi45NzA1IDQuMjU3NiAyNi4xMTQ4IDcuMTM0MTEgMTguMjY0NiA3LjEzNDExWiIvPgogICAgICA8cGF0aCB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNjM5LjczIDIyODUuNDgpIiBkPSJNIDE4LjI3MzMgNS45MzkzMUMgMjYuMTIzNSA1LjkzOTMxIDMyLjk3OTMgOC44MTU4MyAzNi41MzggMTMuMDczNEMgMzUuMjEyNiA5LjI1MzAzIDMyLjc0MjQgNS45NDI2MiAyOS40Njk0IDMuNjAwNEMgMjYuMTk2MyAxLjI1ODE4IDIyLjI4MjMgMCAxOC4yNjkgMEMgMTQuMjU1NyAwIDEwLjM0MTcgMS4yNTgxOCA3LjA2ODYgMy42MDA0QyAzLjc5NTU2IDUuOTQyNjIgMS4zMjUzOSA5LjI1MzAzIDAgMTMuMDczNEMgMy41Njc0NSA4LjgyNDYzIDEwLjQyMzIgNS45MzkzMSAxOC4yNzMzIDUuOTM5MzFaIi8+CiAgICA8L2c+CiAgICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgICA8cGF0aCB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNjY5LjMgMjI4MS4zMSkiIGQ9Ik0gNS44OTM1MyAyLjg0NEMgNS45MTg4OSAzLjQzMTY1IDUuNzcwODUgNC4wMTM2NyA1LjQ2ODE1IDQuNTE2NDVDIDUuMTY1NDUgNS4wMTkyMiA0LjcyMTY4IDUuNDIwMTUgNC4xOTI5OSA1LjY2ODUxQyAzLjY2NDMgNS45MTY4OCAzLjA3NDQ0IDYuMDAxNTEgMi40OTgwNSA1LjkxMTcxQyAxLjkyMTY2IDUuODIxOSAxLjM4NDYzIDUuNTYxNyAwLjk1NDg5OCA1LjE2NDAxQyAwLjUyNTE3IDQuNzY2MzMgMC4yMjIwNTYgNC4yNDkwMyAwLjA4MzkwMzcgMy42Nzc1N0MgLTAuMDU0MjQ4MyAzLjEwNjExIC0wLjAyMTIzIDIuNTA2MTcgMC4xNzg3ODEgMS45NTM2NEMgMC4zNzg3OTMgMS40MDExIDAuNzM2ODA5IDAuOTIwODE3IDEuMjA3NTQgMC41NzM1MzhDIDEuNjc4MjYgMC4yMjYyNTkgMi4yNDA1NSAwLjAyNzU5MTkgMi44MjMyNiAwLjAwMjY3MjI5QyAzLjYwMzg5IC0wLjAzMDcxMTUgNC4zNjU3MyAwLjI0OTc4OSA0Ljk0MTQyIDAuNzgyNTUxQyA1LjUxNzExIDEuMzE1MzEgNS44NTk1NiAyLjA1Njc2IDUuODkzNTMgMi44NDRaIi8+CiAgICAgIDxwYXRoIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE2MzkuOCAyMzIzLjgxKSIgZD0iTSA3LjQyNzg5IDMuNTgzMzhDIDcuNDYwMDggNC4zMjQzIDcuMjczNTUgNS4wNTgxOSA2Ljg5MTkzIDUuNjkyMTNDIDYuNTEwMzEgNi4zMjYwNyA1Ljk1MDc1IDYuODMxNTYgNS4yODQxMSA3LjE0NDZDIDQuNjE3NDcgNy40NTc2MyAzLjg3MzcxIDcuNTY0MTQgMy4xNDcwMiA3LjQ1MDYzQyAyLjQyMDMyIDcuMzM3MTIgMS43NDMzNiA3LjAwODcgMS4yMDE4NCA2LjUwNjk1QyAwLjY2MDMyOCA2LjAwNTIgMC4yNzg2MSA1LjM1MjY4IDAuMTA1MDE3IDQuNjMyMDJDIC0wLjA2ODU3NTcgMy45MTEzNSAtMC4wMjYyMzYxIDMuMTU0OTQgMC4yMjY2NzUgMi40NTg1NkMgMC40Nzk1ODcgMS43NjIxNyAwLjkzMTY5NyAxLjE1NzEzIDEuNTI1NzYgMC43MjAwMzNDIDIuMTE5ODMgMC4yODI5MzUgMi44MjkxNCAwLjAzMzQzOTUgMy41NjM4OSAwLjAwMzEzMzQ0QyA0LjU0NjY3IC0wLjAzNzQwMzMgNS41MDUyOSAwLjMxNjcwNiA2LjIyOTYxIDAuOTg3ODM1QyA2Ljk1MzkzIDEuNjU4OTYgNy4zODQ4NCAyLjU5MjM1IDcuNDI3ODkgMy41ODMzOEwgNy40Mjc4OSAzLjU4MzM4WiIvPgogICAgICA8cGF0aCB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNjM4LjM2IDIyODYuMDYpIiBkPSJNIDIuMjc0NzEgNC4zOTYyOUMgMS44NDM2MyA0LjQxNTA4IDEuNDE2NzEgNC4zMDQ0NSAxLjA0Nzk5IDQuMDc4NDNDIDAuNjc5MjY4IDMuODUyNCAwLjM4NTMyOCAzLjUyMTE0IDAuMjAzMzcxIDMuMTI2NTZDIDAuMDIxNDEzNiAyLjczMTk4IC0wLjA0MDM3OTggMi4yOTE4MyAwLjAyNTgxMTYgMS44NjE4MUMgMC4wOTIwMDMxIDEuNDMxOCAwLjI4MzIwNCAxLjAzMTI2IDAuNTc1MjEzIDAuNzEwODgzQyAwLjg2NzIyMiAwLjM5MDUxIDEuMjQ2OTEgMC4xNjQ3MDggMS42NjYyMiAwLjA2MjA1OTJDIDIuMDg1NTMgLTAuMDQwNTg5NyAyLjUyNTYxIC0wLjAxNTQ3MTQgMi45MzA3NiAwLjEzNDIzNUMgMy4zMzU5MSAwLjI4Mzk0MSAzLjY4NzkyIDAuNTUxNTA1IDMuOTQyMjIgMC45MDMwNkMgNC4xOTY1MiAxLjI1NDYyIDQuMzQxNjkgMS42NzQzNiA0LjM1OTM1IDIuMTA5MTZDIDQuMzgyOTkgMi42OTEwNyA0LjE3Njc4IDMuMjU4NjkgMy43ODU5NyAzLjY4NzQ2QyAzLjM5NTE2IDQuMTE2MjQgMi44NTE2NiA0LjM3MTE2IDIuMjc0NzEgNC4zOTYyOUwgMi4yNzQ3MSA0LjM5NjI5WiIvPgogICAgPC9nPgogIDwvZz4+Cjwvc3ZnPgo=);
  --jp-icon-jupyterlab-wordmark: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAiIHZpZXdCb3g9IjAgMCAxODYwLjggNDc1Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjIiIGZpbGw9IiM0RTRFNEUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDQ4MC4xMzY0MDEsIDY0LjI3MTQ5MykiPgogICAgPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMC4wMDAwMDAsIDU4Ljg3NTU2NikiPgogICAgICA8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLjA4NzYwMywgMC4xNDAyOTQpIj4KICAgICAgICA8cGF0aCBkPSJNLTQyNi45LDE2OS44YzAsNDguNy0zLjcsNjQuNy0xMy42LDc2LjRjLTEwLjgsMTAtMjUsMTUuNS0zOS43LDE1LjVsMy43LDI5IGMyMi44LDAuMyw0NC44LTcuOSw2MS45LTIzLjFjMTcuOC0xOC41LDI0LTQ0LjEsMjQtODMuM1YwSC00Mjd2MTcwLjFMLTQyNi45LDE2OS44TC00MjYuOSwxNjkuOHoiLz4KICAgICAgPC9nPgogICAgPC9nPgogICAgPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTU1LjA0NTI5NiwgNTYuODM3MTA0KSI+CiAgICAgIDxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEuNTYyNDUzLCAxLjc5OTg0MikiPgogICAgICAgIDxwYXRoIGQ9Ik0tMzEyLDE0OGMwLDIxLDAsMzkuNSwxLjcsNTUuNGgtMzEuOGwtMi4xLTMzLjNoLTAuOGMtNi43LDExLjYtMTYuNCwyMS4zLTI4LDI3LjkgYy0xMS42LDYuNi0yNC44LDEwLTM4LjIsOS44Yy0zMS40LDAtNjktMTcuNy02OS04OVYwaDM2LjR2MTEyLjdjMCwzOC43LDExLjYsNjQuNyw0NC42LDY0LjdjMTAuMy0wLjIsMjAuNC0zLjUsMjguOS05LjQgYzguNS01LjksMTUuMS0xNC4zLDE4LjktMjMuOWMyLjItNi4xLDMuMy0xMi41LDMuMy0xOC45VjAuMmgzNi40VjE0OEgtMzEyTC0zMTIsMTQ4eiIvPgogICAgICA8L2c+CiAgICA8L2c+CiAgICA8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzOTAuMDEzMzIyLCA1My40Nzk2MzgpIj4KICAgICAgPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMS43MDY0NTgsIDAuMjMxNDI1KSI+CiAgICAgICAgPHBhdGggZD0iTS00NzguNiw3MS40YzAtMjYtMC44LTQ3LTEuNy02Ni43aDMyLjdsMS43LDM0LjhoMC44YzcuMS0xMi41LDE3LjUtMjIuOCwzMC4xLTI5LjcgYzEyLjUtNywyNi43LTEwLjMsNDEtOS44YzQ4LjMsMCw4NC43LDQxLjcsODQuNywxMDMuM2MwLDczLjEtNDMuNywxMDkuMi05MSwxMDkuMmMtMTIuMSwwLjUtMjQuMi0yLjItMzUtNy44IGMtMTAuOC01LjYtMTkuOS0xMy45LTI2LjYtMjQuMmgtMC44VjI5MWgtMzZ2LTIyMEwtNDc4LjYsNzEuNEwtNDc4LjYsNzEuNHogTS00NDIuNiwxMjUuNmMwLjEsNS4xLDAuNiwxMC4xLDEuNywxNS4xIGMzLDEyLjMsOS45LDIzLjMsMTkuOCwzMS4xYzkuOSw3LjgsMjIuMSwxMi4xLDM0LjcsMTIuMWMzOC41LDAsNjAuNy0zMS45LDYwLjctNzguNWMwLTQwLjctMjEuMS03NS42LTU5LjUtNzUuNiBjLTEyLjksMC40LTI1LjMsNS4xLTM1LjMsMTMuNGMtOS45LDguMy0xNi45LDE5LjctMTkuNiwzMi40Yy0xLjUsNC45LTIuMywxMC0yLjUsMTUuMVYxMjUuNkwtNDQyLjYsMTI1LjZMLTQ0Mi42LDEyNS42eiIvPgogICAgICA8L2c+CiAgICA8L2c+CiAgICA8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSg2MDYuNzQwNzI2LCA1Ni44MzcxMDQpIj4KICAgICAgPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMC43NTEyMjYsIDEuOTg5Mjk5KSI+CiAgICAgICAgPHBhdGggZD0iTS00NDAuOCwwbDQzLjcsMTIwLjFjNC41LDEzLjQsOS41LDI5LjQsMTIuOCw0MS43aDAuOGMzLjctMTIuMiw3LjktMjcuNywxMi44LTQyLjQgbDM5LjctMTE5LjJoMzguNUwtMzQ2LjksMTQ1Yy0yNiw2OS43LTQzLjcsMTA1LjQtNjguNiwxMjcuMmMtMTIuNSwxMS43LTI3LjksMjAtNDQuNiwyMy45bC05LjEtMzEuMSBjMTEuNy0zLjksMjIuNS0xMC4xLDMxLjgtMTguMWMxMy4yLTExLjEsMjMuNy0yNS4yLDMwLjYtNDEuMmMxLjUtMi44LDIuNS01LjcsMi45LTguOGMtMC4zLTMuMy0xLjItNi42LTIuNS05LjdMLTQ4MC4yLDAuMSBoMzkuN0wtNDQwLjgsMEwtNDQwLjgsMHoiLz4KICAgICAgPC9nPgogICAgPC9nPgogICAgPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoODIyLjc0ODEwNCwgMC4wMDAwMDApIj4KICAgICAgPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMS40NjQwNTAsIDAuMzc4OTE0KSI+CiAgICAgICAgPHBhdGggZD0iTS00MTMuNywwdjU4LjNoNTJ2MjguMmgtNTJWMTk2YzAsMjUsNywzOS41LDI3LjMsMzkuNWM3LjEsMC4xLDE0LjItMC43LDIxLjEtMi41IGwxLjcsMjcuN2MtMTAuMywzLjctMjEuMyw1LjQtMzIuMiw1Yy03LjMsMC40LTE0LjYtMC43LTIxLjMtMy40Yy02LjgtMi43LTEyLjktNi44LTE3LjktMTIuMWMtMTAuMy0xMC45LTE0LjEtMjktMTQuMS01Mi45IFY4Ni41aC0zMVY1OC4zaDMxVjkuNkwtNDEzLjcsMEwtNDEzLjcsMHoiLz4KICAgICAgPC9nPgogICAgPC9nPgogICAgPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoOTc0LjQzMzI4NiwgNTMuNDc5NjM4KSI+CiAgICAgIDxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAuOTkwMDM0LCAwLjYxMDMzOSkiPgogICAgICAgIDxwYXRoIGQ9Ik0tNDQ1LjgsMTEzYzAuOCw1MCwzMi4yLDcwLjYsNjguNiw3MC42YzE5LDAuNiwzNy45LTMsNTUuMy0xMC41bDYuMiwyNi40IGMtMjAuOSw4LjktNDMuNSwxMy4xLTY2LjIsMTIuNmMtNjEuNSwwLTk4LjMtNDEuMi05OC4zLTEwMi41Qy00ODAuMiw0OC4yLTQ0NC43LDAtMzg2LjUsMGM2NS4yLDAsODIuNyw1OC4zLDgyLjcsOTUuNyBjLTAuMSw1LjgtMC41LDExLjUtMS4yLDE3LjJoLTE0MC42SC00NDUuOEwtNDQ1LjgsMTEzeiBNLTMzOS4yLDg2LjZjMC40LTIzLjUtOS41LTYwLjEtNTAuNC02MC4xIGMtMzYuOCwwLTUyLjgsMzQuNC01NS43LDYwLjFILTMzOS4yTC0zMzkuMiw4Ni42TC0zMzkuMiw4Ni42eiIvPgogICAgICA8L2c+CiAgICA8L2c+CiAgICA8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMjAxLjk2MTA1OCwgNTMuNDc5NjM4KSI+CiAgICAgIDxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEuMTc5NjQwLCAwLjcwNTA2OCkiPgogICAgICAgIDxwYXRoIGQ9Ik0tNDc4LjYsNjhjMC0yMy45LTAuNC00NC41LTEuNy02My40aDMxLjhsMS4yLDM5LjloMS43YzkuMS0yNy4zLDMxLTQ0LjUsNTUuMy00NC41IGMzLjUtMC4xLDcsMC40LDEwLjMsMS4ydjM0LjhjLTQuMS0wLjktOC4yLTEuMy0xMi40LTEuMmMtMjUuNiwwLTQzLjcsMTkuNy00OC43LDQ3LjRjLTEsNS43LTEuNiwxMS41LTEuNywxNy4ydjEwOC4zaC0zNlY2OCBMLTQ3OC42LDY4eiIvPgogICAgICA8L2c+CiAgICA8L2c+CiAgPC9nPgoKICA8ZyBjbGFzcz0ianAtaWNvbi13YXJuMCIgZmlsbD0iI0YzNzcyNiI+CiAgICA8cGF0aCBkPSJNMTM1Mi4zLDMyNi4yaDM3VjI4aC0zN1YzMjYuMnogTTE2MDQuOCwzMjYuMmMtMi41LTEzLjktMy40LTMxLjEtMy40LTQ4Ljd2LTc2IGMwLTQwLjctMTUuMS04My4xLTc3LjMtODMuMWMtMjUuNiwwLTUwLDcuMS02Ni44LDE4LjFsOC40LDI0LjRjMTQuMy05LjIsMzQtMTUuMSw1My0xNS4xYzQxLjYsMCw0Ni4yLDMwLjIsNDYuMiw0N3Y0LjIgYy03OC42LTAuNC0xMjIuMywyNi41LTEyMi4zLDc1LjZjMCwyOS40LDIxLDU4LjQsNjIuMiw1OC40YzI5LDAsNTAuOS0xNC4zLDYyLjItMzAuMmgxLjNsMi45LDI1LjZIMTYwNC44eiBNMTU2NS43LDI1Ny43IGMwLDMuOC0wLjgsOC0yLjEsMTEuOGMtNS45LDE3LjItMjIuNywzNC00OS4yLDM0Yy0xOC45LDAtMzQuOS0xMS4zLTM0LjktMzUuM2MwLTM5LjUsNDUuOC00Ni42LDg2LjItNDUuOFYyNTcuN3ogTTE2OTguNSwzMjYuMiBsMS43LTMzLjZoMS4zYzE1LjEsMjYuOSwzOC43LDM4LjIsNjguMSwzOC4yYzQ1LjQsMCw5MS4yLTM2LjEsOTEuMi0xMDguOGMwLjQtNjEuNy0zNS4zLTEwMy43LTg1LjctMTAzLjcgYy0zMi44LDAtNTYuMywxNC43LTY5LjMsMzcuNGgtMC44VjI4aC0zNi42djI0NS43YzAsMTguMS0wLjgsMzguNi0xLjcsNTIuNUgxNjk4LjV6IE0xNzA0LjgsMjA4LjJjMC01LjksMS4zLTEwLjksMi4xLTE1LjEgYzcuNi0yOC4xLDMxLjEtNDUuNCw1Ni4zLTQ1LjRjMzkuNSwwLDYwLjUsMzQuOSw2MC41LDc1LjZjMCw0Ni42LTIzLjEsNzguMS02MS44LDc4LjFjLTI2LjksMC00OC4zLTE3LjYtNTUuNS00My4zIGMtMC44LTQuMi0xLjctOC44LTEuNy0xMy40VjIwOC4yeiIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-kernel: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICAgIDxwYXRoIGNsYXNzPSJqcC1pY29uMiIgZmlsbD0iIzYxNjE2MSIgZD0iTTE1IDlIOXY2aDZWOXptLTIgNGgtMnYtMmgydjJ6bTgtMlY5aC0yVjdjMC0xLjEtLjktMi0yLTJoLTJWM2gtMnYyaC0yVjNIOXYySDdjLTEuMSAwLTIgLjktMiAydjJIM3YyaDJ2MkgzdjJoMnYyYzAgMS4xLjkgMiAyIDJoMnYyaDJ2LTJoMnYyaDJ2LTJoMmMxLjEgMCAyLS45IDItMnYtMmgydi0yaC0ydi0yaDJ6bS00IDZIN1Y3aDEwdjEweiIvPgo8L3N2Zz4K);
  --jp-icon-keyboard: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8cGF0aCBjbGFzcz0ianAtaWNvbjMganAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjNjE2MTYxIiBkPSJNMjAgNUg0Yy0xLjEgMC0xLjk5LjktMS45OSAyTDIgMTdjMCAxLjEuOSAyIDIgMmgxNmMxLjEgMCAyLS45IDItMlY3YzAtMS4xLS45LTItMi0yem0tOSAzaDJ2MmgtMlY4em0wIDNoMnYyaC0ydi0yek04IDhoMnYySDhWOHptMCAzaDJ2Mkg4di0yem0tMSAySDV2LTJoMnYyem0wLTNINVY4aDJ2MnptOSA3SDh2LTJoOHYyem0wLTRoLTJ2LTJoMnYyem0wLTNoLTJWOGgydjJ6bTMgM2gtMnYtMmgydjJ6bTAtM2gtMlY4aDJ2MnoiLz4KPC9zdmc+Cg==);
  --jp-icon-launch: url(data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMzIgMzIiIHdpZHRoPSIzMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZyBjbGFzcz0ianAtaWNvbjMganAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjNjE2MTYxIj4KICAgIDxwYXRoIGQ9Ik0yNiwyOEg2YTIuMDAyNywyLjAwMjcsMCwwLDEtMi0yVjZBMi4wMDI3LDIuMDAyNywwLDAsMSw2LDRIMTZWNkg2VjI2SDI2VjE2aDJWMjZBMi4wMDI3LDIuMDAyNywwLDAsMSwyNiwyOFoiLz4KICAgIDxwb2x5Z29uIHBvaW50cz0iMjAgMiAyMCA0IDI2LjU4NiA0IDE4IDEyLjU4NiAxOS40MTQgMTQgMjggNS40MTQgMjggMTIgMzAgMTIgMzAgMiAyMCAyIi8+CiAgPC9nPgo8L3N2Zz4K);
  --jp-icon-launcher: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8cGF0aCBjbGFzcz0ianAtaWNvbjMganAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjNjE2MTYxIiBkPSJNMTkgMTlINVY1aDdWM0g1YTIgMiAwIDAwLTIgMnYxNGEyIDIgMCAwMDIgMmgxNGMxLjEgMCAyLS45IDItMnYtN2gtMnY3ek0xNCAzdjJoMy41OWwtOS44MyA5LjgzIDEuNDEgMS40MUwxOSA2LjQxVjEwaDJWM2gtN3oiLz4KPC9zdmc+Cg==);
  --jp-icon-line-form: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICAgIDxwYXRoIGZpbGw9IndoaXRlIiBkPSJNNS44OCA0LjEyTDEzLjc2IDEybC03Ljg4IDcuODhMOCAyMmwxMC0xMEw4IDJ6Ii8+Cjwvc3ZnPgo=);
  --jp-icon-link: url(data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIxNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTTMuOSAxMmMwLTEuNzEgMS4zOS0zLjEgMy4xLTMuMWg0VjdIN2MtMi43NiAwLTUgMi4yNC01IDVzMi4yNCA1IDUgNWg0di0xLjlIN2MtMS43MSAwLTMuMS0xLjM5LTMuMS0zLjF6TTggMTNoOHYtMkg4djJ6bTktNmgtNHYxLjloNGMxLjcxIDAgMy4xIDEuMzkgMy4xIDMuMXMtMS4zOSAzLjEtMy4xIDMuMWgtNFYxN2g0YzIuNzYgMCA1LTIuMjQgNS01cy0yLjI0LTUtNS01eiIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-list: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICAgIDxwYXRoIGNsYXNzPSJqcC1pY29uMiBqcC1pY29uLXNlbGVjdGFibGUiIGZpbGw9IiM2MTYxNjEiIGQ9Ik0xOSA1djE0SDVWNWgxNG0xLjEtMkgzLjljLS41IDAtLjkuNC0uOS45djE2LjJjMCAuNC40LjkuOS45aDE2LjJjLjQgMCAuOS0uNS45LS45VjMuOWMwLS41LS41LS45LS45LS45ek0xMSA3aDZ2MmgtNlY3em0wIDRoNnYyaC02di0yem0wIDRoNnYyaC02ek03IDdoMnYySDd6bTAgNGgydjJIN3ptMCA0aDJ2Mkg3eiIvPgo8L3N2Zz4K);
  --jp-icon-markdown: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDIyIDIyIj4KICA8cGF0aCBjbGFzcz0ianAtaWNvbi1jb250cmFzdDAganAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjN0IxRkEyIiBkPSJNNSAxNC45aDEybC02LjEgNnptOS40LTYuOGMwLTEuMy0uMS0yLjktLjEtNC41LS40IDEuNC0uOSAyLjktMS4zIDQuM2wtMS4zIDQuM2gtMkw4LjUgNy45Yy0uNC0xLjMtLjctMi45LTEtNC4zLS4xIDEuNi0uMSAzLjItLjIgNC42TDcgMTIuNEg0LjhsLjctMTFoMy4zTDEwIDVjLjQgMS4yLjcgMi43IDEgMy45LjMtMS4yLjctMi42IDEtMy45bDEuMi0zLjdoMy4zbC42IDExaC0yLjRsLS4zLTQuMnoiLz4KPC9zdmc+Cg==);
  --jp-icon-move-down: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAxNCAxNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggY2xhc3M9ImpwLWljb24zIiBkPSJNMTIuNDcxIDcuNTI4OTlDMTIuNzYzMiA3LjIzNjg0IDEyLjc2MzIgNi43NjMxNiAxMi40NzEgNi40NzEwMVY2LjQ3MTAxQzEyLjE3OSA2LjE3OTA1IDExLjcwNTcgNi4xNzg4NCAxMS40MTM1IDYuNDcwNTRMNy43NSAxMC4xMjc1VjEuNzVDNy43NSAxLjMzNTc5IDcuNDE0MjEgMSA3IDFWMUM2LjU4NTc5IDEgNi4yNSAxLjMzNTc5IDYuMjUgMS43NVYxMC4xMjc1TDIuNTk3MjYgNi40NjgyMkMyLjMwMzM4IDYuMTczODEgMS44MjY0MSA2LjE3MzU5IDEuNTMyMjYgNi40Njc3NFY2LjQ2Nzc0QzEuMjM4MyA2Ljc2MTcgMS4yMzgzIDcuMjM4MyAxLjUzMjI2IDcuNTMyMjZMNi4yOTI4OSAxMi4yOTI5QzYuNjgzNDIgMTIuNjgzNCA3LjMxNjU4IDEyLjY4MzQgNy43MDcxMSAxMi4yOTI5TDEyLjQ3MSA3LjUyODk5WiIgZmlsbD0iIzYxNjE2MSIvPgo8L3N2Zz4K);
  --jp-icon-move-up: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAxNCAxNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggY2xhc3M9ImpwLWljb24zIiBkPSJNMS41Mjg5OSA2LjQ3MTAxQzEuMjM2ODQgNi43NjMxNiAxLjIzNjg0IDcuMjM2ODQgMS41Mjg5OSA3LjUyODk5VjcuNTI4OTlDMS44MjA5NSA3LjgyMDk1IDIuMjk0MjYgNy44MjExNiAyLjU4NjQ5IDcuNTI5NDZMNi4yNSAzLjg3MjVWMTIuMjVDNi4yNSAxMi42NjQyIDYuNTg1NzkgMTMgNyAxM1YxM0M3LjQxNDIxIDEzIDcuNzUgMTIuNjY0MiA3Ljc1IDEyLjI1VjMuODcyNUwxMS40MDI3IDcuNTMxNzhDMTEuNjk2NiA3LjgyNjE5IDEyLjE3MzYgNy44MjY0MSAxMi40Njc3IDcuNTMyMjZWNy41MzIyNkMxMi43NjE3IDcuMjM4MyAxMi43NjE3IDYuNzYxNyAxMi40Njc3IDYuNDY3NzRMNy43MDcxMSAxLjcwNzExQzcuMzE2NTggMS4zMTY1OCA2LjY4MzQyIDEuMzE2NTggNi4yOTI4OSAxLjcwNzExTDEuNTI4OTkgNi40NzEwMVoiIGZpbGw9IiM2MTYxNjEiLz4KPC9zdmc+Cg==);
  --jp-icon-new-folder: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTTIwIDZoLThsLTItMkg0Yy0xLjExIDAtMS45OS44OS0xLjk5IDJMMiAxOGMwIDEuMTEuODkgMiAyIDJoMTZjMS4xMSAwIDItLjg5IDItMlY4YzAtMS4xMS0uODktMi0yLTJ6bS0xIDhoLTN2M2gtMnYtM2gtM3YtMmgzVjloMnYzaDN2MnoiLz4KICA8L2c+Cjwvc3ZnPgo=);
  --jp-icon-not-trusted: url(data:image/svg+xml;base64,PHN2ZyBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI1IDI1Ij4KICAgIDxwYXRoIGNsYXNzPSJqcC1pY29uMiIgc3Ryb2tlPSIjMzMzMzMzIiBzdHJva2Utd2lkdGg9IjIiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDMgMykiIGQ9Ik0xLjg2MDk0IDExLjQ0MDlDMC44MjY0NDggOC43NzAyNyAwLjg2Mzc3OSA2LjA1NzY0IDEuMjQ5MDcgNC4xOTkzMkMyLjQ4MjA2IDMuOTMzNDcgNC4wODA2OCAzLjQwMzQ3IDUuNjAxMDIgMi44NDQ5QzcuMjM1NDkgMi4yNDQ0IDguODU2NjYgMS41ODE1IDkuOTg3NiAxLjA5NTM5QzExLjA1OTcgMS41ODM0MSAxMi42MDk0IDIuMjQ0NCAxNC4yMTggMi44NDMzOUMxNS43NTAzIDMuNDEzOTQgMTcuMzk5NSAzLjk1MjU4IDE4Ljc1MzkgNC4yMTM4NUMxOS4xMzY0IDYuMDcxNzcgMTkuMTcwOSA4Ljc3NzIyIDE4LjEzOSAxMS40NDA5QzE3LjAzMDMgMTQuMzAzMiAxNC42NjY4IDE3LjE4NDQgOS45OTk5OSAxOC45MzU0QzUuMzMzMTkgMTcuMTg0NCAyLjk2OTY4IDE0LjMwMzIgMS44NjA5NCAxMS40NDA5WiIvPgogICAgPHBhdGggY2xhc3M9ImpwLWljb24yIiBzdHJva2U9IiMzMzMzMzMiIHN0cm9rZS13aWR0aD0iMiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoOS4zMTU5MiA5LjMyMDMxKSIgZD0iTTcuMzY4NDIgMEwwIDcuMzY0NzkiLz4KICAgIDxwYXRoIGNsYXNzPSJqcC1pY29uMiIgc3Ryb2tlPSIjMzMzMzMzIiBzdHJva2Utd2lkdGg9IjIiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDkuMzE1OTIgMTYuNjgzNikgc2NhbGUoMSAtMSkiIGQ9Ik03LjM2ODQyIDBMMCA3LjM2NDc5Ii8+Cjwvc3ZnPgo=);
  --jp-icon-notebook: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDIyIDIyIj4KICA8ZyBjbGFzcz0ianAtbm90ZWJvb2staWNvbi1jb2xvciBqcC1pY29uLXNlbGVjdGFibGUiIGZpbGw9IiNFRjZDMDAiPgogICAgPHBhdGggZD0iTTE4LjcgMy4zdjE1LjRIMy4zVjMuM2gxNS40bTEuNS0xLjVIMS44djE4LjNoMTguM2wuMS0xOC4zeiIvPgogICAgPHBhdGggZD0iTTE2LjUgMTYuNWwtNS40LTQuMy01LjYgNC4zdi0xMWgxMXoiLz4KICA8L2c+Cjwvc3ZnPgo=);
  --jp-icon-numbering: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjIiIGhlaWdodD0iMjIiIHZpZXdCb3g9IjAgMCAyOCAyOCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KCTxnIGNsYXNzPSJqcC1pY29uMyIgZmlsbD0iIzYxNjE2MSI+CgkJPHBhdGggZD0iTTQgMTlINlYxOS41SDVWMjAuNUg2VjIxSDRWMjJIN1YxOEg0VjE5Wk01IDEwSDZWNkg0VjdINVYxMFpNNCAxM0g1LjhMNCAxNS4xVjE2SDdWMTVINS4yTDcgMTIuOVYxMkg0VjEzWk05IDdWOUgyM1Y3SDlaTTkgMjFIMjNWMTlIOVYyMVpNOSAxNUgyM1YxM0g5VjE1WiIvPgoJPC9nPgo8L3N2Zz4K);
  --jp-icon-offline-bolt: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjE2Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTTEyIDIuMDJjLTUuNTEgMC05Ljk4IDQuNDctOS45OCA5Ljk4czQuNDcgOS45OCA5Ljk4IDkuOTggOS45OC00LjQ3IDkuOTgtOS45OFMxNy41MSAyLjAyIDEyIDIuMDJ6TTExLjQ4IDIwdi02LjI2SDhMMTMgNHY2LjI2aDMuMzVMMTEuNDggMjB6Ii8+CiAgPC9nPgo8L3N2Zz4K);
  --jp-icon-palette: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTTE4IDEzVjIwSDRWNkg5LjAyQzkuMDcgNS4yOSA5LjI0IDQuNjIgOS41IDRINEMyLjkgNCAyIDQuOSAyIDZWMjBDMiAyMS4xIDIuOSAyMiA0IDIySDE4QzE5LjEgMjIgMjAgMjEuMSAyMCAyMFYxNUwxOCAxM1pNMTkuMyA4Ljg5QzE5Ljc0IDguMTkgMjAgNy4zOCAyMCA2LjVDMjAgNC4wMSAxNy45OSAyIDE1LjUgMkMxMy4wMSAyIDExIDQuMDEgMTEgNi41QzExIDguOTkgMTMuMDEgMTEgMTUuNDkgMTFDMTYuMzcgMTEgMTcuMTkgMTAuNzQgMTcuODggMTAuM0wyMSAxMy40MkwyMi40MiAxMkwxOS4zIDguODlaTTE1LjUgOUMxNC4xMiA5IDEzIDcuODggMTMgNi41QzEzIDUuMTIgMTQuMTIgNCAxNS41IDRDMTYuODggNCAxOCA1LjEyIDE4IDYuNUMxOCA3Ljg4IDE2Ljg4IDkgMTUuNSA5WiIvPgogICAgPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik00IDZIOS4wMTg5NEM5LjAwNjM5IDYuMTY1MDIgOSA2LjMzMTc2IDkgNi41QzkgOC44MTU3NyAxMC4yMTEgMTAuODQ4NyAxMi4wMzQzIDEySDlWMTRIMTZWMTIuOTgxMUMxNi41NzAzIDEyLjkzNzcgMTcuMTIgMTIuODIwNyAxNy42Mzk2IDEyLjYzOTZMMTggMTNWMjBINFY2Wk04IDhINlYxMEg4VjhaTTYgMTJIOFYxNEg2VjEyWk04IDE2SDZWMThIOFYxNlpNOSAxNkgxNlYxOEg5VjE2WiIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-paste: url(data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxnIGNsYXNzPSJqcC1pY29uMyIgZmlsbD0iIzYxNjE2MSI+CiAgICAgICAgPHBhdGggZD0iTTE5IDJoLTQuMThDMTQuNC44NCAxMy4zIDAgMTIgMGMtMS4zIDAtMi40Ljg0LTIuODIgMkg1Yy0xLjEgMC0yIC45LTIgMnYxNmMwIDEuMS45IDIgMiAyaDE0YzEuMSAwIDItLjkgMi0yVjRjMC0xLjEtLjktMi0yLTJ6bS03IDBjLjU1IDAgMSAuNDUgMSAxcy0uNDUgMS0xIDEtMS0uNDUtMS0xIC40NS0xIDEtMXptNyAxOEg1VjRoMnYzaDEwVjRoMnYxNnoiLz4KICAgIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-pdf: url(data:image/svg+xml;base64,PHN2ZwogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMiAyMiIgd2lkdGg9IjE2Ij4KICAgIDxwYXRoIHRyYW5zZm9ybT0icm90YXRlKDQ1KSIgY2xhc3M9ImpwLWljb24tc2VsZWN0YWJsZSIgZmlsbD0iI0ZGMkEyQSIKICAgICAgIGQ9Im0gMjIuMzQ0MzY5LC0zLjAxNjM2NDIgaCA1LjYzODYwNCB2IDEuNTc5MjQzMyBoIC0zLjU0OTIyNyB2IDEuNTA4NjkyOTkgaCAzLjMzNzU3NiBWIDEuNjUwODE1NCBoIC0zLjMzNzU3NiB2IDMuNDM1MjYxMyBoIC0yLjA4OTM3NyB6IG0gLTcuMTM2NDQ0LDEuNTc5MjQzMyB2IDQuOTQzOTU0MyBoIDAuNzQ4OTIgcSAxLjI4MDc2MSwwIDEuOTUzNzAzLC0wLjYzNDk1MzUgMC42NzgzNjksLTAuNjM0OTUzNSAwLjY3ODM2OSwtMS44NDUxNjQxIDAsLTEuMjA0NzgzNTUgLTAuNjcyOTQyLC0xLjgzNDMxMDExIC0wLjY3Mjk0MiwtMC42Mjk1MjY1OSAtMS45NTkxMywtMC42Mjk1MjY1OSB6IG0gLTIuMDg5Mzc3LC0xLjU3OTI0MzMgaCAyLjIwMzM0MyBxIDEuODQ1MTY0LDAgMi43NDYwMzksMC4yNjU5MjA3IDAuOTA2MzAxLDAuMjYwNDkzNyAxLjU1MjEwOCwwLjg5MDAyMDMgMC41Njk4MywwLjU0ODEyMjMgMC44NDY2MDUsMS4yNjQ0ODAwNiAwLjI3Njc3NCwwLjcxNjM1NzgxIDAuMjc2Nzc0LDEuNjIyNjU4OTQgMCwwLjkxNzE1NTEgLTAuMjc2Nzc0LDEuNjM4OTM5OSAtMC4yNzY3NzUsMC43MTYzNTc4IC0wLjg0NjYwNSwxLjI2NDQ4IC0wLjY1MTIzNCwwLjYyOTUyNjYgLTEuNTYyOTYyLDAuODk1NDQ3MyAtMC45MTE3MjgsMC4yNjA0OTM3IC0yLjczNTE4NSwwLjI2MDQ5MzcgaCAtMi4yMDMzNDMgeiBtIC04LjE0NTg1NjUsMCBoIDMuNDY3ODIzIHEgMS41NDY2ODE2LDAgMi4zNzE1Nzg1LDAuNjg5MjIzIDAuODMwMzI0LDAuNjgzNzk2MSAwLjgzMDMyNCwxLjk1MzcwMzE0IDAsMS4yNzUzMzM5NyAtMC44MzAzMjQsMS45NjQ1NTcwNiBRIDkuOTg3MTk2MSwyLjI3NDkxNSA4LjQ0MDUxNDUsMi4yNzQ5MTUgSCA3LjA2MjA2ODQgViA1LjA4NjA3NjcgSCA0Ljk3MjY5MTUgWiBtIDIuMDg5Mzc2OSwxLjUxNDExOTkgdiAyLjI2MzAzOTQzIGggMS4xNTU5NDEgcSAwLjYwNzgxODgsMCAwLjkzODg2MjksLTAuMjkzMDU1NDcgMC4zMzEwNDQxLC0wLjI5ODQ4MjQxIDAuMzMxMDQ0MSwtMC44NDExNzc3MiAwLC0wLjU0MjY5NTMxIC0wLjMzMTA0NDEsLTAuODM1NzUwNzQgLTAuMzMxMDQ0MSwtMC4yOTMwNTU1IC0wLjkzODg2MjksLTAuMjkzMDU1NSB6IgovPgo8L3N2Zz4K);
  --jp-icon-python: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iLTEwIC0xMCAxMzEuMTYxMzYxNjk0MzM1OTQgMTMyLjM4ODk5OTkzODk2NDg0Ij4KICA8cGF0aCBjbGFzcz0ianAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjMzA2OTk4IiBkPSJNIDU0LjkxODc4NSw5LjE5Mjc0MjFlLTQgQyA1MC4zMzUxMzIsMC4wMjIyMTcyNyA0NS45NTc4NDYsMC40MTMxMzY5NyA0Mi4xMDYyODUsMS4wOTQ2NjkzIDMwLjc2MDA2OSwzLjA5OTE3MzEgMjguNzAwMDM2LDcuMjk0NzcxNCAyOC43MDAwMzUsMTUuMDMyMTY5IHYgMTAuMjE4NzUgaCAyNi44MTI1IHYgMy40MDYyNSBoIC0yNi44MTI1IC0xMC4wNjI1IGMgLTcuNzkyNDU5LDAgLTE0LjYxNTc1ODgsNC42ODM3MTcgLTE2Ljc0OTk5OTgsMTMuNTkzNzUgLTIuNDYxODE5OTgsMTAuMjEyOTY2IC0yLjU3MTAxNTA4LDE2LjU4NjAyMyAwLDI3LjI1IDEuOTA1OTI4Myw3LjkzNzg1MiA2LjQ1NzU0MzIsMTMuNTkzNzQ4IDE0LjI0OTk5OTgsMTMuNTkzNzUgaCA5LjIxODc1IHYgLTEyLjI1IGMgMCwtOC44NDk5MDIgNy42NTcxNDQsLTE2LjY1NjI0OCAxNi43NSwtMTYuNjU2MjUgaCAyNi43ODEyNSBjIDcuNDU0OTUxLDAgMTMuNDA2MjUzLC02LjEzODE2NCAxMy40MDYyNSwtMTMuNjI1IHYgLTI1LjUzMTI1IGMgMCwtNy4yNjYzMzg2IC02LjEyOTk4LC0xMi43MjQ3NzcxIC0xMy40MDYyNSwtMTMuOTM3NDk5NyBDIDY0LjI4MTU0OCwwLjMyNzk0Mzk3IDU5LjUwMjQzOCwtMC4wMjAzNzkwMyA1NC45MTg3ODUsOS4xOTI3NDIxZS00IFogbSAtMTQuNSw4LjIxODc1MDEyNTc5IGMgMi43Njk1NDcsMCA1LjAzMTI1LDIuMjk4NjQ1NiA1LjAzMTI1LDUuMTI0OTk5NiAtMmUtNiwyLjgxNjMzNiAtMi4yNjE3MDMsNS4wOTM3NSAtNS4wMzEyNSw1LjA5Mzc1IC0yLjc3OTQ3NiwtMWUtNiAtNS4wMzEyNSwtMi4yNzc0MTUgLTUuMDMxMjUsLTUuMDkzNzUgLTEwZS03LC0yLjgyNjM1MyAyLjI1MTc3NCwtNS4xMjQ5OTk2IDUuMDMxMjUsLTUuMTI0OTk5NiB6Ii8+CiAgPHBhdGggY2xhc3M9ImpwLWljb24tc2VsZWN0YWJsZSIgZmlsbD0iI2ZmZDQzYiIgZD0ibSA4NS42Mzc1MzUsMjguNjU3MTY5IHYgMTEuOTA2MjUgYyAwLDkuMjMwNzU1IC03LjgyNTg5NSwxNi45OTk5OTkgLTE2Ljc1LDE3IGggLTI2Ljc4MTI1IGMgLTcuMzM1ODMzLDAgLTEzLjQwNjI0OSw2LjI3ODQ4MyAtMTMuNDA2MjUsMTMuNjI1IHYgMjUuNTMxMjQ3IGMgMCw3LjI2NjM0NCA2LjMxODU4OCwxMS41NDAzMjQgMTMuNDA2MjUsMTMuNjI1MDA0IDguNDg3MzMxLDIuNDk1NjEgMTYuNjI2MjM3LDIuOTQ2NjMgMjYuNzgxMjUsMCA2Ljc1MDE1NSwtMS45NTQzOSAxMy40MDYyNTMsLTUuODg3NjEgMTMuNDA2MjUsLTEzLjYyNTAwNCBWIDg2LjUwMDkxOSBoIC0yNi43ODEyNSB2IC0zLjQwNjI1IGggMjYuNzgxMjUgMTMuNDA2MjU0IGMgNy43OTI0NjEsMCAxMC42OTYyNTEsLTUuNDM1NDA4IDEzLjQwNjI0MSwtMTMuNTkzNzUgMi43OTkzMywtOC4zOTg4ODYgMi42ODAyMiwtMTYuNDc1Nzc2IDAsLTI3LjI1IC0xLjkyNTc4LC03Ljc1NzQ0MSAtNS42MDM4NywtMTMuNTkzNzUgLTEzLjQwNjI0MSwtMTMuNTkzNzUgeiBtIC0xNS4wNjI1LDY0LjY1NjI1IGMgMi43Nzk0NzgsM2UtNiA1LjAzMTI1LDIuMjc3NDE3IDUuMDMxMjUsNS4wOTM3NDcgLTJlLTYsMi44MjYzNTQgLTIuMjUxNzc1LDUuMTI1MDA0IC01LjAzMTI1LDUuMTI1MDA0IC0yLjc2OTU1LDAgLTUuMDMxMjUsLTIuMjk4NjUgLTUuMDMxMjUsLTUuMTI1MDA0IDJlLTYsLTIuODE2MzMgMi4yNjE2OTcsLTUuMDkzNzQ3IDUuMDMxMjUsLTUuMDkzNzQ3IHoiLz4KPC9zdmc+Cg==);
  --jp-icon-r-kernel: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDIyIDIyIj4KICA8cGF0aCBjbGFzcz0ianAtaWNvbi1jb250cmFzdDMganAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjMjE5NkYzIiBkPSJNNC40IDIuNWMxLjItLjEgMi45LS4zIDQuOS0uMyAyLjUgMCA0LjEuNCA1LjIgMS4zIDEgLjcgMS41IDEuOSAxLjUgMy41IDAgMi0xLjQgMy41LTIuOSA0LjEgMS4yLjQgMS43IDEuNiAyLjIgMyAuNiAxLjkgMSAzLjkgMS4zIDQuNmgtMy44Yy0uMy0uNC0uOC0xLjctMS4yLTMuN3MtMS4yLTIuNi0yLjYtMi42aC0uOXY2LjRINC40VjIuNXptMy43IDYuOWgxLjRjMS45IDAgMi45LS45IDIuOS0yLjNzLTEtMi4zLTIuOC0yLjNjLS43IDAtMS4zIDAtMS42LjJ2NC41aC4xdi0uMXoiLz4KPC9zdmc+Cg==);
  --jp-icon-react: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMTUwIDE1MCA1NDEuOSAyOTUuMyI+CiAgPGcgY2xhc3M9ImpwLWljb24tYnJhbmQyIGpwLWljb24tc2VsZWN0YWJsZSIgZmlsbD0iIzYxREFGQiI+CiAgICA8cGF0aCBkPSJNNjY2LjMgMjk2LjVjMC0zMi41LTQwLjctNjMuMy0xMDMuMS04Mi40IDE0LjQtNjMuNiA4LTExNC4yLTIwLjItMTMwLjQtNi41LTMuOC0xNC4xLTUuNi0yMi40LTUuNnYyMi4zYzQuNiAwIDguMy45IDExLjQgMi42IDEzLjYgNy44IDE5LjUgMzcuNSAxNC45IDc1LjctMS4xIDkuNC0yLjkgMTkuMy01LjEgMjkuNC0xOS42LTQuOC00MS04LjUtNjMuNS0xMC45LTEzLjUtMTguNS0yNy41LTM1LjMtNDEuNi01MCAzMi42LTMwLjMgNjMuMi00Ni45IDg0LTQ2LjlWNzhjLTI3LjUgMC02My41IDE5LjYtOTkuOSA1My42LTM2LjQtMzMuOC03Mi40LTUzLjItOTkuOS01My4ydjIyLjNjMjAuNyAwIDUxLjQgMTYuNSA4NCA0Ni42LTE0IDE0LjctMjggMzEuNC00MS4zIDQ5LjktMjIuNiAyLjQtNDQgNi4xLTYzLjYgMTEtMi4zLTEwLTQtMTkuNy01LjItMjktNC43LTM4LjIgMS4xLTY3LjkgMTQuNi03NS44IDMtMS44IDYuOS0yLjYgMTEuNS0yLjZWNzguNWMtOC40IDAtMTYgMS44LTIyLjYgNS42LTI4LjEgMTYuMi0zNC40IDY2LjctMTkuOSAxMzAuMS02Mi4yIDE5LjItMTAyLjcgNDkuOS0xMDIuNyA4Mi4zIDAgMzIuNSA0MC43IDYzLjMgMTAzLjEgODIuNC0xNC40IDYzLjYtOCAxMTQuMiAyMC4yIDEzMC40IDYuNSAzLjggMTQuMSA1LjYgMjIuNSA1LjYgMjcuNSAwIDYzLjUtMTkuNiA5OS45LTUzLjYgMzYuNCAzMy44IDcyLjQgNTMuMiA5OS45IDUzLjIgOC40IDAgMTYtMS44IDIyLjYtNS42IDI4LjEtMTYuMiAzNC40LTY2LjcgMTkuOS0xMzAuMSA2Mi0xOS4xIDEwMi41LTQ5LjkgMTAyLjUtODIuM3ptLTEzMC4yLTY2LjdjLTMuNyAxMi45LTguMyAyNi4yLTEzLjUgMzkuNS00LjEtOC04LjQtMTYtMTMuMS0yNC00LjYtOC05LjUtMTUuOC0xNC40LTIzLjQgMTQuMiAyLjEgMjcuOSA0LjcgNDEgNy45em0tNDUuOCAxMDYuNWMtNy44IDEzLjUtMTUuOCAyNi4zLTI0LjEgMzguMi0xNC45IDEuMy0zMCAyLTQ1LjIgMi0xNS4xIDAtMzAuMi0uNy00NS0xLjktOC4zLTExLjktMTYuNC0yNC42LTI0LjItMzgtNy42LTEzLjEtMTQuNS0yNi40LTIwLjgtMzkuOCA2LjItMTMuNCAxMy4yLTI2LjggMjAuNy0zOS45IDcuOC0xMy41IDE1LjgtMjYuMyAyNC4xLTM4LjIgMTQuOS0xLjMgMzAtMiA0NS4yLTIgMTUuMSAwIDMwLjIuNyA0NSAxLjkgOC4zIDExLjkgMTYuNCAyNC42IDI0LjIgMzggNy42IDEzLjEgMTQuNSAyNi40IDIwLjggMzkuOC02LjMgMTMuNC0xMy4yIDI2LjgtMjAuNyAzOS45em0zMi4zLTEzYzUuNCAxMy40IDEwIDI2LjggMTMuOCAzOS44LTEzLjEgMy4yLTI2LjkgNS45LTQxLjIgOCA0LjktNy43IDkuOC0xNS42IDE0LjQtMjMuNyA0LjYtOCA4LjktMTYuMSAxMy0yNC4xek00MjEuMiA0MzBjLTkuMy05LjYtMTguNi0yMC4zLTI3LjgtMzIgOSAuNCAxOC4yLjcgMjcuNS43IDkuNCAwIDE4LjctLjIgMjcuOC0uNy05IDExLjctMTguMyAyMi40LTI3LjUgMzJ6bS03NC40LTU4LjljLTE0LjItMi4xLTI3LjktNC43LTQxLTcuOSAzLjctMTIuOSA4LjMtMjYuMiAxMy41LTM5LjUgNC4xIDggOC40IDE2IDEzLjEgMjQgNC43IDggOS41IDE1LjggMTQuNCAyMy40ek00MjAuNyAxNjNjOS4zIDkuNiAxOC42IDIwLjMgMjcuOCAzMi05LS40LTE4LjItLjctMjcuNS0uNy05LjQgMC0xOC43LjItMjcuOC43IDktMTEuNyAxOC4zLTIyLjQgMjcuNS0zMnptLTc0IDU4LjljLTQuOSA3LjctOS44IDE1LjYtMTQuNCAyMy43LTQuNiA4LTguOSAxNi0xMyAyNC01LjQtMTMuNC0xMC0yNi44LTEzLjgtMzkuOCAxMy4xLTMuMSAyNi45LTUuOCA0MS4yLTcuOXptLTkwLjUgMTI1LjJjLTM1LjQtMTUuMS01OC4zLTM0LjktNTguMy01MC42IDAtMTUuNyAyMi45LTM1LjYgNTguMy01MC42IDguNi0zLjcgMTgtNyAyNy43LTEwLjEgNS43IDE5LjYgMTMuMiA0MCAyMi41IDYwLjktOS4yIDIwLjgtMTYuNiA0MS4xLTIyLjIgNjAuNi05LjktMy4xLTE5LjMtNi41LTI4LTEwLjJ6TTMxMCA0OTBjLTEzLjYtNy44LTE5LjUtMzcuNS0xNC45LTc1LjcgMS4xLTkuNCAyLjktMTkuMyA1LjEtMjkuNCAxOS42IDQuOCA0MSA4LjUgNjMuNSAxMC45IDEzLjUgMTguNSAyNy41IDM1LjMgNDEuNiA1MC0zMi42IDMwLjMtNjMuMiA0Ni45LTg0IDQ2LjktNC41LS4xLTguMy0xLTExLjMtMi43em0yMzcuMi03Ni4yYzQuNyAzOC4yLTEuMSA2Ny45LTE0LjYgNzUuOC0zIDEuOC02LjkgMi42LTExLjUgMi42LTIwLjcgMC01MS40LTE2LjUtODQtNDYuNiAxNC0xNC43IDI4LTMxLjQgNDEuMy00OS45IDIyLjYtMi40IDQ0LTYuMSA2My42LTExIDIuMyAxMC4xIDQuMSAxOS44IDUuMiAyOS4xem0zOC41LTY2LjdjLTguNiAzLjctMTggNy0yNy43IDEwLjEtNS43LTE5LjYtMTMuMi00MC0yMi41LTYwLjkgOS4yLTIwLjggMTYuNi00MS4xIDIyLjItNjAuNiA5LjkgMy4xIDE5LjMgNi41IDI4LjEgMTAuMiAzNS40IDE1LjEgNTguMyAzNC45IDU4LjMgNTAuNi0uMSAxNS43LTIzIDM1LjYtNTguNCA1MC42ek0zMjAuOCA3OC40eiIvPgogICAgPGNpcmNsZSBjeD0iNDIwLjkiIGN5PSIyOTYuNSIgcj0iNDUuNyIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-redo: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjE2Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgICA8cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTE4LjQgMTAuNkMxNi41NSA4Ljk5IDE0LjE1IDggMTEuNSA4Yy00LjY1IDAtOC41OCAzLjAzLTkuOTYgNy4yMkwzLjkgMTZjMS4wNS0zLjE5IDQuMDUtNS41IDcuNi01LjUgMS45NSAwIDMuNzMuNzIgNS4xMiAxLjg4TDEzIDE2aDlWN2wtMy42IDMuNnoiLz4KICA8L2c+Cjwvc3ZnPgo=);
  --jp-icon-refresh: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDE4IDE4Ij4KICAgIDxnIGNsYXNzPSJqcC1pY29uMyIgZmlsbD0iIzYxNjE2MSI+CiAgICAgICAgPHBhdGggZD0iTTkgMTMuNWMtMi40OSAwLTQuNS0yLjAxLTQuNS00LjVTNi41MSA0LjUgOSA0LjVjMS4yNCAwIDIuMzYuNTIgMy4xNyAxLjMzTDEwIDhoNVYzbC0xLjc2IDEuNzZDMTIuMTUgMy42OCAxMC42NiAzIDkgMyA1LjY5IDMgMy4wMSA1LjY5IDMuMDEgOVM1LjY5IDE1IDkgMTVjMi45NyAwIDUuNDMtMi4xNiA1LjktNWgtMS41MmMtLjQ2IDItMi4yNCAzLjUtNC4zOCAzLjV6Ii8+CiAgICA8L2c+Cjwvc3ZnPgo=);
  --jp-icon-regex: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDIwIDIwIj4KICA8ZyBjbGFzcz0ianAtaWNvbjIiIGZpbGw9IiM0MTQxNDEiPgogICAgPHJlY3QgeD0iMiIgeT0iMiIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2Ii8+CiAgPC9nPgoKICA8ZyBjbGFzcz0ianAtaWNvbi1hY2NlbnQyIiBmaWxsPSIjRkZGIj4KICAgIDxjaXJjbGUgY2xhc3M9InN0MiIgY3g9IjUuNSIgY3k9IjE0LjUiIHI9IjEuNSIvPgogICAgPHJlY3QgeD0iMTIiIHk9IjQiIGNsYXNzPSJzdDIiIHdpZHRoPSIxIiBoZWlnaHQ9IjgiLz4KICAgIDxyZWN0IHg9IjguNSIgeT0iNy41IiB0cmFuc2Zvcm09Im1hdHJpeCgwLjg2NiAtMC41IDAuNSAwLjg2NiAtMi4zMjU1IDcuMzIxOSkiIGNsYXNzPSJzdDIiIHdpZHRoPSI4IiBoZWlnaHQ9IjEiLz4KICAgIDxyZWN0IHg9IjEyIiB5PSI0IiB0cmFuc2Zvcm09Im1hdHJpeCgwLjUgLTAuODY2IDAuODY2IDAuNSAtMC42Nzc5IDE0LjgyNTIpIiBjbGFzcz0ic3QyIiB3aWR0aD0iMSIgaGVpZ2h0PSI4Ii8+CiAgPC9nPgo8L3N2Zz4K);
  --jp-icon-run: url(data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxnIGNsYXNzPSJqcC1pY29uMyIgZmlsbD0iIzYxNjE2MSI+CiAgICAgICAgPHBhdGggZD0iTTggNXYxNGwxMS03eiIvPgogICAgPC9nPgo8L3N2Zz4K);
  --jp-icon-running: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDUxMiA1MTIiPgogIDxnIGNsYXNzPSJqcC1pY29uMyIgZmlsbD0iIzYxNjE2MSI+CiAgICA8cGF0aCBkPSJNMjU2IDhDMTE5IDggOCAxMTkgOCAyNTZzMTExIDI0OCAyNDggMjQ4IDI0OC0xMTEgMjQ4LTI0OFMzOTMgOCAyNTYgOHptOTYgMzI4YzAgOC44LTcuMiAxNi0xNiAxNkgxNzZjLTguOCAwLTE2LTcuMi0xNi0xNlYxNzZjMC04LjggNy4yLTE2IDE2LTE2aDE2MGM4LjggMCAxNiA3LjIgMTYgMTZ2MTYweiIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-save: url(data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxnIGNsYXNzPSJqcC1pY29uMyIgZmlsbD0iIzYxNjE2MSI+CiAgICAgICAgPHBhdGggZD0iTTE3IDNINWMtMS4xMSAwLTIgLjktMiAydjE0YzAgMS4xLjg5IDIgMiAyaDE0YzEuMSAwIDItLjkgMi0yVjdsLTQtNHptLTUgMTZjLTEuNjYgMC0zLTEuMzQtMy0zczEuMzQtMyAzLTMgMyAxLjM0IDMgMy0xLjM0IDMtMyAzem0zLTEwSDVWNWgxMHY0eiIvPgogICAgPC9nPgo8L3N2Zz4K);
  --jp-icon-search: url(data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMTggMTgiIHdpZHRoPSIxNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTTEyLjEsMTAuOWgtMC43bC0wLjItMC4yYzAuOC0wLjksMS4zLTIuMiwxLjMtMy41YzAtMy0yLjQtNS40LTUuNC01LjRTMS44LDQuMiwxLjgsNy4xczIuNCw1LjQsNS40LDUuNCBjMS4zLDAsMi41LTAuNSwzLjUtMS4zbDAuMiwwLjJ2MC43bDQuMSw0LjFsMS4yLTEuMkwxMi4xLDEwLjl6IE03LjEsMTAuOWMtMi4xLDAtMy43LTEuNy0zLjctMy43czEuNy0zLjcsMy43LTMuN3MzLjcsMS43LDMuNywzLjcgUzkuMiwxMC45LDcuMSwxMC45eiIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-settings: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8cGF0aCBjbGFzcz0ianAtaWNvbjMganAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjNjE2MTYxIiBkPSJNMTkuNDMgMTIuOThjLjA0LS4zMi4wNy0uNjQuMDctLjk4cy0uMDMtLjY2LS4wNy0uOThsMi4xMS0xLjY1Yy4xOS0uMTUuMjQtLjQyLjEyLS42NGwtMi0zLjQ2Yy0uMTItLjIyLS4zOS0uMy0uNjEtLjIybC0yLjQ5IDFjLS41Mi0uNC0xLjA4LS43My0xLjY5LS45OGwtLjM4LTIuNjVBLjQ4OC40ODggMCAwMDE0IDJoLTRjLS4yNSAwLS40Ni4xOC0uNDkuNDJsLS4zOCAyLjY1Yy0uNjEuMjUtMS4xNy41OS0xLjY5Ljk4bC0yLjQ5LTFjLS4yMy0uMDktLjQ5IDAtLjYxLjIybC0yIDMuNDZjLS4xMy4yMi0uMDcuNDkuMTIuNjRsMi4xMSAxLjY1Yy0uMDQuMzItLjA3LjY1LS4wNy45OHMuMDMuNjYuMDcuOThsLTIuMTEgMS42NWMtLjE5LjE1LS4yNC40Mi0uMTIuNjRsMiAzLjQ2Yy4xMi4yMi4zOS4zLjYxLjIybDIuNDktMWMuNTIuNCAxLjA4LjczIDEuNjkuOThsLjM4IDIuNjVjLjAzLjI0LjI0LjQyLjQ5LjQyaDRjLjI1IDAgLjQ2LS4xOC40OS0uNDJsLjM4LTIuNjVjLjYxLS4yNSAxLjE3LS41OSAxLjY5LS45OGwyLjQ5IDFjLjIzLjA5LjQ5IDAgLjYxLS4yMmwyLTMuNDZjLjEyLS4yMi4wNy0uNDktLjEyLS42NGwtMi4xMS0xLjY1ek0xMiAxNS41Yy0xLjkzIDAtMy41LTEuNTctMy41LTMuNXMxLjU3LTMuNSAzLjUtMy41IDMuNSAxLjU3IDMuNSAzLjUtMS41NyAzLjUtMy41IDMuNXoiLz4KPC9zdmc+Cg==);
  --jp-icon-share: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIHZpZXdCb3g9IjAgMCAyNCAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTSAxOCAyIEMgMTYuMzU0OTkgMiAxNSAzLjM1NDk5MDQgMTUgNSBDIDE1IDUuMTkwOTUyOSAxNS4wMjE3OTEgNS4zNzcxMjI0IDE1LjA1NjY0MSA1LjU1ODU5MzggTCA3LjkyMTg3NSA5LjcyMDcwMzEgQyA3LjM5ODUzOTkgOS4yNzc4NTM5IDYuNzMyMDc3MSA5IDYgOSBDIDQuMzU0OTkwNCA5IDMgMTAuMzU0OTkgMyAxMiBDIDMgMTMuNjQ1MDEgNC4zNTQ5OTA0IDE1IDYgMTUgQyA2LjczMjA3NzEgMTUgNy4zOTg1Mzk5IDE0LjcyMjE0NiA3LjkyMTg3NSAxNC4yNzkyOTcgTCAxNS4wNTY2NDEgMTguNDM5NDUzIEMgMTUuMDIxNTU1IDE4LjYyMTUxNCAxNSAxOC44MDgzODYgMTUgMTkgQyAxNSAyMC42NDUwMSAxNi4zNTQ5OSAyMiAxOCAyMiBDIDE5LjY0NTAxIDIyIDIxIDIwLjY0NTAxIDIxIDE5IEMgMjEgMTcuMzU0OTkgMTkuNjQ1MDEgMTYgMTggMTYgQyAxNy4yNjc0OCAxNiAxNi42MDE1OTMgMTYuMjc5MzI4IDE2LjA3ODEyNSAxNi43MjI2NTYgTCA4Ljk0MzM1OTQgMTIuNTU4NTk0IEMgOC45NzgyMDk1IDEyLjM3NzEyMiA5IDEyLjE5MDk1MyA5IDEyIEMgOSAxMS44MDkwNDcgOC45NzgyMDk1IDExLjYyMjg3OCA4Ljk0MzM1OTQgMTEuNDQxNDA2IEwgMTYuMDc4MTI1IDcuMjc5Mjk2OSBDIDE2LjYwMTQ2IDcuNzIyMTQ2MSAxNy4yNjc5MjMgOCAxOCA4IEMgMTkuNjQ1MDEgOCAyMSA2LjY0NTAwOTYgMjEgNSBDIDIxIDMuMzU0OTkwNCAxOS42NDUwMSAyIDE4IDIgeiBNIDE4IDQgQyAxOC41NjQxMjkgNCAxOSA0LjQzNTg3MDYgMTkgNSBDIDE5IDUuNTY0MTI5NCAxOC41NjQxMjkgNiAxOCA2IEMgMTcuNDM1ODcxIDYgMTcgNS41NjQxMjk0IDE3IDUgQyAxNyA0LjQzNTg3MDYgMTcuNDM1ODcxIDQgMTggNCB6IE0gNiAxMSBDIDYuNTY0MTI5NCAxMSA3IDExLjQzNTg3MSA3IDEyIEMgNyAxMi41NjQxMjkgNi41NjQxMjk0IDEzIDYgMTMgQyA1LjQzNTg3MDYgMTMgNSAxMi41NjQxMjkgNSAxMiBDIDUgMTEuNDM1ODcxIDUuNDM1ODcwNiAxMSA2IDExIHogTSAxOCAxOCBDIDE4LjU2NDEyOSAxOCAxOSAxOC40MzU4NzEgMTkgMTkgQyAxOSAxOS41NjQxMjkgMTguNTY0MTI5IDIwIDE4IDIwIEMgMTcuNDM1ODcxIDIwIDE3IDE5LjU2NDEyOSAxNyAxOSBDIDE3IDE4LjQzNTg3MSAxNy40MzU4NzEgMTggMTggMTggeiIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-spreadsheet: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDIyIDIyIj4KICA8cGF0aCBjbGFzcz0ianAtaWNvbi1jb250cmFzdDEganAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjNENBRjUwIiBkPSJNMi4yIDIuMnYxNy42aDE3LjZWMi4ySDIuMnptMTUuNCA3LjdoLTUuNVY0LjRoNS41djUuNXpNOS45IDQuNHY1LjVINC40VjQuNGg1LjV6bS01LjUgNy43aDUuNXY1LjVINC40di01LjV6bTcuNyA1LjV2LTUuNWg1LjV2NS41aC01LjV6Ii8+Cjwvc3ZnPgo=);
  --jp-icon-stop: url(data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxnIGNsYXNzPSJqcC1pY29uMyIgZmlsbD0iIzYxNjE2MSI+CiAgICAgICAgPHBhdGggZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPgogICAgICAgIDxwYXRoIGQ9Ik02IDZoMTJ2MTJINnoiLz4KICAgIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-tab: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTTIxIDNIM2MtMS4xIDAtMiAuOS0yIDJ2MTRjMCAxLjEuOSAyIDIgMmgxOGMxLjEgMCAyLS45IDItMlY1YzAtMS4xLS45LTItMi0yem0wIDE2SDNWNWgxMHY0aDh2MTB6Ii8+CiAgPC9nPgo8L3N2Zz4K);
  --jp-icon-table-rows: url(data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxnIGNsYXNzPSJqcC1pY29uMyIgZmlsbD0iIzYxNjE2MSI+CiAgICAgICAgPHBhdGggZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPgogICAgICAgIDxwYXRoIGQ9Ik0yMSw4SDNWNGgxOFY4eiBNMjEsMTBIM3Y0aDE4VjEweiBNMjEsMTZIM3Y0aDE4VjE2eiIvPgogICAgPC9nPgo8L3N2Zz4K);
  --jp-icon-tag: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjgiIGhlaWdodD0iMjgiIHZpZXdCb3g9IjAgMCA0MyAyOCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KCTxnIGNsYXNzPSJqcC1pY29uMyIgZmlsbD0iIzYxNjE2MSI+CgkJPHBhdGggZD0iTTI4LjgzMzIgMTIuMzM0TDMyLjk5OTggMTYuNTAwN0wzNy4xNjY1IDEyLjMzNEgyOC44MzMyWiIvPgoJCTxwYXRoIGQ9Ik0xNi4yMDk1IDIxLjYxMDRDMTUuNjg3MyAyMi4xMjk5IDE0Ljg0NDMgMjIuMTI5OSAxNC4zMjQ4IDIxLjYxMDRMNi45ODI5IDE0LjcyNDVDNi41NzI0IDE0LjMzOTQgNi4wODMxMyAxMy42MDk4IDYuMDQ3ODYgMTMuMDQ4MkM1Ljk1MzQ3IDExLjUyODggNi4wMjAwMiA4LjYxOTQ0IDYuMDY2MjEgNy4wNzY5NUM2LjA4MjgxIDYuNTE0NzcgNi41NTU0OCA2LjA0MzQ3IDcuMTE4MDQgNi4wMzA1NUM5LjA4ODYzIDUuOTg0NzMgMTMuMjYzOCA1LjkzNTc5IDEzLjY1MTggNi4zMjQyNUwyMS43MzY5IDEzLjYzOUMyMi4yNTYgMTQuMTU4NSAyMS43ODUxIDE1LjQ3MjQgMjEuMjYyIDE1Ljk5NDZMMTYuMjA5NSAyMS42MTA0Wk05Ljc3NTg1IDguMjY1QzkuMzM1NTEgNy44MjU2NiA4LjYyMzUxIDcuODI1NjYgOC4xODI4IDguMjY1QzcuNzQzNDYgOC43MDU3MSA3Ljc0MzQ2IDkuNDE3MzMgOC4xODI4IDkuODU2NjdDOC42MjM4MiAxMC4yOTY0IDkuMzM1ODIgMTAuMjk2NCA5Ljc3NTg1IDkuODU2NjdDMTAuMjE1NiA5LjQxNzMzIDEwLjIxNTYgOC43MDUzMyA5Ljc3NTg1IDguMjY1WiIvPgoJPC9nPgo8L3N2Zz4K);
  --jp-icon-terminal: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0IiA+CiAgICA8cmVjdCBjbGFzcz0ianAtdGVybWluYWwtaWNvbi1iYWNrZ3JvdW5kLWNvbG9yIGpwLWljb24tc2VsZWN0YWJsZSIgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyIDIpIiBmaWxsPSIjMzMzMzMzIi8+CiAgICA8cGF0aCBjbGFzcz0ianAtdGVybWluYWwtaWNvbi1jb2xvciBqcC1pY29uLXNlbGVjdGFibGUtaW52ZXJzZSIgZD0iTTUuMDU2NjQgOC43NjE3MkM1LjA1NjY0IDguNTk3NjYgNS4wMzEyNSA4LjQ1MzEyIDQuOTgwNDcgOC4zMjgxMkM0LjkzMzU5IDguMTk5MjIgNC44NTU0NyA4LjA4MjAzIDQuNzQ2MDkgNy45NzY1NkM0LjY0MDYyIDcuODcxMDkgNC41IDcuNzc1MzkgNC4zMjQyMiA3LjY4OTQ1QzQuMTUyMzQgNy41OTk2MSAzLjk0MzM2IDcuNTExNzIgMy42OTcyNyA3LjQyNTc4QzMuMzAyNzMgNy4yODUxNiAyLjk0MzM2IDcuMTM2NzIgMi42MTkxNCA2Ljk4MDQ3QzIuMjk0OTIgNi44MjQyMiAyLjAxNzU4IDYuNjQyNTggMS43ODcxMSA2LjQzNTU1QzEuNTYwNTUgNi4yMjg1MiAxLjM4NDc3IDUuOTg4MjggMS4yNTk3NyA1LjcxNDg0QzEuMTM0NzcgNS40Mzc1IDEuMDcyMjcgNS4xMDkzOCAxLjA3MjI3IDQuNzMwNDdDMS4wNzIyNyA0LjM5ODQ0IDEuMTI4OTEgNC4wOTU3IDEuMjQyMTkgMy44MjIyN0MxLjM1NTQ3IDMuNTQ0OTIgMS41MTU2MiAzLjMwNDY5IDEuNzIyNjYgMy4xMDE1NkMxLjkyOTY5IDIuODk4NDQgMi4xNzk2OSAyLjczNDM3IDIuNDcyNjYgMi42MDkzOEMyLjc2NTYyIDIuNDg0MzggMy4wOTE4IDIuNDA0MyAzLjQ1MTE3IDIuMzY5MTRWMS4xMDkzOEg0LjM4ODY3VjIuMzgwODZDNC43NDAyMyAyLjQyNzczIDUuMDU2NjQgMi41MjM0NCA1LjMzNzg5IDIuNjY3OTdDNS42MTkxNCAyLjgxMjUgNS44NTc0MiAzLjAwMTk1IDYuMDUyNzMgMy4yMzYzM0M2LjI1MTk1IDMuNDY2OCA2LjQwNDMgMy43NDAyMyA2LjUwOTc3IDQuMDU2NjRDNi42MTkxNCA0LjM2OTE0IDYuNjczODMgNC43MjA3IDYuNjczODMgNS4xMTEzM0g1LjA0NDkyQzUuMDQ0OTIgNC42Mzg2NyA0LjkzNzUgNC4yODEyNSA0LjcyMjY2IDQuMDM5MDZDNC41MDc4MSAzLjc5Mjk3IDQuMjE2OCAzLjY2OTkyIDMuODQ5NjEgMy42Njk5MkMzLjY1MDM5IDMuNjY5OTIgMy40NzY1NiAzLjY5NzI3IDMuMzI4MTIgMy43NTE5NUMzLjE4MzU5IDMuODAyNzMgMy4wNjQ0NSAzLjg3Njk1IDIuOTcwNyAzLjk3NDYxQzIuODc2OTUgNC4wNjgzNiAyLjgwNjY0IDQuMTc5NjkgMi43NTk3NyA0LjMwODU5QzIuNzE2OCA0LjQzNzUgMi42OTUzMSA0LjU3ODEyIDIuNjk1MzEgNC43MzA0N0MyLjY5NTMxIDQuODgyODEgMi43MTY4IDUuMDE5NTMgMi43NTk3NyA1LjE0MDYyQzIuODA2NjQgNS4yNTc4MSAyLjg4MjgxIDUuMzY3MTkgMi45ODgyOCA1LjQ2ODc1QzMuMDk3NjYgNS41NzAzMSAzLjI0MDIzIDUuNjY3OTcgMy40MTYwMiA1Ljc2MTcyQzMuNTkxOCA1Ljg1MTU2IDMuODEwNTUgNS45NDMzNiA0LjA3MjI3IDYuMDM3MTFDNC40NjY4IDYuMTg1NTUgNC44MjQyMiA2LjMzOTg0IDUuMTQ0NTMgNi41QzUuNDY0ODQgNi42NTYyNSA1LjczODI4IDYuODM5ODQgNS45NjQ4NCA3LjA1MDc4QzYuMTk1MzEgNy4yNTc4MSA2LjM3MTA5IDcuNSA2LjQ5MjE5IDcuNzc3MzRDNi42MTcxOSA4LjA1MDc4IDYuNjc5NjkgOC4zNzUgNi42Nzk2OSA4Ljc1QzYuNjc5NjkgOS4wOTM3NSA2LjYyMzA1IDkuNDA0MyA2LjUwOTc3IDkuNjgxNjRDNi4zOTY0OCA5Ljk1NTA4IDYuMjM0MzggMTAuMTkxNCA2LjAyMzQ0IDEwLjM5MDZDNS44MTI1IDEwLjU4OTggNS41NTg1OSAxMC43NSA1LjI2MTcyIDEwLjg3MTFDNC45NjQ4NCAxMC45ODgzIDQuNjMyODEgMTEuMDY0NSA0LjI2NTYyIDExLjA5OTZWMTIuMjQ4SDMuMzMzOThWMTEuMDk5NkMzLjAwMTk1IDExLjA2ODQgMi42Nzk2OSAxMC45OTYxIDIuMzY3MTkgMTAuODgyOEMyLjA1NDY5IDEwLjc2NTYgMS43NzczNCAxMC41OTc3IDEuNTM1MTYgMTAuMzc4OUMxLjI5Njg4IDEwLjE2MDIgMS4xMDU0NyA5Ljg4NDc3IDAuOTYwOTM4IDkuNTUyNzNDMC44MTY0MDYgOS4yMTY4IDAuNzQ0MTQxIDguODE0NDUgMC43NDQxNDEgOC4zNDU3SDIuMzc4OTFDMi4zNzg5MSA4LjYyNjk1IDIuNDE5OTIgOC44NjMyOCAyLjUwMTk1IDkuMDU0NjlDMi41ODM5OCA5LjI0MjE5IDIuNjg5NDUgOS4zOTI1OCAyLjgxODM2IDkuNTA1ODZDMi45NTExNyA5LjYxNTIzIDMuMTAxNTYgOS42OTMzNiAzLjI2OTUzIDkuNzQwMjNDMy40Mzc1IDkuNzg3MTEgMy42MDkzOCA5LjgxMDU1IDMuNzg1MTYgOS44MTA1NUM0LjIwMzEyIDkuODEwNTUgNC41MTk1MyA5LjcxMjg5IDQuNzM0MzggOS41MTc1OEM0Ljk0OTIyIDkuMzIyMjcgNS4wNTY2NCA5LjA3MDMxIDUuMDU2NjQgOC43NjE3MlpNMTMuNDE4IDEyLjI3MTVIOC4wNzQyMlYxMUgxMy40MThWMTIuMjcxNVoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDMuOTUyNjQgNikiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPgo=);
  --jp-icon-text-editor: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8cGF0aCBjbGFzcz0ianAtdGV4dC1lZGl0b3ItaWNvbi1jb2xvciBqcC1pY29uLXNlbGVjdGFibGUiIGZpbGw9IiM2MTYxNjEiIGQ9Ik0xNSAxNUgzdjJoMTJ2LTJ6bTAtOEgzdjJoMTJWN3pNMyAxM2gxOHYtMkgzdjJ6bTAgOGgxOHYtMkgzdjJ6TTMgM3YyaDE4VjNIM3oiLz4KPC9zdmc+Cg==);
  --jp-icon-toc: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8ZyBjbGFzcz0ianAtaWNvbjMganAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjNjE2MTYxIj4KICAgIDxwYXRoIGQ9Ik03LDVIMjFWN0g3VjVNNywxM1YxMUgyMVYxM0g3TTQsNC41QTEuNSwxLjUgMCAwLDEgNS41LDZBMS41LDEuNSAwIDAsMSA0LDcuNUExLjUsMS41IDAgMCwxIDIuNSw2QTEuNSwxLjUgMCAwLDEgNCw0LjVNNCwxMC41QTEuNSwxLjUgMCAwLDEgNS41LDEyQTEuNSwxLjUgMCAwLDEgNCwxMy41QTEuNSwxLjUgMCAwLDEgMi41LDEyQTEuNSwxLjUgMCAwLDEgNCwxMC41TTcsMTlWMTdIMjFWMTlIN000LDE2LjVBMS41LDEuNSAwIDAsMSA1LjUsMThBMS41LDEuNSAwIDAsMSA0LDE5LjVBMS41LDEuNSAwIDAsMSAyLjUsMThBMS41LDEuNSAwIDAsMSA0LDE2LjVaIiAvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-tree-view: url(data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxnIGNsYXNzPSJqcC1pY29uMyIgZmlsbD0iIzYxNjE2MSI+CiAgICAgICAgPHBhdGggZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPgogICAgICAgIDxwYXRoIGQ9Ik0yMiAxMVYzaC03djNIOVYzSDJ2OGg3VjhoMnYxMGg0djNoN3YtOGgtN3YzaC0yVjhoMnYzeiIvPgogICAgPC9nPgo8L3N2Zz4K);
  --jp-icon-trusted: url(data:image/svg+xml;base64,PHN2ZyBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDI0IDI1Ij4KICAgIDxwYXRoIGNsYXNzPSJqcC1pY29uMiIgc3Ryb2tlPSIjMzMzMzMzIiBzdHJva2Utd2lkdGg9IjIiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDIgMykiIGQ9Ik0xLjg2MDk0IDExLjQ0MDlDMC44MjY0NDggOC43NzAyNyAwLjg2Mzc3OSA2LjA1NzY0IDEuMjQ5MDcgNC4xOTkzMkMyLjQ4MjA2IDMuOTMzNDcgNC4wODA2OCAzLjQwMzQ3IDUuNjAxMDIgMi44NDQ5QzcuMjM1NDkgMi4yNDQ0IDguODU2NjYgMS41ODE1IDkuOTg3NiAxLjA5NTM5QzExLjA1OTcgMS41ODM0MSAxMi42MDk0IDIuMjQ0NCAxNC4yMTggMi44NDMzOUMxNS43NTAzIDMuNDEzOTQgMTcuMzk5NSAzLjk1MjU4IDE4Ljc1MzkgNC4yMTM4NUMxOS4xMzY0IDYuMDcxNzcgMTkuMTcwOSA4Ljc3NzIyIDE4LjEzOSAxMS40NDA5QzE3LjAzMDMgMTQuMzAzMiAxNC42NjY4IDE3LjE4NDQgOS45OTk5OSAxOC45MzU0QzUuMzMzMiAxNy4xODQ0IDIuOTY5NjggMTQuMzAzMiAxLjg2MDk0IDExLjQ0MDlaIi8+CiAgICA8cGF0aCBjbGFzcz0ianAtaWNvbjIiIGZpbGw9IiMzMzMzMzMiIHN0cm9rZT0iIzMzMzMzMyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoOCA5Ljg2NzE5KSIgZD0iTTIuODYwMTUgNC44NjUzNUwwLjcyNjU0OSAyLjk5OTU5TDAgMy42MzA0NUwyLjg2MDE1IDYuMTMxNTdMOCAwLjYzMDg3Mkw3LjI3ODU3IDBMMi44NjAxNSA0Ljg2NTM1WiIvPgo8L3N2Zz4K);
  --jp-icon-undo: url(data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIxNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTTEyLjUgOGMtMi42NSAwLTUuMDUuOTktNi45IDIuNkwyIDd2OWg5bC0zLjYyLTMuNjJjMS4zOS0xLjE2IDMuMTYtMS44OCA1LjEyLTEuODggMy41NCAwIDYuNTUgMi4zMSA3LjYgNS41bDIuMzctLjc4QzIxLjA4IDExLjAzIDE3LjE1IDggMTIuNSA4eiIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-user: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIHZpZXdCb3g9IjAgMCAyNCAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZyBjbGFzcz0ianAtaWNvbjMiIGZpbGw9IiM2MTYxNjEiPgogICAgPHBhdGggZD0iTTE2IDdhNCA0IDAgMTEtOCAwIDQgNCAwIDAxOCAwek0xMiAxNGE3IDcgMCAwMC03IDdoMTRhNyA3IDAgMDAtNy03eiIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-users: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDM2IDI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogPGcgY2xhc3M9ImpwLWljb24zIiB0cmFuc2Zvcm09Im1hdHJpeCgxLjczMjcgMCAwIDEuNzMyNyAtMy42MjgyIC4wOTk1NzcpIiBmaWxsPSIjNjE2MTYxIj4KICA8cGF0aCB0cmFuc2Zvcm09Im1hdHJpeCgxLjUsMCwwLDEuNSwwLC02KSIgZD0ibTEyLjE4NiA3LjUwOThjLTEuMDUzNSAwLTEuOTc1NyAwLjU2NjUtMi40Nzg1IDEuNDEwMiAwLjc1MDYxIDAuMzEyNzcgMS4zOTc0IDAuODI2NDggMS44NzMgMS40NzI3aDMuNDg2M2MwLTEuNTkyLTEuMjg4OS0yLjg4MjgtMi44ODA5LTIuODgyOHoiLz4KICA8cGF0aCBkPSJtMjAuNDY1IDIuMzg5NWEyLjE4ODUgMi4xODg1IDAgMCAxLTIuMTg4NCAyLjE4ODUgMi4xODg1IDIuMTg4NSAwIDAgMS0yLjE4ODUtMi4xODg1IDIuMTg4NSAyLjE4ODUgMCAwIDEgMi4xODg1LTIuMTg4NSAyLjE4ODUgMi4xODg1IDAgMCAxIDIuMTg4NCAyLjE4ODV6Ii8+CiAgPHBhdGggdHJhbnNmb3JtPSJtYXRyaXgoMS41LDAsMCwxLjUsMCwtNikiIGQ9Im0zLjU4OTggOC40MjE5Yy0xLjExMjYgMC0yLjAxMzcgMC45MDExMS0yLjAxMzcgMi4wMTM3aDIuODE0NWMwLjI2Nzk3LTAuMzczMDkgMC41OTA3LTAuNzA0MzUgMC45NTg5OC0wLjk3ODUyLTAuMzQ0MzMtMC42MTY4OC0xLjAwMzEtMS4wMzUyLTEuNzU5OC0xLjAzNTJ6Ii8+CiAgPHBhdGggZD0ibTYuOTE1NCA0LjYyM2ExLjUyOTQgMS41Mjk0IDAgMCAxLTEuNTI5NCAxLjUyOTQgMS41Mjk0IDEuNTI5NCAwIDAgMS0xLjUyOTQtMS41Mjk0IDEuNTI5NCAxLjUyOTQgMCAwIDEgMS41Mjk0LTEuNTI5NCAxLjUyOTQgMS41Mjk0IDAgMCAxIDEuNTI5NCAxLjUyOTR6Ii8+CiAgPHBhdGggZD0ibTYuMTM1IDEzLjUzNWMwLTMuMjM5MiAyLjYyNTktNS44NjUgNS44NjUtNS44NjUgMy4yMzkyIDAgNS44NjUgMi42MjU5IDUuODY1IDUuODY1eiIvPgogIDxjaXJjbGUgY3g9IjEyIiBjeT0iMy43Njg1IiByPSIyLjk2ODUiLz4KIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-vega: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDIyIDIyIj4KICA8ZyBjbGFzcz0ianAtaWNvbjEganAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjMjEyMTIxIj4KICAgIDxwYXRoIGQ9Ik0xMC42IDUuNGwyLjItMy4ySDIuMnY3LjNsNC02LjZ6Ii8+CiAgICA8cGF0aCBkPSJNMTUuOCAyLjJsLTQuNCA2LjZMNyA2LjNsLTQuOCA4djUuNWgxNy42VjIuMmgtNHptLTcgMTUuNEg1LjV2LTQuNGgzLjN2NC40em00LjQgMEg5LjhWOS44aDMuNHY3Ljh6bTQuNCAwaC0zLjRWNi41aDMuNHYxMS4xeiIvPgogIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-word: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDIwIDIwIj4KIDxnIGNsYXNzPSJqcC1pY29uMiIgZmlsbD0iIzQxNDE0MSI+CiAgPHJlY3QgeD0iMiIgeT0iMiIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2Ii8+CiA8L2c+CiA8ZyBjbGFzcz0ianAtaWNvbi1hY2NlbnQyIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSguNDMgLjA0MDEpIiBmaWxsPSIjZmZmIj4KICA8cGF0aCBkPSJtNC4xNCA4Ljc2cTAuMDY4Mi0xLjg5IDIuNDItMS44OSAxLjE2IDAgMS42OCAwLjQyIDAuNTY3IDAuNDEgMC41NjcgMS4xNnYzLjQ3cTAgMC40NjIgMC41MTQgMC40NjIgMC4xMDMgMCAwLjItMC4wMjMxdjAuNzE0cS0wLjM5OSAwLjEwMy0wLjY1MSAwLjEwMy0wLjQ1MiAwLTAuNjkzLTAuMjItMC4yMzEtMC4yLTAuMjg0LTAuNjYyLTAuOTU2IDAuODcyLTIgMC44NzItMC45MDMgMC0xLjQ3LTAuNDcyLTAuNTI1LTAuNDcyLTAuNTI1LTEuMjYgMC0wLjI2MiAwLjA0NTItMC40NzIgMC4wNTY3LTAuMjIgMC4xMTYtMC4zNzggMC4wNjgyLTAuMTY4IDAuMjMxLTAuMzA0IDAuMTU4LTAuMTQ3IDAuMjYyLTAuMjQyIDAuMTE2LTAuMDkxNCAwLjM2OC0wLjE2OCAwLjI2Mi0wLjA5MTQgMC4zOTktMC4xMjYgMC4xMzYtMC4wNDUyIDAuNDcyLTAuMTAzIDAuMzM2LTAuMDU3OCAwLjUwNC0wLjA3OTggMC4xNTgtMC4wMjMxIDAuNTY3LTAuMDc5OCAwLjU1Ni0wLjA2ODIgMC43NzctMC4yMjEgMC4yMi0wLjE1MiAwLjIyLTAuNDQxdi0wLjI1MnEwLTAuNDMtMC4zNTctMC42NjItMC4zMzYtMC4yMzEtMC45NzYtMC4yMzEtMC42NjIgMC0wLjk5OCAwLjI2Mi0wLjMzNiAwLjI1Mi0wLjM5OSAwLjc5OHptMS44OSAzLjY4cTAuNzg4IDAgMS4yNi0wLjQxIDAuNTA0LTAuNDIgMC41MDQtMC45MDN2LTEuMDVxLTAuMjg0IDAuMTM2LTAuODYxIDAuMjMxLTAuNTY3IDAuMDkxNC0wLjk4NyAwLjE1OC0wLjQyIDAuMDY4Mi0wLjc2NiAwLjMyNi0wLjMzNiAwLjI1Mi0wLjMzNiAwLjcwNHQwLjMwNCAwLjcwNCAwLjg2MSAwLjI1MnoiIHN0cm9rZS13aWR0aD0iMS4wNSIvPgogIDxwYXRoIGQ9Im0xMCA0LjU2aDAuOTQ1djMuMTVxMC42NTEtMC45NzYgMS44OS0wLjk3NiAxLjE2IDAgMS44OSAwLjg0IDAuNjgyIDAuODQgMC42ODIgMi4zMSAwIDEuNDctMC43MDQgMi40Mi0wLjcwNCAwLjg4Mi0xLjg5IDAuODgyLTEuMjYgMC0xLjg5LTEuMDJ2MC43NjZoLTAuODV6bTIuNjIgMy4wNHEtMC43NDYgMC0xLjE2IDAuNjQtMC40NTIgMC42My0wLjQ1MiAxLjY4IDAgMS4wNSAwLjQ1MiAxLjY4dDEuMTYgMC42M3EwLjc3NyAwIDEuMjYtMC42MyAwLjQ5NC0wLjY0IDAuNDk0LTEuNjggMC0xLjA1LTAuNDcyLTEuNjgtMC40NjItMC42NC0xLjI2LTAuNjR6IiBzdHJva2Utd2lkdGg9IjEuMDUiLz4KICA8cGF0aCBkPSJtMi43MyAxNS44IDEzLjYgMC4wMDgxYzAuMDA2OSAwIDAtMi42IDAtMi42IDAtMC4wMDc4LTEuMTUgMC0xLjE1IDAtMC4wMDY5IDAtMC4wMDgzIDEuNS0wLjAwODMgMS41LTJlLTMgLTAuMDAxNC0xMS4zLTAuMDAxNC0xMS4zLTAuMDAxNGwtMC4wMDU5Mi0xLjVjMC0wLjAwNzgtMS4xNyAwLjAwMTMtMS4xNyAwLjAwMTN6IiBzdHJva2Utd2lkdGg9Ii45NzUiLz4KIDwvZz4KPC9zdmc+Cg==);
  --jp-icon-yaml: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgdmlld0JveD0iMCAwIDIyIDIyIj4KICA8ZyBjbGFzcz0ianAtaWNvbi1jb250cmFzdDIganAtaWNvbi1zZWxlY3RhYmxlIiBmaWxsPSIjRDgxQjYwIj4KICAgIDxwYXRoIGQ9Ik03LjIgMTguNnYtNS40TDMgNS42aDMuM2wxLjQgMy4xYy4zLjkuNiAxLjYgMSAyLjUuMy0uOC42LTEuNiAxLTIuNWwxLjQtMy4xaDMuNGwtNC40IDcuNnY1LjVsLTIuOS0uMXoiLz4KICAgIDxjaXJjbGUgY2xhc3M9InN0MCIgY3g9IjE3LjYiIGN5PSIxNi41IiByPSIyLjEiLz4KICAgIDxjaXJjbGUgY2xhc3M9InN0MCIgY3g9IjE3LjYiIGN5PSIxMSIgcj0iMi4xIi8+CiAgPC9nPgo8L3N2Zz4K);
}

/* Icon CSS class declarations */

.jp-AddAboveIcon {
  background-image: var(--jp-icon-add-above);
}

.jp-AddBelowIcon {
  background-image: var(--jp-icon-add-below);
}

.jp-AddIcon {
  background-image: var(--jp-icon-add);
}

.jp-BellIcon {
  background-image: var(--jp-icon-bell);
}

.jp-BugDotIcon {
  background-image: var(--jp-icon-bug-dot);
}

.jp-BugIcon {
  background-image: var(--jp-icon-bug);
}

.jp-BuildIcon {
  background-image: var(--jp-icon-build);
}

.jp-CaretDownEmptyIcon {
  background-image: var(--jp-icon-caret-down-empty);
}

.jp-CaretDownEmptyThinIcon {
  background-image: var(--jp-icon-caret-down-empty-thin);
}

.jp-CaretDownIcon {
  background-image: var(--jp-icon-caret-down);
}

.jp-CaretLeftIcon {
  background-image: var(--jp-icon-caret-left);
}

.jp-CaretRightIcon {
  background-image: var(--jp-icon-caret-right);
}

.jp-CaretUpEmptyThinIcon {
  background-image: var(--jp-icon-caret-up-empty-thin);
}

.jp-CaretUpIcon {
  background-image: var(--jp-icon-caret-up);
}

.jp-CaseSensitiveIcon {
  background-image: var(--jp-icon-case-sensitive);
}

.jp-CheckIcon {
  background-image: var(--jp-icon-check);
}

.jp-CircleEmptyIcon {
  background-image: var(--jp-icon-circle-empty);
}

.jp-CircleIcon {
  background-image: var(--jp-icon-circle);
}

.jp-ClearIcon {
  background-image: var(--jp-icon-clear);
}

.jp-CloseIcon {
  background-image: var(--jp-icon-close);
}

.jp-CodeCheckIcon {
  background-image: var(--jp-icon-code-check);
}

.jp-CodeIcon {
  background-image: var(--jp-icon-code);
}

.jp-CollapseAllIcon {
  background-image: var(--jp-icon-collapse-all);
}

.jp-ConsoleIcon {
  background-image: var(--jp-icon-console);
}

.jp-CopyIcon {
  background-image: var(--jp-icon-copy);
}

.jp-CopyrightIcon {
  background-image: var(--jp-icon-copyright);
}

.jp-CutIcon {
  background-image: var(--jp-icon-cut);
}

.jp-DeleteIcon {
  background-image: var(--jp-icon-delete);
}

.jp-DownloadIcon {
  background-image: var(--jp-icon-download);
}

.jp-DuplicateIcon {
  background-image: var(--jp-icon-duplicate);
}

.jp-EditIcon {
  background-image: var(--jp-icon-edit);
}

.jp-EllipsesIcon {
  background-image: var(--jp-icon-ellipses);
}

.jp-ErrorIcon {
  background-image: var(--jp-icon-error);
}

.jp-ExpandAllIcon {
  background-image: var(--jp-icon-expand-all);
}

.jp-ExtensionIcon {
  background-image: var(--jp-icon-extension);
}

.jp-FastForwardIcon {
  background-image: var(--jp-icon-fast-forward);
}

.jp-FileIcon {
  background-image: var(--jp-icon-file);
}

.jp-FileUploadIcon {
  background-image: var(--jp-icon-file-upload);
}

.jp-FilterDotIcon {
  background-image: var(--jp-icon-filter-dot);
}

.jp-FilterIcon {
  background-image: var(--jp-icon-filter);
}

.jp-FilterListIcon {
  background-image: var(--jp-icon-filter-list);
}

.jp-FolderFavoriteIcon {
  background-image: var(--jp-icon-folder-favorite);
}

.jp-FolderIcon {
  background-image: var(--jp-icon-folder);
}

.jp-HomeIcon {
  background-image: var(--jp-icon-home);
}

.jp-Html5Icon {
  background-image: var(--jp-icon-html5);
}

.jp-ImageIcon {
  background-image: var(--jp-icon-image);
}

.jp-InfoIcon {
  background-image: var(--jp-icon-info);
}

.jp-InspectorIcon {
  background-image: var(--jp-icon-inspector);
}

.jp-JsonIcon {
  background-image: var(--jp-icon-json);
}

.jp-JuliaIcon {
  background-image: var(--jp-icon-julia);
}

.jp-JupyterFaviconIcon {
  background-image: var(--jp-icon-jupyter-favicon);
}

.jp-JupyterIcon {
  background-image: var(--jp-icon-jupyter);
}

.jp-JupyterlabWordmarkIcon {
  background-image: var(--jp-icon-jupyterlab-wordmark);
}

.jp-KernelIcon {
  background-image: var(--jp-icon-kernel);
}

.jp-KeyboardIcon {
  background-image: var(--jp-icon-keyboard);
}

.jp-LaunchIcon {
  background-image: var(--jp-icon-launch);
}

.jp-LauncherIcon {
  background-image: var(--jp-icon-launcher);
}

.jp-LineFormIcon {
  background-image: var(--jp-icon-line-form);
}

.jp-LinkIcon {
  background-image: var(--jp-icon-link);
}

.jp-ListIcon {
  background-image: var(--jp-icon-list);
}

.jp-MarkdownIcon {
  background-image: var(--jp-icon-markdown);
}

.jp-MoveDownIcon {
  background-image: var(--jp-icon-move-down);
}

.jp-MoveUpIcon {
  background-image: var(--jp-icon-move-up);
}

.jp-NewFolderIcon {
  background-image: var(--jp-icon-new-folder);
}

.jp-NotTrustedIcon {
  background-image: var(--jp-icon-not-trusted);
}

.jp-NotebookIcon {
  background-image: var(--jp-icon-notebook);
}

.jp-NumberingIcon {
  background-image: var(--jp-icon-numbering);
}

.jp-OfflineBoltIcon {
  background-image: var(--jp-icon-offline-bolt);
}

.jp-PaletteIcon {
  background-image: var(--jp-icon-palette);
}

.jp-PasteIcon {
  background-image: var(--jp-icon-paste);
}

.jp-PdfIcon {
  background-image: var(--jp-icon-pdf);
}

.jp-PythonIcon {
  background-image: var(--jp-icon-python);
}

.jp-RKernelIcon {
  background-image: var(--jp-icon-r-kernel);
}

.jp-ReactIcon {
  background-image: var(--jp-icon-react);
}

.jp-RedoIcon {
  background-image: var(--jp-icon-redo);
}

.jp-RefreshIcon {
  background-image: var(--jp-icon-refresh);
}

.jp-RegexIcon {
  background-image: var(--jp-icon-regex);
}

.jp-RunIcon {
  background-image: var(--jp-icon-run);
}

.jp-RunningIcon {
  background-image: var(--jp-icon-running);
}

.jp-SaveIcon {
  background-image: var(--jp-icon-save);
}

.jp-SearchIcon {
  background-image: var(--jp-icon-search);
}

.jp-SettingsIcon {
  background-image: var(--jp-icon-settings);
}

.jp-ShareIcon {
  background-image: var(--jp-icon-share);
}

.jp-SpreadsheetIcon {
  background-image: var(--jp-icon-spreadsheet);
}

.jp-StopIcon {
  background-image: var(--jp-icon-stop);
}

.jp-TabIcon {
  background-image: var(--jp-icon-tab);
}

.jp-TableRowsIcon {
  background-image: var(--jp-icon-table-rows);
}

.jp-TagIcon {
  background-image: var(--jp-icon-tag);
}

.jp-TerminalIcon {
  background-image: var(--jp-icon-terminal);
}

.jp-TextEditorIcon {
  background-image: var(--jp-icon-text-editor);
}

.jp-TocIcon {
  background-image: var(--jp-icon-toc);
}

.jp-TreeViewIcon {
  background-image: var(--jp-icon-tree-view);
}

.jp-TrustedIcon {
  background-image: var(--jp-icon-trusted);
}

.jp-UndoIcon {
  background-image: var(--jp-icon-undo);
}

.jp-UserIcon {
  background-image: var(--jp-icon-user);
}

.jp-UsersIcon {
  background-image: var(--jp-icon-users);
}

.jp-VegaIcon {
  background-image: var(--jp-icon-vega);
}

.jp-WordIcon {
  background-image: var(--jp-icon-word);
}

.jp-YamlIcon {
  background-image: var(--jp-icon-yaml);
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/**
 * (DEPRECATED) Support for consuming icons as CSS background images
 */

.jp-Icon,
.jp-MaterialIcon {
  background-position: center;
  background-repeat: no-repeat;
  background-size: 16px;
  min-width: 16px;
  min-height: 16px;
}

.jp-Icon-cover {
  background-position: center;
  background-repeat: no-repeat;
  background-size: cover;
}

/**
 * (DEPRECATED) Support for specific CSS icon sizes
 */

.jp-Icon-16 {
  background-size: 16px;
  min-width: 16px;
  min-height: 16px;
}

.jp-Icon-18 {
  background-size: 18px;
  min-width: 18px;
  min-height: 18px;
}

.jp-Icon-20 {
  background-size: 20px;
  min-width: 20px;
  min-height: 20px;
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

.lm-TabBar .lm-TabBar-addButton {
  align-items: center;
  display: flex;
  padding: 4px;
  padding-bottom: 5px;
  margin-right: 1px;
  background-color: var(--jp-layout-color2);
}

.lm-TabBar .lm-TabBar-addButton:hover {
  background-color: var(--jp-layout-color1);
}

.lm-DockPanel-tabBar .lm-TabBar-tab {
  width: var(--jp-private-horizontal-tab-width);
}

.lm-DockPanel-tabBar .lm-TabBar-content {
  flex: unset;
}

.lm-DockPanel-tabBar[data-orientation='horizontal'] {
  flex: 1 1 auto;
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/**
 * Support for icons as inline SVG HTMLElements
 */

/* recolor the primary elements of an icon */
.jp-icon0[fill] {
  fill: var(--jp-inverse-layout-color0);
}

.jp-icon1[fill] {
  fill: var(--jp-inverse-layout-color1);
}

.jp-icon2[fill] {
  fill: var(--jp-inverse-layout-color2);
}

.jp-icon3[fill] {
  fill: var(--jp-inverse-layout-color3);
}

.jp-icon4[fill] {
  fill: var(--jp-inverse-layout-color4);
}

.jp-icon0[stroke] {
  stroke: var(--jp-inverse-layout-color0);
}

.jp-icon1[stroke] {
  stroke: var(--jp-inverse-layout-color1);
}

.jp-icon2[stroke] {
  stroke: var(--jp-inverse-layout-color2);
}

.jp-icon3[stroke] {
  stroke: var(--jp-inverse-layout-color3);
}

.jp-icon4[stroke] {
  stroke: var(--jp-inverse-layout-color4);
}

/* recolor the accent elements of an icon */
.jp-icon-accent0[fill] {
  fill: var(--jp-layout-color0);
}

.jp-icon-accent1[fill] {
  fill: var(--jp-layout-color1);
}

.jp-icon-accent2[fill] {
  fill: var(--jp-layout-color2);
}

.jp-icon-accent3[fill] {
  fill: var(--jp-layout-color3);
}

.jp-icon-accent4[fill] {
  fill: var(--jp-layout-color4);
}

.jp-icon-accent0[stroke] {
  stroke: var(--jp-layout-color0);
}

.jp-icon-accent1[stroke] {
  stroke: var(--jp-layout-color1);
}

.jp-icon-accent2[stroke] {
  stroke: var(--jp-layout-color2);
}

.jp-icon-accent3[stroke] {
  stroke: var(--jp-layout-color3);
}

.jp-icon-accent4[stroke] {
  stroke: var(--jp-layout-color4);
}

/* set the color of an icon to transparent */
.jp-icon-none[fill] {
  fill: none;
}

.jp-icon-none[stroke] {
  stroke: none;
}

/* brand icon colors. Same for light and dark */
.jp-icon-brand0[fill] {
  fill: var(--jp-brand-color0);
}

.jp-icon-brand1[fill] {
  fill: var(--jp-brand-color1);
}

.jp-icon-brand2[fill] {
  fill: var(--jp-brand-color2);
}

.jp-icon-brand3[fill] {
  fill: var(--jp-brand-color3);
}

.jp-icon-brand4[fill] {
  fill: var(--jp-brand-color4);
}

.jp-icon-brand0[stroke] {
  stroke: var(--jp-brand-color0);
}

.jp-icon-brand1[stroke] {
  stroke: var(--jp-brand-color1);
}

.jp-icon-brand2[stroke] {
  stroke: var(--jp-brand-color2);
}

.jp-icon-brand3[stroke] {
  stroke: var(--jp-brand-color3);
}

.jp-icon-brand4[stroke] {
  stroke: var(--jp-brand-color4);
}

/* warn icon colors. Same for light and dark */
.jp-icon-warn0[fill] {
  fill: var(--jp-warn-color0);
}

.jp-icon-warn1[fill] {
  fill: var(--jp-warn-color1);
}

.jp-icon-warn2[fill] {
  fill: var(--jp-warn-color2);
}

.jp-icon-warn3[fill] {
  fill: var(--jp-warn-color3);
}

.jp-icon-warn0[stroke] {
  stroke: var(--jp-warn-color0);
}

.jp-icon-warn1[stroke] {
  stroke: var(--jp-warn-color1);
}

.jp-icon-warn2[stroke] {
  stroke: var(--jp-warn-color2);
}

.jp-icon-warn3[stroke] {
  stroke: var(--jp-warn-color3);
}

/* icon colors that contrast well with each other and most backgrounds */
.jp-icon-contrast0[fill] {
  fill: var(--jp-icon-contrast-color0);
}

.jp-icon-contrast1[fill] {
  fill: var(--jp-icon-contrast-color1);
}

.jp-icon-contrast2[fill] {
  fill: var(--jp-icon-contrast-color2);
}

.jp-icon-contrast3[fill] {
  fill: var(--jp-icon-contrast-color3);
}

.jp-icon-contrast0[stroke] {
  stroke: var(--jp-icon-contrast-color0);
}

.jp-icon-contrast1[stroke] {
  stroke: var(--jp-icon-contrast-color1);
}

.jp-icon-contrast2[stroke] {
  stroke: var(--jp-icon-contrast-color2);
}

.jp-icon-contrast3[stroke] {
  stroke: var(--jp-icon-contrast-color3);
}

.jp-icon-dot[fill] {
  fill: var(--jp-warn-color0);
}

.jp-jupyter-icon-color[fill] {
  fill: var(--jp-jupyter-icon-color, var(--jp-warn-color0));
}

.jp-notebook-icon-color[fill] {
  fill: var(--jp-notebook-icon-color, var(--jp-warn-color0));
}

.jp-json-icon-color[fill] {
  fill: var(--jp-json-icon-color, var(--jp-warn-color1));
}

.jp-console-icon-color[fill] {
  fill: var(--jp-console-icon-color, white);
}

.jp-console-icon-background-color[fill] {
  fill: var(--jp-console-icon-background-color, var(--jp-brand-color1));
}

.jp-terminal-icon-color[fill] {
  fill: var(--jp-terminal-icon-color, var(--jp-layout-color2));
}

.jp-terminal-icon-background-color[fill] {
  fill: var(
    --jp-terminal-icon-background-color,
    var(--jp-inverse-layout-color2)
  );
}

.jp-text-editor-icon-color[fill] {
  fill: var(--jp-text-editor-icon-color, var(--jp-inverse-layout-color3));
}

.jp-inspector-icon-color[fill] {
  fill: var(--jp-inspector-icon-color, var(--jp-inverse-layout-color3));
}

/* CSS for icons in selected filebrowser listing items */
.jp-DirListing-item.jp-mod-selected .jp-icon-selectable[fill] {
  fill: #fff;
}

.jp-DirListing-item.jp-mod-selected .jp-icon-selectable-inverse[fill] {
  fill: var(--jp-brand-color1);
}

/* stylelint-disable selector-max-class, selector-max-compound-selectors */

/**
* TODO: come up with non css-hack solution for showing the busy icon on top
*  of the close icon
* CSS for complex behavior of close icon of tabs in the main area tabbar
*/
.lm-DockPanel-tabBar
  .lm-TabBar-tab.lm-mod-closable.jp-mod-dirty
  > .lm-TabBar-tabCloseIcon
  > :not(:hover)
  > .jp-icon3[fill] {
  fill: none;
}

.lm-DockPanel-tabBar
  .lm-TabBar-tab.lm-mod-closable.jp-mod-dirty
  > .lm-TabBar-tabCloseIcon
  > :not(:hover)
  > .jp-icon-busy[fill] {
  fill: var(--jp-inverse-layout-color3);
}

/* stylelint-enable selector-max-class, selector-max-compound-selectors */

/* CSS for icons in status bar */
#jp-main-statusbar .jp-mod-selected .jp-icon-selectable[fill] {
  fill: #fff;
}

#jp-main-statusbar .jp-mod-selected .jp-icon-selectable-inverse[fill] {
  fill: var(--jp-brand-color1);
}

/* special handling for splash icon CSS. While the theme CSS reloads during
   splash, the splash icon can loose theming. To prevent that, we set a
   default for its color variable */
:root {
  --jp-warn-color0: var(--md-orange-700);
}

/* not sure what to do with this one, used in filebrowser listing */
.jp-DragIcon {
  margin-right: 4px;
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/**
 * Support for alt colors for icons as inline SVG HTMLElements
 */

/* alt recolor the primary elements of an icon */
.jp-icon-alt .jp-icon0[fill] {
  fill: var(--jp-layout-color0);
}

.jp-icon-alt .jp-icon1[fill] {
  fill: var(--jp-layout-color1);
}

.jp-icon-alt .jp-icon2[fill] {
  fill: var(--jp-layout-color2);
}

.jp-icon-alt .jp-icon3[fill] {
  fill: var(--jp-layout-color3);
}

.jp-icon-alt .jp-icon4[fill] {
  fill: var(--jp-layout-color4);
}

.jp-icon-alt .jp-icon0[stroke] {
  stroke: var(--jp-layout-color0);
}

.jp-icon-alt .jp-icon1[stroke] {
  stroke: var(--jp-layout-color1);
}

.jp-icon-alt .jp-icon2[stroke] {
  stroke: var(--jp-layout-color2);
}

.jp-icon-alt .jp-icon3[stroke] {
  stroke: var(--jp-layout-color3);
}

.jp-icon-alt .jp-icon4[stroke] {
  stroke: var(--jp-layout-color4);
}

/* alt recolor the accent elements of an icon */
.jp-icon-alt .jp-icon-accent0[fill] {
  fill: var(--jp-inverse-layout-color0);
}

.jp-icon-alt .jp-icon-accent1[fill] {
  fill: var(--jp-inverse-layout-color1);
}

.jp-icon-alt .jp-icon-accent2[fill] {
  fill: var(--jp-inverse-layout-color2);
}

.jp-icon-alt .jp-icon-accent3[fill] {
  fill: var(--jp-inverse-layout-color3);
}

.jp-icon-alt .jp-icon-accent4[fill] {
  fill: var(--jp-inverse-layout-color4);
}

.jp-icon-alt .jp-icon-accent0[stroke] {
  stroke: var(--jp-inverse-layout-color0);
}

.jp-icon-alt .jp-icon-accent1[stroke] {
  stroke: var(--jp-inverse-layout-color1);
}

.jp-icon-alt .jp-icon-accent2[stroke] {
  stroke: var(--jp-inverse-layout-color2);
}

.jp-icon-alt .jp-icon-accent3[stroke] {
  stroke: var(--jp-inverse-layout-color3);
}

.jp-icon-alt .jp-icon-accent4[stroke] {
  stroke: var(--jp-inverse-layout-color4);
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

.jp-icon-hoverShow:not(:hover) .jp-icon-hoverShow-content {
  display: none !important;
}

/**
 * Support for hover colors for icons as inline SVG HTMLElements
 */

/**
 * regular colors
 */

/* recolor the primary elements of an icon */
.jp-icon-hover :hover .jp-icon0-hover[fill] {
  fill: var(--jp-inverse-layout-color0);
}

.jp-icon-hover :hover .jp-icon1-hover[fill] {
  fill: var(--jp-inverse-layout-color1);
}

.jp-icon-hover :hover .jp-icon2-hover[fill] {
  fill: var(--jp-inverse-layout-color2);
}

.jp-icon-hover :hover .jp-icon3-hover[fill] {
  fill: var(--jp-inverse-layout-color3);
}

.jp-icon-hover :hover .jp-icon4-hover[fill] {
  fill: var(--jp-inverse-layout-color4);
}

.jp-icon-hover :hover .jp-icon0-hover[stroke] {
  stroke: var(--jp-inverse-layout-color0);
}

.jp-icon-hover :hover .jp-icon1-hover[stroke] {
  stroke: var(--jp-inverse-layout-color1);
}

.jp-icon-hover :hover .jp-icon2-hover[stroke] {
  stroke: var(--jp-inverse-layout-color2);
}

.jp-icon-hover :hover .jp-icon3-hover[stroke] {
  stroke: var(--jp-inverse-layout-color3);
}

.jp-icon-hover :hover .jp-icon4-hover[stroke] {
  stroke: var(--jp-inverse-layout-color4);
}

/* recolor the accent elements of an icon */
.jp-icon-hover :hover .jp-icon-accent0-hover[fill] {
  fill: var(--jp-layout-color0);
}

.jp-icon-hover :hover .jp-icon-accent1-hover[fill] {
  fill: var(--jp-layout-color1);
}

.jp-icon-hover :hover .jp-icon-accent2-hover[fill] {
  fill: var(--jp-layout-color2);
}

.jp-icon-hover :hover .jp-icon-accent3-hover[fill] {
  fill: var(--jp-layout-color3);
}

.jp-icon-hover :hover .jp-icon-accent4-hover[fill] {
  fill: var(--jp-layout-color4);
}

.jp-icon-hover :hover .jp-icon-accent0-hover[stroke] {
  stroke: var(--jp-layout-color0);
}

.jp-icon-hover :hover .jp-icon-accent1-hover[stroke] {
  stroke: var(--jp-layout-color1);
}

.jp-icon-hover :hover .jp-icon-accent2-hover[stroke] {
  stroke: var(--jp-layout-color2);
}

.jp-icon-hover :hover .jp-icon-accent3-hover[stroke] {
  stroke: var(--jp-layout-color3);
}

.jp-icon-hover :hover .jp-icon-accent4-hover[stroke] {
  stroke: var(--jp-layout-color4);
}

/* set the color of an icon to transparent */
.jp-icon-hover :hover .jp-icon-none-hover[fill] {
  fill: none;
}

.jp-icon-hover :hover .jp-icon-none-hover[stroke] {
  stroke: none;
}

/**
 * inverse colors
 */

/* inverse recolor the primary elements of an icon */
.jp-icon-hover.jp-icon-alt :hover .jp-icon0-hover[fill] {
  fill: var(--jp-layout-color0);
}

.jp-icon-hover.jp-icon-alt :hover .jp-icon1-hover[fill] {
  fill: var(--jp-layout-color1);
}

.jp-icon-hover.jp-icon-alt :hover .jp-icon2-hover[fill] {
  fill: var(--jp-layout-color2);
}

.jp-icon-hover.jp-icon-alt :hover .jp-icon3-hover[fill] {
  fill: var(--jp-layout-color3);
}

.jp-icon-hover.jp-icon-alt :hover .jp-icon4-hover[fill] {
  fill: var(--jp-layout-color4);
}

.jp-icon-hover.jp-icon-alt :hover .jp-icon0-hover[stroke] {
  stroke: var(--jp-layout-color0);
}

.jp-icon-hover.jp-icon-alt :hover .jp-icon1-hover[stroke] {
  stroke: var(--jp-layout-color1);
}

.jp-icon-hover.jp-icon-alt :hover .jp-icon2-hover[stroke] {
  stroke: var(--jp-layout-color2);
}

.jp-icon-hover.jp-icon-alt :hover .jp-icon3-hover[stroke] {
  stroke: var(--jp-layout-color3);
}

.jp-icon-hover.jp-icon-alt :hover .jp-icon4-hover[stroke] {
  stroke: var(--jp-layout-color4);
}

/* inverse recolor the accent elements of an icon */
.jp-icon-hover.jp-icon-alt :hover .jp-icon-accent0-hover[fill] {
  fill: var(--jp-inverse-layout-color0);
}

.jp-icon-hover.jp-icon-alt :hover .jp-icon-accent1-hover[fill] {
  fill: var(--jp-inverse-layout-color1);
}

.jp-icon-hover.jp-icon-alt :hover .jp-icon-accent2-hover[fill] {
  fill: var(--jp-inverse-layout-color2);
}

.jp-icon-hover.jp-icon-alt :hover .jp-icon-accent3-hover[fill] {
  fill: var(--jp-inverse-layout-color3);
}

.jp-icon-hover.jp-icon-alt :hover .jp-icon-accent4-hover[fill] {
  fill: var(--jp-inverse-layout-color4);
}

.jp-icon-hover.jp-icon-alt :hover .jp-icon-accent0-hover[stroke] {
  stroke: var(--jp-inverse-layout-color0);
}

.jp-icon-hover.jp-icon-alt :hover .jp-icon-accent1-hover[stroke] {
  stroke: var(--jp-inverse-layout-color1);
}

.jp-icon-hover.jp-icon-alt :hover .jp-icon-accent2-hover[stroke] {
  stroke: var(--jp-inverse-layout-color2);
}

.jp-icon-hover.jp-icon-alt :hover .jp-icon-accent3-hover[stroke] {
  stroke: var(--jp-inverse-layout-color3);
}

.jp-icon-hover.jp-icon-alt :hover .jp-icon-accent4-hover[stroke] {
  stroke: var(--jp-inverse-layout-color4);
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

.jp-IFrame {
  width: 100%;
  height: 100%;
}

.jp-IFrame > iframe {
  border: none;
}

/*
When drag events occur, `lm-mod-override-cursor` is added to the body.
Because iframes steal all cursor events, the following two rules are necessary
to suppress pointer events while resize drags are occurring. There may be a
better solution to this problem.
*/
body.lm-mod-override-cursor .jp-IFrame {
  position: relative;
}

body.lm-mod-override-cursor .jp-IFrame::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: transparent;
}

/*-----------------------------------------------------------------------------
| Copyright (c) 2014-2016, Jupyter Development Team.
|
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

.jp-HoverBox {
  position: fixed;
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

.jp-FormGroup-content fieldset {
  border: none;
  padding: 0;
  min-width: 0;
  width: 100%;
}

/* stylelint-disable selector-max-type */

.jp-FormGroup-content fieldset .jp-inputFieldWrapper input,
.jp-FormGroup-content fieldset .jp-inputFieldWrapper select,
.jp-FormGroup-content fieldset .jp-inputFieldWrapper textarea {
  font-size: var(--jp-content-font-size2);
  border-color: var(--jp-input-border-color);
  border-style: solid;
  border-radius: var(--jp-border-radius);
  border-width: 1px;
  padding: 6px 8px;
  background: none;
  color: var(--jp-ui-font-color0);
  height: inherit;
}

.jp-FormGroup-content fieldset input[type='checkbox'] {
  position: relative;
  top: 2px;
  margin-left: 0;
}

.jp-FormGroup-content button.jp-mod-styled {
  cursor: pointer;
}

.jp-FormGroup-content .checkbox label {
  cursor: pointer;
  font-size: var(--jp-content-font-size1);
}

.jp-FormGroup-content .jp-root > fieldset > legend {
  display: none;
}

.jp-FormGroup-content .jp-root > fieldset > p {
  display: none;
}

/** copy of `input.jp-mod-styled:focus` style */
.jp-FormGroup-content fieldset input:focus,
.jp-FormGroup-content fieldset select:focus {
  -moz-outline-radius: unset;
  outline: var(--jp-border-width) solid var(--md-blue-500);
  outline-offset: -1px;
  box-shadow: inset 0 0 4px var(--md-blue-300);
}

.jp-FormGroup-content fieldset input:hover:not(:focus),
.jp-FormGroup-content fieldset select:hover:not(:focus) {
  background-color: var(--jp-border-color2);
}

/* stylelint-enable selector-max-type */

.jp-FormGroup-content .checkbox .field-description {
  /* Disable default description field for checkbox:
   because other widgets do not have description fields,
   we add descriptions to each widget on the field level.
  */
  display: none;
}

.jp-FormGroup-content #root__description {
  display: none;
}

.jp-FormGroup-content .jp-modifiedIndicator {
  width: 5px;
  background-color: var(--jp-brand-color2);
  margin-top: 0;
  margin-left: calc(var(--jp-private-settingeditor-modifier-indent) * -1);
  flex-shrink: 0;
}

.jp-FormGroup-content .jp-modifiedIndicator.jp-errorIndicator {
  background-color: var(--jp-error-color0);
  margin-right: 0.5em;
}

/* RJSF ARRAY style */

.jp-arrayFieldWrapper legend {
  font-size: var(--jp-content-font-size2);
  color: var(--jp-ui-font-color0);
  flex-basis: 100%;
  padding: 4px 0;
  font-weight: var(--jp-content-heading-font-weight);
  border-bottom: 1px solid var(--jp-border-color2);
}

.jp-arrayFieldWrapper .field-description {
  padding: 4px 0;
  white-space: pre-wrap;
}

.jp-arrayFieldWrapper .array-item {
  width: 100%;
  border: 1px solid var(--jp-border-color2);
  border-radius: 4px;
  margin: 4px;
}

.jp-ArrayOperations {
  display: flex;
  margin-left: 8px;
}

.jp-ArrayOperationsButton {
  margin: 2px;
}

.jp-ArrayOperationsButton .jp-icon3[fill] {
  fill: var(--jp-ui-font-color0);
}

button.jp-ArrayOperationsButton.jp-mod-styled:disabled {
  cursor: not-allowed;
  opacity: 0.5;
}

/* RJSF form validation error */

.jp-FormGroup-content .validationErrors {
  color: var(--jp-error-color0);
}

/* Hide panel level error as duplicated the field level error */
.jp-FormGroup-content .panel.errors {
  display: none;
}

/* RJSF normal content (settings-editor) */

.jp-FormGroup-contentNormal {
  display: flex;
  align-items: center;
  flex-wrap: wrap;
}

.jp-FormGroup-contentNormal .jp-FormGroup-contentItem {
  margin-left: 7px;
  color: var(--jp-ui-font-color0);
}

.jp-FormGroup-contentNormal .jp-FormGroup-description {
  flex-basis: 100%;
  padding: 4px 7px;
}

.jp-FormGroup-contentNormal .jp-FormGroup-default {
  flex-basis: 100%;
  padding: 4px 7px;
}

.jp-FormGroup-contentNormal .jp-FormGroup-fieldLabel {
  font-size: var(--jp-content-font-size1);
  font-weight: normal;
  min-width: 120px;
}

.jp-FormGroup-contentNormal fieldset:not(:first-child) {
  margin-left: 7px;
}

.jp-FormGroup-contentNormal .field-array-of-string .array-item {
  /* Display `jp-ArrayOperations` buttons side-by-side with content except
    for small screens where flex-wrap will place them one below the other.
  */
  display: flex;
  align-items: center;
  flex-wrap: wrap;
}

.jp-FormGroup-contentNormal .jp-objectFieldWrapper .form-group {
  padding: 2px 8px 2px var(--jp-private-settingeditor-modifier-indent);
  margin-top: 2px;
}

/* RJSF compact content (metadata-form) */

.jp-FormGroup-content.jp-FormGroup-contentCompact {
  width: 100%;
}

.jp-FormGroup-contentCompact .form-group {
  display: flex;
  padding: 0.5em 0.2em 0.5em 0;
}

.jp-FormGroup-contentCompact
  .jp-FormGroup-compactTitle
  .jp-FormGroup-description {
  font-size: var(--jp-ui-font-size1);
  color: var(--jp-ui-font-color2);
}

.jp-FormGroup-contentCompact .jp-FormGroup-fieldLabel {
  padding-bottom: 0.3em;
}

.jp-FormGroup-contentCompact .jp-inputFieldWrapper .form-control {
  width: 100%;
  box-sizing: border-box;
}

.jp-FormGroup-contentCompact .jp-arrayFieldWrapper .jp-FormGroup-compactTitle {
  padding-bottom: 7px;
}

.jp-FormGroup-contentCompact
  .jp-objectFieldWrapper
  .jp-objectFieldWrapper
  .form-group {
  padding: 2px 8px 2px var(--jp-private-settingeditor-modifier-indent);
  margin-top: 2px;
}

.jp-FormGroup-contentCompact ul.error-detail {
  margin-block-start: 0.5em;
  margin-block-end: 0.5em;
  padding-inline-start: 1em;
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

.jp-SidePanel {
  display: flex;
  flex-direction: column;
  min-width: var(--jp-sidebar-min-width);
  overflow-y: auto;
  color: var(--jp-ui-font-color1);
  background: var(--jp-layout-color1);
  font-size: var(--jp-ui-font-size1);
}

.jp-SidePanel-header {
  flex: 0 0 auto;
  display: flex;
  border-bottom: var(--jp-border-width) solid var(--jp-border-color2);
  font-size: var(--jp-ui-font-size0);
  font-weight: 600;
  letter-spacing: 1px;
  margin: 0;
  padding: 2px;
  text-transform: uppercase;
}

.jp-SidePanel-toolbar {
  flex: 0 0 auto;
}

.jp-SidePanel-content {
  flex: 1 1 auto;
}

.jp-SidePanel-toolbar,
.jp-AccordionPanel-toolbar {
  height: var(--jp-private-toolbar-height);
}

.jp-SidePanel-toolbar.jp-Toolbar-micro {
  display: none;
}

.lm-AccordionPanel .jp-AccordionPanel-title {
  box-sizing: border-box;
  line-height: 25px;
  margin: 0;
  display: flex;
  align-items: center;
  background: var(--jp-layout-color1);
  color: var(--jp-ui-font-color1);
  border-bottom: var(--jp-border-width) solid var(--jp-toolbar-border-color);
  box-shadow: var(--jp-toolbar-box-shadow);
  font-size: var(--jp-ui-font-size0);
}

.jp-AccordionPanel-title {
  cursor: pointer;
  user-select: none;
  -moz-user-select: none;
  -webkit-user-select: none;
  text-transform: uppercase;
}

.lm-AccordionPanel[data-orientation='horizontal'] > .jp-AccordionPanel-title {
  /* Title is rotated for horizontal accordion panel using CSS */
  display: block;
  transform-origin: top left;
  transform: rotate(-90deg) translate(-100%);
}

.jp-AccordionPanel-title .lm-AccordionPanel-titleLabel {
  user-select: none;
  text-overflow: ellipsis;
  white-space: nowrap;
  overflow: hidden;
}

.jp-AccordionPanel-title .lm-AccordionPanel-titleCollapser {
  transform: rotate(-90deg);
  margin: auto 0;
  height: 16px;
}

.jp-AccordionPanel-title.lm-mod-expanded .lm-AccordionPanel-titleCollapser {
  transform: rotate(0deg);
}

.lm-AccordionPanel .jp-AccordionPanel-toolbar {
  background: none;
  box-shadow: none;
  border: none;
  margin-left: auto;
}

.lm-AccordionPanel .lm-SplitPanel-handle:hover {
  background: var(--jp-layout-color3);
}

.jp-text-truncated {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/*-----------------------------------------------------------------------------
| Copyright (c) 2017, Jupyter Development Team.
|
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

.jp-Spinner {
  position: absolute;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 10;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background: var(--jp-layout-color0);
  outline: none;
}

.jp-SpinnerContent {
  font-size: 10px;
  margin: 50px auto;
  text-indent: -9999em;
  width: 3em;
  height: 3em;
  border-radius: 50%;
  background: var(--jp-brand-color3);
  background: linear-gradient(
    to right,
    #f37626 10%,
    rgba(255, 255, 255, 0) 42%
  );
  position: relative;
  animation: load3 1s infinite linear, fadeIn 1s;
}

.jp-SpinnerContent::before {
  width: 50%;
  height: 50%;
  background: #f37626;
  border-radius: 100% 0 0;
  position: absolute;
  top: 0;
  left: 0;
  content: '';
}

.jp-SpinnerContent::after {
  background: var(--jp-layout-color0);
  width: 75%;
  height: 75%;
  border-radius: 50%;
  content: '';
  margin: auto;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0;
  right: 0;
}

@keyframes fadeIn {
  0% {
    opacity: 0;
  }

  100% {
    opacity: 1;
  }
}

@keyframes load3 {
  0% {
    transform: rotate(0deg);
  }

  100% {
    transform: rotate(360deg);
  }
}

/*-----------------------------------------------------------------------------
| Copyright (c) 2014-2017, Jupyter Development Team.
|
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

button.jp-mod-styled {
  font-size: var(--jp-ui-font-size1);
  color: var(--jp-ui-font-color0);
  border: none;
  box-sizing: border-box;
  text-align: center;
  line-height: 32px;
  height: 32px;
  padding: 0 12px;
  letter-spacing: 0.8px;
  outline: none;
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
}

input.jp-mod-styled {
  background: var(--jp-input-background);
  height: 28px;
  box-sizing: border-box;
  border: var(--jp-border-width) solid var(--jp-border-color1);
  padding-left: 7px;
  padding-right: 7px;
  font-size: var(--jp-ui-font-size2);
  color: var(--jp-ui-font-color0);
  outline: none;
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
}

input[type='checkbox'].jp-mod-styled {
  appearance: checkbox;
  -webkit-appearance: checkbox;
  -moz-appearance: checkbox;
  height: auto;
}

input.jp-mod-styled:focus {
  border: var(--jp-border-width) solid var(--md-blue-500);
  box-shadow: inset 0 0 4px var(--md-blue-300);
}

.jp-select-wrapper {
  display: flex;
  position: relative;
  flex-direction: column;
  padding: 1px;
  background-color: var(--jp-layout-color1);
  box-sizing: border-box;
  margin-bottom: 12px;
}

.jp-select-wrapper:not(.multiple) {
  height: 28px;
}

.jp-select-wrapper.jp-mod-focused select.jp-mod-styled {
  border: var(--jp-border-width) solid var(--jp-input-active-border-color);
  box-shadow: var(--jp-input-box-shadow);
  background-color: var(--jp-input-active-background);
}

select.jp-mod-styled:hover {
  cursor: pointer;
  color: var(--jp-ui-font-color0);
  background-color: var(--jp-input-hover-background);
  box-shadow: inset 0 0 1px rgba(0, 0, 0, 0.5);
}

select.jp-mod-styled {
  flex: 1 1 auto;
  width: 100%;
  font-size: var(--jp-ui-font-size2);
  background: var(--jp-input-background);
  color: var(--jp-ui-font-color0);
  padding: 0 25px 0 8px;
  border: var(--jp-border-width) solid var(--jp-input-border-color);
  border-radius: 0;
  outline: none;
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
}

select.jp-mod-styled:not([multiple]) {
  height: 32px;
}

select.jp-mod-styled[multiple] {
  max-height: 200px;
  overflow-y: auto;
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

.jp-switch {
  display: flex;
  align-items: center;
  padding-left: 4px;
  padding-right: 4px;
  font-size: var(--jp-ui-font-size1);
  background-color: transparent;
  color: var(--jp-ui-font-color1);
  border: none;
  height: 20px;
}

.jp-switch:hover {
  background-color: var(--jp-layout-color2);
}

.jp-switch-label {
  margin-right: 5px;
  font-family: var(--jp-ui-font-family);
}

.jp-switch-track {
  cursor: pointer;
  background-color: var(--jp-switch-color, var(--jp-border-color1));
  -webkit-transition: 0.4s;
  transition: 0.4s;
  border-radius: 34px;
  height: 16px;
  width: 35px;
  position: relative;
}

.jp-switch-track::before {
  content: '';
  position: absolute;
  height: 10px;
  width: 10px;
  margin: 3px;
  left: 0;
  background-color: var(--jp-ui-inverse-font-color1);
  -webkit-transition: 0.4s;
  transition: 0.4s;
  border-radius: 50%;
}

.jp-switch[aria-checked='true'] .jp-switch-track {
  background-color: var(--jp-switch-true-position-color, var(--jp-warn-color0));
}

.jp-switch[aria-checked='true'] .jp-switch-track::before {
  /* track width (35) - margins (3 + 3) - thumb width (10) */
  left: 19px;
}

/*-----------------------------------------------------------------------------
| Copyright (c) 2014-2016, Jupyter Development Team.
|
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

:root {
  --jp-private-toolbar-height: calc(
    28px + var(--jp-border-width)
  ); /* leave 28px for content */
}

.jp-Toolbar {
  color: var(--jp-ui-font-color1);
  flex: 0 0 auto;
  display: flex;
  flex-direction: row;
  border-bottom: var(--jp-border-width) solid var(--jp-toolbar-border-color);
  box-shadow: var(--jp-toolbar-box-shadow);
  background: var(--jp-toolbar-background);
  min-height: var(--jp-toolbar-micro-height);
  padding: 2px;
  z-index: 8;
  overflow-x: hidden;
}

/* Toolbar items */

.jp-Toolbar > .jp-Toolbar-item.jp-Toolbar-spacer {
  flex-grow: 1;
  flex-shrink: 1;
}

.jp-Toolbar-item.jp-Toolbar-kernelStatus {
  display: inline-block;
  width: 32px;
  background-repeat: no-repeat;
  background-position: center;
  background-size: 16px;
}

.jp-Toolbar > .jp-Toolbar-item {
  flex: 0 0 auto;
  display: flex;
  padding-left: 1px;
  padding-right: 1px;
  font-size: var(--jp-ui-font-size1);
  line-height: var(--jp-private-toolbar-height);
  height: 100%;
}

/* Toolbar buttons */

/* This is the div we use to wrap the react component into a Widget */
div.jp-ToolbarButton {
  color: transparent;
  border: none;
  box-sizing: border-box;
  outline: none;
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  padding: 0;
  margin: 0;
}

button.jp-ToolbarButtonComponent {
  background: var(--jp-layout-color1);
  border: none;
  box-sizing: border-box;
  outline: none;
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  padding: 0 6px;
  margin: 0;
  height: 24px;
  border-radius: var(--jp-border-radius);
  display: flex;
  align-items: center;
  text-align: center;
  font-size: 14px;
  min-width: unset;
  min-height: unset;
}

button.jp-ToolbarButtonComponent:disabled {
  opacity: 0.4;
}

button.jp-ToolbarButtonComponent > span {
  padding: 0;
  flex: 0 0 auto;
}

button.jp-ToolbarButtonComponent .jp-ToolbarButtonComponent-label {
  font-size: var(--jp-ui-font-size1);
  line-height: 100%;
  padding-left: 2px;
  color: var(--jp-ui-font-color1);
  font-family: var(--jp-ui-font-family);
}

#jp-main-dock-panel[data-mode='single-document']
  .jp-MainAreaWidget
  > .jp-Toolbar.jp-Toolbar-micro {
  padding: 0;
  min-height: 0;
}

#jp-main-dock-panel[data-mode='single-document']
  .jp-MainAreaWidget
  > .jp-Toolbar {
  border: none;
  box-shadow: none;
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

.jp-WindowedPanel-outer {
  position: relative;
  overflow-y: auto;
}

.jp-WindowedPanel-inner {
  position: relative;
}

.jp-WindowedPanel-window {
  position: absolute;
  left: 0;
  right: 0;
  overflow: visible;
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/* Sibling imports */

body {
  color: var(--jp-ui-font-color1);
  font-size: var(--jp-ui-font-size1);
}

/* Disable native link decoration styles everywhere outside of dialog boxes */
a {
  text-decoration: unset;
  color: unset;
}

a:hover {
  text-decoration: unset;
  color: unset;
}

/* Accessibility for links inside dialog box text */
.jp-Dialog-content a {
  text-decoration: revert;
  color: var(--jp-content-link-color);
}

.jp-Dialog-content a:hover {
  text-decoration: revert;
}

/* Styles for ui-components */
.jp-Button {
  color: var(--jp-ui-font-color2);
  border-radius: var(--jp-border-radius);
  padding: 0 12px;
  font-size: var(--jp-ui-font-size1);

  /* Copy from blueprint 3 */
  display: inline-flex;
  flex-direction: row;
  border: none;
  cursor: pointer;
  align-items: center;
  justify-content: center;
  text-align: left;
  vertical-align: middle;
  min-height: 30px;
  min-width: 30px;
}

.jp-Button:disabled {
  cursor: not-allowed;
}

.jp-Button:empty {
  padding: 0 !important;
}

.jp-Button.jp-mod-small {
  min-height: 24px;
  min-width: 24px;
  font-size: 12px;
  padding: 0 7px;
}

/* Use our own theme for hover styles */
.jp-Button.jp-mod-minimal:hover {
  background-color: var(--jp-layout-color2);
}

.jp-Button.jp-mod-minimal {
  background: none;
}

.jp-InputGroup {
  display: block;
  position: relative;
}

.jp-InputGroup input {
  box-sizing: border-box;
  border: none;
  border-radius: 0;
  background-color: transparent;
  color: var(--jp-ui-font-color0);
  box-shadow: inset 0 0 0 var(--jp-border-width) var(--jp-input-border-color);
  padding-bottom: 0;
  padding-top: 0;
  padding-left: 10px;
  padding-right: 28px;
  position: relative;
  width: 100%;
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  font-size: 14px;
  font-weight: 400;
  height: 30px;
  line-height: 30px;
  outline: none;
  vertical-align: middle;
}

.jp-InputGroup input:focus {
  box-shadow: inset 0 0 0 var(--jp-border-width)
      var(--jp-input-active-box-shadow-color),
    inset 0 0 0 3px var(--jp-input-active-box-shadow-color);
}

.jp-InputGroup input:disabled {
  cursor: not-allowed;
  resize: block;
  background-color: var(--jp-layout-color2);
  color: var(--jp-ui-font-color2);
}

.jp-InputGroup input:disabled ~ span {
  cursor: not-allowed;
  color: var(--jp-ui-font-color2);
}

.jp-InputGroup input::placeholder,
input::placeholder {
  color: var(--jp-ui-font-color2);
}

.jp-InputGroupAction {
  position: absolute;
  bottom: 1px;
  right: 0;
  padding: 6px;
}

.jp-HTMLSelect.jp-DefaultStyle select {
  background-color: initial;
  border: none;
  border-radius: 0;
  box-shadow: none;
  color: var(--jp-ui-font-color0);
  display: block;
  font-size: var(--jp-ui-font-size1);
  font-family: var(--jp-ui-font-family);
  height: 24px;
  line-height: 14px;
  padding: 0 25px 0 10px;
  text-align: left;
  -moz-appearance: none;
  -webkit-appearance: none;
}

.jp-HTMLSelect.jp-DefaultStyle select:disabled {
  background-color: var(--jp-layout-color2);
  color: var(--jp-ui-font-color2);
  cursor: not-allowed;
  resize: block;
}

.jp-HTMLSelect.jp-DefaultStyle select:disabled ~ span {
  cursor: not-allowed;
}

/* Use our own theme for hover and option styles */
/* stylelint-disable-next-line selector-max-type */
.jp-HTMLSelect.jp-DefaultStyle select:hover,
.jp-HTMLSelect.jp-DefaultStyle select > option {
  background-color: var(--jp-layout-color2);
  color: var(--jp-ui-font-color0);
}

select {
  box-sizing: border-box;
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
| Styles
|----------------------------------------------------------------------------*/

.jp-StatusBar-Widget {
  display: flex;
  align-items: center;
  background: var(--jp-layout-color2);
  min-height: var(--jp-statusbar-height);
  justify-content: space-between;
  padding: 0 10px;
}

.jp-StatusBar-Left {
  display: flex;
  align-items: center;
  flex-direction: row;
}

.jp-StatusBar-Middle {
  display: flex;
  align-items: center;
}

.jp-StatusBar-Right {
  display: flex;
  align-items: center;
  flex-direction: row-reverse;
}

.jp-StatusBar-Item {
  max-height: var(--jp-statusbar-height);
  margin: 0 2px;
  height: var(--jp-statusbar-height);
  white-space: nowrap;
  text-overflow: ellipsis;
  color: var(--jp-ui-font-color1);
  padding: 0 6px;
}

.jp-mod-highlighted:hover {
  background-color: var(--jp-layout-color3);
}

.jp-mod-clicked {
  background-color: var(--jp-brand-color1);
}

.jp-mod-clicked:hover {
  background-color: var(--jp-brand-color0);
}

.jp-mod-clicked .jp-StatusBar-TextItem {
  color: var(--jp-ui-inverse-font-color1);
}

.jp-StatusBar-HoverItem {
  box-shadow: '0px 4px 4px rgba(0, 0, 0, 0.25)';
}

.jp-StatusBar-TextItem {
  font-size: var(--jp-ui-font-size1);
  font-family: var(--jp-ui-font-family);
  line-height: 24px;
  color: var(--jp-ui-font-color1);
}

.jp-StatusBar-GroupItem {
  display: flex;
  align-items: center;
  flex-direction: row;
}

.jp-Statusbar-ProgressCircle svg {
  display: block;
  margin: 0 auto;
  width: 16px;
  height: 24px;
  align-self: normal;
}

.jp-Statusbar-ProgressCircle path {
  fill: var(--jp-inverse-layout-color3);
}

.jp-Statusbar-ProgressBar-progress-bar {
  height: 10px;
  width: 100px;
  border: solid 0.25px var(--jp-brand-color2);
  border-radius: 3px;
  overflow: hidden;
  align-self: center;
}

.jp-Statusbar-ProgressBar-progress-bar > div {
  background-color: var(--jp-brand-color2);
  background-image: linear-gradient(
    -45deg,
    rgba(255, 255, 255, 0.2) 25%,
    transparent 25%,
    transparent 50%,
    rgba(255, 255, 255, 0.2) 50%,
    rgba(255, 255, 255, 0.2) 75%,
    transparent 75%,
    transparent
  );
  background-size: 40px 40px;
  float: left;
  width: 0%;
  height: 100%;
  font-size: 12px;
  line-height: 14px;
  color: #fff;
  text-align: center;
  animation: jp-Statusbar-ExecutionTime-progress-bar 2s linear infinite;
}

.jp-Statusbar-ProgressBar-progress-bar p {
  color: var(--jp-ui-font-color1);
  font-family: var(--jp-ui-font-family);
  font-size: var(--jp-ui-font-size1);
  line-height: 10px;
  width: 100px;
}

@keyframes jp-Statusbar-ExecutionTime-progress-bar {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 40px 40px;
  }
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
| Variables
|----------------------------------------------------------------------------*/

:root {
  --jp-private-commandpalette-search-height: 28px;
}

/*-----------------------------------------------------------------------------
| Overall styles
|----------------------------------------------------------------------------*/

.lm-CommandPalette {
  padding-bottom: 0;
  color: var(--jp-ui-font-color1);
  background: var(--jp-layout-color1);

  /* This is needed so that all font sizing of children done in ems is
   * relative to this base size */
  font-size: var(--jp-ui-font-size1);
}

/*-----------------------------------------------------------------------------
| Modal variant
|----------------------------------------------------------------------------*/

.jp-ModalCommandPalette {
  position: absolute;
  z-index: 10000;
  top: 38px;
  left: 30%;
  margin: 0;
  padding: 4px;
  width: 40%;
  box-shadow: var(--jp-elevation-z4);
  border-radius: 4px;
  background: var(--jp-layout-color0);
}

.jp-ModalCommandPalette .lm-CommandPalette {
  max-height: 40vh;
}

.jp-ModalCommandPalette .lm-CommandPalette .lm-close-icon::after {
  display: none;
}

.jp-ModalCommandPalette .lm-CommandPalette .lm-CommandPalette-header {
  display: none;
}

.jp-ModalCommandPalette .lm-CommandPalette .lm-CommandPalette-item {
  margin-left: 4px;
  margin-right: 4px;
}

.jp-ModalCommandPalette
  .lm-CommandPalette
  .lm-CommandPalette-item.lm-mod-disabled {
  display: none;
}

/*-----------------------------------------------------------------------------
| Search
|----------------------------------------------------------------------------*/

.lm-CommandPalette-search {
  padding: 4px;
  background-color: var(--jp-layout-color1);
  z-index: 2;
}

.lm-CommandPalette-wrapper {
  overflow: overlay;
  padding: 0 9px;
  background-color: var(--jp-input-active-background);
  height: 30px;
  box-shadow: inset 0 0 0 var(--jp-border-width) var(--jp-input-border-color);
}

.lm-CommandPalette.lm-mod-focused .lm-CommandPalette-wrapper {
  box-shadow: inset 0 0 0 1px var(--jp-input-active-box-shadow-color),
    inset 0 0 0 3px var(--jp-input-active-box-shadow-color);
}

.jp-SearchIconGroup {
  color: white;
  background-color: var(--jp-brand-color1);
  position: absolute;
  top: 4px;
  right: 4px;
  padding: 5px 5px 1px;
}

.jp-SearchIconGroup svg {
  height: 20px;
  width: 20px;
}

.jp-SearchIconGroup .jp-icon3[fill] {
  fill: var(--jp-layout-color0);
}

.lm-CommandPalette-input {
  background: transparent;
  width: calc(100% - 18px);
  float: left;
  border: none;
  outline: none;
  font-size: var(--jp-ui-font-size1);
  color: var(--jp-ui-font-color0);
  line-height: var(--jp-private-commandpalette-search-height);
}

.lm-CommandPalette-input::-webkit-input-placeholder,
.lm-CommandPalette-input::-moz-placeholder,
.lm-CommandPalette-input:-ms-input-placeholder {
  color: var(--jp-ui-font-color2);
  font-size: var(--jp-ui-font-size1);
}

/*-----------------------------------------------------------------------------
| Results
|----------------------------------------------------------------------------*/

.lm-CommandPalette-header:first-child {
  margin-top: 0;
}

.lm-CommandPalette-header {
  border-bottom: solid var(--jp-border-width) var(--jp-border-color2);
  color: var(--jp-ui-font-color1);
  cursor: pointer;
  display: flex;
  font-size: var(--jp-ui-font-size0);
  font-weight: 600;
  letter-spacing: 1px;
  margin-top: 8px;
  padding: 8px 0 8px 12px;
  text-transform: uppercase;
}

.lm-CommandPalette-header.lm-mod-active {
  background: var(--jp-layout-color2);
}

.lm-CommandPalette-header > mark {
  background-color: transparent;
  font-weight: bold;
  color: var(--jp-ui-font-color1);
}

.lm-CommandPalette-item {
  padding: 4px 12px 4px 4px;
  color: var(--jp-ui-font-color1);
  font-size: var(--jp-ui-font-size1);
  font-weight: 400;
  display: flex;
}

.lm-CommandPalette-item.lm-mod-disabled {
  color: var(--jp-ui-font-color2);
}

.lm-CommandPalette-item.lm-mod-active {
  color: var(--jp-ui-inverse-font-color1);
  background: var(--jp-brand-color1);
}

.lm-CommandPalette-item.lm-mod-active .lm-CommandPalette-itemLabel > mark {
  color: var(--jp-ui-inverse-font-color0);
}

.lm-CommandPalette-item.lm-mod-active .jp-icon-selectable[fill] {
  fill: var(--jp-layout-color0);
}

.lm-CommandPalette-item.lm-mod-active:hover:not(.lm-mod-disabled) {
  color: var(--jp-ui-inverse-font-color1);
  background: var(--jp-brand-color1);
}

.lm-CommandPalette-item:hover:not(.lm-mod-active):not(.lm-mod-disabled) {
  background: var(--jp-layout-color2);
}

.lm-CommandPalette-itemContent {
  overflow: hidden;
}

.lm-CommandPalette-itemLabel > mark {
  color: var(--jp-ui-font-color0);
  background-color: transparent;
  font-weight: bold;
}

.lm-CommandPalette-item.lm-mod-disabled mark {
  color: var(--jp-ui-font-color2);
}

.lm-CommandPalette-item .lm-CommandPalette-itemIcon {
  margin: 0 4px 0 0;
  position: relative;
  width: 16px;
  top: 2px;
  flex: 0 0 auto;
}

.lm-CommandPalette-item.lm-mod-disabled .lm-CommandPalette-itemIcon {
  opacity: 0.6;
}

.lm-CommandPalette-item .lm-CommandPalette-itemShortcut {
  flex: 0 0 auto;
}

.lm-CommandPalette-itemCaption {
  display: none;
}

.lm-CommandPalette-content {
  background-color: var(--jp-layout-color1);
}

.lm-CommandPalette-content:empty::after {
  content: 'No results';
  margin: auto;
  margin-top: 20px;
  width: 100px;
  display: block;
  font-size: var(--jp-ui-font-size2);
  font-family: var(--jp-ui-font-family);
  font-weight: lighter;
}

.lm-CommandPalette-emptyMessage {
  text-align: center;
  margin-top: 24px;
  line-height: 1.32;
  padding: 0 8px;
  color: var(--jp-content-font-color3);
}

/*-----------------------------------------------------------------------------
| Copyright (c) 2014-2017, Jupyter Development Team.
|
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

.jp-Dialog {
  position: absolute;
  z-index: 10000;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  top: 0;
  left: 0;
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  background: var(--jp-dialog-background);
}

.jp-Dialog-content {
  display: flex;
  flex-direction: column;
  margin-left: auto;
  margin-right: auto;
  background: var(--jp-layout-color1);
  padding: 24px 24px 12px;
  min-width: 300px;
  min-height: 150px;
  max-width: 1000px;
  max-height: 500px;
  box-sizing: border-box;
  box-shadow: var(--jp-elevation-z20);
  word-wrap: break-word;
  border-radius: var(--jp-border-radius);

  /* This is needed so that all font sizing of children done in ems is
   * relative to this base size */
  font-size: var(--jp-ui-font-size1);
  color: var(--jp-ui-font-color1);
  resize: both;
}

.jp-Dialog-content.jp-Dialog-content-small {
  max-width: 500px;
}

.jp-Dialog-button {
  overflow: visible;
}

button.jp-Dialog-button:focus {
  outline: 1px solid var(--jp-brand-color1);
  outline-offset: 4px;
  -moz-outline-radius: 0;
}

button.jp-Dialog-button:focus::-moz-focus-inner {
  border: 0;
}

button.jp-Dialog-button.jp-mod-styled.jp-mod-accept:focus,
button.jp-Dialog-button.jp-mod-styled.jp-mod-warn:focus,
button.jp-Dialog-button.jp-mod-styled.jp-mod-reject:focus {
  outline-offset: 4px;
  -moz-outline-radius: 0;
}

button.jp-Dialog-button.jp-mod-styled.jp-mod-accept:focus {
  outline: 1px solid var(--jp-accept-color-normal, var(--jp-brand-color1));
}

button.jp-Dialog-button.jp-mod-styled.jp-mod-warn:focus {
  outline: 1px solid var(--jp-warn-color-normal, var(--jp-error-color1));
}

button.jp-Dialog-button.jp-mod-styled.jp-mod-reject:focus {
  outline: 1px solid var(--jp-reject-color-normal, var(--md-grey-600));
}

button.jp-Dialog-close-button {
  padding: 0;
  height: 100%;
  min-width: unset;
  min-height: unset;
}

.jp-Dialog-header {
  display: flex;
  justify-content: space-between;
  flex: 0 0 auto;
  padding-bottom: 12px;
  font-size: var(--jp-ui-font-size3);
  font-weight: 400;
  color: var(--jp-ui-font-color1);
}

.jp-Dialog-body {
  display: flex;
  flex-direction: column;
  flex: 1 1 auto;
  font-size: var(--jp-ui-font-size1);
  background: var(--jp-layout-color1);
  color: var(--jp-ui-font-color1);
  overflow: auto;
}

.jp-Dialog-footer {
  display: flex;
  flex-direction: row;
  justify-content: flex-end;
  align-items: center;
  flex: 0 0 auto;
  margin-left: -12px;
  margin-right: -12px;
  padding: 12px;
}

.jp-Dialog-checkbox {
  padding-right: 5px;
}

.jp-Dialog-checkbox > input:focus-visible {
  outline: 1px solid var(--jp-input-active-border-color);
  outline-offset: 1px;
}

.jp-Dialog-spacer {
  flex: 1 1 auto;
}

.jp-Dialog-title {
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}

.jp-Dialog-body > .jp-select-wrapper {
  width: 100%;
}

.jp-Dialog-body > button {
  padding: 0 16px;
}

.jp-Dialog-body > label {
  line-height: 1.4;
  color: var(--jp-ui-font-color0);
}

.jp-Dialog-button.jp-mod-styled:not(:last-child) {
  margin-right: 12px;
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

.jp-Input-Boolean-Dialog {
  flex-direction: row-reverse;
  align-items: end;
  width: 100%;
}

.jp-Input-Boolean-Dialog > label {
  flex: 1 1 auto;
}

/*-----------------------------------------------------------------------------
| Copyright (c) 2014-2016, Jupyter Development Team.
|
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

.jp-MainAreaWidget > :focus {
  outline: none;
}

.jp-MainAreaWidget .jp-MainAreaWidget-error {
  padding: 6px;
}

.jp-MainAreaWidget .jp-MainAreaWidget-error > pre {
  width: auto;
  padding: 10px;
  background: var(--jp-error-color3);
  border: var(--jp-border-width) solid var(--jp-error-color1);
  border-radius: var(--jp-border-radius);
  color: var(--jp-ui-font-color1);
  font-size: var(--jp-ui-font-size1);
  white-space: pre-wrap;
  word-wrap: break-word;
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

/**
 * google-material-color v1.2.6
 * https://github.com/danlevan/google-material-color
 */
:root {
  --md-red-50: #ffebee;
  --md-red-100: #ffcdd2;
  --md-red-200: #ef9a9a;
  --md-red-300: #e57373;
  --md-red-400: #ef5350;
  --md-red-500: #f44336;
  --md-red-600: #e53935;
  --md-red-700: #d32f2f;
  --md-red-800: #c62828;
  --md-red-900: #b71c1c;
  --md-red-A100: #ff8a80;
  --md-red-A200: #ff5252;
  --md-red-A400: #ff1744;
  --md-red-A700: #d50000;
  --md-pink-50: #fce4ec;
  --md-pink-100: #f8bbd0;
  --md-pink-200: #f48fb1;
  --md-pink-300: #f06292;
  --md-pink-400: #ec407a;
  --md-pink-500: #e91e63;
  --md-pink-600: #d81b60;
  --md-pink-700: #c2185b;
  --md-pink-800: #ad1457;
  --md-pink-900: #880e4f;
  --md-pink-A100: #ff80ab;
  --md-pink-A200: #ff4081;
  --md-pink-A400: #f50057;
  --md-pink-A700: #c51162;
  --md-purple-50: #f3e5f5;
  --md-purple-100: #e1bee7;
  --md-purple-200: #ce93d8;
  --md-purple-300: #ba68c8;
  --md-purple-400: #ab47bc;
  --md-purple-500: #9c27b0;
  --md-purple-600: #8e24aa;
  --md-purple-700: #7b1fa2;
  --md-purple-800: #6a1b9a;
  --md-purple-900: #4a148c;
  --md-purple-A100: #ea80fc;
  --md-purple-A200: #e040fb;
  --md-purple-A400: #d500f9;
  --md-purple-A700: #a0f;
  --md-deep-purple-50: #ede7f6;
  --md-deep-purple-100: #d1c4e9;
  --md-deep-purple-200: #b39ddb;
  --md-deep-purple-300: #9575cd;
  --md-deep-purple-400: #7e57c2;
  --md-deep-purple-500: #673ab7;
  --md-deep-purple-600: #5e35b1;
  --md-deep-purple-700: #512da8;
  --md-deep-purple-800: #4527a0;
  --md-deep-purple-900: #311b92;
  --md-deep-purple-A100: #b388ff;
  --md-deep-purple-A200: #7c4dff;
  --md-deep-purple-A400: #651fff;
  --md-deep-purple-A700: #6200ea;
  --md-indigo-50: #e8eaf6;
  --md-indigo-100: #c5cae9;
  --md-indigo-200: #9fa8da;
  --md-indigo-300: #7986cb;
  --md-indigo-400: #5c6bc0;
  --md-indigo-500: #3f51b5;
  --md-indigo-600: #3949ab;
  --md-indigo-700: #303f9f;
  --md-indigo-800: #283593;
  --md-indigo-900: #1a237e;
  --md-indigo-A100: #8c9eff;
  --md-indigo-A200: #536dfe;
  --md-indigo-A400: #3d5afe;
  --md-indigo-A700: #304ffe;
  --md-blue-50: #e3f2fd;
  --md-blue-100: #bbdefb;
  --md-blue-200: #90caf9;
  --md-blue-300: #64b5f6;
  --md-blue-400: #42a5f5;
  --md-blue-500: #2196f3;
  --md-blue-600: #1e88e5;
  --md-blue-700: #1976d2;
  --md-blue-800: #1565c0;
  --md-blue-900: #0d47a1;
  --md-blue-A100: #82b1ff;
  --md-blue-A200: #448aff;
  --md-blue-A400: #2979ff;
  --md-blue-A700: #2962ff;
  --md-light-blue-50: #e1f5fe;
  --md-light-blue-100: #b3e5fc;
  --md-light-blue-200: #81d4fa;
  --md-light-blue-300: #4fc3f7;
  --md-light-blue-400: #29b6f6;
  --md-light-blue-500: #03a9f4;
  --md-light-blue-600: #039be5;
  --md-light-blue-700: #0288d1;
  --md-light-blue-800: #0277bd;
  --md-light-blue-900: #01579b;
  --md-light-blue-A100: #80d8ff;
  --md-light-blue-A200: #40c4ff;
  --md-light-blue-A400: #00b0ff;
  --md-light-blue-A700: #0091ea;
  --md-cyan-50: #e0f7fa;
  --md-cyan-100: #b2ebf2;
  --md-cyan-200: #80deea;
  --md-cyan-300: #4dd0e1;
  --md-cyan-400: #26c6da;
  --md-cyan-500: #00bcd4;
  --md-cyan-600: #00acc1;
  --md-cyan-700: #0097a7;
  --md-cyan-800: #00838f;
  --md-cyan-900: #006064;
  --md-cyan-A100: #84ffff;
  --md-cyan-A200: #18ffff;
  --md-cyan-A400: #00e5ff;
  --md-cyan-A700: #00b8d4;
  --md-teal-50: #e0f2f1;
  --md-teal-100: #b2dfdb;
  --md-teal-200: #80cbc4;
  --md-teal-300: #4db6ac;
  --md-teal-400: #26a69a;
  --md-teal-500: #009688;
  --md-teal-600: #00897b;
  --md-teal-700: #00796b;
  --md-teal-800: #00695c;
  --md-teal-900: #004d40;
  --md-teal-A100: #a7ffeb;
  --md-teal-A200: #64ffda;
  --md-teal-A400: #1de9b6;
  --md-teal-A700: #00bfa5;
  --md-green-50: #e8f5e9;
  --md-green-100: #c8e6c9;
  --md-green-200: #a5d6a7;
  --md-green-300: #81c784;
  --md-green-400: #66bb6a;
  --md-green-500: #4caf50;
  --md-green-600: #43a047;
  --md-green-700: #388e3c;
  --md-green-800: #2e7d32;
  --md-green-900: #1b5e20;
  --md-green-A100: #b9f6ca;
  --md-green-A200: #69f0ae;
  --md-green-A400: #00e676;
  --md-green-A700: #00c853;
  --md-light-green-50: #f1f8e9;
  --md-light-green-100: #dcedc8;
  --md-light-green-200: #c5e1a5;
  --md-light-green-300: #aed581;
  --md-light-green-400: #9ccc65;
  --md-light-green-500: #8bc34a;
  --md-light-green-600: #7cb342;
  --md-light-green-700: #689f38;
  --md-light-green-800: #558b2f;
  --md-light-green-900: #33691e;
  --md-light-green-A100: #ccff90;
  --md-light-green-A200: #b2ff59;
  --md-light-green-A400: #76ff03;
  --md-light-green-A700: #64dd17;
  --md-lime-50: #f9fbe7;
  --md-lime-100: #f0f4c3;
  --md-lime-200: #e6ee9c;
  --md-lime-300: #dce775;
  --md-lime-400: #d4e157;
  --md-lime-500: #cddc39;
  --md-lime-600: #c0ca33;
  --md-lime-700: #afb42b;
  --md-lime-800: #9e9d24;
  --md-lime-900: #827717;
  --md-lime-A100: #f4ff81;
  --md-lime-A200: #eeff41;
  --md-lime-A400: #c6ff00;
  --md-lime-A700: #aeea00;
  --md-yellow-50: #fffde7;
  --md-yellow-100: #fff9c4;
  --md-yellow-200: #fff59d;
  --md-yellow-300: #fff176;
  --md-yellow-400: #ffee58;
  --md-yellow-500: #ffeb3b;
  --md-yellow-600: #fdd835;
  --md-yellow-700: #fbc02d;
  --md-yellow-800: #f9a825;
  --md-yellow-900: #f57f17;
  --md-yellow-A100: #ffff8d;
  --md-yellow-A200: #ff0;
  --md-yellow-A400: #ffea00;
  --md-yellow-A700: #ffd600;
  --md-amber-50: #fff8e1;
  --md-amber-100: #ffecb3;
  --md-amber-200: #ffe082;
  --md-amber-300: #ffd54f;
  --md-amber-400: #ffca28;
  --md-amber-500: #ffc107;
  --md-amber-600: #ffb300;
  --md-amber-700: #ffa000;
  --md-amber-800: #ff8f00;
  --md-amber-900: #ff6f00;
  --md-amber-A100: #ffe57f;
  --md-amber-A200: #ffd740;
  --md-amber-A400: #ffc400;
  --md-amber-A700: #ffab00;
  --md-orange-50: #fff3e0;
  --md-orange-100: #ffe0b2;
  --md-orange-200: #ffcc80;
  --md-orange-300: #ffb74d;
  --md-orange-400: #ffa726;
  --md-orange-500: #ff9800;
  --md-orange-600: #fb8c00;
  --md-orange-700: #f57c00;
  --md-orange-800: #ef6c00;
  --md-orange-900: #e65100;
  --md-orange-A100: #ffd180;
  --md-orange-A200: #ffab40;
  --md-orange-A400: #ff9100;
  --md-orange-A700: #ff6d00;
  --md-deep-orange-50: #fbe9e7;
  --md-deep-orange-100: #ffccbc;
  --md-deep-orange-200: #ffab91;
  --md-deep-orange-300: #ff8a65;
  --md-deep-orange-400: #ff7043;
  --md-deep-orange-500: #ff5722;
  --md-deep-orange-600: #f4511e;
  --md-deep-orange-700: #e64a19;
  --md-deep-orange-800: #d84315;
  --md-deep-orange-900: #bf360c;
  --md-deep-orange-A100: #ff9e80;
  --md-deep-orange-A200: #ff6e40;
  --md-deep-orange-A400: #ff3d00;
  --md-deep-orange-A700: #dd2c00;
  --md-brown-50: #efebe9;
  --md-brown-100: #d7ccc8;
  --md-brown-200: #bcaaa4;
  --md-brown-300: #a1887f;
  --md-brown-400: #8d6e63;
  --md-brown-500: #795548;
  --md-brown-600: #6d4c41;
  --md-brown-700: #5d4037;
  --md-brown-800: #4e342e;
  --md-brown-900: #3e2723;
  --md-grey-50: #fafafa;
  --md-grey-100: #f5f5f5;
  --md-grey-200: #eee;
  --md-grey-300: #e0e0e0;
  --md-grey-400: #bdbdbd;
  --md-grey-500: #9e9e9e;
  --md-grey-600: #757575;
  --md-grey-700: #616161;
  --md-grey-800: #424242;
  --md-grey-900: #212121;
  --md-blue-grey-50: #eceff1;
  --md-blue-grey-100: #cfd8dc;
  --md-blue-grey-200: #b0bec5;
  --md-blue-grey-300: #90a4ae;
  --md-blue-grey-400: #78909c;
  --md-blue-grey-500: #607d8b;
  --md-blue-grey-600: #546e7a;
  --md-blue-grey-700: #455a64;
  --md-blue-grey-800: #37474f;
  --md-blue-grey-900: #263238;
}

/*-----------------------------------------------------------------------------
| Copyright (c) 2014-2017, Jupyter Development Team.
|
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
| RenderedText
|----------------------------------------------------------------------------*/

:root {
  /* This is the padding value to fill the gaps between lines containing spans with background color. */
  --jp-private-code-span-padding: calc(
    (var(--jp-code-line-height) - 1) * var(--jp-code-font-size) / 2
  );
}

.jp-RenderedText {
  text-align: left;
  padding-left: var(--jp-code-padding);
  line-height: var(--jp-code-line-height);
  font-family: var(--jp-code-font-family);
}

.jp-RenderedText pre,
.jp-RenderedJavaScript pre,
.jp-RenderedHTMLCommon pre {
  color: var(--jp-content-font-color1);
  font-size: var(--jp-code-font-size);
  border: none;
  margin: 0;
  padding: 0;
}

.jp-RenderedText pre a:link {
  text-decoration: none;
  color: var(--jp-content-link-color);
}

.jp-RenderedText pre a:hover {
  text-decoration: underline;
  color: var(--jp-content-link-color);
}

.jp-RenderedText pre a:visited {
  text-decoration: none;
  color: var(--jp-content-link-color);
}

/* console foregrounds and backgrounds */
.jp-RenderedText pre .ansi-black-fg {
  color: #3e424d;
}

.jp-RenderedText pre .ansi-red-fg {
  color: #e75c58;
}

.jp-RenderedText pre .ansi-green-fg {
  color: #00a250;
}

.jp-RenderedText pre .ansi-yellow-fg {
  color: #ddb62b;
}

.jp-RenderedText pre .ansi-blue-fg {
  color: #208ffb;
}

.jp-RenderedText pre .ansi-magenta-fg {
  color: #d160c4;
}

.jp-RenderedText pre .ansi-cyan-fg {
  color: #60c6c8;
}

.jp-RenderedText pre .ansi-white-fg {
  color: #c5c1b4;
}

.jp-RenderedText pre .ansi-black-bg {
  background-color: #3e424d;
  padding: var(--jp-private-code-span-padding) 0;
}

.jp-RenderedText pre .ansi-red-bg {
  background-color: #e75c58;
  padding: var(--jp-private-code-span-padding) 0;
}

.jp-RenderedText pre .ansi-green-bg {
  background-color: #00a250;
  padding: var(--jp-private-code-span-padding) 0;
}

.jp-RenderedText pre .ansi-yellow-bg {
  background-color: #ddb62b;
  padding: var(--jp-private-code-span-padding) 0;
}

.jp-RenderedText pre .ansi-blue-bg {
  background-color: #208ffb;
  padding: var(--jp-private-code-span-padding) 0;
}

.jp-RenderedText pre .ansi-magenta-bg {
  background-color: #d160c4;
  padding: var(--jp-private-code-span-padding) 0;
}

.jp-RenderedText pre .ansi-cyan-bg {
  background-color: #60c6c8;
  padding: var(--jp-private-code-span-padding) 0;
}

.jp-RenderedText pre .ansi-white-bg {
  background-color: #c5c1b4;
  padding: var(--jp-private-code-span-padding) 0;
}

.jp-RenderedText pre .ansi-black-intense-fg {
  color: #282c36;
}

.jp-RenderedText pre .ansi-red-intense-fg {
  color: #b22b31;
}

.jp-RenderedText pre .ansi-green-intense-fg {
  color: #007427;
}

.jp-RenderedText pre .ansi-yellow-intense-fg {
  color: #b27d12;
}

.jp-RenderedText pre .ansi-blue-intense-fg {
  color: #0065ca;
}

.jp-RenderedText pre .ansi-magenta-intense-fg {
  color: #a03196;
}

.jp-RenderedText pre .ansi-cyan-intense-fg {
  color: #258f8f;
}

.jp-RenderedText pre .ansi-white-intense-fg {
  color: #a1a6b2;
}

.jp-RenderedText pre .ansi-black-intense-bg {
  background-color: #282c36;
  padding: var(--jp-private-code-span-padding) 0;
}

.jp-RenderedText pre .ansi-red-intense-bg {
  background-color: #b22b31;
  padding: var(--jp-private-code-span-padding) 0;
}

.jp-RenderedText pre .ansi-green-intense-bg {
  background-color: #007427;
  padding: var(--jp-private-code-span-padding) 0;
}

.jp-RenderedText pre .ansi-yellow-intense-bg {
  background-color: #b27d12;
  padding: var(--jp-private-code-span-padding) 0;
}

.jp-RenderedText pre .ansi-blue-intense-bg {
  background-color: #0065ca;
  padding: var(--jp-private-code-span-padding) 0;
}

.jp-RenderedText pre .ansi-magenta-intense-bg {
  background-color: #a03196;
  padding: var(--jp-private-code-span-padding) 0;
}

.jp-RenderedText pre .ansi-cyan-intense-bg {
  background-color: #258f8f;
  padding: var(--jp-private-code-span-padding) 0;
}

.jp-RenderedText pre .ansi-white-intense-bg {
  background-color: #a1a6b2;
  padding: var(--jp-private-code-span-padding) 0;
}

.jp-RenderedText pre .ansi-default-inverse-fg {
  color: var(--jp-ui-inverse-font-color0);
}

.jp-RenderedText pre .ansi-default-inverse-bg {
  background-color: var(--jp-inverse-layout-color0);
  padding: var(--jp-private-code-span-padding) 0;
}

.jp-RenderedText pre .ansi-bold {
  font-weight: bold;
}

.jp-RenderedText pre .ansi-underline {
  text-decoration: underline;
}

.jp-RenderedText[data-mime-type='application/vnd.jupyter.stderr'] {
  background: var(--jp-rendermime-error-background);
  padding-top: var(--jp-code-padding);
}

/*-----------------------------------------------------------------------------
| RenderedLatex
|----------------------------------------------------------------------------*/

.jp-RenderedLatex {
  color: var(--jp-content-font-color1);
  font-size: var(--jp-content-font-size1);
  line-height: var(--jp-content-line-height);
}

/* Left-justify outputs.*/
.jp-OutputArea-output.jp-RenderedLatex {
  padding: var(--jp-code-padding);
  text-align: left;
}

/*-----------------------------------------------------------------------------
| RenderedHTML
|----------------------------------------------------------------------------*/

.jp-RenderedHTMLCommon {
  color: var(--jp-content-font-color1);
  font-family: var(--jp-content-font-family);
  font-size: var(--jp-content-font-size1);
  line-height: var(--jp-content-line-height);

  /* Give a bit more R padding on Markdown text to keep line lengths reasonable */
  padding-right: 20px;
}

.jp-RenderedHTMLCommon em {
  font-style: italic;
}

.jp-RenderedHTMLCommon strong {
  font-weight: bold;
}

.jp-RenderedHTMLCommon u {
  text-decoration: underline;
}

.jp-RenderedHTMLCommon a:link {
  text-decoration: none;
  color: var(--jp-content-link-color);
}

.jp-RenderedHTMLCommon a:hover {
  text-decoration: underline;
  color: var(--jp-content-link-color);
}

.jp-RenderedHTMLCommon a:visited {
  text-decoration: none;
  color: var(--jp-content-link-color);
}

/* Headings */

.jp-RenderedHTMLCommon h1,
.jp-RenderedHTMLCommon h2,
.jp-RenderedHTMLCommon h3,
.jp-RenderedHTMLCommon h4,
.jp-RenderedHTMLCommon h5,
.jp-RenderedHTMLCommon h6 {
  line-height: var(--jp-content-heading-line-height);
  font-weight: var(--jp-content-heading-font-weight);
  font-style: normal;
  margin: var(--jp-content-heading-margin-top) 0
    var(--jp-content-heading-margin-bottom) 0;
}

.jp-RenderedHTMLCommon h1:first-child,
.jp-RenderedHTMLCommon h2:first-child,
.jp-RenderedHTMLCommon h3:first-child,
.jp-RenderedHTMLCommon h4:first-child,
.jp-RenderedHTMLCommon h5:first-child,
.jp-RenderedHTMLCommon h6:first-child {
  margin-top: calc(0.5 * var(--jp-content-heading-margin-top));
}

.jp-RenderedHTMLCommon h1:last-child,
.jp-RenderedHTMLCommon h2:last-child,
.jp-RenderedHTMLCommon h3:last-child,
.jp-RenderedHTMLCommon h4:last-child,
.jp-RenderedHTMLCommon h5:last-child,
.jp-RenderedHTMLCommon h6:last-child {
  margin-bottom: calc(0.5 * var(--jp-content-heading-margin-bottom));
}

.jp-RenderedHTMLCommon h1 {
  font-size: var(--jp-content-font-size5);
}

.jp-RenderedHTMLCommon h2 {
  font-size: var(--jp-content-font-size4);
}

.jp-RenderedHTMLCommon h3 {
  font-size: var(--jp-content-font-size3);
}

.jp-RenderedHTMLCommon h4 {
  font-size: var(--jp-content-font-size2);
}

.jp-RenderedHTMLCommon h5 {
  font-size: var(--jp-content-font-size1);
}

.jp-RenderedHTMLCommon h6 {
  font-size: var(--jp-content-font-size0);
}

/* Lists */

/* stylelint-disable selector-max-type, selector-max-compound-selectors */

.jp-RenderedHTMLCommon ul:not(.list-inline),
.jp-RenderedHTMLCommon ol:not(.list-inline) {
  padding-left: 2em;
}

.jp-RenderedHTMLCommon ul {
  list-style: disc;
}

.jp-RenderedHTMLCommon ul ul {
  list-style: square;
}

.jp-RenderedHTMLCommon ul ul ul {
  list-style: circle;
}

.jp-RenderedHTMLCommon ol {
  list-style: decimal;
}

.jp-RenderedHTMLCommon ol ol {
  list-style: upper-alpha;
}

.jp-RenderedHTMLCommon ol ol ol {
  list-style: lower-alpha;
}

.jp-RenderedHTMLCommon ol ol ol ol {
  list-style: lower-roman;
}

.jp-RenderedHTMLCommon ol ol ol ol ol {
  list-style: decimal;
}

.jp-RenderedHTMLCommon ol,
.jp-RenderedHTMLCommon ul {
  margin-bottom: 1em;
}

.jp-RenderedHTMLCommon ul ul,
.jp-RenderedHTMLCommon ul ol,
.jp-RenderedHTMLCommon ol ul,
.jp-RenderedHTMLCommon ol ol {
  margin-bottom: 0;
}

/* stylelint-enable selector-max-type, selector-max-compound-selectors */

.jp-RenderedHTMLCommon hr {
  color: var(--jp-border-color2);
  background-color: var(--jp-border-color1);
  margin-top: 1em;
  margin-bottom: 1em;
}

.jp-RenderedHTMLCommon > pre {
  margin: 1.5em 2em;
}

.jp-RenderedHTMLCommon pre,
.jp-RenderedHTMLCommon code {
  border: 0;
  background-color: var(--jp-layout-color0);
  color: var(--jp-content-font-color1);
  font-family: var(--jp-code-font-family);
  font-size: inherit;
  line-height: var(--jp-code-line-height);
  padding: 0;
  white-space: pre-wrap;
}

.jp-RenderedHTMLCommon :not(pre) > code {
  background-color: var(--jp-layout-color2);
  padding: 1px 5px;
}

/* Tables */

.jp-RenderedHTMLCommon table {
  border-collapse: collapse;
  border-spacing: 0;
  border: none;
  color: var(--jp-ui-font-color1);
  font-size: var(--jp-ui-font-size1);
  table-layout: fixed;
  margin-left: auto;
  margin-bottom: 1em;
  margin-right: auto;
}

.jp-RenderedHTMLCommon thead {
  border-bottom: var(--jp-border-width) solid var(--jp-border-color1);
  vertical-align: bottom;
}

.jp-RenderedHTMLCommon td,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon tr {
  vertical-align: middle;
  padding: 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}

.jp-RenderedMarkdown.jp-RenderedHTMLCommon td,
.jp-RenderedMarkdown.jp-RenderedHTMLCommon th {
  max-width: none;
}

:not(.jp-RenderedMarkdown).jp-RenderedHTMLCommon td,
:not(.jp-RenderedMarkdown).jp-RenderedHTMLCommon th,
:not(.jp-RenderedMarkdown).jp-RenderedHTMLCommon tr {
  text-align: right;
}

.jp-RenderedHTMLCommon th {
  font-weight: bold;
}

.jp-RenderedHTMLCommon tbody tr:nth-child(odd) {
  background: var(--jp-layout-color0);
}

.jp-RenderedHTMLCommon tbody tr:nth-child(even) {
  background: var(--jp-rendermime-table-row-background);
}

.jp-RenderedHTMLCommon tbody tr:hover {
  background: var(--jp-rendermime-table-row-hover-background);
}

.jp-RenderedHTMLCommon p {
  text-align: left;
  margin: 0;
  margin-bottom: 1em;
}

.jp-RenderedHTMLCommon img {
  -moz-force-broken-image-icon: 1;
}

/* Restrict to direct children as other images could be nested in other content. */
.jp-RenderedHTMLCommon > img {
  display: block;
  margin-left: 0;
  margin-right: 0;
  margin-bottom: 1em;
}

/* Change color behind transparent images if they need it... */
[data-jp-theme-light='false'] .jp-RenderedImage img.jp-needs-light-background {
  background-color: var(--jp-inverse-layout-color1);
}

[data-jp-theme-light='true'] .jp-RenderedImage img.jp-needs-dark-background {
  background-color: var(--jp-inverse-layout-color1);
}

.jp-RenderedHTMLCommon img,
.jp-RenderedImage img,
.jp-RenderedHTMLCommon svg,
.jp-RenderedSVG svg {
  max-width: 100%;
  height: auto;
}

.jp-RenderedHTMLCommon img.jp-mod-unconfined,
.jp-RenderedImage img.jp-mod-unconfined,
.jp-RenderedHTMLCommon svg.jp-mod-unconfined,
.jp-RenderedSVG svg.jp-mod-unconfined {
  max-width: none;
}

.jp-RenderedHTMLCommon .alert {
  padding: var(--jp-notebook-padding);
  border: var(--jp-border-width) solid transparent;
  border-radius: var(--jp-border-radius);
  margin-bottom: 1em;
}

.jp-RenderedHTMLCommon .alert-info {
  color: var(--jp-info-color0);
  background-color: var(--jp-info-color3);
  border-color: var(--jp-info-color2);
}

.jp-RenderedHTMLCommon .alert-info hr {
  border-color: var(--jp-info-color3);
}

.jp-RenderedHTMLCommon .alert-info > p:last-child,
.jp-RenderedHTMLCommon .alert-info > ul:last-child {
  margin-bottom: 0;
}

.jp-RenderedHTMLCommon .alert-warning {
  color: var(--jp-warn-color0);
  background-color: var(--jp-warn-color3);
  border-color: var(--jp-warn-color2);
}

.jp-RenderedHTMLCommon .alert-warning hr {
  border-color: var(--jp-warn-color3);
}

.jp-RenderedHTMLCommon .alert-warning > p:last-child,
.jp-RenderedHTMLCommon .alert-warning > ul:last-child {
  margin-bottom: 0;
}

.jp-RenderedHTMLCommon .alert-success {
  color: var(--jp-success-color0);
  background-color: var(--jp-success-color3);
  border-color: var(--jp-success-color2);
}

.jp-RenderedHTMLCommon .alert-success hr {
  border-color: var(--jp-success-color3);
}

.jp-RenderedHTMLCommon .alert-success > p:last-child,
.jp-RenderedHTMLCommon .alert-success > ul:last-child {
  margin-bottom: 0;
}

.jp-RenderedHTMLCommon .alert-danger {
  color: var(--jp-error-color0);
  background-color: var(--jp-error-color3);
  border-color: var(--jp-error-color2);
}

.jp-RenderedHTMLCommon .alert-danger hr {
  border-color: var(--jp-error-color3);
}

.jp-RenderedHTMLCommon .alert-danger > p:last-child,
.jp-RenderedHTMLCommon .alert-danger > ul:last-child {
  margin-bottom: 0;
}

.jp-RenderedHTMLCommon blockquote {
  margin: 1em 2em;
  padding: 0 1em;
  border-left: 5px solid var(--jp-border-color2);
}

a.jp-InternalAnchorLink {
  visibility: hidden;
  margin-left: 8px;
  color: var(--md-blue-800);
}

h1:hover .jp-InternalAnchorLink,
h2:hover .jp-InternalAnchorLink,
h3:hover .jp-InternalAnchorLink,
h4:hover .jp-InternalAnchorLink,
h5:hover .jp-InternalAnchorLink,
h6:hover .jp-InternalAnchorLink {
  visibility: visible;
}

.jp-RenderedHTMLCommon kbd {
  background-color: var(--jp-rendermime-table-row-background);
  border: 1px solid var(--jp-border-color0);
  border-bottom-color: var(--jp-border-color2);
  border-radius: 3px;
  box-shadow: inset 0 -1px 0 rgba(0, 0, 0, 0.25);
  display: inline-block;
  font-size: var(--jp-ui-font-size0);
  line-height: 1em;
  padding: 0.2em 0.5em;
}

/* Most direct children of .jp-RenderedHTMLCommon have a margin-bottom of 1.0.
 * At the bottom of cells this is a bit too much as there is also spacing
 * between cells. Going all the way to 0 gets too tight between markdown and
 * code cells.
 */
.jp-RenderedHTMLCommon > *:last-child {
  margin-bottom: 0.5em;
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Copyright (c) 2014-2017, PhosphorJS Contributors
|
| Distributed under the terms of the BSD 3-Clause License.
|
| The full license is in the file LICENSE, distributed with this software.
|----------------------------------------------------------------------------*/

.lm-cursor-backdrop {
  position: fixed;
  width: 200px;
  height: 200px;
  margin-top: -100px;
  margin-left: -100px;
  will-change: transform;
  z-index: 100;
}

.lm-mod-drag-image {
  will-change: transform;
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

.jp-lineFormSearch {
  padding: 4px 12px;
  background-color: var(--jp-layout-color2);
  box-shadow: var(--jp-toolbar-box-shadow);
  z-index: 2;
  font-size: var(--jp-ui-font-size1);
}

.jp-lineFormCaption {
  font-size: var(--jp-ui-font-size0);
  line-height: var(--jp-ui-font-size1);
  margin-top: 4px;
  color: var(--jp-ui-font-color0);
}

.jp-baseLineForm {
  border: none;
  border-radius: 0;
  position: absolute;
  background-size: 16px;
  background-repeat: no-repeat;
  background-position: center;
  outline: none;
}

.jp-lineFormButtonContainer {
  top: 4px;
  right: 8px;
  height: 24px;
  padding: 0 12px;
  width: 12px;
}

.jp-lineFormButtonIcon {
  top: 0;
  right: 0;
  background-color: var(--jp-brand-color1);
  height: 100%;
  width: 100%;
  box-sizing: border-box;
  padding: 4px 6px;
}

.jp-lineFormButton {
  top: 0;
  right: 0;
  background-color: transparent;
  height: 100%;
  width: 100%;
  box-sizing: border-box;
}

.jp-lineFormWrapper {
  overflow: hidden;
  padding: 0 8px;
  border: 1px solid var(--jp-border-color0);
  background-color: var(--jp-input-active-background);
  height: 22px;
}

.jp-lineFormWrapperFocusWithin {
  border: var(--jp-border-width) solid var(--md-blue-500);
  box-shadow: inset 0 0 4px var(--md-blue-300);
}

.jp-lineFormInput {
  background: transparent;
  width: 200px;
  height: 100%;
  border: none;
  outline: none;
  color: var(--jp-ui-font-color0);
  line-height: 28px;
}

/*-----------------------------------------------------------------------------
| Copyright (c) 2014-2016, Jupyter Development Team.
|
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

.jp-JSONEditor {
  display: flex;
  flex-direction: column;
  width: 100%;
}

.jp-JSONEditor-host {
  flex: 1 1 auto;
  border: var(--jp-border-width) solid var(--jp-input-border-color);
  border-radius: 0;
  background: var(--jp-layout-color0);
  min-height: 50px;
  padding: 1px;
}

.jp-JSONEditor.jp-mod-error .jp-JSONEditor-host {
  border-color: red;
  outline-color: red;
}

.jp-JSONEditor-header {
  display: flex;
  flex: 1 0 auto;
  padding: 0 0 0 12px;
}

.jp-JSONEditor-header label {
  flex: 0 0 auto;
}

.jp-JSONEditor-commitButton {
  height: 16px;
  width: 16px;
  background-size: 18px;
  background-repeat: no-repeat;
  background-position: center;
}

.jp-JSONEditor-host.jp-mod-focused {
  background-color: var(--jp-input-active-background);
  border: 1px solid var(--jp-input-active-border-color);
  box-shadow: var(--jp-input-box-shadow);
}

.jp-Editor.jp-mod-dropTarget {
  border: var(--jp-border-width) solid var(--jp-input-active-border-color);
  box-shadow: var(--jp-input-box-shadow);
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/
.jp-DocumentSearch-input {
  border: none;
  outline: none;
  color: var(--jp-ui-font-color0);
  font-size: var(--jp-ui-font-size1);
  background-color: var(--jp-layout-color0);
  font-family: var(--jp-ui-font-family);
  padding: 2px 1px;
  resize: none;
}

.jp-DocumentSearch-overlay {
  position: absolute;
  background-color: var(--jp-toolbar-background);
  border-bottom: var(--jp-border-width) solid var(--jp-toolbar-border-color);
  border-left: var(--jp-border-width) solid var(--jp-toolbar-border-color);
  top: 0;
  right: 0;
  z-index: 7;
  min-width: 405px;
  padding: 2px;
  font-size: var(--jp-ui-font-size1);

  --jp-private-document-search-button-height: 20px;
}

.jp-DocumentSearch-overlay button {
  background-color: var(--jp-toolbar-background);
  outline: 0;
}

.jp-DocumentSearch-overlay button:hover {
  background-color: var(--jp-layout-color2);
}

.jp-DocumentSearch-overlay button:active {
  background-color: var(--jp-layout-color3);
}

.jp-DocumentSearch-overlay-row {
  display: flex;
  align-items: center;
  margin-bottom: 2px;
}

.jp-DocumentSearch-button-content {
  display: inline-block;
  cursor: pointer;
  box-sizing: border-box;
  width: 100%;
  height: 100%;
}

.jp-DocumentSearch-button-content svg {
  width: 100%;
  height: 100%;
}

.jp-DocumentSearch-input-wrapper {
  border: var(--jp-border-width) solid var(--jp-border-color0);
  display: flex;
  background-color: var(--jp-layout-color0);
  margin: 2px;
}

.jp-DocumentSearch-input-wrapper:focus-within {
  border-color: var(--jp-cell-editor-active-border-color);
}

.jp-DocumentSearch-toggle-wrapper,
.jp-DocumentSearch-button-wrapper {
  all: initial;
  overflow: hidden;
  display: inline-block;
  border: none;
  box-sizing: border-box;
}

.jp-DocumentSearch-toggle-wrapper {
  width: 14px;
  height: 14px;
}

.jp-DocumentSearch-button-wrapper {
  width: var(--jp-private-document-search-button-height);
  height: var(--jp-private-document-search-button-height);
}

.jp-DocumentSearch-toggle-wrapper:focus,
.jp-DocumentSearch-button-wrapper:focus {
  outline: var(--jp-border-width) solid
    var(--jp-cell-editor-active-border-color);
  outline-offset: -1px;
}

.jp-DocumentSearch-toggle-wrapper,
.jp-DocumentSearch-button-wrapper,
.jp-DocumentSearch-button-content:focus {
  outline: none;
}

.jp-DocumentSearch-toggle-placeholder {
  width: 5px;
}

.jp-DocumentSearch-input-button::before {
  display: block;
  padding-top: 100%;
}

.jp-DocumentSearch-input-button-off {
  opacity: var(--jp-search-toggle-off-opacity);
}

.jp-DocumentSearch-input-button-off:hover {
  opacity: var(--jp-search-toggle-hover-opacity);
}

.jp-DocumentSearch-input-button-on {
  opacity: var(--jp-search-toggle-on-opacity);
}

.jp-DocumentSearch-index-counter {
  padding-left: 10px;
  padding-right: 10px;
  user-select: none;
  min-width: 35px;
  display: inline-block;
}

.jp-DocumentSearch-up-down-wrapper {
  display: inline-block;
  padding-right: 2px;
  margin-left: auto;
  white-space: nowrap;
}

.jp-DocumentSearch-spacer {
  margin-left: auto;
}

.jp-DocumentSearch-up-down-wrapper button {
  outline: 0;
  border: none;
  width: var(--jp-private-document-search-button-height);
  height: var(--jp-private-document-search-button-height);
  vertical-align: middle;
  margin: 1px 5px 2px;
}

.jp-DocumentSearch-up-down-button:hover {
  background-color: var(--jp-layout-color2);
}

.jp-DocumentSearch-up-down-button:active {
  background-color: var(--jp-layout-color3);
}

.jp-DocumentSearch-filter-button {
  border-radius: var(--jp-border-radius);
}

.jp-DocumentSearch-filter-button:hover {
  background-color: var(--jp-layout-color2);
}

.jp-DocumentSearch-filter-button-enabled {
  background-color: var(--jp-layout-color2);
}

.jp-DocumentSearch-filter-button-enabled:hover {
  background-color: var(--jp-layout-color3);
}

.jp-DocumentSearch-search-options {
  padding: 0 8px;
  margin-left: 3px;
  width: 100%;
  display: grid;
  justify-content: start;
  grid-template-columns: 1fr 1fr;
  align-items: center;
  justify-items: stretch;
}

.jp-DocumentSearch-search-filter-disabled {
  color: var(--jp-ui-font-color2);
}

.jp-DocumentSearch-search-filter {
  display: flex;
  align-items: center;
  user-select: none;
}

.jp-DocumentSearch-regex-error {
  color: var(--jp-error-color0);
}

.jp-DocumentSearch-replace-button-wrapper {
  overflow: hidden;
  display: inline-block;
  box-sizing: border-box;
  border: var(--jp-border-width) solid var(--jp-border-color0);
  margin: auto 2px;
  padding: 1px 4px;
  height: calc(var(--jp-private-document-search-button-height) + 2px);
}

.jp-DocumentSearch-replace-button-wrapper:focus {
  border: var(--jp-border-width) solid var(--jp-cell-editor-active-border-color);
}

.jp-DocumentSearch-replace-button {
  display: inline-block;
  text-align: center;
  cursor: pointer;
  box-sizing: border-box;
  color: var(--jp-ui-font-color1);

  /* height - 2 * (padding of wrapper) */
  line-height: calc(var(--jp-private-document-search-button-height) - 2px);
  width: 100%;
  height: 100%;
}

.jp-DocumentSearch-replace-button:focus {
  outline: none;
}

.jp-DocumentSearch-replace-wrapper-class {
  margin-left: 14px;
  display: flex;
}

.jp-DocumentSearch-replace-toggle {
  border: none;
  background-color: var(--jp-toolbar-background);
  border-radius: var(--jp-border-radius);
}

.jp-DocumentSearch-replace-toggle:hover {
  background-color: var(--jp-layout-color2);
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

.cm-editor {
  line-height: var(--jp-code-line-height);
  font-size: var(--jp-code-font-size);
  font-family: var(--jp-code-font-family);
  border: 0;
  border-radius: 0;
  height: auto;

  /* Changed to auto to autogrow */
}

.cm-editor pre {
  padding: 0 var(--jp-code-padding);
}

.jp-CodeMirrorEditor[data-type='inline'] .cm-dialog {
  background-color: var(--jp-layout-color0);
  color: var(--jp-content-font-color1);
}

.jp-CodeMirrorEditor {
  cursor: text;
}

/* When zoomed out 67% and 33% on a screen of 1440 width x 900 height */
@media screen and (min-width: 2138px) and (max-width: 4319px) {
  .jp-CodeMirrorEditor[data-type='inline'] .cm-cursor {
    border-left: var(--jp-code-cursor-width1) solid
      var(--jp-editor-cursor-color);
  }
}

/* When zoomed out less than 33% */
@media screen and (min-width: 4320px) {
  .jp-CodeMirrorEditor[data-type='inline'] .cm-cursor {
    border-left: var(--jp-code-cursor-width2) solid
      var(--jp-editor-cursor-color);
  }
}

.cm-editor.jp-mod-readOnly .cm-cursor {
  display: none;
}

.jp-CollaboratorCursor {
  border-left: 5px solid transparent;
  border-right: 5px solid transparent;
  border-top: none;
  border-bottom: 3px solid;
  background-clip: content-box;
  margin-left: -5px;
  margin-right: -5px;
}

.cm-searching,
.cm-searching span {
  /* `.cm-searching span`: we need to override syntax highlighting */
  background-color: var(--jp-search-unselected-match-background-color);
  color: var(--jp-search-unselected-match-color);
}

.cm-searching::selection,
.cm-searching span::selection {
  background-color: var(--jp-search-unselected-match-background-color);
  color: var(--jp-search-unselected-match-color);
}

.jp-current-match > .cm-searching,
.jp-current-match > .cm-searching span,
.cm-searching > .jp-current-match,
.cm-searching > .jp-current-match span {
  background-color: var(--jp-search-selected-match-background-color);
  color: var(--jp-search-selected-match-color);
}

.jp-current-match > .cm-searching::selection,
.cm-searching > .jp-current-match::selection,
.jp-current-match > .cm-searching span::selection {
  background-color: var(--jp-search-selected-match-background-color);
  color: var(--jp-search-selected-match-color);
}

.cm-trailingspace {
  background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAFCAYAAAB4ka1VAAAAsElEQVQIHQGlAFr/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA7+r3zKmT0/+pk9P/7+r3zAAAAAAAAAAABAAAAAAAAAAA6OPzM+/q9wAAAAAA6OPzMwAAAAAAAAAAAgAAAAAAAAAAGR8NiRQaCgAZIA0AGR8NiQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQyoYJ/SY80UAAAAASUVORK5CYII=);
  background-position: center left;
  background-repeat: repeat-x;
}

.jp-CollaboratorCursor-hover {
  position: absolute;
  z-index: 1;
  transform: translateX(-50%);
  color: white;
  border-radius: 3px;
  padding-left: 4px;
  padding-right: 4px;
  padding-top: 1px;
  padding-bottom: 1px;
  text-align: center;
  font-size: var(--jp-ui-font-size1);
  white-space: nowrap;
}

.jp-CodeMirror-ruler {
  border-left: 1px dashed var(--jp-border-color2);
}

/* Styles for shared cursors (remote cursor locations and selected ranges) */
.jp-CodeMirrorEditor .cm-ySelectionCaret {
  position: relative;
  border-left: 1px solid black;
  margin-left: -1px;
  margin-right: -1px;
  box-sizing: border-box;
}

.jp-CodeMirrorEditor .cm-ySelectionCaret > .cm-ySelectionInfo {
  white-space: nowrap;
  position: absolute;
  top: -1.15em;
  padding-bottom: 0.05em;
  left: -1px;
  font-size: 0.95em;
  font-family: var(--jp-ui-font-family);
  font-weight: bold;
  line-height: normal;
  user-select: none;
  color: white;
  padding-left: 2px;
  padding-right: 2px;
  z-index: 101;
  transition: opacity 0.3s ease-in-out;
}

.jp-CodeMirrorEditor .cm-ySelectionInfo {
  transition-delay: 0.7s;
  opacity: 0;
}

.jp-CodeMirrorEditor .cm-ySelectionCaret:hover > .cm-ySelectionInfo {
  opacity: 1;
  transition-delay: 0s;
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

.jp-MimeDocument {
  outline: none;
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
| Variables
|----------------------------------------------------------------------------*/

:root {
  --jp-private-filebrowser-button-height: 28px;
  --jp-private-filebrowser-button-width: 48px;
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

.jp-FileBrowser .jp-SidePanel-content {
  display: flex;
  flex-direction: column;
}

.jp-FileBrowser-toolbar.jp-Toolbar {
  flex-wrap: wrap;
  row-gap: 12px;
  border-bottom: none;
  height: auto;
  margin: 8px 12px 0;
  box-shadow: none;
  padding: 0;
  justify-content: flex-start;
}

.jp-FileBrowser-Panel {
  flex: 1 1 auto;
  display: flex;
  flex-direction: column;
}

.jp-BreadCrumbs {
  flex: 0 0 auto;
  margin: 8px 12px;
}

.jp-BreadCrumbs-item {
  margin: 0 2px;
  padding: 0 2px;
  border-radius: var(--jp-border-radius);
  cursor: pointer;
}

.jp-BreadCrumbs-item:hover {
  background-color: var(--jp-layout-color2);
}

.jp-BreadCrumbs-item:first-child {
  margin-left: 0;
}

.jp-BreadCrumbs-item.jp-mod-dropTarget {
  background-color: var(--jp-brand-color2);
  opacity: 0.7;
}

/*-----------------------------------------------------------------------------
| Buttons
|----------------------------------------------------------------------------*/

.jp-FileBrowser-toolbar > .jp-Toolbar-item {
  flex: 0 0 auto;
  padding-left: 0;
  padding-right: 2px;
  align-items: center;
  height: unset;
}

.jp-FileBrowser-toolbar > .jp-Toolbar-item .jp-ToolbarButtonComponent {
  width: 40px;
}

/*-----------------------------------------------------------------------------
| Other styles
|----------------------------------------------------------------------------*/

.jp-FileDialog.jp-mod-conflict input {
  color: var(--jp-error-color1);
}

.jp-FileDialog .jp-new-name-title {
  margin-top: 12px;
}

.jp-LastModified-hidden {
  display: none;
}

.jp-FileSize-hidden {
  display: none;
}

.jp-FileBrowser .lm-AccordionPanel > h3:first-child {
  display: none;
}

/*-----------------------------------------------------------------------------
| DirListing
|----------------------------------------------------------------------------*/

.jp-DirListing {
  flex: 1 1 auto;
  display: flex;
  flex-direction: column;
  outline: 0;
}

.jp-DirListing-header {
  flex: 0 0 auto;
  display: flex;
  flex-direction: row;
  align-items: center;
  overflow: hidden;
  border-top: var(--jp-border-width) solid var(--jp-border-color2);
  border-bottom: var(--jp-border-width) solid var(--jp-border-color1);
  box-shadow: var(--jp-toolbar-box-shadow);
  z-index: 2;
}

.jp-DirListing-headerItem {
  padding: 4px 12px 2px;
  font-weight: 500;
}

.jp-DirListing-headerItem:hover {
  background: var(--jp-layout-color2);
}

.jp-DirListing-headerItem.jp-id-name {
  flex: 1 0 84px;
}

.jp-DirListing-headerItem.jp-id-modified {
  flex: 0 0 112px;
  border-left: var(--jp-border-width) solid var(--jp-border-color2);
  text-align: right;
}

.jp-DirListing-headerItem.jp-id-filesize {
  flex: 0 0 75px;
  border-left: var(--jp-border-width) solid var(--jp-border-color2);
  text-align: right;
}

.jp-id-narrow {
  display: none;
  flex: 0 0 5px;
  padding: 4px;
  border-left: var(--jp-border-width) solid var(--jp-border-color2);
  text-align: right;
  color: var(--jp-border-color2);
}

.jp-DirListing-narrow .jp-id-narrow {
  display: block;
}

.jp-DirListing-narrow .jp-id-modified,
.jp-DirListing-narrow .jp-DirListing-itemModified {
  display: none;
}

.jp-DirListing-headerItem.jp-mod-selected {
  font-weight: 600;
}

/* increase specificity to override bundled default */
.jp-DirListing-content {
  flex: 1 1 auto;
  margin: 0;
  padding: 0;
  list-style-type: none;
  overflow: auto;
  background-color: var(--jp-layout-color1);
}

.jp-DirListing-content mark {
  color: var(--jp-ui-font-color0);
  background-color: transparent;
  font-weight: bold;
}

.jp-DirListing-content .jp-DirListing-item.jp-mod-selected mark {
  color: var(--jp-ui-inverse-font-color0);
}

/* Style the directory listing content when a user drops a file to upload */
.jp-DirListing.jp-mod-native-drop .jp-DirListing-content {
  outline: 5px dashed rgba(128, 128, 128, 0.5);
  outline-offset: -10px;
  cursor: copy;
}

.jp-DirListing-item {
  display: flex;
  flex-direction: row;
  align-items: center;
  padding: 4px 12px;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.jp-DirListing-checkboxWrapper {
  /* Increases hit area of checkbox. */
  padding: 4px;
}

.jp-DirListing-header
  .jp-DirListing-checkboxWrapper
  + .jp-DirListing-headerItem {
  padding-left: 4px;
}

.jp-DirListing-content .jp-DirListing-checkboxWrapper {
  position: relative;
  left: -4px;
  margin: -4px 0 -4px -8px;
}

.jp-DirListing-checkboxWrapper.jp-mod-visible {
  visibility: visible;
}

/* For devices that support hovering, hide checkboxes until hovered, selected...
*/
@media (hover: hover) {
  .jp-DirListing-checkboxWrapper {
    visibility: hidden;
  }

  .jp-DirListing-item:hover .jp-DirListing-checkboxWrapper,
  .jp-DirListing-item.jp-mod-selected .jp-DirListing-checkboxWrapper {
    visibility: visible;
  }
}

.jp-DirListing-item[data-is-dot] {
  opacity: 75%;
}

.jp-DirListing-item.jp-mod-selected {
  color: var(--jp-ui-inverse-font-color1);
  background: var(--jp-brand-color1);
}

.jp-DirListing-item.jp-mod-dropTarget {
  background: var(--jp-brand-color3);
}

.jp-DirListing-item:hover:not(.jp-mod-selected) {
  background: var(--jp-layout-color2);
}

.jp-DirListing-itemIcon {
  flex: 0 0 20px;
  margin-right: 4px;
}

.jp-DirListing-itemText {
  flex: 1 0 64px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  user-select: none;
}

.jp-DirListing-itemText:focus {
  outline-width: 2px;
  outline-color: var(--jp-inverse-layout-color1);
  outline-style: solid;
  outline-offset: 1px;
}

.jp-DirListing-item.jp-mod-selected .jp-DirListing-itemText:focus {
  outline-color: var(--jp-layout-color1);
}

.jp-DirListing-itemModified {
  flex: 0 0 125px;
  text-align: right;
}

.jp-DirListing-itemFileSize {
  flex: 0 0 90px;
  text-align: right;
}

.jp-DirListing-editor {
  flex: 1 0 64px;
  outline: none;
  border: none;
  color: var(--jp-ui-font-color1);
  background-color: var(--jp-layout-color1);
}

.jp-DirListing-item.jp-mod-running .jp-DirListing-itemIcon::before {
  color: var(--jp-success-color1);
  content: '\25CF';
  font-size: 8px;
  position: absolute;
  left: -8px;
}

.jp-DirListing-item.jp-mod-running.jp-mod-selected
  .jp-DirListing-itemIcon::before {
  color: var(--jp-ui-inverse-font-color1);
}

.jp-DirListing-item.lm-mod-drag-image,
.jp-DirListing-item.jp-mod-selected.lm-mod-drag-image {
  font-size: var(--jp-ui-font-size1);
  padding-left: 4px;
  margin-left: 4px;
  width: 160px;
  background-color: var(--jp-ui-inverse-font-color2);
  box-shadow: var(--jp-elevation-z2);
  border-radius: 0;
  color: var(--jp-ui-font-color1);
  transform: translateX(-40%) translateY(-58%);
}

.jp-Document {
  min-width: 120px;
  min-height: 120px;
  outline: none;
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
| Main OutputArea
| OutputArea has a list of Outputs
|----------------------------------------------------------------------------*/

.jp-OutputArea {
  overflow-y: auto;
}

.jp-OutputArea-child {
  display: table;
  table-layout: fixed;
  width: 100%;
  overflow: hidden;
}

.jp-OutputPrompt {
  width: var(--jp-cell-prompt-width);
  color: var(--jp-cell-outprompt-font-color);
  font-family: var(--jp-cell-prompt-font-family);
  padding: var(--jp-code-padding);
  letter-spacing: var(--jp-cell-prompt-letter-spacing);
  line-height: var(--jp-code-line-height);
  font-size: var(--jp-code-font-size);
  border: var(--jp-border-width) solid transparent;
  opacity: var(--jp-cell-prompt-opacity);

  /* Right align prompt text, don't wrap to handle large prompt numbers */
  text-align: right;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;

  /* Disable text selection */
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.jp-OutputArea-prompt {
  display: table-cell;
  vertical-align: top;
}

.jp-OutputArea-output {
  display: table-cell;
  width: 100%;
  height: auto;
  overflow: auto;
  user-select: text;
  -moz-user-select: text;
  -webkit-user-select: text;
  -ms-user-select: text;
}

.jp-OutputArea .jp-RenderedText {
  padding-left: 1ch;
}

/**
 * Prompt overlay.
 */

.jp-OutputArea-promptOverlay {
  position: absolute;
  top: 0;
  width: var(--jp-cell-prompt-width);
  height: 100%;
  opacity: 0.5;
}

.jp-OutputArea-promptOverlay:hover {
  background: var(--jp-layout-color2);
  box-shadow: inset 0 0 1px var(--jp-inverse-layout-color0);
  cursor: zoom-out;
}

.jp-mod-outputsScrolled .jp-OutputArea-promptOverlay:hover {
  cursor: zoom-in;
}

/**
 * Isolated output.
 */
.jp-OutputArea-output.jp-mod-isolated {
  width: 100%;
  display: block;
}

/*
When drag events occur, `lm-mod-override-cursor` is added to the body.
Because iframes steal all cursor events, the following two rules are necessary
to suppress pointer events while resize drags are occurring. There may be a
better solution to this problem.
*/
body.lm-mod-override-cursor .jp-OutputArea-output.jp-mod-isolated {
  position: relative;
}

body.lm-mod-override-cursor .jp-OutputArea-output.jp-mod-isolated::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: transparent;
}

/* pre */

.jp-OutputArea-output pre {
  border: none;
  margin: 0;
  padding: 0;
  overflow-x: auto;
  overflow-y: auto;
  word-break: break-all;
  word-wrap: break-word;
  white-space: pre-wrap;
}

/* tables */

.jp-OutputArea-output.jp-RenderedHTMLCommon table {
  margin-left: 0;
  margin-right: 0;
}

/* description lists */

.jp-OutputArea-output dl,
.jp-OutputArea-output dt,
.jp-OutputArea-output dd {
  display: block;
}

.jp-OutputArea-output dl {
  width: 100%;
  overflow: hidden;
  padding: 0;
  margin: 0;
}

.jp-OutputArea-output dt {
  font-weight: bold;
  float: left;
  width: 20%;
  padding: 0;
  margin: 0;
}

.jp-OutputArea-output dd {
  float: left;
  width: 80%;
  padding: 0;
  margin: 0;
}

.jp-TrimmedOutputs pre {
  background: var(--jp-layout-color3);
  font-size: calc(var(--jp-code-font-size) * 1.4);
  text-align: center;
  text-transform: uppercase;
}

/* Hide the gutter in case of
 *  - nested output areas (e.g. in the case of output widgets)
 *  - mirrored output areas
 */
.jp-OutputArea .jp-OutputArea .jp-OutputArea-prompt {
  display: none;
}

/* Hide empty lines in the output area, for instance due to cleared widgets */
.jp-OutputArea-prompt:empty {
  padding: 0;
  border: 0;
}

/*-----------------------------------------------------------------------------
| executeResult is added to any Output-result for the display of the object
| returned by a cell
|----------------------------------------------------------------------------*/

.jp-OutputArea-output.jp-OutputArea-executeResult {
  margin-left: 0;
  width: 100%;
}

/* Text output with the Out[] prompt needs a top padding to match the
 * alignment of the Out[] prompt itself.
 */
.jp-OutputArea-executeResult .jp-RenderedText.jp-OutputArea-output {
  padding-top: var(--jp-code-padding);
  border-top: var(--jp-border-width) solid transparent;
}

/*-----------------------------------------------------------------------------
| The Stdin output
|----------------------------------------------------------------------------*/

.jp-Stdin-prompt {
  color: var(--jp-content-font-color0);
  padding-right: var(--jp-code-padding);
  vertical-align: baseline;
  flex: 0 0 auto;
}

.jp-Stdin-input {
  font-family: var(--jp-code-font-family);
  font-size: inherit;
  color: inherit;
  background-color: inherit;
  width: 42%;
  min-width: 200px;

  /* make sure input baseline aligns with prompt */
  vertical-align: baseline;

  /* padding + margin = 0.5em between prompt and cursor */
  padding: 0 0.25em;
  margin: 0 0.25em;
  flex: 0 0 70%;
}

.jp-Stdin-input::placeholder {
  opacity: 0;
}

.jp-Stdin-input:focus {
  box-shadow: none;
}

.jp-Stdin-input:focus::placeholder {
  opacity: 1;
}

/*-----------------------------------------------------------------------------
| Output Area View
|----------------------------------------------------------------------------*/

.jp-LinkedOutputView .jp-OutputArea {
  height: 100%;
  display: block;
}

.jp-LinkedOutputView .jp-OutputArea-output:only-child {
  height: 100%;
}

/*-----------------------------------------------------------------------------
| Printing
|----------------------------------------------------------------------------*/

@media print {
  .jp-OutputArea-child {
    break-inside: avoid-page;
  }
}

/*-----------------------------------------------------------------------------
| Mobile
|----------------------------------------------------------------------------*/
@media only screen and (max-width: 760px) {
  .jp-OutputPrompt {
    display: table-row;
    text-align: left;
  }

  .jp-OutputArea-child .jp-OutputArea-output {
    display: table-row;
    margin-left: var(--jp-notebook-padding);
  }
}

/* Trimmed outputs warning */
.jp-TrimmedOutputs > a {
  margin: 10px;
  text-decoration: none;
  cursor: pointer;
}

.jp-TrimmedOutputs > a:hover {
  text-decoration: none;
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
| Table of Contents
|----------------------------------------------------------------------------*/

:root {
  --jp-private-toc-active-width: 4px;
}

.jp-TableOfContents {
  display: flex;
  flex-direction: column;
  background: var(--jp-layout-color1);
  color: var(--jp-ui-font-color1);
  font-size: var(--jp-ui-font-size1);
  height: 100%;
}

.jp-TableOfContents-placeholder {
  text-align: center;
}

.jp-TableOfContents-placeholderContent {
  color: var(--jp-content-font-color2);
  padding: 8px;
}

.jp-TableOfContents-placeholderContent > h3 {
  margin-bottom: var(--jp-content-heading-margin-bottom);
}

.jp-TableOfContents .jp-SidePanel-content {
  overflow-y: auto;
}

.jp-TableOfContents-tree {
  margin: 4px;
}

.jp-TableOfContents ol {
  list-style-type: none;
}

/* stylelint-disable-next-line selector-max-type */
.jp-TableOfContents li > ol {
  /* Align left border with triangle icon center */
  padding-left: 11px;
}

.jp-TableOfContents-content {
  /* left margin for the active heading indicator */
  margin: 0 0 0 var(--jp-private-toc-active-width);
  padding: 0;
  background-color: var(--jp-layout-color1);
}

.jp-tocItem {
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.jp-tocItem-heading {
  display: flex;
  cursor: pointer;
}

.jp-tocItem-heading:hover {
  background-color: var(--jp-layout-color2);
}

.jp-tocItem-content {
  display: block;
  padding: 4px 0;
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow-x: hidden;
}

.jp-tocItem-collapser {
  height: 20px;
  margin: 2px 2px 0;
  padding: 0;
  background: none;
  border: none;
  cursor: pointer;
}

.jp-tocItem-collapser:hover {
  background-color: var(--jp-layout-color3);
}

/* Active heading indicator */

.jp-tocItem-heading::before {
  content: ' ';
  background: transparent;
  width: var(--jp-private-toc-active-width);
  height: 24px;
  position: absolute;
  left: 0;
  border-radius: var(--jp-border-radius);
}

.jp-tocItem-heading.jp-tocItem-active::before {
  background-color: var(--jp-brand-color1);
}

.jp-tocItem-heading:hover.jp-tocItem-active::before {
  background: var(--jp-brand-color0);
  opacity: 1;
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

.jp-Collapser {
  flex: 0 0 var(--jp-cell-collapser-width);
  padding: 0;
  margin: 0;
  border: none;
  outline: none;
  background: transparent;
  border-radius: var(--jp-border-radius);
  opacity: 1;
}

.jp-Collapser-child {
  display: block;
  width: 100%;
  box-sizing: border-box;

  /* height: 100% doesn't work because the height of its parent is computed from content */
  position: absolute;
  top: 0;
  bottom: 0;
}

/*-----------------------------------------------------------------------------
| Printing
|----------------------------------------------------------------------------*/

/*
Hiding collapsers in print mode.

Note: input and output wrappers have "display: block" propery in print mode.
*/

@media print {
  .jp-Collapser {
    display: none;
  }
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
| Header/Footer
|----------------------------------------------------------------------------*/

/* Hidden by zero height by default */
.jp-CellHeader,
.jp-CellFooter {
  height: 0;
  width: 100%;
  padding: 0;
  margin: 0;
  border: none;
  outline: none;
  background: transparent;
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
| Input
|----------------------------------------------------------------------------*/

/* All input areas */
.jp-InputArea {
  display: table;
  table-layout: fixed;
  width: 100%;
  overflow: hidden;
}

.jp-InputArea-editor {
  display: table-cell;
  overflow: hidden;
  vertical-align: top;

  /* This is the non-active, default styling */
  border: var(--jp-border-width) solid var(--jp-cell-editor-border-color);
  border-radius: 0;
  background: var(--jp-cell-editor-background);
}

.jp-InputPrompt {
  display: table-cell;
  vertical-align: top;
  width: var(--jp-cell-prompt-width);
  color: var(--jp-cell-inprompt-font-color);
  font-family: var(--jp-cell-prompt-font-family);
  padding: var(--jp-code-padding);
  letter-spacing: var(--jp-cell-prompt-letter-spacing);
  opacity: var(--jp-cell-prompt-opacity);
  line-height: var(--jp-code-line-height);
  font-size: var(--jp-code-font-size);
  border: var(--jp-border-width) solid transparent;

  /* Right align prompt text, don't wrap to handle large prompt numbers */
  text-align: right;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;

  /* Disable text selection */
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

/*-----------------------------------------------------------------------------
| Mobile
|----------------------------------------------------------------------------*/
@media only screen and (max-width: 760px) {
  .jp-InputArea-editor {
    display: table-row;
    margin-left: var(--jp-notebook-padding);
  }

  .jp-InputPrompt {
    display: table-row;
    text-align: left;
  }
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
| Placeholder
|----------------------------------------------------------------------------*/

.jp-Placeholder {
  display: table;
  table-layout: fixed;
  width: 100%;
}

.jp-Placeholder-prompt {
  display: table-cell;
  box-sizing: border-box;
}

.jp-Placeholder-content {
  display: table-cell;
  padding: 4px 6px;
  border: 1px solid transparent;
  border-radius: 0;
  background: none;
  box-sizing: border-box;
  cursor: pointer;
}

.jp-Placeholder-contentContainer {
  display: flex;
}

.jp-Placeholder-content:hover,
.jp-InputPlaceholder > .jp-Placeholder-content:hover {
  border-color: var(--jp-layout-color3);
}

.jp-Placeholder-content .jp-MoreHorizIcon {
  width: 32px;
  height: 16px;
  border: 1px solid transparent;
  border-radius: var(--jp-border-radius);
}

.jp-Placeholder-content .jp-MoreHorizIcon:hover {
  border: 1px solid var(--jp-border-color1);
  box-shadow: 0 0 2px 0 rgba(0, 0, 0, 0.25);
  background-color: var(--jp-layout-color0);
}

.jp-PlaceholderText {
  white-space: nowrap;
  overflow-x: hidden;
  color: var(--jp-inverse-layout-color3);
  font-family: var(--jp-code-font-family);
}

.jp-InputPlaceholder > .jp-Placeholder-content {
  border-color: var(--jp-cell-editor-border-color);
  background: var(--jp-cell-editor-background);
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
| Private CSS variables
|----------------------------------------------------------------------------*/

:root {
  --jp-private-cell-scrolling-output-offset: 5px;
}

/*-----------------------------------------------------------------------------
| Cell
|----------------------------------------------------------------------------*/

.jp-Cell {
  padding: var(--jp-cell-padding);
  margin: 0;
  border: none;
  outline: none;
  background: transparent;
}

/*-----------------------------------------------------------------------------
| Common input/output
|----------------------------------------------------------------------------*/

.jp-Cell-inputWrapper,
.jp-Cell-outputWrapper {
  display: flex;
  flex-direction: row;
  padding: 0;
  margin: 0;

  /* Added to reveal the box-shadow on the input and output collapsers. */
  overflow: visible;
}

/* Only input/output areas inside cells */
.jp-Cell-inputArea,
.jp-Cell-outputArea {
  flex: 1 1 auto;
}

/*-----------------------------------------------------------------------------
| Collapser
|----------------------------------------------------------------------------*/

/* Make the output collapser disappear when there is not output, but do so
 * in a manner that leaves it in the layout and preserves its width.
 */
.jp-Cell.jp-mod-noOutputs .jp-Cell-outputCollapser {
  border: none !important;
  background: transparent !important;
}

.jp-Cell:not(.jp-mod-noOutputs) .jp-Cell-outputCollapser {
  min-height: var(--jp-cell-collapser-min-height);
}

/*-----------------------------------------------------------------------------
| Output
|----------------------------------------------------------------------------*/

/* Put a space between input and output when there IS output */
.jp-Cell:not(.jp-mod-noOutputs) .jp-Cell-outputWrapper {
  margin-top: 5px;
}

.jp-CodeCell.jp-mod-outputsScrolled .jp-Cell-outputArea {
  overflow-y: auto;
  max-height: 24em;
  margin-left: var(--jp-private-cell-scrolling-output-offset);
  resize: vertical;
}

.jp-CodeCell.jp-mod-outputsScrolled .jp-Cell-outputArea[style*='height'] {
  max-height: unset;
}

.jp-CodeCell.jp-mod-outputsScrolled .jp-Cell-outputArea::after {
  content: ' ';
  box-shadow: inset 0 0 6px 2px rgb(0 0 0 / 30%);
  width: 100%;
  height: 100%;
  position: sticky;
  bottom: 0;
  top: 0;
  margin-top: -50%;
  float: left;
  display: block;
  pointer-events: none;
}

.jp-CodeCell.jp-mod-outputsScrolled .jp-OutputArea-child {
  padding-top: 6px;
}

.jp-CodeCell.jp-mod-outputsScrolled .jp-OutputArea-prompt {
  width: calc(
    var(--jp-cell-prompt-width) - var(--jp-private-cell-scrolling-output-offset)
  );
}

.jp-CodeCell.jp-mod-outputsScrolled .jp-OutputArea-promptOverlay {
  left: calc(-1 * var(--jp-private-cell-scrolling-output-offset));
}

/*-----------------------------------------------------------------------------
| CodeCell
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
| MarkdownCell
|----------------------------------------------------------------------------*/

.jp-MarkdownOutput {
  display: table-cell;
  width: 100%;
  margin-top: 0;
  margin-bottom: 0;
  padding-left: var(--jp-code-padding);
}

.jp-MarkdownOutput.jp-RenderedHTMLCommon {
  overflow: auto;
}

/* collapseHeadingButton (show always if hiddenCellsButton is _not_ shown) */
.jp-collapseHeadingButton {
  display: flex;
  min-height: var(--jp-cell-collapser-min-height);
  font-size: var(--jp-code-font-size);
  position: absolute;
  background-color: transparent;
  background-size: 25px;
  background-repeat: no-repeat;
  background-position-x: center;
  background-position-y: top;
  background-image: var(--jp-icon-caret-down);
  right: 0;
  top: 0;
  bottom: 0;
}

.jp-collapseHeadingButton.jp-mod-collapsed {
  background-image: var(--jp-icon-caret-right);
}

/*
 set the container font size to match that of content
 so that the nested collapse buttons have the right size
*/
.jp-MarkdownCell .jp-InputPrompt {
  font-size: var(--jp-content-font-size1);
}

/*
  Align collapseHeadingButton with cell top header
  The font sizes are identical to the ones in packages/rendermime/style/base.css
*/
.jp-mod-rendered .jp-collapseHeadingButton[data-heading-level='1'] {
  font-size: var(--jp-content-font-size5);
  background-position-y: calc(0.3 * var(--jp-content-font-size5));
}

.jp-mod-rendered .jp-collapseHeadingButton[data-heading-level='2'] {
  font-size: var(--jp-content-font-size4);
  background-position-y: calc(0.3 * var(--jp-content-font-size4));
}

.jp-mod-rendered .jp-collapseHeadingButton[data-heading-level='3'] {
  font-size: var(--jp-content-font-size3);
  background-position-y: calc(0.3 * var(--jp-content-font-size3));
}

.jp-mod-rendered .jp-collapseHeadingButton[data-heading-level='4'] {
  font-size: var(--jp-content-font-size2);
  background-position-y: calc(0.3 * var(--jp-content-font-size2));
}

.jp-mod-rendered .jp-collapseHeadingButton[data-heading-level='5'] {
  font-size: var(--jp-content-font-size1);
  background-position-y: top;
}

.jp-mod-rendered .jp-collapseHeadingButton[data-heading-level='6'] {
  font-size: var(--jp-content-font-size0);
  background-position-y: top;
}

/* collapseHeadingButton (show only on (hover,active) if hiddenCellsButton is shown) */
.jp-Notebook.jp-mod-showHiddenCellsButton .jp-collapseHeadingButton {
  display: none;
}

.jp-Notebook.jp-mod-showHiddenCellsButton
  :is(.jp-MarkdownCell:hover, .jp-mod-active)
  .jp-collapseHeadingButton {
  display: flex;
}

/* showHiddenCellsButton (only show if jp-mod-showHiddenCellsButton is set, which
is a consequence of the showHiddenCellsButton option in Notebook Settings)*/
.jp-Notebook.jp-mod-showHiddenCellsButton .jp-showHiddenCellsButton {
  margin-left: calc(var(--jp-cell-prompt-width) + 2 * var(--jp-code-padding));
  margin-top: var(--jp-code-padding);
  border: 1px solid var(--jp-border-color2);
  background-color: var(--jp-border-color3) !important;
  color: var(--jp-content-font-color0) !important;
  display: flex;
}

.jp-Notebook.jp-mod-showHiddenCellsButton .jp-showHiddenCellsButton:hover {
  background-color: var(--jp-border-color2) !important;
}

.jp-showHiddenCellsButton {
  display: none;
}

/*-----------------------------------------------------------------------------
| Printing
|----------------------------------------------------------------------------*/

/*
Using block instead of flex to allow the use of the break-inside CSS property for
cell outputs.
*/

@media print {
  .jp-Cell-inputWrapper,
  .jp-Cell-outputWrapper {
    display: block;
  }
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
| Variables
|----------------------------------------------------------------------------*/

:root {
  --jp-notebook-toolbar-padding: 2px 5px 2px 2px;
}

/*-----------------------------------------------------------------------------

/*-----------------------------------------------------------------------------
| Styles
|----------------------------------------------------------------------------*/

.jp-NotebookPanel-toolbar {
  padding: var(--jp-notebook-toolbar-padding);

  /* disable paint containment from lumino 2.0 default strict CSS containment */
  contain: style size !important;
}

.jp-Toolbar-item.jp-Notebook-toolbarCellType .jp-select-wrapper.jp-mod-focused {
  border: none;
  box-shadow: none;
}

.jp-Notebook-toolbarCellTypeDropdown select {
  height: 24px;
  font-size: var(--jp-ui-font-size1);
  line-height: 14px;
  border-radius: 0;
  display: block;
}

.jp-Notebook-toolbarCellTypeDropdown span {
  top: 5px !important;
}

.jp-Toolbar-responsive-popup {
  position: absolute;
  height: fit-content;
  display: flex;
  flex-direction: row;
  flex-wrap: wrap;
  justify-content: flex-end;
  border-bottom: var(--jp-border-width) solid var(--jp-toolbar-border-color);
  box-shadow: var(--jp-toolbar-box-shadow);
  background: var(--jp-toolbar-background);
  min-height: var(--jp-toolbar-micro-height);
  padding: var(--jp-notebook-toolbar-padding);
  z-index: 1;
  right: 0;
  top: 0;
}

.jp-Toolbar > .jp-Toolbar-responsive-opener {
  margin-left: auto;
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
| Variables
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------

/*-----------------------------------------------------------------------------
| Styles
|----------------------------------------------------------------------------*/

.jp-Notebook-ExecutionIndicator {
  position: relative;
  display: inline-block;
  height: 100%;
  z-index: 9997;
}

.jp-Notebook-ExecutionIndicator-tooltip {
  visibility: hidden;
  height: auto;
  width: max-content;
  width: -moz-max-content;
  background-color: var(--jp-layout-color2);
  color: var(--jp-ui-font-color1);
  text-align: justify;
  border-radius: 6px;
  padding: 0 5px;
  position: fixed;
  display: table;
}

.jp-Notebook-ExecutionIndicator-tooltip.up {
  transform: translateX(-50%) translateY(-100%) translateY(-32px);
}

.jp-Notebook-ExecutionIndicator-tooltip.down {
  transform: translateX(calc(-100% + 16px)) translateY(5px);
}

.jp-Notebook-ExecutionIndicator-tooltip.hidden {
  display: none;
}

.jp-Notebook-ExecutionIndicator:hover .jp-Notebook-ExecutionIndicator-tooltip {
  visibility: visible;
}

.jp-Notebook-ExecutionIndicator span {
  font-size: var(--jp-ui-font-size1);
  font-family: var(--jp-ui-font-family);
  color: var(--jp-ui-font-color1);
  line-height: 24px;
  display: block;
}

.jp-Notebook-ExecutionIndicator-progress-bar {
  display: flex;
  justify-content: center;
  height: 100%;
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

/*
 * Execution indicator
 */
.jp-tocItem-content::after {
  content: '';

  /* Must be identical to form a circle */
  width: 12px;
  height: 12px;
  background: none;
  border: none;
  position: absolute;
  right: 0;
}

.jp-tocItem-content[data-running='0']::after {
  border-radius: 50%;
  border: var(--jp-border-width) solid var(--jp-inverse-layout-color3);
  background: none;
}

.jp-tocItem-content[data-running='1']::after {
  border-radius: 50%;
  border: var(--jp-border-width) solid var(--jp-inverse-layout-color3);
  background-color: var(--jp-inverse-layout-color3);
}

.jp-tocItem-content[data-running='0'],
.jp-tocItem-content[data-running='1'] {
  margin-right: 12px;
}

/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

.jp-Notebook-footer {
  height: 27px;
  margin-left: calc(
    var(--jp-cell-prompt-width) + var(--jp-cell-collapser-width) +
      var(--jp-cell-padding)
  );
  width: calc(
    100% -
      (
        var(--jp-cell-prompt-width) + var(--jp-cell-collapser-width) +
          var(--jp-cell-padding) + var(--jp-cell-padding)
      )
  );
  border: var(--jp-border-width) solid var(--jp-cell-editor-border-color);
  color: var(--jp-ui-font-color3);
  margin-top: 6px;
  background: none;
  cursor: pointer;
}

.jp-Notebook-footer:focus {
  border-color: var(--jp-cell-editor-active-border-color);
}

/* For devices that support hovering, hide footer until hover */
@media (hover: hover) {
  .jp-Notebook-footer {
    opacity: 0;
  }

  .jp-Notebook-footer:focus,
  .jp-Notebook-footer:hover {
    opacity: 1;
  }
}

/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
| Imports
|----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------
| CSS variables
|----------------------------------------------------------------------------*/

:root {
  --jp-side-by-side-output-size: 1fr;
  --jp-side-by-side-resized-cell: var(--jp-side-by-side-output-size);
  --jp-private-notebook-dragImage-width: 304px;
  --jp-private-notebook-dragImage-height: 36px;
  --jp-private-notebook-selected-color: var(--md-blue-400);
  --jp-private-notebook-active-color: var(--md-green-400);
}

/*-----------------------------------------------------------------------------
| Notebook
|----------------------------------------------------------------------------*/

/* stylelint-disable selector-max-class */

.jp-NotebookPanel {
  display: block;
  height: 100%;
}

.jp-NotebookPanel.jp-Document {
  min-width: 240px;
  min-height: 120px;
}

.jp-Notebook {
  padding: var(--jp-notebook-padding);
  outline: none;
  overflow: auto;
  background: var(--jp-layout-color0);
}

.jp-Notebook.jp-mod-scrollPastEnd::after {
  display: block;
  content: '';
  min-height: var(--jp-notebook-scroll-padding);
}

.jp-MainAreaWidget-ContainStrict .jp-Notebook * {
  contain: strict;
}

.jp-Notebook .jp-Cell {
  overflow: visible;
}

.jp-Notebook .jp-Cell .jp-InputPrompt {
  cursor: move;
}

/*-----------------------------------------------------------------------------
| Notebook state related styling
|
| The notebook and cells each have states, here are the possibilities:
|
| - Notebook
|   - Command
|   - Edit
| - Cell
|   - None
|   - Active (only one can be active)
|   - Selected (the cells actions are applied to)
|   - Multiselected (when multiple selected, the cursor)
|   - No outputs
|----------------------------------------------------------------------------*/

/* Command or edit modes */

.jp-Notebook .jp-Cell:not(.jp-mod-active) .jp-InputPrompt {
  opacity: var(--jp-cell-prompt-not-active-opacity);
  color: var(--jp-cell-prompt-not-active-font-color);
}

.jp-Notebook .jp-Cell:not(.jp-mod-active) .jp-OutputPrompt {
  opacity: var(--jp-cell-prompt-not-active-opacity);
  color: var(--jp-cell-prompt-not-active-font-color);
}

/* cell is active */
.jp-Notebook .jp-Cell.jp-mod-active .jp-Collapser {
  background: var(--jp-brand-color1);
}

/* cell is dirty */
.jp-Notebook .jp-Cell.jp-mod-dirty .jp-InputPrompt {
  color: var(--jp-warn-color1);
}

.jp-Notebook .jp-Cell.jp-mod-dirty .jp-InputPrompt::before {
  color: var(--jp-warn-color1);
  content: '';
}

.jp-Notebook .jp-Cell.jp-mod-active.jp-mod-dirty .jp-Collapser {
  background: var(--jp-warn-color1);
}

/* collapser is hovered */
.jp-Notebook .jp-Cell .jp-Collapser:hover {
  box-shadow: var(--jp-elevation-z2);
  background: var(--jp-brand-color1);
  opacity: var(--jp-cell-collapser-not-active-hover-opacity);
}

/* cell is active and collapser is hovered */
.jp-Notebook .jp-Cell.jp-mod-active .jp-Collapser:hover {
  background: var(--jp-brand-color0);
  opacity: 1;
}

/* Command mode */

.jp-Notebook.jp-mod-commandMode .jp-Cell.jp-mod-selected {
  background: var(--jp-notebook-multiselected-color);
}

.jp-Notebook.jp-mod-commandMode
  .jp-Cell.jp-mod-active.jp-mod-selected:not(.jp-mod-multiSelected) {
  background: transparent;
}

/* Edit mode */

.jp-Notebook.jp-mod-editMode .jp-Cell.jp-mod-active .jp-InputArea-editor {
  border: var(--jp-border-width) solid var(--jp-cell-editor-active-border-color);
  box-shadow: var(--jp-input-box-shadow);
  background-color: var(--jp-cell-editor-active-background);
}

/*-----------------------------------------------------------------------------
| Notebook drag and drop
|----------------------------------------------------------------------------*/

.jp-Notebook-cell.jp-mod-dropSource {
  opacity: 0.5;
}

.jp-Notebook-cell.jp-mod-dropTarget,
.jp-Notebook.jp-mod-commandMode
  .jp-Notebook-cell.jp-mod-active.jp-mod-selected.jp-mod-dropTarget {
  border-top-color: var(--jp-private-notebook-selected-color);
  border-top-style: solid;
  border-top-width: 2px;
}

.jp-dragImage {
  display: block;
  flex-direction: row;
  width: var(--jp-private-notebook-dragImage-width);
  height: var(--jp-private-notebook-dragImage-height);
  border: var(--jp-border-width) solid var(--jp-cell-editor-border-color);
  background: var(--jp-cell-editor-background);
  overflow: visible;
}

.jp-dragImage-singlePrompt {
  box-shadow: 2px 2px 4px 0 rgba(0, 0, 0, 0.12);
}

.jp-dragImage .jp-dragImage-content {
  flex: 1 1 auto;
  z-index: 2;
  font-size: var(--jp-code-font-size);
  font-family: var(--jp-code-font-family);
  line-height: var(--jp-code-line-height);
  padding: var(--jp-code-padding);
  border: var(--jp-border-width) solid var(--jp-cell-editor-border-color);
  background: var(--jp-cell-editor-background-color);
  color: var(--jp-content-font-color3);
  text-align: left;
  margin: 4px 4px 4px 0;
}

.jp-dragImage .jp-dragImage-prompt {
  flex: 0 0 auto;
  min-width: 36px;
  color: var(--jp-cell-inprompt-font-color);
  padding: var(--jp-code-padding);
  padding-left: 12px;
  font-family: var(--jp-cell-prompt-font-family);
  letter-spacing: var(--jp-cell-prompt-letter-spacing);
  line-height: 1.9;
  font-size: var(--jp-code-font-size);
  border: var(--jp-border-width) solid transparent;
}

.jp-dragImage-multipleBack {
  z-index: -1;
  position: absolute;
  height: 32px;
  width: 300px;
  top: 8px;
  left: 8px;
  background: var(--jp-layout-color2);
  border: var(--jp-border-width) solid var(--jp-input-border-color);
  box-shadow: 2px 2px 4px 0 rgba(0, 0, 0, 0.12);
}

/*-----------------------------------------------------------------------------
| Cell toolbar
|----------------------------------------------------------------------------*/

.jp-NotebookTools {
  display: block;
  min-width: var(--jp-sidebar-min-width);
  color: var(--jp-ui-font-color1);
  background: var(--jp-layout-color1);

  /* This is needed so that all font sizing of children done in ems is
    * relative to this base size */
  font-size: var(--jp-ui-font-size1);
  overflow: auto;
}

.jp-ActiveCellTool {
  padding: 12px 0;
  display: flex;
}

.jp-ActiveCellTool-Content {
  flex: 1 1 auto;
}

.jp-ActiveCellTool .jp-ActiveCellTool-CellContent {
  background: var(--jp-cell-editor-background);
  border: var(--jp-border-width) solid var(--jp-cell-editor-border-color);
  border-radius: 0;
  min-height: 29px;
}

.jp-ActiveCellTool .jp-InputPrompt {
  min-width: calc(var(--jp-cell-prompt-width) * 0.75);
}

.jp-ActiveCellTool-CellContent > pre {
  padding: 5px 4px;
  margin: 0;
  white-space: normal;
}

.jp-MetadataEditorTool {
  flex-direction: column;
  padding: 12px 0;
}

.jp-RankedPanel > :not(:first-child) {
  margin-top: 12px;
}

.jp-KeySelector select.jp-mod-styled {
  font-size: var(--jp-ui-font-size1);
  color: var(--jp-ui-font-color0);
  border: var(--jp-border-width) solid var(--jp-border-color1);
}

.jp-KeySelector label,
.jp-MetadataEditorTool label,
.jp-NumberSetter label {
  line-height: 1.4;
}

.jp-NotebookTools .jp-select-wrapper {
  margin-top: 4px;
  margin-bottom: 0;
}

.jp-NumberSetter input {
  width: 100%;
  margin-top: 4px;
}

.jp-NotebookTools .jp-Collapse {
  margin-top: 16px;
}

/*-----------------------------------------------------------------------------
| Presentation Mode (.jp-mod-presentationMode)
|----------------------------------------------------------------------------*/

.jp-mod-presentationMode .jp-Notebook {
  --jp-content-font-size1: var(--jp-content-presentation-font-size1);
  --jp-code-font-size: var(--jp-code-presentation-font-size);
}

.jp-mod-presentationMode .jp-Notebook .jp-Cell .jp-InputPrompt,
.jp-mod-presentationMode .jp-Notebook .jp-Cell .jp-OutputPrompt {
  flex: 0 0 110px;
}

/*-----------------------------------------------------------------------------
| Side-by-side Mode (.jp-mod-sideBySide)
|----------------------------------------------------------------------------*/
.jp-mod-sideBySide.jp-Notebook .jp-Notebook-cell {
  margin-top: 3em;
  margin-bottom: 3em;
  margin-left: 5%;
  margin-right: 5%;
}

.jp-mod-sideBySide.jp-Notebook .jp-CodeCell {
  display: grid;
  grid-template-columns: minmax(0, 1fr) min-content minmax(
      0,
      var(--jp-side-by-side-output-size)
    );
  grid-template-rows: auto minmax(0, 1fr) auto;
  grid-template-areas:
    'header header header'
    'input handle output'
    'footer footer footer';
}

.jp-mod-sideBySide.jp-Notebook .jp-CodeCell.jp-mod-resizedCell {
  grid-template-columns: minmax(0, 1fr) min-content minmax(
      0,
      var(--jp-side-by-side-resized-cell)
    );
}

.jp-mod-sideBySide.jp-Notebook .jp-CodeCell .jp-CellHeader {
  grid-area: header;
}

.jp-mod-sideBySide.jp-Notebook .jp-CodeCell .jp-Cell-inputWrapper {
  grid-area: input;
}

.jp-mod-sideBySide.jp-Notebook .jp-CodeCell .jp-Cell-outputWrapper {
  /* overwrite the default margin (no vertical separation needed in side by side move */
  margin-top: 0;
  grid-area: output;
}

.jp-mod-sideBySide.jp-Notebook .jp-CodeCell .jp-CellFooter {
  grid-area: footer;
}

.jp-mod-sideBySide.jp-Notebook .jp-CodeCell .jp-CellResizeHandle {
  grid-area: handle;
  user-select: none;
  display: block;
  height: 100%;
  cursor: ew-resize;
  padding: 0 var(--jp-cell-padding);
}

.jp-mod-sideBySide.jp-Notebook .jp-CodeCell .jp-CellResizeHandle::after {
  content: '';
  display: block;
  background: var(--jp-border-color2);
  height: 100%;
  width: 5px;
}

.jp-mod-sideBySide.jp-Notebook
  .jp-CodeCell.jp-mod-resizedCell
  .jp-CellResizeHandle::after {
  background: var(--jp-border-color0);
}

.jp-CellResizeHandle {
  display: none;
}

/*-----------------------------------------------------------------------------
| Placeholder
|----------------------------------------------------------------------------*/

.jp-Cell-Placeholder {
  padding-left: 55px;
}

.jp-Cell-Placeholder-wrapper {
  background: #fff;
  border: 1px solid;
  border-color: #e5e6e9 #dfe0e4 #d0d1d5;
  border-radius: 4px;
  -webkit-border-radius: 4px;
  margin: 10px 15px;
}

.jp-Cell-Placeholder-wrapper-inner {
  padding: 15px;
  position: relative;
}

.jp-Cell-Placeholder-wrapper-body {
  background-repeat: repeat;
  background-size: 50% auto;
}

.jp-Cell-Placeholder-wrapper-body div {
  background: #f6f7f8;
  background-image: -webkit-linear-gradient(
    left,
    #f6f7f8 0%,
    #edeef1 20%,
    #f6f7f8 40%,
    #f6f7f8 100%
  );
  background-repeat: no-repeat;
  background-size: 800px 104px;
  height: 104px;
  position: absolute;
  right: 15px;
  left: 15px;
  top: 15px;
}

div.jp-Cell-Placeholder-h1 {
  top: 20px;
  height: 20px;
  left: 15px;
  width: 150px;
}

div.jp-Cell-Placeholder-h2 {
  left: 15px;
  top: 50px;
  height: 10px;
  width: 100px;
}

div.jp-Cell-Placeholder-content-1,
div.jp-Cell-Placeholder-content-2,
div.jp-Cell-Placeholder-content-3 {
  left: 15px;
  right: 15px;
  height: 10px;
}

div.jp-Cell-Placeholder-content-1 {
  top: 100px;
}

div.jp-Cell-Placeholder-content-2 {
  top: 120px;
}

div.jp-Cell-Placeholder-content-3 {
  top: 140px;
}

</style>
<style type="text/css">
/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/*
The following CSS variables define the main, public API for styling JupyterLab.
These variables should be used by all plugins wherever possible. In other
words, plugins should not define custom colors, sizes, etc unless absolutely
necessary. This enables users to change the visual theme of JupyterLab
by changing these variables.

Many variables appear in an ordered sequence (0,1,2,3). These sequences
are designed to work well together, so for example, `--jp-border-color1` should
be used with `--jp-layout-color1`. The numbers have the following meanings:

* 0: super-primary, reserved for special emphasis
* 1: primary, most important under normal situations
* 2: secondary, next most important under normal situations
* 3: tertiary, next most important under normal situations

Throughout JupyterLab, we are mostly following principles from Google's
Material Design when selecting colors. We are not, however, following
all of MD as it is not optimized for dense, information rich UIs.
*/

:root {
  /* Elevation
   *
   * We style box-shadows using Material Design's idea of elevation. These particular numbers are taken from here:
   *
   * https://github.com/material-components/material-components-web
   * https://material-components-web.appspot.com/elevation.html
   */

  --jp-shadow-base-lightness: 0;
  --jp-shadow-umbra-color: rgba(
    var(--jp-shadow-base-lightness),
    var(--jp-shadow-base-lightness),
    var(--jp-shadow-base-lightness),
    0.2
  );
  --jp-shadow-penumbra-color: rgba(
    var(--jp-shadow-base-lightness),
    var(--jp-shadow-base-lightness),
    var(--jp-shadow-base-lightness),
    0.14
  );
  --jp-shadow-ambient-color: rgba(
    var(--jp-shadow-base-lightness),
    var(--jp-shadow-base-lightness),
    var(--jp-shadow-base-lightness),
    0.12
  );
  --jp-elevation-z0: none;
  --jp-elevation-z1: 0 2px 1px -1px var(--jp-shadow-umbra-color),
    0 1px 1px 0 var(--jp-shadow-penumbra-color),
    0 1px 3px 0 var(--jp-shadow-ambient-color);
  --jp-elevation-z2: 0 3px 1px -2px var(--jp-shadow-umbra-color),
    0 2px 2px 0 var(--jp-shadow-penumbra-color),
    0 1px 5px 0 var(--jp-shadow-ambient-color);
  --jp-elevation-z4: 0 2px 4px -1px var(--jp-shadow-umbra-color),
    0 4px 5px 0 var(--jp-shadow-penumbra-color),
    0 1px 10px 0 var(--jp-shadow-ambient-color);
  --jp-elevation-z6: 0 3px 5px -1px var(--jp-shadow-umbra-color),
    0 6px 10px 0 var(--jp-shadow-penumbra-color),
    0 1px 18px 0 var(--jp-shadow-ambient-color);
  --jp-elevation-z8: 0 5px 5px -3px var(--jp-shadow-umbra-color),
    0 8px 10px 1px var(--jp-shadow-penumbra-color),
    0 3px 14px 2px var(--jp-shadow-ambient-color);
  --jp-elevation-z12: 0 7px 8px -4px var(--jp-shadow-umbra-color),
    0 12px 17px 2px var(--jp-shadow-penumbra-color),
    0 5px 22px 4px var(--jp-shadow-ambient-color);
  --jp-elevation-z16: 0 8px 10px -5px var(--jp-shadow-umbra-color),
    0 16px 24px 2px var(--jp-shadow-penumbra-color),
    0 6px 30px 5px var(--jp-shadow-ambient-color);
  --jp-elevation-z20: 0 10px 13px -6px var(--jp-shadow-umbra-color),
    0 20px 31px 3px var(--jp-shadow-penumbra-color),
    0 8px 38px 7px var(--jp-shadow-ambient-color);
  --jp-elevation-z24: 0 11px 15px -7px var(--jp-shadow-umbra-color),
    0 24px 38px 3px var(--jp-shadow-penumbra-color),
    0 9px 46px 8px var(--jp-shadow-ambient-color);

  /* Borders
   *
   * The following variables, specify the visual styling of borders in JupyterLab.
   */

  --jp-border-width: 1px;
  --jp-border-color0: var(--md-grey-400);
  --jp-border-color1: var(--md-grey-400);
  --jp-border-color2: var(--md-grey-300);
  --jp-border-color3: var(--md-grey-200);
  --jp-inverse-border-color: var(--md-grey-600);
  --jp-border-radius: 2px;

  /* UI Fonts
   *
   * The UI font CSS variables are used for the typography all of the JupyterLab
   * user interface elements that are not directly user generated content.
   *
   * The font sizing here is done assuming that the body font size of --jp-ui-font-size1
   * is applied to a parent element. When children elements, such as headings, are sized
   * in em all things will be computed relative to that body size.
   */

  --jp-ui-font-scale-factor: 1.2;
  --jp-ui-font-size0: 0.83333em;
  --jp-ui-font-size1: 13px; /* Base font size */
  --jp-ui-font-size2: 1.2em;
  --jp-ui-font-size3: 1.44em;
  --jp-ui-font-family: system-ui, -apple-system, blinkmacsystemfont, 'Segoe UI',
    helvetica, arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji',
    'Segoe UI Symbol';

  /*
   * Use these font colors against the corresponding main layout colors.
   * In a light theme, these go from dark to light.
   */

  /* Defaults use Material Design specification */
  --jp-ui-font-color0: rgba(0, 0, 0, 1);
  --jp-ui-font-color1: rgba(0, 0, 0, 0.87);
  --jp-ui-font-color2: rgba(0, 0, 0, 0.54);
  --jp-ui-font-color3: rgba(0, 0, 0, 0.38);

  /*
   * Use these against the brand/accent/warn/error colors.
   * These will typically go from light to darker, in both a dark and light theme.
   */

  --jp-ui-inverse-font-color0: rgba(255, 255, 255, 1);
  --jp-ui-inverse-font-color1: rgba(255, 255, 255, 1);
  --jp-ui-inverse-font-color2: rgba(255, 255, 255, 0.7);
  --jp-ui-inverse-font-color3: rgba(255, 255, 255, 0.5);

  /* Content Fonts
   *
   * Content font variables are used for typography of user generated content.
   *
   * The font sizing here is done assuming that the body font size of --jp-content-font-size1
   * is applied to a parent element. When children elements, such as headings, are sized
   * in em all things will be computed relative to that body size.
   */

  --jp-content-line-height: 1.6;
  --jp-content-font-scale-factor: 1.2;
  --jp-content-font-size0: 0.83333em;
  --jp-content-font-size1: 14px; /* Base font size */
  --jp-content-font-size2: 1.2em;
  --jp-content-font-size3: 1.44em;
  --jp-content-font-size4: 1.728em;
  --jp-content-font-size5: 2.0736em;

  /* This gives a magnification of about 125% in presentation mode over normal. */
  --jp-content-presentation-font-size1: 17px;
  --jp-content-heading-line-height: 1;
  --jp-content-heading-margin-top: 1.2em;
  --jp-content-heading-margin-bottom: 0.8em;
  --jp-content-heading-font-weight: 500;

  /* Defaults use Material Design specification */
  --jp-content-font-color0: rgba(0, 0, 0, 1);
  --jp-content-font-color1: rgba(0, 0, 0, 0.87);
  --jp-content-font-color2: rgba(0, 0, 0, 0.54);
  --jp-content-font-color3: rgba(0, 0, 0, 0.38);
  --jp-content-link-color: var(--md-blue-900);
  --jp-content-font-family: system-ui, -apple-system, blinkmacsystemfont,
    'Segoe UI', helvetica, arial, sans-serif, 'Apple Color Emoji',
    'Segoe UI Emoji', 'Segoe UI Symbol';

  /*
   * Code Fonts
   *
   * Code font variables are used for typography of code and other monospaces content.
   */

  --jp-code-font-size: 13px;
  --jp-code-line-height: 1.3077; /* 17px for 13px base */
  --jp-code-padding: 5px; /* 5px for 13px base, codemirror highlighting needs integer px value */
  --jp-code-font-family-default: menlo, consolas, 'DejaVu Sans Mono', monospace;
  --jp-code-font-family: var(--jp-code-font-family-default);

  /* This gives a magnification of about 125% in presentation mode over normal. */
  --jp-code-presentation-font-size: 16px;

  /* may need to tweak cursor width if you change font size */
  --jp-code-cursor-width0: 1.4px;
  --jp-code-cursor-width1: 2px;
  --jp-code-cursor-width2: 4px;

  /* Layout
   *
   * The following are the main layout colors use in JupyterLab. In a light
   * theme these would go from light to dark.
   */

  --jp-layout-color0: white;
  --jp-layout-color1: white;
  --jp-layout-color2: var(--md-grey-200);
  --jp-layout-color3: var(--md-grey-400);
  --jp-layout-color4: var(--md-grey-600);

  /* Inverse Layout
   *
   * The following are the inverse layout colors use in JupyterLab. In a light
   * theme these would go from dark to light.
   */

  --jp-inverse-layout-color0: #111;
  --jp-inverse-layout-color1: var(--md-grey-900);
  --jp-inverse-layout-color2: var(--md-grey-800);
  --jp-inverse-layout-color3: var(--md-grey-700);
  --jp-inverse-layout-color4: var(--md-grey-600);

  /* Brand/accent */

  --jp-brand-color0: var(--md-blue-900);
  --jp-brand-color1: var(--md-blue-700);
  --jp-brand-color2: var(--md-blue-300);
  --jp-brand-color3: var(--md-blue-100);
  --jp-brand-color4: var(--md-blue-50);
  --jp-accent-color0: var(--md-green-900);
  --jp-accent-color1: var(--md-green-700);
  --jp-accent-color2: var(--md-green-300);
  --jp-accent-color3: var(--md-green-100);

  /* State colors (warn, error, success, info) */

  --jp-warn-color0: var(--md-orange-900);
  --jp-warn-color1: var(--md-orange-700);
  --jp-warn-color2: var(--md-orange-300);
  --jp-warn-color3: var(--md-orange-100);
  --jp-error-color0: var(--md-red-900);
  --jp-error-color1: var(--md-red-700);
  --jp-error-color2: var(--md-red-300);
  --jp-error-color3: var(--md-red-100);
  --jp-success-color0: var(--md-green-900);
  --jp-success-color1: var(--md-green-700);
  --jp-success-color2: var(--md-green-300);
  --jp-success-color3: var(--md-green-100);
  --jp-info-color0: var(--md-cyan-900);
  --jp-info-color1: var(--md-cyan-700);
  --jp-info-color2: var(--md-cyan-300);
  --jp-info-color3: var(--md-cyan-100);

  /* Cell specific styles */

  --jp-cell-padding: 5px;
  --jp-cell-collapser-width: 8px;
  --jp-cell-collapser-min-height: 20px;
  --jp-cell-collapser-not-active-hover-opacity: 0.6;
  --jp-cell-editor-background: var(--md-grey-100);
  --jp-cell-editor-border-color: var(--md-grey-300);
  --jp-cell-editor-box-shadow: inset 0 0 2px var(--md-blue-300);
  --jp-cell-editor-active-background: var(--jp-layout-color0);
  --jp-cell-editor-active-border-color: var(--jp-brand-color1);
  --jp-cell-prompt-width: 64px;
  --jp-cell-prompt-font-family: var(--jp-code-font-family-default);
  --jp-cell-prompt-letter-spacing: 0;
  --jp-cell-prompt-opacity: 1;
  --jp-cell-prompt-not-active-opacity: 0.5;
  --jp-cell-prompt-not-active-font-color: var(--md-grey-700);

  /* A custom blend of MD grey and blue 600
   * See https://meyerweb.com/eric/tools/color-blend/#546E7A:1E88E5:5:hex */
  --jp-cell-inprompt-font-color: #307fc1;

  /* A custom blend of MD grey and orange 600
   * https://meyerweb.com/eric/tools/color-blend/#546E7A:F4511E:5:hex */
  --jp-cell-outprompt-font-color: #bf5b3d;

  /* Notebook specific styles */

  --jp-notebook-padding: 10px;
  --jp-notebook-select-background: var(--jp-layout-color1);
  --jp-notebook-multiselected-color: var(--md-blue-50);

  /* The scroll padding is calculated to fill enough space at the bottom of the
  notebook to show one single-line cell (with appropriate padding) at the top
  when the notebook is scrolled all the way to the bottom. We also subtract one
  pixel so that no scrollbar appears if we have just one single-line cell in the
  notebook. This padding is to enable a 'scroll past end' feature in a notebook.
  */
  --jp-notebook-scroll-padding: calc(
    100% - var(--jp-code-font-size) * var(--jp-code-line-height) -
      var(--jp-code-padding) - var(--jp-cell-padding) - 1px
  );

  /* Rendermime styles */

  --jp-rendermime-error-background: #fdd;
  --jp-rendermime-table-row-background: var(--md-grey-100);
  --jp-rendermime-table-row-hover-background: var(--md-light-blue-50);

  /* Dialog specific styles */

  --jp-dialog-background: rgba(0, 0, 0, 0.25);

  /* Console specific styles */

  --jp-console-padding: 10px;

  /* Toolbar specific styles */

  --jp-toolbar-border-color: var(--jp-border-color1);
  --jp-toolbar-micro-height: 8px;
  --jp-toolbar-background: var(--jp-layout-color1);
  --jp-toolbar-box-shadow: 0 0 2px 0 rgba(0, 0, 0, 0.24);
  --jp-toolbar-header-margin: 4px 4px 0 4px;
  --jp-toolbar-active-background: var(--md-grey-300);

  /* Statusbar specific styles */

  --jp-statusbar-height: 24px;

  /* Input field styles */

  --jp-input-box-shadow: inset 0 0 2px var(--md-blue-300);
  --jp-input-active-background: var(--jp-layout-color1);
  --jp-input-hover-background: var(--jp-layout-color1);
  --jp-input-background: var(--md-grey-100);
  --jp-input-border-color: var(--jp-inverse-border-color);
  --jp-input-active-border-color: var(--jp-brand-color1);
  --jp-input-active-box-shadow-color: rgba(19, 124, 189, 0.3);

  /* General editor styles */

  --jp-editor-selected-background: #d9d9d9;
  --jp-editor-selected-focused-background: #d7d4f0;
  --jp-editor-cursor-color: var(--jp-ui-font-color0);

  /* Code mirror specific styles */

  --jp-mirror-editor-keyword-color: #008000;
  --jp-mirror-editor-atom-color: #88f;
  --jp-mirror-editor-number-color: #080;
  --jp-mirror-editor-def-color: #00f;
  --jp-mirror-editor-variable-color: var(--md-grey-900);
  --jp-mirror-editor-variable-2-color: rgb(0, 54, 109);
  --jp-mirror-editor-variable-3-color: #085;
  --jp-mirror-editor-punctuation-color: #05a;
  --jp-mirror-editor-property-color: #05a;
  --jp-mirror-editor-operator-color: #a2f;
  --jp-mirror-editor-comment-color: #408080;
  --jp-mirror-editor-string-color: #ba2121;
  --jp-mirror-editor-string-2-color: #708;
  --jp-mirror-editor-meta-color: #a2f;
  --jp-mirror-editor-qualifier-color: #555;
  --jp-mirror-editor-builtin-color: #008000;
  --jp-mirror-editor-bracket-color: #997;
  --jp-mirror-editor-tag-color: #170;
  --jp-mirror-editor-attribute-color: #00c;
  --jp-mirror-editor-header-color: blue;
  --jp-mirror-editor-quote-color: #090;
  --jp-mirror-editor-link-color: #00c;
  --jp-mirror-editor-error-color: #f00;
  --jp-mirror-editor-hr-color: #999;

  /*
    RTC user specific colors.
    These colors are used for the cursor, username in the editor,
    and the icon of the user.
  */

  --jp-collaborator-color1: #ffad8e;
  --jp-collaborator-color2: #dac83d;
  --jp-collaborator-color3: #72dd76;
  --jp-collaborator-color4: #00e4d0;
  --jp-collaborator-color5: #45d4ff;
  --jp-collaborator-color6: #e2b1ff;
  --jp-collaborator-color7: #ff9de6;

  /* Vega extension styles */

  --jp-vega-background: white;

  /* Sidebar-related styles */

  --jp-sidebar-min-width: 250px;

  /* Search-related styles */

  --jp-search-toggle-off-opacity: 0.5;
  --jp-search-toggle-hover-opacity: 0.8;
  --jp-search-toggle-on-opacity: 1;
  --jp-search-selected-match-background-color: rgb(245, 200, 0);
  --jp-search-selected-match-color: black;
  --jp-search-unselected-match-background-color: var(
    --jp-inverse-layout-color0
  );
  --jp-search-unselected-match-color: var(--jp-ui-inverse-font-color0);

  /* Icon colors that work well with light or dark backgrounds */
  --jp-icon-contrast-color0: var(--md-purple-600);
  --jp-icon-contrast-color1: var(--md-green-600);
  --jp-icon-contrast-color2: var(--md-pink-600);
  --jp-icon-contrast-color3: var(--md-blue-600);

  /* Button colors */
  --jp-accept-color-normal: var(--md-blue-700);
  --jp-accept-color-hover: var(--md-blue-800);
  --jp-accept-color-active: var(--md-blue-900);
  --jp-warn-color-normal: var(--md-red-700);
  --jp-warn-color-hover: var(--md-red-800);
  --jp-warn-color-active: var(--md-red-900);
  --jp-reject-color-normal: var(--md-grey-600);
  --jp-reject-color-hover: var(--md-grey-700);
  --jp-reject-color-active: var(--md-grey-800);

  /* File or activity icons and switch semantic variables */
  --jp-jupyter-icon-color: #f37626;
  --jp-notebook-icon-color: #f37626;
  --jp-json-icon-color: var(--md-orange-700);
  --jp-console-icon-background-color: var(--md-blue-700);
  --jp-console-icon-color: white;
  --jp-terminal-icon-background-color: var(--md-grey-800);
  --jp-terminal-icon-color: var(--md-grey-200);
  --jp-text-editor-icon-color: var(--md-grey-700);
  --jp-inspector-icon-color: var(--md-grey-700);
  --jp-switch-color: var(--md-grey-400);
  --jp-switch-true-position-color: var(--md-orange-900);
}
</style>
<style type="text/css">
/* Force rendering true colors when outputing to pdf */
* {
  -webkit-print-color-adjust: exact;
}

/* Misc */
a.anchor-link {
  display: none;
}

/* Input area styling */
.jp-InputArea {
  overflow: hidden;
}

.jp-InputArea-editor {
  overflow: hidden;
}

.cm-editor.cm-s-jupyter .highlight pre {
/* weird, but --jp-code-padding defined to be 5px but 4px horizontal padding is hardcoded for pre.cm-line */
  padding: var(--jp-code-padding) 4px;
  margin: 0;

  font-family: inherit;
  font-size: inherit;
  line-height: inherit;
  color: inherit;

}

.jp-OutputArea-output pre {
  line-height: inherit;
  font-family: inherit;
}

.jp-RenderedText pre {
  color: var(--jp-content-font-color1);
  font-size: var(--jp-code-font-size);
}

/* Hiding the collapser by default */
.jp-Collapser {
  display: none;
}

@page {
    margin: 0.5in; /* Margin for each printed piece of paper */
}

@media print {
  .jp-Cell-inputWrapper,
  .jp-Cell-outputWrapper {
    display: block;
  }
}
</style>
<!-- Load mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML-full,Safe"> </script>
<!-- MathJax configuration -->
<script type="text/x-mathjax-config">
    init_mathjax = function() {
        if (window.MathJax) {
        // MathJax loaded
            MathJax.Hub.Config({
                TeX: {
                    equationNumbers: {
                    autoNumber: "AMS",
                    useLabelIds: true
                    }
                },
                tex2jax: {
                    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                    displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
                    processEscapes: true,
                    processEnvironments: true
                },
                displayAlign: 'center',
                messageStyle: 'none',
                CommonHTML: {
                    linebreaks: {
                    automatic: true
                    }
                }
            });

            MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
        }
    }
    init_mathjax();
    </script>
<!-- End of mathjax configuration --><script type="module">
  document.addEventListener("DOMContentLoaded", async () => {
    const diagrams = document.querySelectorAll(".jp-Mermaid > pre.mermaid");
    // do not load mermaidjs if not needed
    if (!diagrams.length) {
      return;
    }
    const mermaid = (await import("https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.7.0/mermaid.esm.min.mjs")).default;
    const parser = new DOMParser();

    mermaid.initialize({
      maxTextSize: 100000,
      maxEdges: 100000,
      startOnLoad: false,
      fontFamily: window
        .getComputedStyle(document.body)
        .getPropertyValue("--jp-ui-font-family"),
      theme: document.querySelector("body[data-jp-theme-light='true']")
        ? "default"
        : "dark",
    });

    let _nextMermaidId = 0;

    function makeMermaidImage(svg) {
      const img = document.createElement("img");
      const doc = parser.parseFromString(svg, "image/svg+xml");
      const svgEl = doc.querySelector("svg");
      const { maxWidth } = svgEl?.style || {};
      const firstTitle = doc.querySelector("title");
      const firstDesc = doc.querySelector("desc");

      img.setAttribute("src", `data:image/svg+xml,${encodeURIComponent(svg)}`);
      if (maxWidth) {
        img.width = parseInt(maxWidth);
      }
      if (firstTitle) {
        img.setAttribute("alt", firstTitle.textContent);
      }
      if (firstDesc) {
        const caption = document.createElement("figcaption");
        caption.className = "sr-only";
        caption.textContent = firstDesc.textContent;
        return [img, caption];
      }
      return [img];
    }

    async function makeMermaidError(text) {
      let errorMessage = "";
      try {
        await mermaid.parse(text);
      } catch (err) {
        errorMessage = `${err}`;
      }

      const result = document.createElement("details");
      result.className = 'jp-RenderedMermaid-Details';
      const summary = document.createElement("summary");
      summary.className = 'jp-RenderedMermaid-Summary';
      const pre = document.createElement("pre");
      const code = document.createElement("code");
      code.innerText = text;
      pre.appendChild(code);
      summary.appendChild(pre);
      result.appendChild(summary);

      const warning = document.createElement("pre");
      warning.innerText = errorMessage;
      result.appendChild(warning);
      return [result];
    }

    async function renderOneMarmaid(src) {
      const id = `jp-mermaid-${_nextMermaidId++}`;
      const parent = src.parentNode;
      let raw = src.textContent.trim();
      const el = document.createElement("div");
      el.style.visibility = "hidden";
      document.body.appendChild(el);
      let results = null;
      let output = null;
      try {
        let { svg } = await mermaid.render(id, raw, el);
        svg = cleanMermaidSvg(svg);
        results = makeMermaidImage(svg);
        output = document.createElement("figure");
        results.map(output.appendChild, output);
      } catch (err) {
        parent.classList.add("jp-mod-warning");
        results = await makeMermaidError(raw);
        output = results[0];
      } finally {
        el.remove();
      }
      parent.classList.add("jp-RenderedMermaid");
      parent.appendChild(output);
    }


    /**
     * Post-process to ensure mermaid diagrams contain only valid SVG and XHTML.
     */
    function cleanMermaidSvg(svg) {
      return svg.replace(RE_VOID_ELEMENT, replaceVoidElement);
    }


    /**
     * A regular expression for all void elements, which may include attributes and
     * a slash.
     *
     * @see https://developer.mozilla.org/en-US/docs/Glossary/Void_element
     *
     * Of these, only `<br>` is generated by Mermaid in place of `\n`,
     * but _any_ "malformed" tag will break the SVG rendering entirely.
     */
    const RE_VOID_ELEMENT =
      /<\s*(area|base|br|col|embed|hr|img|input|link|meta|param|source|track|wbr)\s*([^>]*?)\s*>/gi;

    /**
     * Ensure a void element is closed with a slash, preserving any attributes.
     */
    function replaceVoidElement(match, tag, rest) {
      rest = rest.trim();
      if (!rest.endsWith('/')) {
        rest = `${rest} /`;
      }
      return `<${tag} ${rest}>`;
    }

    void Promise.all([...diagrams].map(renderOneMarmaid));
  });
</script>
<style>
  .jp-Mermaid:not(.jp-RenderedMermaid) {
    display: none;
  }

  .jp-RenderedMermaid {
    overflow: auto;
    display: flex;
  }

  .jp-RenderedMermaid.jp-mod-warning {
    width: auto;
    padding: 0.5em;
    margin-top: 0.5em;
    border: var(--jp-border-width) solid var(--jp-warn-color2);
    border-radius: var(--jp-border-radius);
    color: var(--jp-ui-font-color1);
    font-size: var(--jp-ui-font-size1);
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  .jp-RenderedMermaid figure {
    margin: 0;
    overflow: auto;
    max-width: 100%;
  }

  .jp-RenderedMermaid img {
    max-width: 100%;
  }

  .jp-RenderedMermaid-Details > pre {
    margin-top: 1em;
  }

  .jp-RenderedMermaid-Summary {
    color: var(--jp-warn-color2);
  }

  .jp-RenderedMermaid:not(.jp-mod-warning) pre {
    display: none;
  }

  .jp-RenderedMermaid-Summary > pre {
    display: inline-block;
    white-space: normal;
  }
</style>
<!-- End of mermaid configuration --></head>
<body class="jp-Notebook" data-jp-theme-light="true" data-jp-theme-name="JupyterLab Light">
<main>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=4f78c727-106f-4790-90a8-1620a531f1ba">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h1 id="OBJECTIVE-:"><strong>OBJECTIVE :</strong><a class="anchor-link" href="#OBJECTIVE-:"></a></h1><h1 id="Business-Case-&amp;-Hypothesis"><strong><code>Business Case &amp; Hypothesis</code></strong><a class="anchor-link" href="#Business-Case-&amp;-Hypothesis"></a></h1><h2>&gt;&gt;&gt; <u>Forecast the monthly transactions amount<u></u></u></h2>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=c56d31d8-94d3-4a10-9061-f6234218f6f2">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h2 id="Source-:-Financial-Transactions-Dataset-(www.Kaggle.com)">Source : Financial Transactions Dataset (www.Kaggle.com)<a class="anchor-link" href="#Source-:-Financial-Transactions-Dataset-(www.Kaggle.com)"></a></h2>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=7c608894-ee97-4d29-a6ef-3bba813e5eca">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4 id="Overview-:-This-comprehensive-financial-dataset-combines-transaction-records,-customer-information,-and-card-data-from-a-banking-institution,-spanning-across-the-2010s-decade.">Overview : This comprehensive financial dataset combines transaction records, customer information, and card data from a banking institution, spanning across the 2010s decade.<a class="anchor-link" href="#Overview-:-This-comprehensive-financial-dataset-combines-transaction-records,-customer-information,-and-card-data-from-a-banking-institution,-spanning-across-the-2010s-decade."></a></h4>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=7d98806a-e3f7-4007-a440-42144d4be937">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="Dataset-Information">Dataset Information<a class="anchor-link" href="#Dataset-Information"></a></h3>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=e46f4980-2e3a-4ca0-90a9-b1cfa77270ba">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4><b><u>1. Transaction Data<b><u></u></b></u></b></h4>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=0fd2f52a-0c1b-465a-964d-eddbe8bb251d">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h5 id="*-Detailed-transaction-records-including-amounts,-timestamps,-and-merchant-details">* Detailed transaction records including amounts, timestamps, and merchant details<a class="anchor-link" href="#*-Detailed-transaction-records-including-amounts,-timestamps,-and-merchant-details"></a></h5><h5 id="*-Covers-transactions-throughout-the-2010s">* Covers transactions throughout the 2010s<a class="anchor-link" href="#*-Covers-transactions-throughout-the-2010s"></a></h5><h5 id="*-Features-transaction-types,-amounts,-and-merchant-information">* Features transaction types, amounts, and merchant information<a class="anchor-link" href="#*-Features-transaction-types,-amounts,-and-merchant-information"></a></h5><h5 id="*-Perfect-for-analyzing-spending-patterns-and-building-fraud-detection-models">* Perfect for analyzing spending patterns and building fraud detection models<a class="anchor-link" href="#*-Perfect-for-analyzing-spending-patterns-and-building-fraud-detection-models"></a></h5>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=2241da9e-cd11-4430-96d7-28a651be7665">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<table>
<thead>
<tr>
<th>Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>ID number of the transaction</td>
</tr>
<tr>
<td>date</td>
<td>Transction's date</td>
</tr>
<tr>
<td>client_id</td>
<td>Client id number</td>
</tr>
<tr>
<td>card_id</td>
<td>Card id number</td>
</tr>
<tr>
<td>amount</td>
<td>Amount of the transaction</td>
</tr>
<tr>
<td>use_chip</td>
<td>Transaction methodology</td>
</tr>
<tr>
<td>merchant_id</td>
<td>ID munber of the merchant</td>
</tr>
<tr>
<td>merchant_city</td>
<td>City of the merchant</td>
</tr>
<tr>
<td>merchant_state</td>
<td>State of the merchant</td>
</tr>
<tr>
<td>zip</td>
<td>Zip code of the merchant</td>
</tr>
<tr>
<td>mcc</td>
<td>ID number indicating the category goods or services concerned by the transation</td>
</tr>
<tr>
<td>errors</td>
<td>Transaction Error</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=3754d24b-c67b-4f64-a367-d30fb61b6ee1">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4><b><u>2. Merchant Category Codes<b><u></u></b></u></b></h4>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=5e5b83dc-484e-429f-9aab-5d09a408f3e9">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h5 id="*-Standard-classification-codes-for-business-types">* Standard classification codes for business types<a class="anchor-link" href="#*-Standard-classification-codes-for-business-types"></a></h5><h5 id="*-Enables-transaction-categorization-and-spending-analysis">* Enables transaction categorization and spending analysis<a class="anchor-link" href="#*-Enables-transaction-categorization-and-spending-analysis"></a></h5><h5 id="*-Industry-standard-MCC-codes-with-descriptions">* Industry-standard MCC codes with descriptions<a class="anchor-link" href="#*-Industry-standard-MCC-codes-with-descriptions"></a></h5>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=8ba7c4d8-b652-4c87-a7d5-fd3bd63aa1bd">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<table>
<thead>
<tr>
<th>Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>ID number of the category</td>
</tr>
<tr>
<td>description</td>
<td>Categorie description</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=vSdP4WZtmVUg">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h1><b><span style="color:blue;">1. CONTEXT DESCRIPTION<b></b></span></b></h1>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=126b7811-7e07-4200-8b5b-a5a598107b81">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h2 id="The-goal-of-this-project-is-to-forecast-the-monthly-transaction-volume-based-on-historical-financial-data-from-2015-to-2019."><strong>The goal of this project is to forecast the monthly transaction volume based on historical financial data from 2015 to 2019.</strong><a class="anchor-link" href="#The-goal-of-this-project-is-to-forecast-the-monthly-transaction-volume-based-on-historical-financial-data-from-2015-to-2019."></a></h2><h3 id="After-an-initial-exploratory-analysis,-I-decided-to-use-LightGBM,-a-gradient-boosting-algorithm-particularly-effective-for-tabular-data-and-capable-of-efficiently-handling-categorical-features."><strong>After an initial exploratory analysis, I decided to use LightGBM, a gradient boosting algorithm particularly effective for tabular data and capable of efficiently handling categorical features.</strong><a class="anchor-link" href="#After-an-initial-exploratory-analysis,-I-decided-to-use-LightGBM,-a-gradient-boosting-algorithm-particularly-effective-for-tabular-data-and-capable-of-efficiently-handling-categorical-features."></a></h3><p>On the below sessions, I used the combo LightGBM + Optuna.</p>
<p>YouTube link where I learned about Optuna : <a href="https://www.youtube.com/watch?v=kR9pOvr9Urs&amp;t=1046s">https://www.youtube.com/watch?v=kR9pOvr9Urs&amp;t=1046s</a></p>
<p>Regarding the machine learning model, I considered two alternatives::</p>
<blockquote>
<blockquote>
<blockquote>
<p>Prophet and LightGBM ; for handling large datasets, I opted for LightGBM.</p>
</blockquote>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>Indeed, LightGBM is a decision tree-based Gradient Boosting Framework. LightGBM targets the leaf that shows the greatest ability to minimize total error. Additionnaly, LightGBM trains quickly even in the absence of a GPU.</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<p>Following extensive manual hyperparameter testing, I decided to use Optuna.</p>
<blockquote>
<blockquote>
<blockquote>
<p>Optuna is a tool that evaluates various parameters to identify the most effective one.</p>
</blockquote>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>I then applied the optimal hyperparameters throughout the machine learning session.</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=IoXXgz4Q7G7w">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="Comments-:"><strong>Comments :</strong><a class="anchor-link" href="#Comments-:"></a></h3><p>The main issue was to obtain reliable predictions while avoiding data leaks and overfitting.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=6_sU88RlyEOM">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h1><b><span style="color:blue;">2. SUCCESSIVE EXPERIMENTS<b></b></span></b></h1>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=YlioUPT3yf1F">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="1.-Basic-Monthly-aggregated-mode-(not-in-the-presentation)"><strong>1. Basic Monthly aggregated mode (not in the presentation)</strong><a class="anchor-link" href="#1.-Basic-Monthly-aggregated-mode-(not-in-the-presentation)"></a></h3><p>Approach: Incorporating lag variables (temporal lags) into a monthly dataset.</p>
<p>Outcome: R  0.99</p>
<p>Analysis: Data leakage  the model indirectly perceived future values through misaligned lag variables.</p>
<h3 id="2.-Complete-transactions-after-2015,-including-filtering-and-data-smoothing-(presentation-paragraph-3)."><strong>2. Complete transactions after 2015, including filtering and data smoothing (presentation paragraph 3).</strong><a class="anchor-link" href="#2.-Complete-transactions-after-2015,-including-filtering-and-data-smoothing-(presentation-paragraph-3)."></a></h3><p>Approach: Direct the model's attention to uniform years post-2015.</p>
<p>Outcome: R  -0.010</p>
<p>Analysis: The model is constrained by insufficient context and is not optimized (numerous hours for the machine learning process).</p>
<h3 id="3.-Comprehensive-transactions-Post-2015-Filtering-enhanced-model-(slide-paragraph-4)"><strong>3. Comprehensive transactions Post-2015 Filtering enhanced model (slide paragraph 4)</strong><a class="anchor-link" href="#3.-Comprehensive-transactions-Post-2015-Filtering-enhanced-model-(slide-paragraph-4)"></a></h3><p>Approach: Enhancing the model (version 2) by utilizing cache for quicker computations.</p>
<p>Outcome: R  0.55</p>
<p>Analysis: The model is producing significantly improved results; however, I believe this time series machine learning model could achieve a better R.</p>
<h3 id="4.-Monthly-aggregated-model-with-temporal-split-no-lag"><strong>4. Monthly aggregated model with temporal split no lag</strong><a class="anchor-link" href="#4.-Monthly-aggregated-model-with-temporal-split-no-lag"></a></h3><p>Method: Monthly aggregation and temporal split with lag</p>
<p>Outcome: R  0.65 on post-2015 data</p>
<p>Analysis:
No data leakage (strict time split)
Very consistent data after 2015  predictable model
R reflects the stability of the series, not overfitting.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=6236c9e4-2f80-4ecd-a106-daf1b0c99b85">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h2><span style="color:blue;">3. <strong>Experiment 2</strong> simple <strong>cache methodology &amp; data smoothing</strong> - MACHINE LEARNING USING LIGHTGBM</span></h2>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=hCyZTmbnEFuZ">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="Comments-:"><strong>Comments :</strong><a class="anchor-link" href="#Comments-:"></a></h3><p>In this initial step, I will download and aggregate data to obtain a consolidated DataFrame with all transaction information.
Then I will</p>
<ol>
<li>Import libraries and install Synpase for machine learning purposes</li>
<li>Data Extraction and Load - I have extracted data by connecting to Kaggle</li>
<li>Spark Session - I have created a Spark Session for big data usage</li>
<li>Optuna Setup - I took 1% sample Dataframe and used Optuna to determine the best hyperparameters automatically</li>
<li>Creation of the pipeline, LGBM algorithm, temporal split</li>
</ol>
<p><strong>Poor Result du to a lack of context : R  -0.010</strong></p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=Vj-ADx8Uorlo">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="%E2%9C%93-Initialization"><b><span style="color:green;"></span> <u>Initialization</u></b><a class="anchor-link" href="#%E2%9C%93-Initialization"></a></h3>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=Jacvecuno5-r">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># -------------------------------------------------------------------------</span>
<span class="c1"># 1. Install JAVA - SPARK</span>
<span class="c1"># -------------------------------------------------------------------------</span>

<span class="o">!</span>apt-get<span class="w"> </span>install<span class="w"> </span>openjdk-11-jdk<span class="w"> </span>-y
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span><span class="nv">pyspark</span><span class="o">==</span><span class="m">3</span>.5.0
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>findspark

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"JAVA_HOME"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"/usr/lib/jvm/java-11-openjdk-amd64"</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"PATH"</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">":/usr/lib/jvm/java-11-openjdk-amd64/bin"</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=aZ9RDfGHmRrU">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># -------------------------------------------------------------------------</span>
<span class="c1"># 2. SPARK Session Initialization</span>
<span class="c1"># -------------------------------------------------------------------------</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.sql</span><span class="w"> </span><span class="kn">import</span> <span class="n">SparkSession</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span> \
    <span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">"ML_Portfolio"</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="s2">"spark.jars.packages"</span><span class="p">,</span> <span class="s2">"com.microsoft.azure:synapseml_2.12:1.0.0"</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=BiHUIfdhUyXR">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># -------------------------------------------------------------------------</span>
<span class="c1"># 3. Install Synapse Optuna</span>
<span class="c1"># -------------------------------------------------------------------------</span>

<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>synapseml<span class="w"> </span>optuna
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=dMzYfP_rm9aK">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># -------------------------------------------------------------------------</span>
<span class="c1"># 4. Import Libraries</span>
<span class="c1"># -------------------------------------------------------------------------</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">kagglehub</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">optuna</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lightgbm</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">lgb</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">product</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.sql</span><span class="w"> </span><span class="kn">import</span> <span class="n">SparkSession</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.sql.functions</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">col</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">unix_timestamp</span><span class="p">,</span> <span class="n">to_date</span><span class="p">,</span> <span class="n">regexp_replace</span><span class="p">,</span> <span class="n">when</span><span class="p">,</span> <span class="nb">abs</span><span class="p">,</span>
    <span class="n">dayofweek</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">avg</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">lit</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.sql.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">DoubleType</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.ml.feature</span><span class="w"> </span><span class="kn">import</span> <span class="n">VectorAssembler</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.ml</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.ml.evaluation</span><span class="w"> </span><span class="kn">import</span> <span class="n">RegressionEvaluator</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">synapse.ml.lightgbm</span><span class="w"> </span><span class="kn">import</span> <span class="n">LightGBMRegressor</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">"ignore"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=d2de7d55-75b1-4826-bbd2-37d773daf7bc">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="%E2%9C%93-Extraction---Load"><b><span style="color:green;"></span> <u>Extraction - Load</u></b><a class="anchor-link" href="#%E2%9C%93-Extraction---Load"></a></h3>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=1uSZIX9J8nUo">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># -------------------------------------------------------------------------</span>
<span class="c1"># 5. Data Loading</span>
<span class="c1"># -------------------------------------------------------------------------</span>

<span class="n">path</span> <span class="o">=</span> <span class="n">kagglehub</span><span class="o">.</span><span class="n">dataset_download</span><span class="p">(</span><span class="s2">"computingvictor/transactions-fraud-datasets"</span><span class="p">)</span>
<span class="n">transaction_data</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">/transactions_data.csv"</span>
<span class="n">mcc_codes_data</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">/mcc_codes.json"</span>

<span class="n">td</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">transaction_data</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">mcc_codes_data</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">mcc_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">mcc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">mcc_dict</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">"index"</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"description"</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"index"</span><span class="p">:</span> <span class="s2">"mcc_code"</span><span class="p">})</span>

<span class="n">mcc_spark</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">mcc</span><span class="p">)</span>
<span class="n">td_spark</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">transaction_data</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inferSchema</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Using Colab cache for faster access to the 'transactions-fraud-datasets' dataset.
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=YLVonj1csjb4">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="%E2%9C%93-Data-Wrangling"><b><span style="color:green;"></span> <u>Data Wrangling</u></b><a class="anchor-link" href="#%E2%9C%93-Data-Wrangling"></a></h3>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=9a5CgA0bpbxm">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># -------------------------------------------------------------------------</span>
<span class="c1"># 6. Data Preparation</span>
<span class="c1"># -------------------------------------------------------------------------</span>

<span class="n">LABEL_COL</span> <span class="o">=</span> <span class="s2">"amount"</span>
<span class="n">CATEGORICAL_FEATURE_COL</span> <span class="o">=</span> <span class="s2">"description"</span>

<span class="n">td_spark</span> <span class="o">=</span> <span class="n">td_spark</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">LABEL_COL</span><span class="p">,</span> <span class="n">regexp_replace</span><span class="p">(</span><span class="n">LABEL_COL</span><span class="p">,</span> <span class="s2">"\$"</span><span class="p">,</span> <span class="s2">""</span><span class="p">))</span>
<span class="n">td_spark</span> <span class="o">=</span> <span class="n">td_spark</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">LABEL_COL</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="n">LABEL_COL</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">DoubleType</span><span class="p">()))</span>
<span class="n">td_spark</span> <span class="o">=</span> <span class="n">td_spark</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"date"</span><span class="p">,</span> <span class="n">to_date</span><span class="p">(</span><span class="s2">"date"</span><span class="p">))</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">td_spark</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mcc_spark</span><span class="p">,</span> <span class="n">td_spark</span><span class="o">.</span><span class="n">mcc</span> <span class="o">==</span> <span class="n">mcc_spark</span><span class="o">.</span><span class="n">mcc_code</span><span class="p">,</span> <span class="s2">"left"</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">"id"</span><span class="p">,</span> <span class="s2">"client_id"</span><span class="p">,</span> <span class="s2">"card_id"</span><span class="p">,</span> <span class="s2">"use_chip"</span><span class="p">,</span> <span class="s2">"merchant_id"</span><span class="p">,</span> <span class="s2">"merchant_city"</span><span class="p">,</span>
             <span class="s2">"merchant_state"</span><span class="p">,</span> <span class="s2">"zip"</span><span class="p">,</span> <span class="s2">"mcc"</span><span class="p">,</span> <span class="s2">"errors"</span><span class="p">,</span> <span class="s2">"mcc_code"</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"date_timestamp"</span><span class="p">,</span> <span class="n">unix_timestamp</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"date"</span><span class="p">))</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">DoubleType</span><span class="p">()))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"day_of_week"</span><span class="p">,</span> <span class="n">dayofweek</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"date"</span><span class="p">))</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">DoubleType</span><span class="p">()))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"month"</span><span class="p">,</span> <span class="n">month</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"date"</span><span class="p">))</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">DoubleType</span><span class="p">()))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"is_refund"</span><span class="p">,</span> <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="n">LABEL_COL</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">DoubleType</span><span class="p">()))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">LABEL_COL</span><span class="p">,</span> <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="n">LABEL_COL</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">(),</span> <span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="n">LABEL_COL</span><span class="p">))))</span>

<span class="n">CLEANED_CATEGORICAL_COL</span> <span class="o">=</span> <span class="s2">"description_clean"</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">CLEANED_CATEGORICAL_COL</span><span class="p">,</span> <span class="n">regexp_replace</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="n">CATEGORICAL_FEATURE_COL</span><span class="p">),</span> <span class="s2">"[ ,:</span><span class="se">\\</span><span class="s2">[</span><span class="se">\\</span><span class="s2">]</span><span class="se">\\</span><span class="s2">{</span><span class="se">\\</span><span class="s2">}]"</span><span class="p">,</span> <span class="s2">"_"</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=pOF6-dnUpbvT">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># -------------------------------------------------------------------------</span>
<span class="c1"># 7. Sample (1%) will be used to search the best hyper parameters settings</span>
<span class="c1"># -------------------------------------------------------------------------</span>

<span class="n">df_sample</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">fraction</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
<span class="n">df_sample</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="n">LABEL_COL</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_sample</span><span class="p">[</span><span class="s2">"date_timestamp"</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_sample</span><span class="p">[</span><span class="s2">"date"</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span><span class="o">**</span><span class="mi">9</span>
<span class="n">df_sample</span><span class="p">[</span><span class="s2">"is_refund"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_sample</span><span class="p">[</span><span class="n">LABEL_COL</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">df_sample</span><span class="p">[</span><span class="n">LABEL_COL</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_sample</span><span class="p">[</span><span class="n">LABEL_COL</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">df_sample</span><span class="p">[[</span><span class="s2">"date_timestamp"</span><span class="p">,</span> <span class="s2">"is_refund"</span><span class="p">]]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_sample</span><span class="p">[</span><span class="n">LABEL_COL</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=B13TppdVpbtb">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># -------------------------------------------------------------------------</span>
<span class="c1"># 8. Bayesian Optimization to find the best hyper parameters settings - Using OPTUNA</span>
<span class="c1"># -------------------------------------------------------------------------</span>

<span class="k">def</span><span class="w"> </span><span class="nf">objective</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"objective"</span><span class="p">:</span> <span class="s2">"regression"</span><span class="p">,</span>
        <span class="s2">"metric"</span><span class="p">:</span> <span class="s2">"rmse"</span><span class="p">,</span>
        <span class="s2">"num_leaves"</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s2">"num_leaves"</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">256</span><span class="p">),</span>
        <span class="s2">"max_depth"</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s2">"max_depth"</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
        <span class="s2">"learning_rate"</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s2">"learning_rate"</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="s2">"feature_fraction"</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s2">"feature_fraction"</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
        <span class="s2">"bagging_fraction"</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s2">"bagging_fraction"</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
        <span class="s2">"num_iterations"</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s2">"num_iterations"</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span>
        <span class="s2">"verbose"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="s2">"seed"</span><span class="p">:</span> <span class="mi">42</span>
    <span class="p">}</span>

    <span class="n">train_data</span> <span class="o">=</span> <span class="n">lgb</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">lgb</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">train_data</span><span class="p">)</span>
    <span class="n">preds</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="p">((</span><span class="n">preds</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">**</span> <span class="mf">0.5</span>
    <span class="k">return</span> <span class="n">rmse</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2"> Optimization starting on 1</span><span class="si">% s</span><span class="s2">ample..."</span><span class="p">)</span>
<span class="n">study</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">create_study</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s2">"minimize"</span><span class="p">)</span>
<span class="n">study</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
<span class="n">best_params</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">best_params</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Best Hyperparameters :</span><span class="se">\n</span><span class="si">{</span><span class="n">best_params</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="application/vnd.jupyter.stderr" tabindex="0">
<pre>[I 2025-11-01 18:18:06,922] A new study created in memory with name: no-name-57a4e1da-1bf0-4ba7-8482-79364ff98811
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>
 Optimization starting on 1% sample...
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="application/vnd.jupyter.stderr" tabindex="0">
<pre>[I 2025-11-01 18:18:24,572] Trial 0 finished with value: 75.33336139121394 and parameters: {'num_leaves': 153, 'max_depth': 15, 'learning_rate': 0.022079166749651016, 'feature_fraction': 0.9887256591512779, 'bagging_fraction': 0.7694494483051384, 'num_iterations': 506}. Best is trial 0 with value: 75.33336139121394.
[I 2025-11-01 18:18:33,982] Trial 1 finished with value: 75.33516233772073 and parameters: {'num_leaves': 48, 'max_depth': 13, 'learning_rate': 0.0165253572023927, 'feature_fraction': 0.9925144157806065, 'bagging_fraction': 0.8878605938404487, 'num_iterations': 497}. Best is trial 0 with value: 75.33336139121394.
[I 2025-11-01 18:18:49,723] Trial 2 finished with value: 75.33334662373754 and parameters: {'num_leaves': 233, 'max_depth': 12, 'learning_rate': 0.05165046435797901, 'feature_fraction': 0.8094348887352868, 'bagging_fraction': 0.7693234761306247, 'num_iterations': 633}. Best is trial 2 with value: 75.33334662373754.
[I 2025-11-01 18:18:53,162] Trial 3 finished with value: 75.3346461708803 and parameters: {'num_leaves': 40, 'max_depth': 6, 'learning_rate': 0.05238422279269173, 'feature_fraction': 0.9450935755759657, 'bagging_fraction': 0.7131263559080584, 'num_iterations': 416}. Best is trial 2 with value: 75.33334662373754.
[I 2025-11-01 18:19:03,265] Trial 4 finished with value: 75.3337900121797 and parameters: {'num_leaves': 229, 'max_depth': 11, 'learning_rate': 0.01369706213812038, 'feature_fraction': 0.7761546545331941, 'bagging_fraction': 0.967152171196962, 'num_iterations': 504}. Best is trial 2 with value: 75.33334662373754.
[I 2025-11-01 18:19:16,633] Trial 5 finished with value: 75.33334999509789 and parameters: {'num_leaves': 233, 'max_depth': 14, 'learning_rate': 0.015688937281912056, 'feature_fraction': 0.8433608839280923, 'bagging_fraction': 0.9221748118503391, 'num_iterations': 592}. Best is trial 2 with value: 75.33334662373754.
[I 2025-11-01 18:19:26,762] Trial 6 finished with value: 75.33784095535036 and parameters: {'num_leaves': 36, 'max_depth': 7, 'learning_rate': 0.01419125446773346, 'feature_fraction': 0.8237011372037017, 'bagging_fraction': 0.8595866435659251, 'num_iterations': 743}. Best is trial 2 with value: 75.33334662373754.
[I 2025-11-01 18:19:40,007] Trial 7 finished with value: 75.33334661368993 and parameters: {'num_leaves': 212, 'max_depth': 11, 'learning_rate': 0.05866715711169298, 'feature_fraction': 0.7690979468447738, 'bagging_fraction': 0.7860163232432587, 'num_iterations': 696}. Best is trial 7 with value: 75.33334661368993.
[I 2025-11-01 18:19:45,163] Trial 8 finished with value: 75.33700383402879 and parameters: {'num_leaves': 50, 'max_depth': 6, 'learning_rate': 0.03650346849563564, 'feature_fraction': 0.7097139209864382, 'bagging_fraction': 0.8355880578816333, 'num_iterations': 405}. Best is trial 7 with value: 75.33334661368993.
[I 2025-11-01 18:19:52,350] Trial 9 finished with value: 75.33378006976533 and parameters: {'num_leaves': 93, 'max_depth': 14, 'learning_rate': 0.02039849886475306, 'feature_fraction': 0.8763056813394847, 'bagging_fraction': 0.8522423482613573, 'num_iterations': 426}. Best is trial 7 with value: 75.33334661368993.
[I 2025-11-01 18:20:10,359] Trial 10 finished with value: 75.3333466063559 and parameters: {'num_leaves': 172, 'max_depth': 9, 'learning_rate': 0.08577542356421035, 'feature_fraction': 0.7148258479028721, 'bagging_fraction': 0.7817799226486011, 'num_iterations': 997}. Best is trial 10 with value: 75.3333466063559.
[I 2025-11-01 18:20:25,881] Trial 11 finished with value: 75.3333466063207 and parameters: {'num_leaves': 171, 'max_depth': 9, 'learning_rate': 0.09787165282999918, 'feature_fraction': 0.7008019787226754, 'bagging_fraction': 0.7855886049211697, 'num_iterations': 1000}. Best is trial 11 with value: 75.3333466063207.
[I 2025-11-01 18:20:41,155] Trial 12 finished with value: 75.33334660632977 and parameters: {'num_leaves': 163, 'max_depth': 9, 'learning_rate': 0.09684336017220545, 'feature_fraction': 0.7090378310462581, 'bagging_fraction': 0.7100293118071392, 'num_iterations': 975}. Best is trial 11 with value: 75.3333466063207.
[I 2025-11-01 18:20:58,657] Trial 13 finished with value: 75.3333466063208 and parameters: {'num_leaves': 118, 'max_depth': 9, 'learning_rate': 0.09927375571548404, 'feature_fraction': 0.700478123880619, 'bagging_fraction': 0.7043598410480008, 'num_iterations': 994}. Best is trial 11 with value: 75.3333466063207.
[I 2025-11-01 18:21:00,688] Trial 14 finished with value: 75.33422894272347 and parameters: {'num_leaves': 106, 'max_depth': 8, 'learning_rate': 0.0703149033675483, 'feature_fraction': 0.7508143010333583, 'bagging_fraction': 0.735203048758299, 'num_iterations': 205}. Best is trial 11 with value: 75.3333466063207.
[I 2025-11-01 18:21:19,277] Trial 15 finished with value: 75.3333472670353 and parameters: {'num_leaves': 117, 'max_depth': 10, 'learning_rate': 0.036253265636337594, 'feature_fraction': 0.9087711177011303, 'bagging_fraction': 0.8084869886099987, 'num_iterations': 894}. Best is trial 11 with value: 75.3333466063207.
[I 2025-11-01 18:21:26,486] Trial 16 finished with value: 75.33337629886226 and parameters: {'num_leaves': 132, 'max_depth': 5, 'learning_rate': 0.07935780737628026, 'feature_fraction': 0.7457165343087223, 'bagging_fraction': 0.7487332273851394, 'num_iterations': 818}. Best is trial 11 with value: 75.3333466063207.
[I 2025-11-01 18:21:40,686] Trial 17 finished with value: 75.33334678797786 and parameters: {'num_leaves': 189, 'max_depth': 8, 'learning_rate': 0.0636738035079704, 'feature_fraction': 0.7924314424608596, 'bagging_fraction': 0.7003824887552348, 'num_iterations': 889}. Best is trial 11 with value: 75.3333466063207.
[I 2025-11-01 18:22:00,330] Trial 18 finished with value: 75.33469747115964 and parameters: {'num_leaves': 84, 'max_depth': 10, 'learning_rate': 0.010314528131513895, 'feature_fraction': 0.7423405834767991, 'bagging_fraction': 0.8243280386651306, 'num_iterations': 870}. Best is trial 11 with value: 75.3333466063207.
[I 2025-11-01 18:22:10,225] Trial 19 finished with value: 75.33334661148078 and parameters: {'num_leaves': 200, 'max_depth': 8, 'learning_rate': 0.09962144869839645, 'feature_fraction': 0.8685840478289141, 'bagging_fraction': 0.7437599151561858, 'num_iterations': 747}. Best is trial 11 with value: 75.3333466063207.
[I 2025-11-01 18:22:31,181] Trial 20 finished with value: 75.33334662481435 and parameters: {'num_leaves': 134, 'max_depth': 11, 'learning_rate': 0.04487622769466529, 'feature_fraction': 0.7376172609779434, 'bagging_fraction': 0.8880071287118501, 'num_iterations': 930}. Best is trial 11 with value: 75.3333466063207.
[I 2025-11-01 18:22:51,912] Trial 21 finished with value: 75.33334660632445 and parameters: {'num_leaves': 163, 'max_depth': 9, 'learning_rate': 0.09520293974693501, 'feature_fraction': 0.7038801162669607, 'bagging_fraction': 0.7200669466932081, 'num_iterations': 995}. Best is trial 11 with value: 75.3333466063207.
[I 2025-11-01 18:23:05,312] Trial 22 finished with value: 75.33334661545665 and parameters: {'num_leaves': 181, 'max_depth': 9, 'learning_rate': 0.07499372140892199, 'feature_fraction': 0.7054118726205305, 'bagging_fraction': 0.7399241270113065, 'num_iterations': 828}. Best is trial 11 with value: 75.3333466063207.
[I 2025-11-01 18:23:18,552] Trial 23 finished with value: 75.33334660877394 and parameters: {'num_leaves': 147, 'max_depth': 7, 'learning_rate': 0.09941472808845467, 'feature_fraction': 0.7256135915820754, 'bagging_fraction': 0.7002212528147715, 'num_iterations': 960}. Best is trial 11 with value: 75.3333466063207.
[I 2025-11-01 18:23:41,876] Trial 24 finished with value: 75.33334660643165 and parameters: {'num_leaves': 256, 'max_depth': 9, 'learning_rate': 0.0808024037834706, 'feature_fraction': 0.7775365150841325, 'bagging_fraction': 0.8019110420922068, 'num_iterations': 999}. Best is trial 11 with value: 75.3333466063207.
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Best Hyperparameters :
{'num_leaves': 171, 'max_depth': 9, 'learning_rate': 0.09787165282999918, 'feature_fraction': 0.7008019787226754, 'bagging_fraction': 0.7855886049211697, 'num_iterations': 1000}
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=aK2dMfbys07E">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="%E2%9C%93-Machine-Learning"><b><span style="color:green;"></span> <u>Machine Learning</u></b><a class="anchor-link" href="#%E2%9C%93-Machine-Learning"></a></h3>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=CKIW_jRXpbrB">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># -------------------------------------------------------------------------</span>
<span class="c1"># 9. Rolling validation Spark with best hyperparameters found</span>
<span class="c1"># -------------------------------------------------------------------------</span>
<span class="k">def</span><span class="w"> </span><span class="nf">target_encode</span><span class="p">(</span><span class="n">train_df</span><span class="p">,</span> <span class="n">test_df</span><span class="p">,</span> <span class="n">categorical_col</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">smoothing</span><span class="o">=</span><span class="mf">100.0</span><span class="p">):</span>
    <span class="n">global_mean</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">avg</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="n">target_col</span><span class="p">)))</span><span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">agg</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="n">categorical_col</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
        <span class="n">avg</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="n">target_col</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"mean_category"</span><span class="p">),</span>
        <span class="n">count</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="n">target_col</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"count_category"</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
        <span class="s2">"mean_encoded"</span><span class="p">,</span>
        <span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"mean_category"</span><span class="p">)</span> <span class="o">*</span> <span class="n">col</span><span class="p">(</span><span class="s2">"count_category"</span><span class="p">)</span> <span class="o">+</span> <span class="n">lit</span><span class="p">(</span><span class="n">global_mean</span><span class="p">)</span> <span class="o">*</span> <span class="n">lit</span><span class="p">(</span><span class="n">smoothing</span><span class="p">))</span>
        <span class="o">/</span> <span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"count_category"</span><span class="p">)</span> <span class="o">+</span> <span class="n">lit</span><span class="p">(</span><span class="n">smoothing</span><span class="p">))</span>
    <span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">categorical_col</span><span class="p">,</span> <span class="s2">"mean_encoded"</span><span class="p">)</span>

    <span class="n">train_encoded</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">agg</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="n">categorical_col</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">"left"</span><span class="p">)</span><span class="o">.</span><span class="n">na</span><span class="o">.</span><span class="n">fill</span><span class="p">({</span><span class="s2">"mean_encoded"</span><span class="p">:</span> <span class="n">global_mean</span><span class="p">})</span>
    <span class="n">test_encoded</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">agg</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="n">categorical_col</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">"left"</span><span class="p">)</span><span class="o">.</span><span class="n">na</span><span class="o">.</span><span class="n">fill</span><span class="p">({</span><span class="s2">"mean_encoded"</span><span class="p">:</span> <span class="n">global_mean</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">train_encoded</span><span class="p">,</span> <span class="n">test_encoded</span>


<span class="k">def</span><span class="w"> </span><span class="nf">train_with_best_params</span><span class="p">(</span><span class="n">train_df</span><span class="p">,</span> <span class="n">test_df</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="n">final_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"date_timestamp"</span><span class="p">,</span> <span class="s2">"day_of_week"</span><span class="p">,</span> <span class="s2">"month"</span><span class="p">,</span> <span class="s2">"is_refund"</span><span class="p">,</span> <span class="s2">"mean_encoded"</span><span class="p">]</span>
    <span class="n">assembler</span> <span class="o">=</span> <span class="n">VectorAssembler</span><span class="p">(</span><span class="n">inputCols</span><span class="o">=</span><span class="n">final_features</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">"features_vector"</span><span class="p">)</span>
    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span><span class="n">assembler</span><span class="p">])</span>
    <span class="n">pipeline_model</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_df</span><span class="p">)</span>
    <span class="n">train_data</span> <span class="o">=</span> <span class="n">pipeline_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">train_df</span><span class="p">)</span>
    <span class="n">test_data</span> <span class="o">=</span> <span class="n">pipeline_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_df</span><span class="p">)</span>

    <span class="n">lgbm</span> <span class="o">=</span> <span class="n">LightGBMRegressor</span><span class="p">(</span>
        <span class="n">featuresCol</span><span class="o">=</span><span class="s2">"features_vector"</span><span class="p">,</span>
        <span class="n">labelCol</span><span class="o">=</span><span class="n">LABEL_COL</span><span class="p">,</span>
        <span class="n">objective</span><span class="o">=</span><span class="s2">"regression"</span><span class="p">,</span>
        <span class="n">numLeaves</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">"num_leaves"</span><span class="p">],</span>
        <span class="n">maxDepth</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">"max_depth"</span><span class="p">],</span>
        <span class="n">learningRate</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">"learning_rate"</span><span class="p">],</span>
        <span class="n">featureFraction</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">"feature_fraction"</span><span class="p">],</span>
        <span class="n">baggingFraction</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">"bagging_fraction"</span><span class="p">],</span>
        <span class="n">numIterations</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">"num_iterations"</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">lgbm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_data</span><span class="p">)</span>
    <span class="n">preds</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>

    <span class="n">evaluator</span> <span class="o">=</span> <span class="n">RegressionEvaluator</span><span class="p">(</span><span class="n">labelCol</span><span class="o">=</span><span class="n">LABEL_COL</span><span class="p">,</span> <span class="n">predictionCol</span><span class="o">=</span><span class="s2">"prediction"</span><span class="p">)</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"mse"</span><span class="p">:</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="p">{</span><span class="n">evaluator</span><span class="o">.</span><span class="n">metricName</span><span class="p">:</span> <span class="s2">"mse"</span><span class="p">}),</span>
        <span class="s2">"rmse"</span><span class="p">:</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="p">{</span><span class="n">evaluator</span><span class="o">.</span><span class="n">metricName</span><span class="p">:</span> <span class="s2">"rmse"</span><span class="p">}),</span>
        <span class="s2">"mae"</span><span class="p">:</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="p">{</span><span class="n">evaluator</span><span class="o">.</span><span class="n">metricName</span><span class="p">:</span> <span class="s2">"mae"</span><span class="p">}),</span>
        <span class="s2">"r2"</span><span class="p">:</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="p">{</span><span class="n">evaluator</span><span class="o">.</span><span class="n">metricName</span><span class="p">:</span> <span class="s2">"r2"</span><span class="p">}),</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">metrics</span>

<span class="c1">#split_years = [2015, 2016, 2017, 2018]</span>
<span class="n">split_years</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2018</span><span class="p">]</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">split_years</span><span class="p">:</span>
    <span class="n">split_date</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">-12-31"</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2"> Temporal Split : Train  </span><span class="si">{</span><span class="n">split_date</span><span class="si">}</span><span class="s2"> | Test &gt; </span><span class="si">{</span><span class="n">split_date</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="n">train_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"date"</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">split_date</span><span class="p">)</span>
    <span class="n">test_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"date"</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">split_date</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">train_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">test_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Not enough data for the year : </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">."</span><span class="p">)</span>
        <span class="k">continue</span>

    <span class="n">train_encoded</span><span class="p">,</span> <span class="n">test_encoded</span> <span class="o">=</span> <span class="n">target_encode</span><span class="p">(</span><span class="n">train_df</span><span class="p">,</span> <span class="n">test_df</span><span class="p">,</span> <span class="n">CLEANED_CATEGORICAL_COL</span><span class="p">,</span> <span class="n">LABEL_COL</span><span class="p">)</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">train_with_best_params</span><span class="p">(</span><span class="n">train_encoded</span><span class="p">,</span> <span class="n">test_encoded</span><span class="p">,</span> <span class="n">best_params</span><span class="p">)</span>
    <span class="n">metrics</span><span class="p">[</span><span class="s2">"train_end"</span><span class="p">]</span> <span class="o">=</span> <span class="n">year</span>
    <span class="n">metrics</span><span class="p">[</span><span class="s2">"test_year"</span><span class="p">]</span> <span class="o">=</span> <span class="n">year</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Rsultats </span><span class="si">{</span><span class="n">year</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">  R = </span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="s1">'r2'</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> | RMSE = </span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="s1">'rmse'</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>
 Temporal Split : Train  2018-12-31 | Test &gt; 2018-12-31
Rsultats 2019  R = -0.0106 | RMSE = 74.78
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=VnLIPoJRpbmr">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># -------------------------------------------------------------------------</span>
<span class="c1"># 10. Final Export</span>
<span class="c1"># -------------------------------------------------------------------------</span>
<span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="n">results_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">"ML_Portfolio.csv"</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Export done 'ML_Portfolio'"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>
Export done 'ML_Portfolio'
           mse       rmse        mae        r2  train_end  test_year
0  5592.309422  74.781745  44.413696 -0.010614       2018       2019
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=xt8IeGwtvcNS">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p><strong>Below the performance indicators result for 2015 - 2018:</strong></p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=706xmDJiu4c6">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<table>
<thead>
<tr>
<th>mse</th>
<th>rmse</th>
<th>mae</th>
<th>r2</th>
<th>train year</th>
<th>test year</th>
</tr>
</thead>
<tbody>
<tr>
<td>5706.459224</td>
<td>75.027384</td>
<td>43.473863</td>
<td>-0.005715</td>
<td>2015</td>
<td>2016</td>
</tr>
<tr>
<td>5808.157885</td>
<td>76.211271</td>
<td>47.710919</td>
<td>-0.043708</td>
<td>2016</td>
<td>2017</td>
</tr>
<tr>
<td>5706.459224</td>
<td>75.541109</td>
<td>46.136135</td>
<td>-0.025676</td>
<td>2017</td>
<td>2018</td>
</tr>
<tr>
<td>5592.319461</td>
<td>74.781812</td>
<td>44.413757</td>
<td>-0.010614</td>
<td>2018</td>
<td>2019</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=_OPlKa1XvFnH">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>In addition to the earlier analysis conducted, <strong>a trend shift occurred in 2015</strong>. It clarifies the <strong>'weak' R outcome in 2015.</strong></p>
<p>In <strong>2016</strong>, the <strong>R improved 100-fold</strong> <em>compared to 2015</em>, suggesting that the LightGBM algorithm has learned. And the R for 2017 is expected to rise.</p>
<p>In <strong>2017</strong>, <strong>the R improved to twice the value of 2016</strong>; nonetheless, it <strong>remains quite low</strong> and can even be negative.</p>
<p>In <strong>2018</strong>, I observe a <strong>similar situation as in 2017</strong>, with a slight rise in <strong>R, yet it remains very low</strong>.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=qcSZpZT20VoN">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="Comments-:"><strong>Comments :</strong><a class="anchor-link" href="#Comments-:"></a></h3><p>Let's verify if the performance indicator is due to the trend shift in 2015.
So I will filter the Dataframe with data from 2015.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=hpHIbdddqQ7x">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h2><span style="color:blue;">4. <strong>Experiment 3</strong> Using cache methodology without data smoothing - MACHINE LEARNING USING LIGHTGBM</span></h2>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=wOGNYqy9rCbf">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="%E2%9C%93-Initialization"><b><span style="color:green;"></span> <u>Initialization</u></b><a class="anchor-link" href="#%E2%9C%93-Initialization"></a></h3>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=43Qg5N9TrIYH">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># -------------------------------------------------------------------------</span>
<span class="c1"># 1. Install JAVA - SPARK</span>
<span class="c1"># -------------------------------------------------------------------------</span>

<span class="o">!</span>apt-get<span class="w"> </span>install<span class="w"> </span>openjdk-11-jdk<span class="w"> </span>-y
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span><span class="nv">pyspark</span><span class="o">==</span><span class="m">3</span>.5.0
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>findspark
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>--force-reinstall<span class="w"> </span><span class="nv">numpy</span><span class="o">==</span><span class="m">1</span>.26.4<span class="w"> </span><span class="nv">pandas</span><span class="o">==</span><span class="m">2</span>.2.2

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"JAVA_HOME"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"/usr/lib/jvm/java-11-openjdk-amd64"</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"PATH"</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">":/usr/lib/jvm/java-11-openjdk-amd64/bin"</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=PSgosFx9Nsz0">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># -------------------------------------------------------------------------</span>
<span class="c1"># 2. Spark Configuration</span>
<span class="c1"># -------------------------------------------------------------------------</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.sql</span><span class="w"> </span><span class="kn">import</span> <span class="n">SparkSession</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span> \
    <span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">"ML_Portfolio_After_2015"</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="s2">"spark.jars.packages"</span><span class="p">,</span> <span class="s2">"com.microsoft.azure:synapseml_2.12:1.0.0"</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="s2">"spark.sql.shuffle.partitions"</span><span class="p">,</span> <span class="s2">"200"</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="s2">"spark.default.parallelism"</span><span class="p">,</span> <span class="s2">"200"</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="s2">"spark.executor.memory"</span><span class="p">,</span> <span class="s2">"4g"</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="s2">"spark.driver.memory"</span><span class="p">,</span> <span class="s2">"4g"</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=NUC8aRIJ4tay">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># -------------------------------------------------------------------------</span>
<span class="c1"># 3. Install Synapse Optuna</span>
<span class="c1"># -------------------------------------------------------------------------</span>

<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>synapseml<span class="w"> </span>optuna
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=8pgukAGk12zi">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># -------------------------------------------------------------------------</span>
<span class="c1"># 4. Import Libraries</span>
<span class="c1"># -------------------------------------------------------------------------</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">kagglehub</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">optuna</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lightgbm</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">lgb</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.sql.functions</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">col</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">unix_timestamp</span><span class="p">,</span> <span class="n">to_date</span><span class="p">,</span> <span class="n">regexp_replace</span><span class="p">,</span> <span class="n">when</span><span class="p">,</span> <span class="nb">abs</span><span class="p">,</span>
    <span class="n">dayofweek</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="nb">sum</span><span class="p">,</span> <span class="n">avg</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">lit</span><span class="p">,</span> <span class="n">isnan</span><span class="p">,</span> <span class="n">countDistinct</span><span class="p">,</span> <span class="n">stddev</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.sql.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">DoubleType</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.ml.feature</span><span class="w"> </span><span class="kn">import</span> <span class="n">VectorAssembler</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.ml</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.ml.evaluation</span><span class="w"> </span><span class="kn">import</span> <span class="n">RegressionEvaluator</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.ml.linalg</span><span class="w"> </span><span class="kn">import</span> <span class="n">DenseVector</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">synapse.ml.lightgbm</span><span class="w"> </span><span class="kn">import</span> <span class="n">LightGBMRegressor</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">"ignore"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=icUGsDUbs_Z0">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="%E2%9C%93-Extraction---Load"><b><span style="color:green;"></span> <u>Extraction - Load</u></b><a class="anchor-link" href="#%E2%9C%93-Extraction---Load"></a></h3>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=B-De6eg012uv">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># -------------------------------------------------------------------------</span>
<span class="c1"># 5. Data Loading</span>
<span class="c1"># -------------------------------------------------------------------------</span>

<span class="n">path</span> <span class="o">=</span> <span class="n">kagglehub</span><span class="o">.</span><span class="n">dataset_download</span><span class="p">(</span><span class="s2">"computingvictor/transactions-fraud-datasets"</span><span class="p">)</span>
<span class="n">transaction_data</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">/transactions_data.csv"</span>
<span class="n">mcc_codes_data</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">/mcc_codes.json"</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">mcc_codes_data</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">mcc_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">mcc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">mcc_dict</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">"index"</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"description"</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"index"</span><span class="p">:</span> <span class="s2">"mcc_code"</span><span class="p">})</span>

<span class="n">mcc_spark</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">mcc</span><span class="p">)</span>
<span class="n">td_spark</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">transaction_data</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inferSchema</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Using Colab cache for faster access to the 'transactions-fraud-datasets' dataset.
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=Ybq--JBGWL1A">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="%E2%9C%93-Data-Wrangling"><b><span style="color:green;"></span> <u>Data Wrangling</u></b><a class="anchor-link" href="#%E2%9C%93-Data-Wrangling"></a></h3>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=usQ_mwKf12sW">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># -------------------------------------------------------------------------</span>
<span class="c1"># 6. Feature Engineering</span>
<span class="c1"># -------------------------------------------------------------------------</span>

<span class="n">LABEL_COL</span> <span class="o">=</span> <span class="s2">"amount"</span>
<span class="n">CATEGORICAL_FEATURE_COL</span> <span class="o">=</span> <span class="s2">"description"</span>
<span class="n">CLEANED_CATEGORICAL_COL</span> <span class="o">=</span> <span class="s2">"description_clean"</span>

<span class="n">td_spark</span> <span class="o">=</span> <span class="n">td_spark</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">LABEL_COL</span><span class="p">,</span> <span class="n">regexp_replace</span><span class="p">(</span><span class="n">LABEL_COL</span><span class="p">,</span> <span class="s2">"\$"</span><span class="p">,</span> <span class="s2">""</span><span class="p">))</span>
<span class="n">td_spark</span> <span class="o">=</span> <span class="n">td_spark</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">LABEL_COL</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="n">LABEL_COL</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">DoubleType</span><span class="p">()))</span>
<span class="n">td_spark</span> <span class="o">=</span> <span class="n">td_spark</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"date"</span><span class="p">,</span> <span class="n">to_date</span><span class="p">(</span><span class="s2">"date"</span><span class="p">))</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">td_spark</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mcc_spark</span><span class="p">,</span> <span class="n">td_spark</span><span class="o">.</span><span class="n">mcc</span> <span class="o">==</span> <span class="n">mcc_spark</span><span class="o">.</span><span class="n">mcc_code</span><span class="p">,</span> <span class="s2">"left"</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">"id"</span><span class="p">,</span> <span class="s2">"client_id"</span><span class="p">,</span> <span class="s2">"card_id"</span><span class="p">,</span> <span class="s2">"use_chip"</span><span class="p">,</span> <span class="s2">"merchant_id"</span><span class="p">,</span> <span class="s2">"merchant_city"</span><span class="p">,</span>
             <span class="s2">"merchant_state"</span><span class="p">,</span> <span class="s2">"zip"</span><span class="p">,</span> <span class="s2">"mcc"</span><span class="p">,</span> <span class="s2">"errors"</span><span class="p">,</span> <span class="s2">"mcc_code"</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"date_timestamp"</span><span class="p">,</span> <span class="n">unix_timestamp</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"date"</span><span class="p">))</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">DoubleType</span><span class="p">()))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"day_of_week"</span><span class="p">,</span> <span class="n">dayofweek</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"date"</span><span class="p">))</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">DoubleType</span><span class="p">()))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"month"</span><span class="p">,</span> <span class="n">month</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"date"</span><span class="p">))</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">DoubleType</span><span class="p">()))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"is_refund"</span><span class="p">,</span> <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="n">LABEL_COL</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">DoubleType</span><span class="p">()))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">LABEL_COL</span><span class="p">,</span> <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="n">LABEL_COL</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">(),</span> <span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="n">LABEL_COL</span><span class="p">))))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">CLEANED_CATEGORICAL_COL</span><span class="p">,</span> <span class="n">regexp_replace</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="n">CATEGORICAL_FEATURE_COL</span><span class="p">),</span> <span class="s2">"[ ,:</span><span class="se">\\</span><span class="s2">[</span><span class="se">\\</span><span class="s2">]</span><span class="se">\\</span><span class="s2">{</span><span class="se">\\</span><span class="s2">}]"</span><span class="p">,</span> <span class="s2">"_"</span><span class="p">))</span>

<span class="c1"># Filter period of interest</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">((</span><span class="n">col</span><span class="p">(</span><span class="s2">"date"</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="s2">"2015-01-01"</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"date"</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="s2">"2019-10-31"</span><span class="p">))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Dataset loaded : </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> rows"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Dataset loaded : 6,734,248 rows
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=D0RLUfCC12p8">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># -------------------------------------------------------------------------</span>
<span class="c1"># 7. Target Encoding</span>
<span class="c1"># -------------------------------------------------------------------------</span>

<span class="k">def</span><span class="w"> </span><span class="nf">target_encode_optimized</span><span class="p">(</span><span class="n">train_df</span><span class="p">,</span> <span class="n">test_df</span><span class="p">,</span> <span class="n">cat_col</span><span class="p">,</span> <span class="n">label_col</span><span class="p">):</span>
    <span class="c1"># Calcul of average per category</span>
    <span class="n">mean_encoding</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="n">cat_col</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">avg</span><span class="p">(</span><span class="n">label_col</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"mean_encoded"</span><span class="p">))</span>
    <span class="n">mean_encoding</span> <span class="o">=</span> <span class="n">mean_encoding</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
    <span class="n">mean_encoding</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

    <span class="c1"># Global Average for empty or unknown values</span>
    <span class="n">global_mean</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">avg</span><span class="p">(</span><span class="n">label_col</span><span class="p">))</span><span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Joining train tables</span>
    <span class="n">train_encoded</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mean_encoding</span><span class="p">,</span> <span class="n">cat_col</span><span class="p">,</span> <span class="s2">"left"</span><span class="p">)</span> \
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"mean_encoded"</span><span class="p">,</span> <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"mean_encoded"</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">(),</span> <span class="n">global_mean</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"mean_encoded"</span><span class="p">)))</span>

    <span class="n">test_encoded</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mean_encoding</span><span class="p">,</span> <span class="n">cat_col</span><span class="p">,</span> <span class="s2">"left"</span><span class="p">)</span> \
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"mean_encoded"</span><span class="p">,</span> <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"mean_encoded"</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">(),</span> <span class="n">global_mean</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"mean_encoded"</span><span class="p">)))</span>

    <span class="c1"># Return as Spark DataFrames</span>
    <span class="k">return</span> <span class="n">train_encoded</span><span class="p">,</span> <span class="n">test_encoded</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=ib7H8XBt12nc">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># -------------------------------------------------------------------------</span>
<span class="c1"># 8. Bayesian Optimization (Automatic best hyperparameters) base on 1% data sample</span>
<span class="c1"># -------------------------------------------------------------------------</span>

<span class="n">FEATURES_COL</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">"date_timestamp"</span><span class="p">,</span> <span class="s2">"day_of_week"</span><span class="p">,</span> <span class="s2">"month"</span><span class="p">,</span> <span class="s2">"is_refund"</span><span class="p">,</span>
    <span class="n">CLEANED_CATEGORICAL_COL</span>
<span class="p">]</span>

<span class="c1"># Creation 1% sample</span>
<span class="n">sample_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">sample_pd</span> <span class="o">=</span> <span class="n">sample_df</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>

<span class="c1"># Vrifie que la colonne catgorielle existe, sinon tente de la rcuprer</span>
<span class="k">if</span> <span class="n">CLEANED_CATEGORICAL_COL</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sample_pd</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="n">CATEGORICAL_FEATURE_COL</span> <span class="ow">in</span> <span class="n">sample_pd</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">sample_pd</span><span class="p">[</span><span class="n">CLEANED_CATEGORICAL_COL</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample_pd</span><span class="p">[</span><span class="n">CATEGORICAL_FEATURE_COL</span><span class="p">]</span>

<span class="c1"># Si la colonne catgorielle existe, on la convertit en catgorie</span>
<span class="k">if</span> <span class="n">CLEANED_CATEGORICAL_COL</span> <span class="ow">in</span> <span class="n">sample_pd</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">sample_pd</span><span class="p">[</span><span class="n">CLEANED_CATEGORICAL_COL</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample_pd</span><span class="p">[</span><span class="n">CLEANED_CATEGORICAL_COL</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">"category"</span><span class="p">)</span>
    <span class="n">sample_pd</span><span class="p">[</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">CLEANED_CATEGORICAL_COL</span><span class="si">}</span><span class="s2">_code"</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample_pd</span><span class="p">[</span><span class="n">CLEANED_CATEGORICAL_COL</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span>
    <span class="n">sample_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"date_timestamp"</span><span class="p">,</span> <span class="s2">"day_of_week"</span><span class="p">,</span> <span class="s2">"month"</span><span class="p">,</span> <span class="s2">"is_refund"</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">CLEANED_CATEGORICAL_COL</span><span class="si">}</span><span class="s2">_code"</span><span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">sample_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"date_timestamp"</span><span class="p">,</span> <span class="s2">"day_of_week"</span><span class="p">,</span> <span class="s2">"month"</span><span class="p">,</span> <span class="s2">"is_refund"</span><span class="p">]</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">sample_pd</span><span class="p">[</span><span class="n">sample_features</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">sample_pd</span><span class="p">[</span><span class="n">LABEL_COL</span><span class="p">]</span>

<span class="c1"># ----------------------------------------------------</span>
<span class="c1"># Optuna objective function</span>
<span class="c1"># ----------------------------------------------------</span>
<span class="k">def</span><span class="w"> </span><span class="nf">objective</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"objective"</span><span class="p">:</span> <span class="s2">"regression"</span><span class="p">,</span>
        <span class="s2">"metric"</span><span class="p">:</span> <span class="s2">"rmse"</span><span class="p">,</span>
        <span class="s2">"num_leaves"</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s2">"num_leaves"</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">256</span><span class="p">),</span>
        <span class="s2">"max_depth"</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s2">"max_depth"</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
        <span class="s2">"learning_rate"</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s2">"learning_rate"</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="s2">"feature_fraction"</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s2">"feature_fraction"</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
        <span class="s2">"bagging_fraction"</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s2">"bagging_fraction"</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
        <span class="s2">"num_iterations"</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s2">"num_iterations"</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span>
        <span class="s2">"verbose"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="s2">"seed"</span><span class="p">:</span> <span class="mi">42</span>
    <span class="p">}</span>

    <span class="n">train_data</span> <span class="o">=</span> <span class="n">lgb</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">lgb</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">train_data</span><span class="p">)</span>
    <span class="n">preds</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="p">((</span><span class="n">preds</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">**</span> <span class="mf">0.5</span>
    <span class="k">return</span> <span class="n">rmse</span>

<span class="c1"># ----------------------------------------------------</span>
<span class="c1"># Run optimization</span>
<span class="c1"># ----------------------------------------------------</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Optuna Optimization start on 1</span><span class="si">% d</span><span class="s2">ata sample..."</span><span class="p">)</span>
<span class="n">study</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">create_study</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s2">"minimize"</span><span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="n">optuna</span><span class="o">.</span><span class="n">samplers</span><span class="o">.</span><span class="n">TPESampler</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
<span class="n">study</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">best_params</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">best_params</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Best hyperparameters:</span><span class="se">\n</span><span class="si">{</span><span class="n">best_params</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="application/vnd.jupyter.stderr" tabindex="0">
<pre>[I 2025-11-03 12:52:17,982] A new study created in memory with name: no-name-58c54689-9de5-497f-8446-dda4951e6ef4
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>
Optuna Optimization start on 1% data sample...
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="application/vnd.jupyter.stderr" tabindex="0">
<pre>[I 2025-11-03 12:52:21,139] Trial 0 finished with value: 51.0878380411952 and parameters: {'num_leaves': 115, 'max_depth': 15, 'learning_rate': 0.05395030966670229, 'feature_fraction': 0.8795975452591109, 'bagging_fraction': 0.7468055921327309, 'num_iterations': 324}. Best is trial 0 with value: 51.0878380411952.
[I 2025-11-03 12:52:29,643] Trial 1 finished with value: 50.91268696034915 and parameters: {'num_leaves': 44, 'max_depth': 14, 'learning_rate': 0.039913058785616795, 'feature_fraction': 0.9124217733388136, 'bagging_fraction': 0.7061753482887407, 'num_iterations': 976}. Best is trial 1 with value: 50.91268696034915.
[I 2025-11-03 12:52:35,277] Trial 2 finished with value: 56.89118695944336 and parameters: {'num_leaves': 219, 'max_depth': 7, 'learning_rate': 0.015199348301309814, 'feature_fraction': 0.7550213529560301, 'bagging_fraction': 0.7912726728878613, 'num_iterations': 620}. Best is trial 1 with value: 50.91268696034915.
[I 2025-11-03 12:52:41,472] Trial 3 finished with value: 54.14778484988534 and parameters: {'num_leaves': 128, 'max_depth': 8, 'learning_rate': 0.04091220574443785, 'feature_fraction': 0.7418481581956126, 'bagging_fraction': 0.7876433945605654, 'num_iterations': 493}. Best is trial 1 with value: 50.91268696034915.
[I 2025-11-03 12:52:43,832] Trial 4 finished with value: 54.816848756407616 and parameters: {'num_leaves': 134, 'max_depth': 13, 'learning_rate': 0.015837031559118753, 'feature_fraction': 0.8542703315240835, 'bagging_fraction': 0.8777243706586128, 'num_iterations': 237}. Best is trial 1 with value: 50.91268696034915.
[I 2025-11-03 12:52:50,961] Trial 5 finished with value: 57.934248639029136 and parameters: {'num_leaves': 168, 'max_depth': 6, 'learning_rate': 0.011615865989246453, 'feature_fraction': 0.984665661176, 'bagging_fraction': 0.9896896099223678, 'num_iterations': 847}. Best is trial 1 with value: 50.91268696034915.
[I 2025-11-03 12:52:55,285] Trial 6 finished with value: 55.208056200558005 and parameters: {'num_leaves': 99, 'max_depth': 6, 'learning_rate': 0.04833180632488466, 'feature_fraction': 0.8320457481218804, 'bagging_fraction': 0.7366114704534336, 'num_iterations': 596}. Best is trial 1 with value: 50.91268696034915.
[I 2025-11-03 12:53:00,376] Trial 7 finished with value: 55.22576977491358 and parameters: {'num_leaves': 38, 'max_depth': 15, 'learning_rate': 0.01814596135349025, 'feature_fraction': 0.8987566853061946, 'bagging_fraction': 0.7935133228268233, 'num_iterations': 616}. Best is trial 1 with value: 50.91268696034915.
[I 2025-11-03 12:53:11,014] Trial 8 finished with value: 47.56964723236516 and parameters: {'num_leaves': 154, 'max_depth': 7, 'learning_rate': 0.09323621351781479, 'feature_fraction': 0.9325398470083344, 'bagging_fraction': 0.9818496824692567, 'num_iterations': 916}. Best is trial 8 with value: 47.56964723236516.
[I 2025-11-03 12:53:18,839] Trial 9 finished with value: 53.38937114942398 and parameters: {'num_leaves': 166, 'max_depth': 15, 'learning_rate': 0.012260057359187526, 'feature_fraction': 0.7587948587257435, 'bagging_fraction': 0.7135681866731614, 'num_iterations': 460}. Best is trial 8 with value: 47.56964723236516.
[I 2025-11-03 12:53:32,208] Trial 10 finished with value: 42.45893664603577 and parameters: {'num_leaves': 244, 'max_depth': 10, 'learning_rate': 0.09322601292624816, 'feature_fraction': 0.9833497436436693, 'bagging_fraction': 0.9951622648438584, 'num_iterations': 831}. Best is trial 10 with value: 42.45893664603577.
[I 2025-11-03 12:53:45,608] Trial 11 finished with value: 42.528694536927645 and parameters: {'num_leaves': 252, 'max_depth': 10, 'learning_rate': 0.09611047754271736, 'feature_fraction': 0.9992041511679673, 'bagging_fraction': 0.9987405662073933, 'num_iterations': 821}. Best is trial 10 with value: 42.45893664603577.
[I 2025-11-03 12:53:59,544] Trial 12 finished with value: 41.06735413468018 and parameters: {'num_leaves': 251, 'max_depth': 11, 'learning_rate': 0.09862929796873673, 'feature_fraction': 0.9911190152534857, 'bagging_fraction': 0.9069671270049076, 'num_iterations': 792}. Best is trial 12 with value: 41.06735413468018.
[I 2025-11-03 12:54:12,366] Trial 13 finished with value: 44.392947655039926 and parameters: {'num_leaves': 216, 'max_depth': 11, 'learning_rate': 0.06858148658869345, 'feature_fraction': 0.9589180921395233, 'bagging_fraction': 0.912027207995444, 'num_iterations': 753}. Best is trial 12 with value: 41.06735413468018.
[I 2025-11-03 12:54:23,793] Trial 14 finished with value: 50.39377342768146 and parameters: {'num_leaves': 254, 'max_depth': 11, 'learning_rate': 0.029279640357738394, 'feature_fraction': 0.9510467545997464, 'bagging_fraction': 0.9320281882773551, 'num_iterations': 734}. Best is trial 12 with value: 41.06735413468018.
[I 2025-11-03 12:54:33,140] Trial 15 finished with value: 49.160207370925775 and parameters: {'num_leaves': 207, 'max_depth': 9, 'learning_rate': 0.06943645170583447, 'feature_fraction': 0.8059496586274635, 'bagging_fraction': 0.940932769738597, 'num_iterations': 728}. Best is trial 12 with value: 41.06735413468018.
[I 2025-11-03 12:54:50,614] Trial 16 finished with value: 48.813241565818956 and parameters: {'num_leaves': 195, 'max_depth': 12, 'learning_rate': 0.027243832983309575, 'feature_fraction': 0.9711614918259046, 'bagging_fraction': 0.8595848791921131, 'num_iterations': 977}. Best is trial 12 with value: 41.06735413468018.
[I 2025-11-03 12:55:02,262] Trial 17 finished with value: 46.75212792503759 and parameters: {'num_leaves': 235, 'max_depth': 9, 'learning_rate': 0.06998487037074656, 'feature_fraction': 0.9274670851039221, 'bagging_fraction': 0.8958797187906674, 'num_iterations': 836}. Best is trial 12 with value: 41.06735413468018.
[I 2025-11-03 12:55:13,403] Trial 18 finished with value: 41.7301024437823 and parameters: {'num_leaves': 180, 'max_depth': 12, 'learning_rate': 0.09609176196016234, 'feature_fraction': 0.9942249576279402, 'bagging_fraction': 0.955604905780556, 'num_iterations': 680}. Best is trial 12 with value: 41.06735413468018.
[I 2025-11-03 12:55:22,577] Trial 19 finished with value: 48.761538492362035 and parameters: {'num_leaves': 190, 'max_depth': 13, 'learning_rate': 0.059217852884309585, 'feature_fraction': 0.7965876180576154, 'bagging_fraction': 0.9521611575184935, 'num_iterations': 499}. Best is trial 12 with value: 41.06735413468018.
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Best hyperparameters:
{'num_leaves': 251, 'max_depth': 11, 'learning_rate': 0.09862929796873673, 'feature_fraction': 0.9911190152534857, 'bagging_fraction': 0.9069671270049076, 'num_iterations': 792}
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=v02TT2FBWVmw">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="%E2%9C%93-Machine-Learning"><b><span style="color:green;"></span> <u>Machine Learning</u></b><a class="anchor-link" href="#%E2%9C%93-Machine-Learning"></a></h3>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=5xbAFt3A12k1">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># -------------------------------------------------------------------------</span>
<span class="c1"># 9. Optimized train data</span>
<span class="c1"># -------------------------------------------------------------------------</span>

<span class="c1"># The previous model was really slow. The purpose of the new optimized version below is to decrease the training duration.</span>

<span class="k">def</span><span class="w"> </span><span class="nf">train_with_best_params_optimized</span><span class="p">(</span><span class="n">train_df</span><span class="p">,</span> <span class="n">test_df</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="n">final_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"date_timestamp"</span><span class="p">,</span> <span class="s2">"day_of_week"</span><span class="p">,</span> <span class="s2">"month"</span><span class="p">,</span> <span class="s2">"is_refund"</span><span class="p">,</span> <span class="s2">"mean_encoded"</span><span class="p">]</span>

    <span class="c1"># Verification of columns in training dataframe</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">final_features</span> <span class="o">+</span> <span class="p">[</span><span class="n">LABEL_COL</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">train_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Missing column </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2"> in training data"</span><span class="p">)</span>

    <span class="c1"># OPTIMISATION 1 : Cleaning and push it to cache</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">clean_and_cache</span><span class="p">(</span><span class="n">dframe</span><span class="p">):</span>
        <span class="n">df_local</span> <span class="o">=</span> <span class="n">dframe</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">final_features</span> <span class="o">+</span> <span class="p">[</span><span class="n">LABEL_COL</span><span class="p">]:</span>
            <span class="n">df_local</span> <span class="o">=</span> <span class="n">df_local</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="o">~</span><span class="n">isnan</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="o">&amp;</span> <span class="n">col</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">())</span>
        <span class="n">df_local</span> <span class="o">=</span> <span class="n">df_local</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">df_local</span>

    <span class="n">train_df</span> <span class="o">=</span> <span class="n">clean_and_cache</span><span class="p">(</span><span class="n">train_df</span><span class="p">)</span>
    <span class="n">test_df</span> <span class="o">=</span> <span class="n">clean_and_cache</span><span class="p">(</span><span class="n">test_df</span><span class="p">)</span>

    <span class="c1"># OPTIMISATION 2 : Verification of the data volume</span>
    <span class="n">train_count</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">train_count</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Too small dataframe, split ignored"</span><span class="p">)</span>
        <span class="n">train_df</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>
        <span class="n">test_df</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">"mse"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">"rmse"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">"mae"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">"r2"</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>

    <span class="c1"># OPTIMISATION 3 : Variance check</span>
    <span class="n">stats_df</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">countDistinct</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="n">f</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="sa">f</span><span class="s2">"distinct_</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">final_features</span><span class="p">]</span> <span class="o">+</span>
                                <span class="p">[</span><span class="n">stddev</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="n">f</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="sa">f</span><span class="s2">"std_</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">final_features</span><span class="p">])</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="n">stats_df</span><span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">asDict</span><span class="p">()</span>

    <span class="n">valid_features</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">final_features</span><span class="p">:</span>
        <span class="n">unique_val</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">"distinct_</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">std_val</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">"std_</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">unique_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">unique_val</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">std_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">std_val</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">valid_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Feature '</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2">' deleted due to null variance or single value"</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">valid_features</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"No valid feature, ignored split."</span><span class="p">)</span>
        <span class="n">train_df</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>
        <span class="n">test_df</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">"mse"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">"rmse"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">"mae"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">"r2"</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>

    <span class="c1"># Assembler</span>
    <span class="n">assembler</span> <span class="o">=</span> <span class="n">VectorAssembler</span><span class="p">(</span><span class="n">inputCols</span><span class="o">=</span><span class="n">valid_features</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">"features_vector"</span><span class="p">,</span> <span class="n">handleInvalid</span><span class="o">=</span><span class="s2">"skip"</span><span class="p">)</span>
    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span><span class="n">assembler</span><span class="p">])</span>
    <span class="n">pipeline_model</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_df</span><span class="p">)</span>

    <span class="n">train_data</span> <span class="o">=</span> <span class="n">pipeline_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">train_df</span><span class="p">)</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
    <span class="n">test_data</span> <span class="o">=</span> <span class="n">pipeline_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_df</span><span class="p">)</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>

    <span class="c1"># OPTIMISATION 4 : Vector verification</span>
    <span class="n">sample_check</span> <span class="o">=</span> <span class="n">train_data</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"features_vector"</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sample_check</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"No data after transformation"</span><span class="p">)</span>
        <span class="n">train_df</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>
        <span class="n">test_df</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>
        <span class="n">train_data</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>
        <span class="n">test_data</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">"mse"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">"rmse"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">"mae"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">"r2"</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>

    <span class="c1"># LightGBM optimized hyperparameters (SynapseML LightGBMRegressor)</span>
    <span class="n">lgbm</span> <span class="o">=</span> <span class="n">LightGBMRegressor</span><span class="p">(</span>
        <span class="n">featuresCol</span><span class="o">=</span><span class="s2">"features_vector"</span><span class="p">,</span>
        <span class="n">labelCol</span><span class="o">=</span><span class="n">LABEL_COL</span><span class="p">,</span>
        <span class="n">objective</span><span class="o">=</span><span class="s2">"regression"</span><span class="p">,</span>
        <span class="n">numLeaves</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"num_leaves"</span><span class="p">,</span> <span class="mi">31</span><span class="p">)),</span>
        <span class="n">maxDepth</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"max_depth"</span><span class="p">,</span> <span class="mi">6</span><span class="p">)),</span>
        <span class="n">learningRate</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"learning_rate"</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
        <span class="n">featureFraction</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"feature_fraction"</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)),</span>
        <span class="n">baggingFraction</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"bagging_fraction"</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)),</span>
        <span class="n">numIterations</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"num_iterations"</span><span class="p">,</span> <span class="mi">100</span><span class="p">)),</span>
        <span class="n">verbosity</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">numThreads</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Training on </span><span class="si">{</span><span class="n">train_count</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> rows..."</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">lgbm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_data</span><span class="p">)</span>
    <span class="n">preds</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>

    <span class="n">evaluator</span> <span class="o">=</span> <span class="n">RegressionEvaluator</span><span class="p">(</span><span class="n">labelCol</span><span class="o">=</span><span class="n">LABEL_COL</span><span class="p">,</span> <span class="n">predictionCol</span><span class="o">=</span><span class="s2">"prediction"</span><span class="p">)</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"mse"</span><span class="p">:</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="p">{</span><span class="n">evaluator</span><span class="o">.</span><span class="n">metricName</span><span class="p">:</span> <span class="s2">"mse"</span><span class="p">}),</span>
        <span class="s2">"rmse"</span><span class="p">:</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="p">{</span><span class="n">evaluator</span><span class="o">.</span><span class="n">metricName</span><span class="p">:</span> <span class="s2">"rmse"</span><span class="p">}),</span>
        <span class="s2">"mae"</span><span class="p">:</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="p">{</span><span class="n">evaluator</span><span class="o">.</span><span class="n">metricName</span><span class="p">:</span> <span class="s2">"mae"</span><span class="p">}),</span>
        <span class="s2">"r2"</span><span class="p">:</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="p">{</span><span class="n">evaluator</span><span class="o">.</span><span class="n">metricName</span><span class="p">:</span> <span class="s2">"r2"</span><span class="p">}),</span>
    <span class="p">}</span>

    <span class="c1"># Cleaning memory</span>
    <span class="n">train_df</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>
    <span class="n">test_df</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>
    <span class="n">train_data</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>
    <span class="n">test_data</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">metrics</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=DG4E_0cf-cS7">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># -------------------------------------------------------------------------</span>
<span class="c1"># 8. Rolling Temporal Validation OPTIMIS</span>
<span class="c1"># -------------------------------------------------------------------------</span>

<span class="n">split_years</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2015</span><span class="p">,</span> <span class="mi">2016</span><span class="p">,</span> <span class="mi">2017</span><span class="p">,</span> <span class="mi">2018</span><span class="p">]</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">split_year</span> <span class="ow">in</span> <span class="n">split_years</span><span class="p">:</span>
    <span class="n">split_date</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">split_year</span><span class="si">}</span><span class="s2">-12-31"</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="si">{</span><span class="s1">'='</span><span class="o">*</span><span class="mi">60</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Temporal Split : Train  </span><span class="si">{</span><span class="n">split_date</span><span class="si">}</span><span class="s2"> | Test &gt; </span><span class="si">{</span><span class="n">split_date</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="s1">'='</span><span class="o">*</span><span class="mi">60</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="c1"># OPTIMISATION 5 : Filter and push to cache</span>
    <span class="n">train_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"date"</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">split_date</span><span class="p">)</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
    <span class="n">test_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"date"</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">split_date</span><span class="p">)</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>

    <span class="n">train_count</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="n">test_count</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Train: </span><span class="si">{</span><span class="n">train_count</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> | Test: </span><span class="si">{</span><span class="n">test_count</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">train_count</span> <span class="o">&lt;</span> <span class="mi">1000</span> <span class="ow">or</span> <span class="n">test_count</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Not enough data for year </span><span class="si">{</span><span class="n">split_year</span><span class="si">}</span><span class="s2">, skipping..."</span><span class="p">)</span>
        <span class="n">train_df</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>
        <span class="n">test_df</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>
        <span class="k">continue</span>

    <span class="c1"># Target Encoding</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Target encoding..."</span><span class="p">)</span>
    <span class="n">train_encoded</span><span class="p">,</span> <span class="n">test_encoded</span> <span class="o">=</span> <span class="n">target_encode_optimized</span><span class="p">(</span><span class="n">train_df</span><span class="p">,</span> <span class="n">test_df</span><span class="p">,</span> <span class="n">CLEANED_CATEGORICAL_COL</span><span class="p">,</span> <span class="n">LABEL_COL</span><span class="p">)</span>
    <span class="n">train_encoded</span> <span class="o">=</span> <span class="n">train_encoded</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
    <span class="n">test_encoded</span> <span class="o">=</span> <span class="n">test_encoded</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>

    <span class="c1"># Training</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">train_with_best_params_optimized</span><span class="p">(</span><span class="n">train_encoded</span><span class="p">,</span> <span class="n">test_encoded</span><span class="p">,</span> <span class="n">best_params</span><span class="p">)</span>

    <span class="c1"># Defensive: ensure metrics is a dict</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="c1"># Try to convert if it's a tuple/list with expected order; otherwise wrap</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">"mse"</span><span class="p">:</span> <span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="s2">"rmse"</span><span class="p">:</span> <span class="n">metrics</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="s2">"mae"</span><span class="p">:</span> <span class="n">metrics</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="s2">"r2"</span><span class="p">:</span> <span class="n">metrics</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"mse"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">"rmse"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">"mae"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">"r2"</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"Warning: metrics returned an unexpected type; normalized to None values."</span><span class="p">)</span>

    <span class="c1"># Add metadata about split</span>
    <span class="n">metrics</span><span class="p">[</span><span class="s2">"train_end"</span><span class="p">]</span> <span class="o">=</span> <span class="n">split_year</span>
    <span class="n">metrics</span><span class="p">[</span><span class="s2">"test_year"</span><span class="p">]</span> <span class="o">=</span> <span class="n">split_year</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">"r2"</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Result </span><span class="si">{</span><span class="n">split_year</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">  R = </span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="s1">'r2'</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> | RMSE = </span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="s1">'rmse'</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>

    <span class="c1"># Cleaning</span>
    <span class="n">train_df</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>
    <span class="n">test_df</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>
    <span class="c1"># target_encode returned cached objects</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">train_encoded</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>
        <span class="n">test_encoded</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>

<span class="c1"># Final results DataFrame</span>
<span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Final results:"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>
============================================================
Temporal Split : Train  2015-12-31 | Test &gt; 2015-12-31
============================================================
Train: 1,388,065 | Test: 5,346,183
Target encoding...
Training on 1,388,065 rows...
Result 2016  R = 0.5509 | RMSE = 50.13

============================================================
Temporal Split : Train  2016-12-31 | Test &gt; 2016-12-31
============================================================
Train: 2,780,182 | Test: 3,954,066
Target encoding...
Training on 2,780,182 rows...
Result 2017  R = 0.5542 | RMSE = 49.81

============================================================
Temporal Split : Train  2017-12-31 | Test &gt; 2017-12-31
============================================================
Train: 4,179,490 | Test: 2,554,758
Target encoding...
Training on 4,179,490 rows...
Result 2018  R = 0.5547 | RMSE = 49.77

============================================================
Temporal Split : Train  2018-12-31 | Test &gt; 2018-12-31
============================================================
Train: 5,574,282 | Test: 1,159,966
Target encoding...
Training on 5,574,282 rows...
Result 2019  R = 0.5530 | RMSE = 49.74

Final results:
           mse       rmse        mae        r2  train_end  test_year
0  2513.398113  50.133802  29.311969  0.550948       2015       2016
1  2480.598657  49.805609  29.263845  0.554244       2016       2017
2  2477.255706  49.772037  29.204425  0.554739       2017       2018
3  2473.638377  49.735685  29.221757  0.552976       2018       2019
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=NJtIQ0HVm9Id">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># -------------------------------------------------------------------------</span>
<span class="c1"># 8. Display final Results</span>
<span class="c1"># -------------------------------------------------------------------------</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="si">{</span><span class="s1">'='</span><span class="o">*</span><span class="mi">60</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"FINAL RESULT"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="s1">'='</span><span class="o">*</span><span class="mi">60</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results_df</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

<span class="c1"># Metrics</span>
<span class="n">valid_results</span> <span class="o">=</span> <span class="n">results_df</span><span class="p">[</span><span class="n">results_df</span><span class="p">[</span><span class="s1">'r2'</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()]</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">valid_results</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2"> Average on </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">valid_results</span><span class="p">)</span><span class="si">}</span><span class="s2"> years:"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">" Average R : </span><span class="si">{</span><span class="n">valid_results</span><span class="p">[</span><span class="s1">'r2'</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">" Average RMSE : </span><span class="si">{</span><span class="n">valid_results</span><span class="p">[</span><span class="s1">'rmse'</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">" Average MAE : </span><span class="si">{</span><span class="n">valid_results</span><span class="p">[</span><span class="s1">'mae'</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>
============================================================
FINAL RESULT
============================================================
        mse      rmse       mae       r2  train_end  test_year
2513.398113 50.133802 29.311969 0.550948       2015       2016
2480.598657 49.805609 29.263845 0.554244       2016       2017
2477.255706 49.772037 29.204425 0.554739       2017       2018
2473.638377 49.735685 29.221757 0.552976       2018       2019

 Average on 4 years:
 Average R : 0.5532
 Average RMSE : 49.86
 Average MAE : 29.25
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=PZwgX5QBZjdm">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="Comments-:"><strong>Comments :</strong><a class="anchor-link" href="#Comments-:"></a></h3><p>As planned by filtering the dataframe after 2015, the result is much better.
However, an R of 0.55 is not enough satisfying in my opinion.</p>
<p>To obtain better results, there is 2 options:</p>
<blockquote>
<blockquote>
<blockquote>
<p><strong>Add addtional data</strong> for the LightGBM algorithm to gain more insights</p>
</blockquote>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>Go back on the first version and <strong>aggregate data</strong> on a monthly periodicity.</p>
</blockquote>
</blockquote>
</blockquote>
<p>Let's return to the first needs: Predict the monthly transaction amount (high level view).
So For the next experiment, I will revisit the initial idea and aggregate data without lag.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=wqWbNdpckbHb">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h2><span style="color:blue;">5. <strong>Experiment 4</strong> with Monthly aggregation - MACHINE LEARNING USING LIGHTGBM</span></h2>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=E69ZiVChmKDr">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="%E2%9C%93-Initialization"><b><span style="color:green;"></span> <u>Initialization</u></b><a class="anchor-link" href="#%E2%9C%93-Initialization"></a></h3>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=wHv6CzD8l--i">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># -------------------------------------------------------------------------</span>
<span class="c1"># 1. Install JAVA - SPARK</span>
<span class="c1"># -------------------------------------------------------------------------</span>

<span class="o">!</span>apt-get<span class="w"> </span>install<span class="w"> </span>openjdk-11-jdk<span class="w"> </span>-y
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span><span class="nv">pyspark</span><span class="o">==</span><span class="m">3</span>.5.0
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>findspark
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>--force-reinstall<span class="w"> </span><span class="nv">numpy</span><span class="o">==</span><span class="m">1</span>.26.4<span class="w"> </span><span class="nv">pandas</span><span class="o">==</span><span class="m">2</span>.2.2

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"JAVA_HOME"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"/usr/lib/jvm/java-11-openjdk-amd64"</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"PATH"</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">":/usr/lib/jvm/java-11-openjdk-amd64/bin"</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=bGBOAVgwaCfY">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># ----------------------</span>
<span class="c1"># 2. Spark init</span>
<span class="c1"># ----------------------</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.sql</span><span class="w"> </span><span class="kn">import</span> <span class="n">SparkSession</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span> \
    <span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">"ML_Portfolio_Monthly_Aggregated_Prediction"</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="s2">"spark.sql.shuffle.partitions"</span><span class="p">,</span> <span class="s2">"200"</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=NxAzgnRhl-6z">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># -------------------------------------------------------------------------</span>
<span class="c1"># 3. Install Synapse Optuna</span>
<span class="c1"># -------------------------------------------------------------------------</span>

<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>synapseml<span class="w"> </span>optuna
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=ORPN6eF3l-1h">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># -------------------------------------------------------------------------</span>
<span class="c1"># 4. Import Libraries</span>
<span class="c1"># -------------------------------------------------------------------------</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">kagglehub</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">optuna</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lightgbm</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">lgb</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">math</span><span class="w"> </span><span class="kn">import</span> <span class="n">pi</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.sql.functions</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">col</span><span class="p">,</span> <span class="n">to_date</span><span class="p">,</span> <span class="n">regexp_replace</span><span class="p">,</span> <span class="n">unix_timestamp</span><span class="p">,</span> <span class="n">dayofweek</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">lit</span><span class="p">,</span>
    <span class="nb">sum</span> <span class="k">as</span> <span class="n">_sum</span><span class="p">,</span> <span class="n">avg</span> <span class="k">as</span> <span class="n">_avg</span><span class="p">,</span> <span class="n">count</span> <span class="k">as</span> <span class="n">_count</span><span class="p">,</span> <span class="n">stddev</span> <span class="k">as</span> <span class="n">_stddev</span><span class="p">,</span> <span class="n">countDistinct</span><span class="p">,</span>
    <span class="n">when</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="nb">max</span> <span class="k">as</span> <span class="n">_max</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.sql.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">DoubleType</span><span class="p">,</span> <span class="n">IntegerType</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">r2_score</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sklearn.metrics</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">"ignore"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=7ipkYY7JFUPG">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="%E2%9C%93-Extraction---Load"><b><span style="color:green;"></span> <u>Extraction - Load</u></b><a class="anchor-link" href="#%E2%9C%93-Extraction---Load"></a></h3>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=3RULNCGSaE7C">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># -------------------------------------------------------------------------</span>
<span class="c1"># 5. Data Loading</span>
<span class="c1"># -------------------------------------------------------------------------</span>

<span class="n">path</span> <span class="o">=</span> <span class="n">kagglehub</span><span class="o">.</span><span class="n">dataset_download</span><span class="p">(</span><span class="s2">"computingvictor/transactions-fraud-datasets"</span><span class="p">)</span>
<span class="n">transaction_data</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">/transactions_data.csv"</span>
<span class="n">mcc_codes_data</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">/mcc_codes.json"</span>

<span class="c1"># load mcc descriptions</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">mcc_codes_data</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">mcc_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">mcc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">mcc_dict</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">"index"</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"description"</span><span class="p">])</span> \
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"index"</span><span class="p">:</span> <span class="s2">"mcc_code"</span><span class="p">})</span>
<span class="n">mcc_spark</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">mcc</span><span class="p">)</span>

<span class="c1"># load transactions</span>
<span class="n">td_spark</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">transaction_data</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inferSchema</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Downloading from https://www.kaggle.com/api/v1/datasets/download/computingvictor/transactions-fraud-datasets?dataset_version_number=1...
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="application/vnd.jupyter.stderr" tabindex="0">
<pre>100%|| 348M/348M [00:02&lt;00:00, 138MB/s]</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Extracting files...
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="application/vnd.jupyter.stderr" tabindex="0">
<pre>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=JKwmi2qSWaZn">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="%E2%9C%93-Data-Wrangling"><b><span style="color:green;"></span> <u>Data Wrangling</u></b><a class="anchor-link" href="#%E2%9C%93-Data-Wrangling"></a></h3>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=eFZf9Zj7aHej">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># -------------------------------------------------------------------------</span>
<span class="c1"># 6. Feature Engineering</span>
<span class="c1"># -------------------------------------------------------------------------</span>

<span class="n">LABEL_COL</span> <span class="o">=</span> <span class="s2">"amount"</span>

<span class="n">td_spark</span> <span class="o">=</span> <span class="n">td_spark</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">LABEL_COL</span><span class="p">,</span> <span class="n">regexp_replace</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="n">LABEL_COL</span><span class="p">),</span> <span class="s2">"</span><span class="se">\\</span><span class="s2">$"</span><span class="p">,</span> <span class="s2">""</span><span class="p">))</span>
<span class="n">td_spark</span> <span class="o">=</span> <span class="n">td_spark</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">LABEL_COL</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="n">LABEL_COL</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">DoubleType</span><span class="p">()))</span>
<span class="n">td_spark</span> <span class="o">=</span> <span class="n">td_spark</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"date"</span><span class="p">,</span> <span class="n">to_date</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"date"</span><span class="p">)))</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">td_spark</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mcc_spark</span><span class="p">,</span> <span class="n">td_spark</span><span class="o">.</span><span class="n">mcc</span> <span class="o">==</span> <span class="n">mcc_spark</span><span class="o">.</span><span class="n">mcc_code</span><span class="p">,</span> <span class="s2">"left"</span><span class="p">)</span>

<span class="n">cols_to_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"id"</span><span class="p">,</span> <span class="s2">"use_chip"</span><span class="p">,</span> <span class="s2">"merchant_city"</span><span class="p">,</span> <span class="s2">"merchant_state"</span><span class="p">,</span> <span class="s2">"zip"</span><span class="p">,</span> <span class="s2">"mcc"</span><span class="p">,</span> <span class="s2">"errors"</span><span class="p">,</span> <span class="s2">"mcc_code"</span><span class="p">]</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cols_to_drop</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"year"</span><span class="p">,</span> <span class="n">year</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"date"</span><span class="p">))</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">()))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"month"</span><span class="p">,</span> <span class="n">month</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"date"</span><span class="p">))</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">()))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"date_timestamp"</span><span class="p">,</span> <span class="n">unix_timestamp</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"date"</span><span class="p">))</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">DoubleType</span><span class="p">()))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"day_of_week"</span><span class="p">,</span> <span class="n">dayofweek</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"date"</span><span class="p">))</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">()))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"is_refund"</span><span class="p">,</span> <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="n">LABEL_COL</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">DoubleType</span><span class="p">()))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"description_clean"</span><span class="p">,</span> <span class="n">regexp_replace</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"description"</span><span class="p">),</span> <span class="s2">"[ ,:</span><span class="se">\\</span><span class="s2">[</span><span class="se">\\</span><span class="s2">]</span><span class="se">\\</span><span class="s2">{</span><span class="se">\\</span><span class="s2">}]"</span><span class="p">,</span> <span class="s2">"_"</span><span class="p">))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">((</span><span class="n">col</span><span class="p">(</span><span class="s2">"date"</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="s2">"2015-01-01"</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"date"</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="s2">"2019-10-31"</span><span class="p">))</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"Rows after filter:"</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Rows after filter: 6734248
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=KskmZh1iaKED">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># ----------------------</span>
<span class="c1"># 7. Monthly aggregation per merchant_id</span>
<span class="c1"># ----------------------</span>

<span class="c1"># Aggregation per (year, month, merchant_id)</span>
<span class="n">group_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"merchant_id"</span><span class="p">,</span> <span class="s2">"year"</span><span class="p">,</span> <span class="s2">"month"</span><span class="p">]</span>

<span class="n">agg</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="o">*</span><span class="n">group_cols</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
    <span class="n">_sum</span><span class="p">(</span><span class="n">LABEL_COL</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"amount_sum"</span><span class="p">),</span>
    <span class="n">_count</span><span class="p">(</span><span class="s2">"*"</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"tx_count"</span><span class="p">),</span>
    <span class="n">_avg</span><span class="p">(</span><span class="n">LABEL_COL</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"amount_avg"</span><span class="p">),</span>
    <span class="n">_stddev</span><span class="p">(</span><span class="n">LABEL_COL</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"amount_stddev"</span><span class="p">),</span>
    <span class="n">_avg</span><span class="p">(</span><span class="s2">"is_refund"</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"refund_rate"</span><span class="p">),</span>
    <span class="n">countDistinct</span><span class="p">(</span><span class="s2">"description_clean"</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"desc_count"</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># fill null stddev with 0</span>
<span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">fillna</span><span class="p">({</span><span class="s2">"amount_stddev"</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">})</span>

<span class="c1"># add ym numeric for splitting and features</span>
<span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"ym"</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">"year"</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">col</span><span class="p">(</span><span class="s2">"month"</span><span class="p">))</span>

<span class="c1"># temporal features</span>
<span class="c1"># month cyclic</span>
<span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"month_sin"</span><span class="p">,</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">col</span><span class="p">(</span><span class="s2">"month"</span><span class="p">)</span> <span class="o">/</span> <span class="n">lit</span><span class="p">(</span><span class="mi">12</span><span class="p">)))</span>
<span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"month_cos"</span><span class="p">,</span> <span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">col</span><span class="p">(</span><span class="s2">"month"</span><span class="p">)</span> <span class="o">/</span> <span class="n">lit</span><span class="p">(</span><span class="mi">12</span><span class="p">)))</span>

<span class="c1"># normalized year (year - min_year)</span>
<span class="n">min_year</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">"year"</span><span class="p">:</span> <span class="s2">"min"</span><span class="p">})</span><span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"year_norm"</span><span class="p">,</span> <span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"year"</span><span class="p">)</span> <span class="o">-</span> <span class="n">lit</span><span class="p">(</span><span class="n">min_year</span><span class="p">))</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">DoubleType</span><span class="p">()))</span>

<span class="c1"># log target</span>
<span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"log_amount_sum"</span><span class="p">,</span> <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"amount_sum"</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">"amount_sum"</span><span class="p">))</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="mf">0.0</span><span class="p">))</span>
<span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"log_amount_sum"</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="s2">"log(1 + log_amount_sum)"</span><span class="p">))</span>

<span class="c1"># cache</span>
<span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Monthly aggregated rows:"</span><span class="p">,</span> <span class="n">agg</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Monthly aggregated rows: 606168
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=cu8-DtP9aMkx">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># ----------------------</span>
<span class="c1"># 8.  prepare splitting boundaries</span>
<span class="c1"># ----------------------</span>
<span class="n">last_ym</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">_max</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"ym"</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"last"</span><span class="p">))</span><span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Last ym available:"</span><span class="p">,</span> <span class="n">last_ym</span><span class="p">)</span>

<span class="n">split_years</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2015</span><span class="p">,</span> <span class="mi">2016</span><span class="p">,</span> <span class="mi">2017</span><span class="p">,</span> <span class="mi">2018</span><span class="p">]</span>  <span class="c1"># will produce tests 2016,2017,2018,2019 (but 2019 months up to available)</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Last ym available: 201910
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=M6LUCxlPWf5Q">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="%E2%9C%93-Machine-Learning"><b><span style="color:green;"></span> <u>Machine Learning</u></b><a class="anchor-link" href="#%E2%9C%93-Machine-Learning"></a></h3>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=BFyxWn4taOhI">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># ----------------------</span>
<span class="c1"># 9. Loop over temporal splits</span>
<span class="c1"># ----------------------</span>

<span class="k">for</span> <span class="n">year_split</span> <span class="ow">in</span> <span class="n">split_years</span><span class="p">:</span>
    <span class="n">train_ym_max</span> <span class="o">=</span> <span class="n">year_split</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">12</span>
    <span class="n">test_ym_min</span> <span class="o">=</span> <span class="p">(</span><span class="n">year_split</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">test_ym_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">((</span><span class="n">year_split</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">12</span><span class="p">,</span> <span class="n">last_ym</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span> <span class="o">+</span> <span class="s2">"="</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Temporal split: train &lt;= </span><span class="si">{</span><span class="n">train_ym_max</span><span class="si">}</span><span class="s2"> | test: </span><span class="si">{</span><span class="n">test_ym_min</span><span class="si">}</span><span class="s2">..</span><span class="si">{</span><span class="n">test_ym_max</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"="</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>

    <span class="n">train_df</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"ym"</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">train_ym_max</span><span class="p">)</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
    <span class="n">test_df</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">filter</span><span class="p">((</span><span class="n">col</span><span class="p">(</span><span class="s2">"ym"</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">test_ym_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"ym"</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">test_ym_max</span><span class="p">))</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>

    <span class="n">train_count</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="n">test_count</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Train rows: </span><span class="si">{</span><span class="n">train_count</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> | Test rows: </span><span class="si">{</span><span class="n">test_count</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">train_count</span> <span class="o">&lt;</span> <span class="mi">50</span> <span class="ow">or</span> <span class="n">test_count</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Not enough data for this split, skipping."</span><span class="p">)</span>
        <span class="n">train_df</span><span class="o">.</span><span class="n">unpersist</span><span class="p">();</span> <span class="n">test_df</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>
        <span class="k">continue</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="c1"># 10. Merchant target encoding</span>
    <span class="c1"># -------------------------------------------------------------------------</span>

    <span class="n">merchant_mean</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">"merchant_id"</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">_avg</span><span class="p">(</span><span class="s2">"log_amount_sum"</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"merchant_mean_log"</span><span class="p">))</span>
    <span class="n">global_mean_log</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">_avg</span><span class="p">(</span><span class="s2">"log_amount_sum"</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"g"</span><span class="p">))</span><span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">train_enc</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">merchant_mean</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">"merchant_id"</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">"left"</span><span class="p">)</span> \
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"merchant_mean_log"</span><span class="p">,</span>
                    <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"merchant_mean_log"</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">(),</span> <span class="n">lit</span><span class="p">(</span><span class="n">global_mean_log</span><span class="p">))</span>
                    <span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"merchant_mean_log"</span><span class="p">)))</span>

    <span class="n">test_enc</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">merchant_mean</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">"merchant_id"</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">"left"</span><span class="p">)</span> \
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"merchant_mean_log"</span><span class="p">,</span>
                    <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"merchant_mean_log"</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">(),</span> <span class="n">lit</span><span class="p">(</span><span class="n">global_mean_log</span><span class="p">))</span>
                    <span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"merchant_mean_log"</span><span class="p">)))</span>

    <span class="c1"># ----------------------------------------------------</span>
    <span class="c1"># 11. Features and labels</span>
    <span class="c1"># ----------------------------------------------------</span>

    <span class="n">feature_cols</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">"tx_count"</span><span class="p">,</span> <span class="s2">"amount_avg"</span><span class="p">,</span> <span class="s2">"amount_stddev"</span><span class="p">,</span> <span class="s2">"refund_rate"</span><span class="p">,</span> <span class="s2">"desc_count"</span><span class="p">,</span>
        <span class="s2">"month_sin"</span><span class="p">,</span> <span class="s2">"month_cos"</span><span class="p">,</span> <span class="s2">"year_norm"</span><span class="p">,</span> <span class="s2">"merchant_mean_log"</span>
    <span class="p">]</span>
    <span class="n">label_col</span> <span class="o">=</span> <span class="s2">"log_amount_sum"</span>

    <span class="c1"># Convert to pandas</span>
    <span class="n">train_pd</span> <span class="o">=</span> <span class="n">train_enc</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="o">*</span><span class="n">feature_cols</span><span class="p">,</span> <span class="n">label_col</span><span class="p">)</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">test_pd</span> <span class="o">=</span> <span class="n">test_enc</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="o">*</span><span class="n">feature_cols</span><span class="p">,</span> <span class="n">label_col</span><span class="p">)</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">train_pd</span><span class="p">[</span><span class="n">feature_cols</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">train_pd</span><span class="p">[</span><span class="n">label_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">test_pd</span><span class="p">[</span><span class="n">feature_cols</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">test_pd</span><span class="p">[</span><span class="n">label_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="c1"># ----------------------------------------------------</span>
    <span class="c1"># 12. Run OPTUNA Optimization</span>
    <span class="c1"># ----------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">objective</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"objective"</span><span class="p">:</span> <span class="s2">"regression"</span><span class="p">,</span>
            <span class="s2">"metric"</span><span class="p">:</span> <span class="s2">"rmse"</span><span class="p">,</span>
            <span class="s2">"verbosity"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="s2">"boosting_type"</span><span class="p">:</span> <span class="s2">"gbdt"</span><span class="p">,</span>
            <span class="s2">"learning_rate"</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s2">"learning_rate"</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="s2">"num_leaves"</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s2">"num_leaves"</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
            <span class="s2">"max_depth"</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s2">"max_depth"</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
            <span class="s2">"min_child_samples"</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s2">"min_child_samples"</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
            <span class="s2">"subsample"</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s2">"subsample"</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="s2">"colsample_bytree"</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s2">"colsample_bytree"</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="s2">"lambda_l1"</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s2">"lambda_l1"</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">),</span>
            <span class="s2">"lambda_l2"</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s2">"lambda_l2"</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="n">lgb_train</span> <span class="o">=</span> <span class="n">lgb</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        <span class="n">lgb_val</span> <span class="o">=</span> <span class="n">lgb</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="n">lgb_train</span><span class="p">)</span>

        <span class="n">model</span> <span class="o">=</span> <span class="n">lgb</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
            <span class="n">params</span><span class="p">,</span>
            <span class="n">lgb_train</span><span class="p">,</span>
            <span class="n">valid_sets</span><span class="o">=</span><span class="p">[</span><span class="n">lgb_val</span><span class="p">],</span>
            <span class="n">num_boost_round</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
            <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">lgb</span><span class="o">.</span><span class="n">early_stopping</span><span class="p">(</span><span class="n">stopping_rounds</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>
        <span class="p">)</span>

        <span class="n">preds</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">num_iteration</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">best_iteration</span><span class="p">)</span>
        <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">preds</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">rmse</span>

    <span class="n">study</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">create_study</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s2">"minimize"</span><span class="p">)</span>
    <span class="n">study</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">show_progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">best_params</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">best_params</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Best params for split"</span><span class="p">,</span> <span class="n">year_split</span><span class="p">,</span> <span class="s2">":"</span><span class="p">,</span> <span class="n">best_params</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------</span>
    <span class="c1"># 13. Train final model with best params</span>
    <span class="c1"># ----------------------------------------------------</span>

    <span class="n">final_params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"objective"</span><span class="p">:</span> <span class="s2">"regression"</span><span class="p">,</span>
        <span class="s2">"metric"</span><span class="p">:</span> <span class="s2">"rmse"</span><span class="p">,</span>
        <span class="s2">"verbosity"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="s2">"boosting_type"</span><span class="p">:</span> <span class="s2">"gbdt"</span><span class="p">,</span>
        <span class="o">**</span><span class="n">best_params</span>
    <span class="p">}</span>

    <span class="n">lgb_train</span> <span class="o">=</span> <span class="n">lgb</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">lgb_val</span> <span class="o">=</span> <span class="n">lgb</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="n">lgb_train</span><span class="p">)</span>

    <span class="n">final_model</span> <span class="o">=</span> <span class="n">lgb</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
        <span class="n">final_params</span><span class="p">,</span>
        <span class="n">lgb_train</span><span class="p">,</span>
        <span class="n">valid_sets</span><span class="o">=</span><span class="p">[</span><span class="n">lgb_val</span><span class="p">],</span>
        <span class="n">num_boost_round</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">lgb</span><span class="o">.</span><span class="n">early_stopping</span><span class="p">(</span><span class="n">stopping_rounds</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>
    <span class="p">)</span>

    <span class="c1"># Predictions</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">final_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">num_iteration</span><span class="o">=</span><span class="n">final_model</span><span class="o">.</span><span class="n">best_iteration</span><span class="p">)</span>
    <span class="n">y_true</span> <span class="o">=</span> <span class="n">y_test</span>

    <span class="c1"># Metrics - Tout avec numpy</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">mae</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">))</span>

    <span class="c1"># R calculation</span>
    <span class="n">ss_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">ss_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y_true</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_true</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">ss_res</span> <span class="o">/</span> <span class="n">ss_tot</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Metrics for test year </span><span class="si">{</span><span class="n">year_split</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">:"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  RMSE: </span><span class="si">{</span><span class="n">rmse</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  MAE: </span><span class="si">{</span><span class="n">mae</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  R2: </span><span class="si">{</span><span class="n">r2</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s2">"year_train"</span><span class="p">:</span> <span class="n">year_split</span><span class="p">,</span>
        <span class="s2">"year_test"</span><span class="p">:</span> <span class="n">year_split</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">"rmse"</span><span class="p">:</span> <span class="n">rmse</span><span class="p">,</span>
        <span class="s2">"mae"</span><span class="p">:</span> <span class="n">mae</span><span class="p">,</span>
        <span class="s2">"r2"</span><span class="p">:</span> <span class="n">r2</span><span class="p">,</span>
        <span class="s2">"best_params"</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">best_params</span><span class="p">)</span>
    <span class="p">})</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="c1"># 14. Prediction export for the tested year</span>
    <span class="c1"># -------------------------------------------------------------------------</span>

    <span class="n">test_pd_full</span> <span class="o">=</span> <span class="n">test_enc</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"merchant_id"</span><span class="p">,</span> <span class="s2">"year"</span><span class="p">,</span> <span class="s2">"month"</span><span class="p">,</span> <span class="s2">"ym"</span><span class="p">,</span> <span class="o">*</span><span class="n">feature_cols</span><span class="p">,</span> <span class="n">label_col</span><span class="p">)</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="n">predictions_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s2">"year_train"</span><span class="p">:</span> <span class="p">[</span><span class="n">year_split</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_true</span><span class="p">),</span>
        <span class="s2">"year_test"</span><span class="p">:</span> <span class="p">[</span><span class="n">year_split</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_true</span><span class="p">),</span>
        <span class="s2">"y_true"</span><span class="p">:</span> <span class="n">y_true</span><span class="p">,</span>
        <span class="s2">"y_pred"</span><span class="p">:</span> <span class="n">y_pred</span>
    <span class="p">})</span>

    <span class="c1"># add features</span>
    <span class="n">predictions_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">test_pd_full</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">predictions_df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">output_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"predictions_</span><span class="si">{</span><span class="n">year_split</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">.csv"</span>
    <span class="n">predictions_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Exported predictions for test year </span><span class="si">{</span><span class="n">year_split</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="c1"># Cleanup</span>
    <span class="n">train_df</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>
    <span class="n">test_df</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>
============================================================
Temporal split: train &lt;= 201512 | test: 201601..201612
============================================================
Train rows: 124,922 | Test rows: 125,226
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="application/vnd.jupyter.stderr" tabindex="0">
<pre>[I 2025-11-03 20:32:56,898] A new study created in memory with name: no-name-78948e06-112d-436d-81d8-116b7b2266c8
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>  0%|          | 0/25 [00:00&lt;?, ?it/s]</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>[I 2025-11-03 20:33:07,297] Trial 0 finished with value: 0.060139679274739864 and parameters: {'learning_rate': 0.076490257591669, 'num_leaves': 23, 'max_depth': 5, 'min_child_samples': 28, 'subsample': 0.7939625800229255, 'colsample_bytree': 0.9921470804593396, 'lambda_l1': 8.18989306657841, 'lambda_l2': 4.678278389143211}. Best is trial 0 with value: 0.060139679274739864.
[I 2025-11-03 20:33:25,623] Trial 1 finished with value: 0.054651993729588295 and parameters: {'learning_rate': 0.2582710480149162, 'num_leaves': 168, 'max_depth': 8, 'min_child_samples': 39, 'subsample': 0.6461382690670414, 'colsample_bytree': 0.9370774636597896, 'lambda_l1': 2.178264531678218, 'lambda_l2': 2.2964780045043343}. Best is trial 1 with value: 0.054651993729588295.
[I 2025-11-03 20:33:44,138] Trial 2 finished with value: 0.13469158160349892 and parameters: {'learning_rate': 0.012868214414757785, 'num_leaves': 244, 'max_depth': 5, 'min_child_samples': 36, 'subsample': 0.5871840558030141, 'colsample_bytree': 0.6450979886951298, 'lambda_l1': 0.1838599122088036, 'lambda_l2': 8.927008303848554}. Best is trial 1 with value: 0.054651993729588295.
[I 2025-11-03 20:34:00,854] Trial 3 finished with value: 0.05666457355191319 and parameters: {'learning_rate': 0.0752606992738189, 'num_leaves': 241, 'max_depth': 7, 'min_child_samples': 24, 'subsample': 0.9995157574415425, 'colsample_bytree': 0.7917487595457646, 'lambda_l1': 4.916225832890647, 'lambda_l2': 8.38978959849083}. Best is trial 1 with value: 0.054651993729588295.
[I 2025-11-03 20:34:26,700] Trial 4 finished with value: 0.08603365670567281 and parameters: {'learning_rate': 0.011039156212744764, 'num_leaves': 140, 'max_depth': 12, 'min_child_samples': 30, 'subsample': 0.9186162567899065, 'colsample_bytree': 0.9401897503684559, 'lambda_l1': 4.438320552279684, 'lambda_l2': 8.42764818358403}. Best is trial 1 with value: 0.054651993729588295.
[I 2025-11-03 20:34:49,651] Trial 5 finished with value: 0.04716510771375575 and parameters: {'learning_rate': 0.1457180135033624, 'num_leaves': 77, 'max_depth': 11, 'min_child_samples': 38, 'subsample': 0.7388625290534151, 'colsample_bytree': 0.704802949302193, 'lambda_l1': 0.9944015462840838, 'lambda_l2': 5.3104527501223195}. Best is trial 5 with value: 0.04716510771375575.
[I 2025-11-03 20:35:12,101] Trial 6 finished with value: 0.06802616268049783 and parameters: {'learning_rate': 0.038488036031760126, 'num_leaves': 91, 'max_depth': 15, 'min_child_samples': 9, 'subsample': 0.6025868842892781, 'colsample_bytree': 0.9404738365024257, 'lambda_l1': 6.902137213138472, 'lambda_l2': 2.640821460068116}. Best is trial 5 with value: 0.04716510771375575.
[I 2025-11-03 20:35:32,599] Trial 7 finished with value: 0.05008619020140666 and parameters: {'learning_rate': 0.08997088136558291, 'num_leaves': 170, 'max_depth': 11, 'min_child_samples': 47, 'subsample': 0.7865346182206077, 'colsample_bytree': 0.60478549501459, 'lambda_l1': 3.909405440754977, 'lambda_l2': 1.3823181748989544}. Best is trial 5 with value: 0.04716510771375575.
[I 2025-11-03 20:35:47,220] Trial 8 finished with value: 0.20704020964182646 and parameters: {'learning_rate': 0.02103664388500847, 'num_leaves': 168, 'max_depth': 5, 'min_child_samples': 31, 'subsample': 0.6296158720190803, 'colsample_bytree': 0.5462004477882092, 'lambda_l1': 7.74582611614044, 'lambda_l2': 7.493150146932866}. Best is trial 5 with value: 0.04716510771375575.
[I 2025-11-03 20:36:04,097] Trial 9 finished with value: 0.047220119403954916 and parameters: {'learning_rate': 0.10743346804621735, 'num_leaves': 249, 'max_depth': 7, 'min_child_samples': 43, 'subsample': 0.5263617914512835, 'colsample_bytree': 0.7741427394724387, 'lambda_l1': 1.123288030684536, 'lambda_l2': 6.541433560291061}. Best is trial 5 with value: 0.04716510771375575.
[I 2025-11-03 20:36:24,096] Trial 10 finished with value: 0.05269197775421956 and parameters: {'learning_rate': 0.29115438455441495, 'num_leaves': 53, 'max_depth': 11, 'min_child_samples': 16, 'subsample': 0.737173879926963, 'colsample_bytree': 0.6975441125831255, 'lambda_l1': 2.968412668221106, 'lambda_l2': 4.7107732115811265}. Best is trial 5 with value: 0.04716510771375575.
[I 2025-11-03 20:36:41,943] Trial 11 finished with value: 0.04780191677522102 and parameters: {'learning_rate': 0.14182580479120738, 'num_leaves': 90, 'max_depth': 9, 'min_child_samples': 49, 'subsample': 0.5004236677867777, 'colsample_bytree': 0.7682814323479417, 'lambda_l1': 0.156734478014668, 'lambda_l2': 6.513611001033408}. Best is trial 5 with value: 0.04716510771375575.
[I 2025-11-03 20:37:07,302] Trial 12 finished with value: 0.048516987180613154 and parameters: {'learning_rate': 0.15577895242798975, 'num_leaves': 204, 'max_depth': 14, 'min_child_samples': 41, 'subsample': 0.5082782326035176, 'colsample_bytree': 0.8289330832636733, 'lambda_l1': 2.0228500319639218, 'lambda_l2': 5.900441768656325}. Best is trial 5 with value: 0.04716510771375575.
[I 2025-11-03 20:37:14,804] Trial 13 finished with value: 0.0907747106015231 and parameters: {'learning_rate': 0.04439198869287272, 'num_leaves': 97, 'max_depth': 3, 'min_child_samples': 43, 'subsample': 0.7075235516773024, 'colsample_bytree': 0.7088185532701846, 'lambda_l1': 1.393271107803828, 'lambda_l2': 3.423979921862637}. Best is trial 5 with value: 0.04716510771375575.
[I 2025-11-03 20:37:31,615] Trial 14 finished with value: 0.057047902212825914 and parameters: {'learning_rate': 0.1444723793819925, 'num_leaves': 54, 'max_depth': 7, 'min_child_samples': 35, 'subsample': 0.8655507893363218, 'colsample_bytree': 0.845174971105226, 'lambda_l1': 5.8766479668655975, 'lambda_l2': 0.17732736596386278}. Best is trial 5 with value: 0.04716510771375575.
[I 2025-11-03 20:37:46,501] Trial 15 finished with value: 0.07026759276393688 and parameters: {'learning_rate': 0.18777130754986673, 'num_leaves': 124, 'max_depth': 13, 'min_child_samples': 23, 'subsample': 0.6816677412032132, 'colsample_bytree': 0.7006390020913578, 'lambda_l1': 9.543947317599919, 'lambda_l2': 9.829430159120575}. Best is trial 5 with value: 0.04716510771375575.
[I 2025-11-03 20:38:03,984] Trial 16 finished with value: 0.05498507217130461 and parameters: {'learning_rate': 0.10604883351548644, 'num_leaves': 201, 'max_depth': 10, 'min_child_samples': 44, 'subsample': 0.55204822648058, 'colsample_bytree': 0.5045124124405821, 'lambda_l1': 3.1842647436909575, 'lambda_l2': 6.257610061658599}. Best is trial 5 with value: 0.04716510771375575.
[I 2025-11-03 20:38:23,030] Trial 17 finished with value: 0.047572200371785535 and parameters: {'learning_rate': 0.05452071238400838, 'num_leaves': 56, 'max_depth': 9, 'min_child_samples': 35, 'subsample': 0.862864062329626, 'colsample_bytree': 0.8625504483606604, 'lambda_l1': 1.2756300744015494, 'lambda_l2': 3.850231644059914}. Best is trial 5 with value: 0.04716510771375575.
[I 2025-11-03 20:38:36,398] Trial 18 finished with value: 0.08240189154776631 and parameters: {'learning_rate': 0.02780720567335787, 'num_leaves': 18, 'max_depth': 7, 'min_child_samples': 49, 'subsample': 0.8063778569502568, 'colsample_bytree': 0.6557699768394809, 'lambda_l1': 0.18835487877062995, 'lambda_l2': 7.188178715132793}. Best is trial 5 with value: 0.04716510771375575.
[I 2025-11-03 20:38:45,790] Trial 19 finished with value: 0.05672340223081547 and parameters: {'learning_rate': 0.11923850307962153, 'num_leaves': 126, 'max_depth': 3, 'min_child_samples': 18, 'subsample': 0.6872861938245265, 'colsample_bytree': 0.7407241644194024, 'lambda_l1': 3.2534034676267085, 'lambda_l2': 5.440348933896855}. Best is trial 5 with value: 0.04716510771375575.
[I 2025-11-03 20:39:02,387] Trial 20 finished with value: 0.055056023853564506 and parameters: {'learning_rate': 0.20519122755517905, 'num_leaves': 207, 'max_depth': 10, 'min_child_samples': 38, 'subsample': 0.9945115481085143, 'colsample_bytree': 0.5806952632588427, 'lambda_l1': 5.797064737722029, 'lambda_l2': 6.967947041179326}. Best is trial 5 with value: 0.04716510771375575.
[I 2025-11-03 20:39:22,675] Trial 21 finished with value: 0.04737529989168915 and parameters: {'learning_rate': 0.0623111529039092, 'num_leaves': 67, 'max_depth': 9, 'min_child_samples': 34, 'subsample': 0.913504529516818, 'colsample_bytree': 0.864081920895445, 'lambda_l1': 1.2984373674518412, 'lambda_l2': 3.9022850030488834}. Best is trial 5 with value: 0.04716510771375575.
[I 2025-11-03 20:39:40,471] Trial 22 finished with value: 0.04705012617171667 and parameters: {'learning_rate': 0.06725972573488755, 'num_leaves': 68, 'max_depth': 8, 'min_child_samples': 32, 'subsample': 0.9315612354861995, 'colsample_bytree': 0.8012608340825836, 'lambda_l1': 1.2097928318710112, 'lambda_l2': 4.047713240105348}. Best is trial 22 with value: 0.04705012617171667.
[I 2025-11-03 20:39:58,800] Trial 23 finished with value: 0.050729309007483236 and parameters: {'learning_rate': 0.10321344142326924, 'num_leaves': 107, 'max_depth': 8, 'min_child_samples': 45, 'subsample': 0.8504330494057206, 'colsample_bytree': 0.7956196575505581, 'lambda_l1': 2.165101322055048, 'lambda_l2': 5.030958569226565}. Best is trial 22 with value: 0.04705012617171667.
[I 2025-11-03 20:40:15,055] Trial 24 finished with value: 0.0466530450260916 and parameters: {'learning_rate': 0.056212793690699765, 'num_leaves': 74, 'max_depth': 6, 'min_child_samples': 41, 'subsample': 0.9501483999696786, 'colsample_bytree': 0.7286220438170226, 'lambda_l1': 0.9104150495563351, 'lambda_l2': 3.0479658216835035}. Best is trial 24 with value: 0.0466530450260916.
Best params for split 2015 : {'learning_rate': 0.056212793690699765, 'num_leaves': 74, 'max_depth': 6, 'min_child_samples': 41, 'subsample': 0.9501483999696786, 'colsample_bytree': 0.7286220438170226, 'lambda_l1': 0.9104150495563351, 'lambda_l2': 3.0479658216835035}

Metrics for test year 2016:
  RMSE: 0.0467
  MAE: 0.0231
  R2: 0.9990
Exported predictions for test year 2016 -&gt; predictions_2016.csv

============================================================
Temporal split: train &lt;= 201612 | test: 201701..201712
============================================================
Train rows: 250,148 | Test rows: 125,659
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="application/vnd.jupyter.stderr" tabindex="0">
<pre>[I 2025-11-03 20:40:49,784] A new study created in memory with name: no-name-719ca7d9-555f-4604-9458-1dbca188f6dc
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>  0%|          | 0/25 [00:00&lt;?, ?it/s]</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>[I 2025-11-03 20:41:23,973] Trial 0 finished with value: 0.04632111219027969 and parameters: {'learning_rate': 0.07160314309209334, 'num_leaves': 182, 'max_depth': 15, 'min_child_samples': 44, 'subsample': 0.9220130681034786, 'colsample_bytree': 0.8933279395314173, 'lambda_l1': 5.744650854749844, 'lambda_l2': 8.809095427704758}. Best is trial 0 with value: 0.04632111219027969.
[I 2025-11-03 20:41:47,221] Trial 1 finished with value: 0.06133274606732788 and parameters: {'learning_rate': 0.02836354598707781, 'num_leaves': 241, 'max_depth': 6, 'min_child_samples': 34, 'subsample': 0.5813999060399747, 'colsample_bytree': 0.5865304931638449, 'lambda_l1': 0.84604852483252, 'lambda_l2': 7.187685952505913}. Best is trial 0 with value: 0.04632111219027969.
[I 2025-11-03 20:42:17,451] Trial 2 finished with value: 0.05472570254399032 and parameters: {'learning_rate': 0.02493071852912228, 'num_leaves': 193, 'max_depth': 11, 'min_child_samples': 43, 'subsample': 0.8168852172614569, 'colsample_bytree': 0.7202351077497415, 'lambda_l1': 7.455372683218881, 'lambda_l2': 8.935528659743193}. Best is trial 0 with value: 0.04632111219027969.
[I 2025-11-03 20:42:43,265] Trial 3 finished with value: 0.04251428673336407 and parameters: {'learning_rate': 0.12818640170696127, 'num_leaves': 59, 'max_depth': 10, 'min_child_samples': 9, 'subsample': 0.7168662539204294, 'colsample_bytree': 0.7728901732821691, 'lambda_l1': 2.194389201711686, 'lambda_l2': 3.607273661885013}. Best is trial 3 with value: 0.04251428673336407.
[I 2025-11-03 20:43:16,260] Trial 4 finished with value: 0.054776355751165476 and parameters: {'learning_rate': 0.023011298910066383, 'num_leaves': 92, 'max_depth': 13, 'min_child_samples': 20, 'subsample': 0.789244851098893, 'colsample_bytree': 0.9388011690005287, 'lambda_l1': 7.707761593820298, 'lambda_l2': 7.210909237317958}. Best is trial 3 with value: 0.04251428673336407.
[I 2025-11-03 20:43:37,248] Trial 5 finished with value: 0.05433591481776095 and parameters: {'learning_rate': 0.03037489838197789, 'num_leaves': 94, 'max_depth': 6, 'min_child_samples': 29, 'subsample': 0.717453793104114, 'colsample_bytree': 0.7005178114274027, 'lambda_l1': 6.955224594426811, 'lambda_l2': 0.7786236076272601}. Best is trial 3 with value: 0.04251428673336407.
[I 2025-11-03 20:43:52,645] Trial 6 finished with value: 0.05513963039075313 and parameters: {'learning_rate': 0.051514912266846534, 'num_leaves': 97, 'max_depth': 4, 'min_child_samples': 38, 'subsample': 0.9091178394700736, 'colsample_bytree': 0.7031970759939535, 'lambda_l1': 7.069666574994876, 'lambda_l2': 6.59866392246636}. Best is trial 3 with value: 0.04251428673336407.
[I 2025-11-03 20:44:17,116] Trial 7 finished with value: 0.04909610346327456 and parameters: {'learning_rate': 0.05027686156900511, 'num_leaves': 59, 'max_depth': 9, 'min_child_samples': 19, 'subsample': 0.5768424805746206, 'colsample_bytree': 0.5661067081881774, 'lambda_l1': 8.914355445335874, 'lambda_l2': 3.567147392381258}. Best is trial 3 with value: 0.04251428673336407.
[I 2025-11-03 20:44:39,736] Trial 8 finished with value: 0.03873808144906869 and parameters: {'learning_rate': 0.11975950342551953, 'num_leaves': 164, 'max_depth': 7, 'min_child_samples': 28, 'subsample': 0.5210252025864097, 'colsample_bytree': 0.6918706551459641, 'lambda_l1': 1.1282659879477375, 'lambda_l2': 7.190306601860703}. Best is trial 8 with value: 0.03873808144906869.
[I 2025-11-03 20:44:53,086] Trial 9 finished with value: 0.2015104964805937 and parameters: {'learning_rate': 0.011867656852350491, 'num_leaves': 253, 'max_depth': 3, 'min_child_samples': 9, 'subsample': 0.9725130416110652, 'colsample_bytree': 0.9110407163774481, 'lambda_l1': 1.6551571686204614, 'lambda_l2': 7.811631986606478}. Best is trial 8 with value: 0.03873808144906869.
[I 2025-11-03 20:45:13,352] Trial 10 finished with value: 0.044710827105995166 and parameters: {'learning_rate': 0.2630525295644748, 'num_leaves': 157, 'max_depth': 7, 'min_child_samples': 20, 'subsample': 0.5187548187282549, 'colsample_bytree': 0.5002667303888002, 'lambda_l1': 3.5152829544629736, 'lambda_l2': 4.899879236973753}. Best is trial 8 with value: 0.03873808144906869.
[I 2025-11-03 20:45:38,577] Trial 11 finished with value: 0.04255139324245287 and parameters: {'learning_rate': 0.1712800796087069, 'num_leaves': 50, 'max_depth': 9, 'min_child_samples': 6, 'subsample': 0.6924934394210798, 'colsample_bytree': 0.7970053043762927, 'lambda_l1': 3.009026871948892, 'lambda_l2': 2.354677485207648}. Best is trial 8 with value: 0.03873808144906869.
[I 2025-11-03 20:45:53,442] Trial 12 finished with value: 0.041553189920725396 and parameters: {'learning_rate': 0.12075393404300924, 'num_leaves': 16, 'max_depth': 12, 'min_child_samples': 13, 'subsample': 0.6468344462959484, 'colsample_bytree': 0.8058209837752345, 'lambda_l1': 0.3141605406665038, 'lambda_l2': 4.855120891430721}. Best is trial 8 with value: 0.03873808144906869.
[I 2025-11-03 20:46:07,947] Trial 13 finished with value: 0.03872562065709963 and parameters: {'learning_rate': 0.11019544041058582, 'num_leaves': 16, 'max_depth': 12, 'min_child_samples': 26, 'subsample': 0.6224717092446601, 'colsample_bytree': 0.8431835194234629, 'lambda_l1': 0.23573620835226805, 'lambda_l2': 5.0598510820472}. Best is trial 13 with value: 0.03872562065709963.
[I 2025-11-03 20:46:43,800] Trial 14 finished with value: 0.04525310362288004 and parameters: {'learning_rate': 0.08378139961832015, 'num_leaves': 132, 'max_depth': 14, 'min_child_samples': 27, 'subsample': 0.5345063251135901, 'colsample_bytree': 0.8464692762730509, 'lambda_l1': 4.641099306777784, 'lambda_l2': 6.004010864962575}. Best is trial 13 with value: 0.03872562065709963.
[I 2025-11-03 20:47:08,188] Trial 15 finished with value: 0.03587889194690827 and parameters: {'learning_rate': 0.18663697064881696, 'num_leaves': 207, 'max_depth': 8, 'min_child_samples': 28, 'subsample': 0.623915115776402, 'colsample_bytree': 0.629993744508443, 'lambda_l1': 0.10624110696739297, 'lambda_l2': 9.87857755355548}. Best is trial 15 with value: 0.03587889194690827.
[I 2025-11-03 20:47:39,485] Trial 16 finished with value: 0.03818446300665162 and parameters: {'learning_rate': 0.2721852270209374, 'num_leaves': 214, 'max_depth': 11, 'min_child_samples': 49, 'subsample': 0.6345000950378225, 'colsample_bytree': 0.6244843478358252, 'lambda_l1': 0.2635984947773711, 'lambda_l2': 9.84468879180248}. Best is trial 15 with value: 0.03587889194690827.
[I 2025-11-03 20:48:02,470] Trial 17 finished with value: 0.04632892084951559 and parameters: {'learning_rate': 0.29672726099918073, 'num_leaves': 218, 'max_depth': 8, 'min_child_samples': 50, 'subsample': 0.6463907238556031, 'colsample_bytree': 0.6291278897548863, 'lambda_l1': 2.7568777934129858, 'lambda_l2': 9.96381651740543}. Best is trial 15 with value: 0.03587889194690827.
[I 2025-11-03 20:48:29,494] Trial 18 finished with value: 0.04414905243788397 and parameters: {'learning_rate': 0.20190464339838457, 'num_leaves': 211, 'max_depth': 10, 'min_child_samples': 50, 'subsample': 0.7678691343047302, 'colsample_bytree': 0.6218049378082752, 'lambda_l1': 4.062804883828537, 'lambda_l2': 9.97408970802261}. Best is trial 15 with value: 0.03587889194690827.
[I 2025-11-03 20:48:45,735] Trial 19 finished with value: 0.04529680527108599 and parameters: {'learning_rate': 0.19788630468602733, 'num_leaves': 224, 'max_depth': 5, 'min_child_samples': 35, 'subsample': 0.5958290004144263, 'colsample_bytree': 0.5429432222159319, 'lambda_l1': 5.627815641627425, 'lambda_l2': 8.379795261956312}. Best is trial 15 with value: 0.03587889194690827.
[I 2025-11-03 20:49:09,056] Trial 20 finished with value: 0.04950206704619459 and parameters: {'learning_rate': 0.1829005767181756, 'num_leaves': 132, 'max_depth': 10, 'min_child_samples': 45, 'subsample': 0.8392630610684972, 'colsample_bytree': 0.6461238937416885, 'lambda_l1': 9.985199218360147, 'lambda_l2': 9.27962735756091}. Best is trial 15 with value: 0.03587889194690827.
[I 2025-11-03 20:49:39,377] Trial 21 finished with value: 0.04042661972679574 and parameters: {'learning_rate': 0.10365935975016957, 'num_leaves': 192, 'max_depth': 12, 'min_child_samples': 26, 'subsample': 0.6273158221737513, 'colsample_bytree': 0.9794340721349789, 'lambda_l1': 0.00676537596001775, 'lambda_l2': 0.658059588189742}. Best is trial 15 with value: 0.03587889194690827.
[I 2025-11-03 20:50:13,619] Trial 22 finished with value: 0.03992114546751811 and parameters: {'learning_rate': 0.1503055354133726, 'num_leaves': 151, 'max_depth': 12, 'min_child_samples': 23, 'subsample': 0.6780450842429485, 'colsample_bytree': 0.8579547953232295, 'lambda_l1': 1.5505415382892498, 'lambda_l2': 6.1842839093493644}. Best is trial 15 with value: 0.03587889194690827.
[I 2025-11-03 20:50:28,818] Trial 23 finished with value: 0.03710793861951079 and parameters: {'learning_rate': 0.24581221723174765, 'num_leaves': 22, 'max_depth': 14, 'min_child_samples': 32, 'subsample': 0.61059331958505, 'colsample_bytree': 0.6678012841303034, 'lambda_l1': 0.05483073036471031, 'lambda_l2': 1.9303860057914939}. Best is trial 15 with value: 0.03587889194690827.
[I 2025-11-03 20:51:04,535] Trial 24 finished with value: 0.04203005899854632 and parameters: {'learning_rate': 0.23952903108125523, 'num_leaves': 235, 'max_depth': 15, 'min_child_samples': 33, 'subsample': 0.551319187814665, 'colsample_bytree': 0.6591237258614339, 'lambda_l1': 2.105720269001668, 'lambda_l2': 1.4121070081977596}. Best is trial 15 with value: 0.03587889194690827.
Best params for split 2016 : {'learning_rate': 0.18663697064881696, 'num_leaves': 207, 'max_depth': 8, 'min_child_samples': 28, 'subsample': 0.623915115776402, 'colsample_bytree': 0.629993744508443, 'lambda_l1': 0.10624110696739297, 'lambda_l2': 9.87857755355548}

Metrics for test year 2017:
  RMSE: 0.0359
  MAE: 0.0182
  R2: 0.9994
Exported predictions for test year 2017 -&gt; predictions_2017.csv

============================================================
Temporal split: train &lt;= 201712 | test: 201801..201812
============================================================
Train rows: 375,807 | Test rows: 125,625
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="application/vnd.jupyter.stderr" tabindex="0">
<pre>[I 2025-11-03 20:51:46,421] A new study created in memory with name: no-name-7e3f8a98-f830-46c2-9a24-87bb5417b3f3
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>  0%|          | 0/25 [00:00&lt;?, ?it/s]</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>[I 2025-11-03 20:52:16,292] Trial 0 finished with value: 0.035871560364749276 and parameters: {'learning_rate': 0.051613510444016346, 'num_leaves': 175, 'max_depth': 7, 'min_child_samples': 27, 'subsample': 0.9330008942226613, 'colsample_bytree': 0.5615334379450214, 'lambda_l1': 0.4442775923464537, 'lambda_l2': 8.251853395350517}. Best is trial 0 with value: 0.035871560364749276.
[I 2025-11-03 20:52:46,319] Trial 1 finished with value: 0.042283267531362356 and parameters: {'learning_rate': 0.0574769811947897, 'num_leaves': 87, 'max_depth': 9, 'min_child_samples': 33, 'subsample': 0.6580856804754907, 'colsample_bytree': 0.5186245000438976, 'lambda_l1': 7.265993151688781, 'lambda_l2': 1.8643156786766724}. Best is trial 0 with value: 0.035871560364749276.
[I 2025-11-03 20:53:07,362] Trial 2 finished with value: 0.03520499823965899 and parameters: {'learning_rate': 0.21833014487976757, 'num_leaves': 224, 'max_depth': 5, 'min_child_samples': 18, 'subsample': 0.7839191570949361, 'colsample_bytree': 0.6884590054464033, 'lambda_l1': 0.07392253322102249, 'lambda_l2': 0.40671570624012277}. Best is trial 2 with value: 0.03520499823965899.
[I 2025-11-03 20:53:25,351] Trial 3 finished with value: 0.04196611363516578 and parameters: {'learning_rate': 0.12878028267463582, 'num_leaves': 65, 'max_depth': 4, 'min_child_samples': 47, 'subsample': 0.5996198100202903, 'colsample_bytree': 0.8815974919940414, 'lambda_l1': 6.488480520657072, 'lambda_l2': 4.844900940367619}. Best is trial 2 with value: 0.03520499823965899.
[I 2025-11-03 20:54:06,033] Trial 4 finished with value: 0.043538118954995854 and parameters: {'learning_rate': 0.024661912881665755, 'num_leaves': 170, 'max_depth': 9, 'min_child_samples': 12, 'subsample': 0.5269170620227556, 'colsample_bytree': 0.8293228530115955, 'lambda_l1': 4.44933534931566, 'lambda_l2': 5.413212946015445}. Best is trial 2 with value: 0.03520499823965899.
[I 2025-11-03 20:54:46,768] Trial 5 finished with value: 0.0416973023272467 and parameters: {'learning_rate': 0.06534551364614952, 'num_leaves': 101, 'max_depth': 12, 'min_child_samples': 44, 'subsample': 0.7805578786615099, 'colsample_bytree': 0.7421784527672672, 'lambda_l1': 6.005044743571379, 'lambda_l2': 5.054866184580314}. Best is trial 2 with value: 0.03520499823965899.
[I 2025-11-03 20:55:10,717] Trial 6 finished with value: 0.041373387056122354 and parameters: {'learning_rate': 0.05233823019912856, 'num_leaves': 34, 'max_depth': 15, 'min_child_samples': 47, 'subsample': 0.802705850852262, 'colsample_bytree': 0.542140949082718, 'lambda_l1': 0.7400066019665075, 'lambda_l2': 6.123888633450582}. Best is trial 2 with value: 0.03520499823965899.
[I 2025-11-03 20:55:50,891] Trial 7 finished with value: 0.04863176134793499 and parameters: {'learning_rate': 0.020164660486546585, 'num_leaves': 155, 'max_depth': 9, 'min_child_samples': 43, 'subsample': 0.7653482636306397, 'colsample_bytree': 0.6246119687546792, 'lambda_l1': 0.7694619579509032, 'lambda_l2': 5.588236318391968}. Best is trial 2 with value: 0.03520499823965899.
[I 2025-11-03 20:56:25,210] Trial 8 finished with value: 0.04180687672089937 and parameters: {'learning_rate': 0.03592122298928411, 'num_leaves': 112, 'max_depth': 9, 'min_child_samples': 32, 'subsample': 0.5284923429175068, 'colsample_bytree': 0.5761104978942777, 'lambda_l1': 1.2577786923957512, 'lambda_l2': 0.3225709335721161}. Best is trial 2 with value: 0.03520499823965899.
[I 2025-11-03 20:57:01,537] Trial 9 finished with value: 0.046896000882135296 and parameters: {'learning_rate': 0.032800005969953, 'num_leaves': 232, 'max_depth': 13, 'min_child_samples': 43, 'subsample': 0.8511803104804936, 'colsample_bytree': 0.5726344522073534, 'lambda_l1': 4.456807130801426, 'lambda_l2': 3.700957483498315}. Best is trial 2 with value: 0.03520499823965899.
[I 2025-11-03 20:57:14,091] Trial 10 finished with value: 0.052105051599286696 and parameters: {'learning_rate': 0.2398045543369124, 'num_leaves': 245, 'max_depth': 3, 'min_child_samples': 5, 'subsample': 0.9351924704795457, 'colsample_bytree': 0.7023879055754664, 'lambda_l1': 9.653624384645525, 'lambda_l2': 0.026184894872152253}. Best is trial 2 with value: 0.03520499823965899.
[I 2025-11-03 20:57:35,177] Trial 11 finished with value: 0.03986532948624216 and parameters: {'learning_rate': 0.11311187906424434, 'num_leaves': 198, 'max_depth': 5, 'min_child_samples': 20, 'subsample': 0.9457558408870888, 'colsample_bytree': 0.9960231751822942, 'lambda_l1': 2.640946837865488, 'lambda_l2': 8.237313507477612}. Best is trial 2 with value: 0.03520499823965899.
[I 2025-11-03 20:58:03,260] Trial 12 finished with value: 0.03975379013420043 and parameters: {'learning_rate': 0.2869480039807418, 'num_leaves': 200, 'max_depth': 7, 'min_child_samples': 23, 'subsample': 0.9885195241952774, 'colsample_bytree': 0.6717114223951335, 'lambda_l1': 2.8134614502011583, 'lambda_l2': 9.929255244440846}. Best is trial 2 with value: 0.03520499823965899.
[I 2025-11-03 20:58:39,427] Trial 13 finished with value: 0.103961687084806 and parameters: {'learning_rate': 0.01030289251497337, 'num_leaves': 192, 'max_depth': 7, 'min_child_samples': 17, 'subsample': 0.8778570706840733, 'colsample_bytree': 0.6400461318857857, 'lambda_l1': 0.11342963981948463, 'lambda_l2': 7.630789006306603}. Best is trial 2 with value: 0.03520499823965899.
[I 2025-11-03 20:59:02,809] Trial 14 finished with value: 0.038819454999064563 and parameters: {'learning_rate': 0.1328375697768406, 'num_leaves': 141, 'max_depth': 6, 'min_child_samples': 27, 'subsample': 0.6693744149145713, 'colsample_bytree': 0.8028912842021768, 'lambda_l1': 2.464574396743612, 'lambda_l2': 2.67067447882373}. Best is trial 2 with value: 0.03520499823965899.
[I 2025-11-03 20:59:30,338] Trial 15 finished with value: 0.037079749683769765 and parameters: {'learning_rate': 0.08472639238871825, 'num_leaves': 222, 'max_depth': 6, 'min_child_samples': 13, 'subsample': 0.7062964424843748, 'colsample_bytree': 0.6209561518107004, 'lambda_l1': 2.019906045717165, 'lambda_l2': 7.6356292992389525}. Best is trial 2 with value: 0.03520499823965899.
[I 2025-11-03 20:59:47,561] Trial 16 finished with value: 0.04165389369415789 and parameters: {'learning_rate': 0.18796369341001332, 'num_leaves': 177, 'max_depth': 4, 'min_child_samples': 34, 'subsample': 0.8593987849816618, 'colsample_bytree': 0.5049892523638526, 'lambda_l1': 3.2599151118516576, 'lambda_l2': 9.85167796066632}. Best is trial 2 with value: 0.03520499823965899.
[I 2025-11-03 21:00:21,202] Trial 17 finished with value: 0.09123003737648314 and parameters: {'learning_rate': 0.0113923970265782, 'num_leaves': 216, 'max_depth': 7, 'min_child_samples': 26, 'subsample': 0.9189634893166071, 'colsample_bytree': 0.7087284446904867, 'lambda_l1': 0.12079998637933002, 'lambda_l2': 1.994583460064228}. Best is trial 2 with value: 0.03520499823965899.
[I 2025-11-03 21:00:55,936] Trial 18 finished with value: 0.043680220051188386 and parameters: {'learning_rate': 0.08770887358114607, 'num_leaves': 253, 'max_depth': 11, 'min_child_samples': 6, 'subsample': 0.7296870460011285, 'colsample_bytree': 0.7632454819460371, 'lambda_l1': 8.565500237346118, 'lambda_l2': 6.65669866642539}. Best is trial 2 with value: 0.03520499823965899.
[I 2025-11-03 21:01:09,522] Trial 19 finished with value: 0.04527202615596242 and parameters: {'learning_rate': 0.17251797779116407, 'num_leaves': 122, 'max_depth': 3, 'min_child_samples': 36, 'subsample': 0.9954605192934194, 'colsample_bytree': 0.9335237867015247, 'lambda_l1': 4.067671027839851, 'lambda_l2': 3.429991823148894}. Best is trial 2 with value: 0.03520499823965899.
[I 2025-11-03 21:01:44,775] Trial 20 finished with value: 0.03993332895292652 and parameters: {'learning_rate': 0.03948116586792747, 'num_leaves': 152, 'max_depth': 11, 'min_child_samples': 17, 'subsample': 0.8249448485223857, 'colsample_bytree': 0.585224882410027, 'lambda_l1': 1.487596902983455, 'lambda_l2': 8.68852627029188}. Best is trial 2 with value: 0.03520499823965899.
[I 2025-11-03 21:02:10,713] Trial 21 finished with value: 0.03717866461092767 and parameters: {'learning_rate': 0.09878393424593476, 'num_leaves': 215, 'max_depth': 6, 'min_child_samples': 13, 'subsample': 0.7061035495628246, 'colsample_bytree': 0.6270276373575047, 'lambda_l1': 2.0356234185363435, 'lambda_l2': 7.638389108004672}. Best is trial 2 with value: 0.03520499823965899.
[I 2025-11-03 21:02:33,010] Trial 22 finished with value: 0.03898211979684881 and parameters: {'learning_rate': 0.07142177199254408, 'num_leaves': 229, 'max_depth': 5, 'min_child_samples': 11, 'subsample': 0.617746434464914, 'colsample_bytree': 0.6645172979328448, 'lambda_l1': 1.524720153807959, 'lambda_l2': 6.7894875731684765}. Best is trial 2 with value: 0.03520499823965899.
[I 2025-11-03 21:03:05,949] Trial 23 finished with value: 0.03250295931239628 and parameters: {'learning_rate': 0.08248031414209436, 'num_leaves': 179, 'max_depth': 8, 'min_child_samples': 22, 'subsample': 0.707063753775236, 'colsample_bytree': 0.6082481577690402, 'lambda_l1': 0.3964241441943502, 'lambda_l2': 9.01725999682326}. Best is trial 23 with value: 0.03250295931239628.
[I 2025-11-03 21:03:34,876] Trial 24 finished with value: 0.03287475226986765 and parameters: {'learning_rate': 0.1726804187517622, 'num_leaves': 178, 'max_depth': 8, 'min_child_samples': 25, 'subsample': 0.899839371809489, 'colsample_bytree': 0.5543005207996052, 'lambda_l1': 0.1330483646776187, 'lambda_l2': 9.119679951736282}. Best is trial 23 with value: 0.03250295931239628.
Best params for split 2017 : {'learning_rate': 0.08248031414209436, 'num_leaves': 179, 'max_depth': 8, 'min_child_samples': 22, 'subsample': 0.707063753775236, 'colsample_bytree': 0.6082481577690402, 'lambda_l1': 0.3964241441943502, 'lambda_l2': 9.01725999682326}

Metrics for test year 2018:
  RMSE: 0.0325
  MAE: 0.0154
  R2: 0.9995
Exported predictions for test year 2018 -&gt; predictions_2018.csv

============================================================
Temporal split: train &lt;= 201812 | test: 201901..201910
============================================================
Train rows: 501,432 | Test rows: 104,736
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="application/vnd.jupyter.stderr" tabindex="0">
<pre>[I 2025-11-03 21:04:29,068] A new study created in memory with name: no-name-81b8d319-7e10-4ab1-b920-55f9c3628f8f
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>  0%|          | 0/25 [00:00&lt;?, ?it/s]</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>[I 2025-11-03 21:05:14,751] Trial 0 finished with value: 0.04884180140054054 and parameters: {'learning_rate': 0.02027298569730179, 'num_leaves': 78, 'max_depth': 15, 'min_child_samples': 35, 'subsample': 0.603000387628423, 'colsample_bytree': 0.7286468483410968, 'lambda_l1': 5.746132448629176, 'lambda_l2': 5.379884474355032}. Best is trial 0 with value: 0.04884180140054054.
[I 2025-11-03 21:06:05,062] Trial 1 finished with value: 0.03845331793181127 and parameters: {'learning_rate': 0.07138609306276979, 'num_leaves': 207, 'max_depth': 15, 'min_child_samples': 27, 'subsample': 0.8870753079016321, 'colsample_bytree': 0.7752813116245643, 'lambda_l1': 6.256504945196257, 'lambda_l2': 8.835961353006315}. Best is trial 1 with value: 0.03845331793181127.
[I 2025-11-03 21:06:50,154] Trial 2 finished with value: 0.03358731105099362 and parameters: {'learning_rate': 0.07807766073052358, 'num_leaves': 238, 'max_depth': 15, 'min_child_samples': 24, 'subsample': 0.5547556341620397, 'colsample_bytree': 0.5726150348023649, 'lambda_l1': 1.8056236016773008, 'lambda_l2': 2.890474303344602}. Best is trial 2 with value: 0.03358731105099362.
[I 2025-11-03 21:07:28,610] Trial 3 finished with value: 0.04492456046085282 and parameters: {'learning_rate': 0.02706735125638705, 'num_leaves': 213, 'max_depth': 7, 'min_child_samples': 39, 'subsample': 0.9652571435378121, 'colsample_bytree': 0.7097674937411805, 'lambda_l1': 3.6279106605332503, 'lambda_l2': 3.118511564337163}. Best is trial 2 with value: 0.03358731105099362.
[I 2025-11-03 21:08:01,303] Trial 4 finished with value: 0.05685787001818877 and parameters: {'learning_rate': 0.02792540582592622, 'num_leaves': 65, 'max_depth': 9, 'min_child_samples': 8, 'subsample': 0.7982296548248327, 'colsample_bytree': 0.5813343034652602, 'lambda_l1': 5.033062245150717, 'lambda_l2': 9.122889913869015}. Best is trial 2 with value: 0.03358731105099362.
[I 2025-11-03 21:08:35,252] Trial 5 finished with value: 0.03340560939643125 and parameters: {'learning_rate': 0.1313532531859879, 'num_leaves': 75, 'max_depth': 13, 'min_child_samples': 15, 'subsample': 0.7704001793681251, 'colsample_bytree': 0.5943207750640616, 'lambda_l1': 2.0246998631546544, 'lambda_l2': 5.871686411076235}. Best is trial 5 with value: 0.03340560939643125.
[I 2025-11-03 21:09:12,444] Trial 6 finished with value: 0.04015266148031862 and parameters: {'learning_rate': 0.09526320163378516, 'num_leaves': 64, 'max_depth': 12, 'min_child_samples': 9, 'subsample': 0.9832498006724523, 'colsample_bytree': 0.7706613569708302, 'lambda_l1': 6.92737578386697, 'lambda_l2': 3.853606221672017}. Best is trial 5 with value: 0.03340560939643125.
[I 2025-11-03 21:09:39,492] Trial 7 finished with value: 0.07408158921419845 and parameters: {'learning_rate': 0.026967698913151494, 'num_leaves': 188, 'max_depth': 5, 'min_child_samples': 23, 'subsample': 0.8505653002865128, 'colsample_bytree': 0.6082903650471524, 'lambda_l1': 1.2326051325341136, 'lambda_l2': 6.6388242228098795}. Best is trial 5 with value: 0.03340560939643125.
[I 2025-11-03 21:10:10,899] Trial 8 finished with value: 0.03200741706667386 and parameters: {'learning_rate': 0.05406291206542523, 'num_leaves': 68, 'max_depth': 13, 'min_child_samples': 7, 'subsample': 0.5949596345457282, 'colsample_bytree': 0.8600734031944522, 'lambda_l1': 0.313252707411783, 'lambda_l2': 5.420769818312312}. Best is trial 8 with value: 0.03200741706667386.
[I 2025-11-03 21:10:49,994] Trial 9 finished with value: 0.04065820204987017 and parameters: {'learning_rate': 0.041526550435144215, 'num_leaves': 210, 'max_depth': 10, 'min_child_samples': 38, 'subsample': 0.8345017547604627, 'colsample_bytree': 0.6838068236304934, 'lambda_l1': 7.686702810382151, 'lambda_l2': 9.214895449412955}. Best is trial 8 with value: 0.03200741706667386.
[I 2025-11-03 21:11:06,273] Trial 10 finished with value: 0.04568308587795758 and parameters: {'learning_rate': 0.28084811684755756, 'num_leaves': 19, 'max_depth': 3, 'min_child_samples': 50, 'subsample': 0.6633250804732702, 'colsample_bytree': 0.9363143888493792, 'lambda_l1': 9.410178333726194, 'lambda_l2': 0.6864054917491558}. Best is trial 8 with value: 0.03200741706667386.
[I 2025-11-03 21:11:37,040] Trial 11 finished with value: 0.03240891380058664 and parameters: {'learning_rate': 0.16625234329458385, 'num_leaves': 124, 'max_depth': 12, 'min_child_samples': 16, 'subsample': 0.7047295567831885, 'colsample_bytree': 0.9003958976253186, 'lambda_l1': 0.3739082914458336, 'lambda_l2': 6.860191320359687}. Best is trial 8 with value: 0.03200741706667386.
[I 2025-11-03 21:12:22,502] Trial 12 finished with value: 0.04798750297046849 and parameters: {'learning_rate': 0.01223508945775223, 'num_leaves': 133, 'max_depth': 12, 'min_child_samples': 16, 'subsample': 0.66815491929785, 'colsample_bytree': 0.9124496223539145, 'lambda_l1': 0.25554572876707987, 'lambda_l2': 7.045672080249634}. Best is trial 8 with value: 0.03200741706667386.
[I 2025-11-03 21:13:02,113] Trial 13 finished with value: 0.03687000566400437 and parameters: {'learning_rate': 0.19041035970803225, 'num_leaves': 130, 'max_depth': 10, 'min_child_samples': 5, 'subsample': 0.6942915743636445, 'colsample_bytree': 0.8589484255157313, 'lambda_l1': 3.3455268426941593, 'lambda_l2': 7.395636273023691}. Best is trial 8 with value: 0.03200741706667386.
[I 2025-11-03 21:13:31,615] Trial 14 finished with value: 0.03209456351382907 and parameters: {'learning_rate': 0.054242359838578315, 'num_leaves': 106, 'max_depth': 13, 'min_child_samples': 16, 'subsample': 0.5123569653331673, 'colsample_bytree': 0.9923671632087563, 'lambda_l1': 0.0463857212028671, 'lambda_l2': 4.419617905553989}. Best is trial 8 with value: 0.03200741706667386.
[I 2025-11-03 21:13:54,843] Trial 15 finished with value: 0.046040422610321395 and parameters: {'learning_rate': 0.047890576738542474, 'num_leaves': 15, 'max_depth': 13, 'min_child_samples': 12, 'subsample': 0.5030490992714804, 'colsample_bytree': 0.835487879459483, 'lambda_l1': 2.925533188665476, 'lambda_l2': 4.336791873113592}. Best is trial 8 with value: 0.03200741706667386.
[I 2025-11-03 21:14:24,691] Trial 16 finished with value: 0.03277669600135339 and parameters: {'learning_rate': 0.05202905092996795, 'num_leaves': 101, 'max_depth': 8, 'min_child_samples': 20, 'subsample': 0.601457440107224, 'colsample_bytree': 0.9920039918828266, 'lambda_l1': 0.2376025668457391, 'lambda_l2': 1.9376960626082615}. Best is trial 8 with value: 0.03200741706667386.
[I 2025-11-03 21:14:49,147] Trial 17 finished with value: 0.03578648233115458 and parameters: {'learning_rate': 0.10641938141282148, 'num_leaves': 46, 'max_depth': 11, 'min_child_samples': 6, 'subsample': 0.5042004084243762, 'colsample_bytree': 0.9716789488782309, 'lambda_l1': 2.4533438205691525, 'lambda_l2': 4.795407266066152}. Best is trial 8 with value: 0.03200741706667386.
[I 2025-11-03 21:15:36,612] Trial 18 finished with value: 0.03799340949734713 and parameters: {'learning_rate': 0.037743365739578476, 'num_leaves': 166, 'max_depth': 14, 'min_child_samples': 30, 'subsample': 0.5892634237849198, 'colsample_bytree': 0.8410140120255261, 'lambda_l1': 4.351073422971963, 'lambda_l2': 1.6868221251247535}. Best is trial 8 with value: 0.03200741706667386.
[I 2025-11-03 21:16:15,834] Trial 19 finished with value: 0.05140214152041259 and parameters: {'learning_rate': 0.013551046379238457, 'num_leaves': 103, 'max_depth': 7, 'min_child_samples': 12, 'subsample': 0.5401988876904595, 'colsample_bytree': 0.9406709330563656, 'lambda_l1': 1.0573217476476475, 'lambda_l2': 5.710922781334721}. Best is trial 8 with value: 0.03200741706667386.
[I 2025-11-03 21:16:50,281] Trial 20 finished with value: 0.04152076198786266 and parameters: {'learning_rate': 0.06559155444903964, 'num_leaves': 108, 'max_depth': 13, 'min_child_samples': 21, 'subsample': 0.6536969370869609, 'colsample_bytree': 0.5189240433840052, 'lambda_l1': 9.502866177339858, 'lambda_l2': 3.493598676796113}. Best is trial 8 with value: 0.03200741706667386.
[I 2025-11-03 21:17:27,281] Trial 21 finished with value: 0.03330100305235274 and parameters: {'learning_rate': 0.15304916753423428, 'num_leaves': 160, 'max_depth': 11, 'min_child_samples': 17, 'subsample': 0.6999134299269756, 'colsample_bytree': 0.883994639456499, 'lambda_l1': 0.203333896618604, 'lambda_l2': 8.179815901299635}. Best is trial 8 with value: 0.03200741706667386.
[I 2025-11-03 21:18:02,471] Trial 22 finished with value: 0.034271795883283836 and parameters: {'learning_rate': 0.2783193528275272, 'num_leaves': 121, 'max_depth': 12, 'min_child_samples': 12, 'subsample': 0.7182039974644779, 'colsample_bytree': 0.8098053731411966, 'lambda_l1': 1.1123084553366018, 'lambda_l2': 6.340627532403696}. Best is trial 8 with value: 0.03200741706667386.
[I 2025-11-03 21:18:29,571] Trial 23 finished with value: 0.03200531871637704 and parameters: {'learning_rate': 0.1948360417986518, 'num_leaves': 153, 'max_depth': 14, 'min_child_samples': 18, 'subsample': 0.6243201948985085, 'colsample_bytree': 0.9021053558399351, 'lambda_l1': 0.02511228497486806, 'lambda_l2': 9.984313207740188}. Best is trial 23 with value: 0.03200531871637704.
[I 2025-11-03 21:19:09,138] Trial 24 finished with value: 0.03214208664604036 and parameters: {'learning_rate': 0.10015679905129961, 'num_leaves': 151, 'max_depth': 14, 'min_child_samples': 10, 'subsample': 0.5567775816047366, 'colsample_bytree': 0.9953182938974803, 'lambda_l1': 1.439804826898321, 'lambda_l2': 9.724411819523587}. Best is trial 23 with value: 0.03200531871637704.
Best params for split 2018 : {'learning_rate': 0.1948360417986518, 'num_leaves': 153, 'max_depth': 14, 'min_child_samples': 18, 'subsample': 0.6243201948985085, 'colsample_bytree': 0.9021053558399351, 'lambda_l1': 0.02511228497486806, 'lambda_l2': 9.984313207740188}

Metrics for test year 2019:
  RMSE: 0.0320
  MAE: 0.0142
  R2: 0.9995
Exported predictions for test year 2019 -&gt; predictions_2019.csv
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=dggt3sCgUcxq">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="Comments-:"><strong>Comments :</strong><a class="anchor-link" href="#Comments-:"></a></h3><p>The R is really high. After the previous tests previously done, I see 2 possible significations:</p>
<blockquote>
<blockquote>
<blockquote>
<p>Option 1: There is again a data leakage due to the merchant_mean_log</p>
</blockquote>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>Option 2: I saw previously that the trend during the stagnation period is really stable and it could explain the algorithm got an extremely performing result</p>
</blockquote>
</blockquote>
</blockquote>
<p>To be sure, I will run the script above without the merchant_mean_log to ensure there is no data leakage.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=2FPBvicqLr3v">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h2><span style="color:blue;">6. <strong>Experiment 5</strong> Monthly aggregation <strong>with lag</strong> - MACHINE LEARNING USING LIGHTGBM</span></h2>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=siJrsEqQLzHq">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="%E2%9C%93-Initialization"><b><span style="color:green;"></span> <u>Initialization</u></b><a class="anchor-link" href="#%E2%9C%93-Initialization"></a></h3>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=TQEGpZLYL3OU">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># -------------------------------------------------------------------------</span>
<span class="c1"># 1. Install JAVA - SPARK</span>
<span class="c1"># -------------------------------------------------------------------------</span>

<span class="o">!</span>apt-get<span class="w"> </span>install<span class="w"> </span>openjdk-11-jdk<span class="w"> </span>-y
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span><span class="nv">pyspark</span><span class="o">==</span><span class="m">3</span>.5.0
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>findspark
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>--force-reinstall<span class="w"> </span><span class="nv">numpy</span><span class="o">==</span><span class="m">1</span>.26.4<span class="w"> </span><span class="nv">pandas</span><span class="o">==</span><span class="m">2</span>.2.2

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"JAVA_HOME"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"/usr/lib/jvm/java-11-openjdk-amd64"</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"PATH"</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">":/usr/lib/jvm/java-11-openjdk-amd64/bin"</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=5s2AYINrLhPk">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># ----------------------</span>
<span class="c1"># 2. Spark init</span>
<span class="c1"># ----------------------</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.sql</span><span class="w"> </span><span class="kn">import</span> <span class="n">SparkSession</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span> \
    <span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">"ML_Portfolio_Monthly_Aggregated_Prediction_LAG"</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="s2">"spark.sql.shuffle.partitions"</span><span class="p">,</span> <span class="s2">"200"</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=ii-fEv25L-qx">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># -------------------------------------------------------------------------</span>
<span class="c1"># 3. Install packages</span>
<span class="c1"># -------------------------------------------------------------------------</span>

<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>optuna
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=USEOZhleL-oH">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># -------------------------------------------------------------------------</span>
<span class="c1"># 4. Import Libraries</span>
<span class="c1"># -------------------------------------------------------------------------</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">kagglehub</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">optuna</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lightgbm</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">lgb</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">math</span><span class="w"> </span><span class="kn">import</span> <span class="n">pi</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.sql.functions</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">col</span><span class="p">,</span> <span class="n">to_date</span><span class="p">,</span> <span class="n">regexp_replace</span><span class="p">,</span> <span class="n">unix_timestamp</span><span class="p">,</span> <span class="n">dayofweek</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">lit</span><span class="p">,</span>
    <span class="nb">sum</span> <span class="k">as</span> <span class="n">_sum</span><span class="p">,</span> <span class="n">avg</span> <span class="k">as</span> <span class="n">_avg</span><span class="p">,</span> <span class="n">count</span> <span class="k">as</span> <span class="n">_count</span><span class="p">,</span> <span class="n">stddev</span> <span class="k">as</span> <span class="n">_stddev</span><span class="p">,</span> <span class="n">countDistinct</span><span class="p">,</span>
    <span class="n">when</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="nb">max</span> <span class="k">as</span> <span class="n">_max</span><span class="p">,</span> <span class="n">lag</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.sql.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">DoubleType</span><span class="p">,</span> <span class="n">IntegerType</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.sql.window</span><span class="w"> </span><span class="kn">import</span> <span class="n">Window</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">r2_score</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">"ignore"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=iWdhjaMxMKEj">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="%E2%9C%93-Extraction---Load"><b><span style="color:green;"></span> <u>Extraction - Load</u></b><a class="anchor-link" href="#%E2%9C%93-Extraction---Load"></a></h3>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=IqP-ALIaL-lp">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># -------------------------------------------------------------------------</span>
<span class="c1"># 5. Data Loading</span>
<span class="c1"># -------------------------------------------------------------------------</span>

<span class="n">path</span> <span class="o">=</span> <span class="n">kagglehub</span><span class="o">.</span><span class="n">dataset_download</span><span class="p">(</span><span class="s2">"computingvictor/transactions-fraud-datasets"</span><span class="p">)</span>
<span class="n">transaction_data</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">/transactions_data.csv"</span>
<span class="n">mcc_codes_data</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">/mcc_codes.json"</span>

<span class="c1"># load mcc descriptions</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">mcc_codes_data</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">mcc_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">mcc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">mcc_dict</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">"index"</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"description"</span><span class="p">])</span> \
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"index"</span><span class="p">:</span> <span class="s2">"mcc_code"</span><span class="p">})</span>
<span class="n">mcc_spark</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">mcc</span><span class="p">)</span>

<span class="c1"># load transactions</span>
<span class="n">td_spark</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">transaction_data</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inferSchema</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Downloading from https://www.kaggle.com/api/v1/datasets/download/computingvictor/transactions-fraud-datasets?dataset_version_number=1...
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="application/vnd.jupyter.stderr" tabindex="0">
<pre>100%|| 348M/348M [00:07&lt;00:00, 52.0MB/s]</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Extracting files...
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="application/vnd.jupyter.stderr" tabindex="0">
<pre>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=56Iip3xBMTXE">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="%E2%9C%93-Data-Wrangling"><b><span style="color:green;"></span> <u>Data Wrangling</u></b><a class="anchor-link" href="#%E2%9C%93-Data-Wrangling"></a></h3>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=gUG6S0TKL-i_">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># -------------------------------------------------------------------------</span>
<span class="c1"># 6. Feature Engineering</span>
<span class="c1"># -------------------------------------------------------------------------</span>

<span class="n">LABEL_COL</span> <span class="o">=</span> <span class="s2">"amount"</span>

<span class="n">td_spark</span> <span class="o">=</span> <span class="n">td_spark</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">LABEL_COL</span><span class="p">,</span> <span class="n">regexp_replace</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="n">LABEL_COL</span><span class="p">),</span> <span class="s2">"</span><span class="se">\\</span><span class="s2">$"</span><span class="p">,</span> <span class="s2">""</span><span class="p">))</span>
<span class="n">td_spark</span> <span class="o">=</span> <span class="n">td_spark</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">LABEL_COL</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="n">LABEL_COL</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">DoubleType</span><span class="p">()))</span>
<span class="n">td_spark</span> <span class="o">=</span> <span class="n">td_spark</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"date"</span><span class="p">,</span> <span class="n">to_date</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"date"</span><span class="p">)))</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">td_spark</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mcc_spark</span><span class="p">,</span> <span class="n">td_spark</span><span class="o">.</span><span class="n">mcc</span> <span class="o">==</span> <span class="n">mcc_spark</span><span class="o">.</span><span class="n">mcc_code</span><span class="p">,</span> <span class="s2">"left"</span><span class="p">)</span>

<span class="n">cols_to_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"id"</span><span class="p">,</span> <span class="s2">"use_chip"</span><span class="p">,</span> <span class="s2">"merchant_city"</span><span class="p">,</span> <span class="s2">"merchant_state"</span><span class="p">,</span> <span class="s2">"zip"</span><span class="p">,</span> <span class="s2">"mcc"</span><span class="p">,</span> <span class="s2">"errors"</span><span class="p">,</span> <span class="s2">"mcc_code"</span><span class="p">]</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cols_to_drop</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"year"</span><span class="p">,</span> <span class="n">year</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"date"</span><span class="p">))</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">()))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"month"</span><span class="p">,</span> <span class="n">month</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"date"</span><span class="p">))</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">()))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"date_timestamp"</span><span class="p">,</span> <span class="n">unix_timestamp</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"date"</span><span class="p">))</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">DoubleType</span><span class="p">()))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"day_of_week"</span><span class="p">,</span> <span class="n">dayofweek</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"date"</span><span class="p">))</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">()))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"is_refund"</span><span class="p">,</span> <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="n">LABEL_COL</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">DoubleType</span><span class="p">()))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"description_clean"</span><span class="p">,</span> <span class="n">regexp_replace</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"description"</span><span class="p">),</span> <span class="s2">"[ ,:</span><span class="se">\\</span><span class="s2">[</span><span class="se">\\</span><span class="s2">]</span><span class="se">\\</span><span class="s2">{</span><span class="se">\\</span><span class="s2">}]"</span><span class="p">,</span> <span class="s2">"_"</span><span class="p">))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">((</span><span class="n">col</span><span class="p">(</span><span class="s2">"date"</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="s2">"2015-01-01"</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"date"</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="s2">"2019-10-31"</span><span class="p">))</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"Rows after filter:"</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Rows after filter: 6734248
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=kQ_6FgNUL-gq">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># ----------------------</span>
<span class="c1"># 7. Monthly aggregation per merchant_id</span>
<span class="c1"># ----------------------</span>

<span class="c1"># Aggregation per (year, month, merchant_id)</span>
<span class="n">group_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"merchant_id"</span><span class="p">,</span> <span class="s2">"year"</span><span class="p">,</span> <span class="s2">"month"</span><span class="p">]</span>

<span class="n">agg</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="o">*</span><span class="n">group_cols</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
    <span class="n">_sum</span><span class="p">(</span><span class="n">LABEL_COL</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"amount_sum"</span><span class="p">),</span>
    <span class="n">_count</span><span class="p">(</span><span class="s2">"*"</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"tx_count"</span><span class="p">),</span>
    <span class="n">_avg</span><span class="p">(</span><span class="n">LABEL_COL</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"amount_avg"</span><span class="p">),</span>
    <span class="n">_stddev</span><span class="p">(</span><span class="n">LABEL_COL</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"amount_stddev"</span><span class="p">),</span>
    <span class="n">_avg</span><span class="p">(</span><span class="s2">"is_refund"</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"refund_rate"</span><span class="p">),</span>
    <span class="n">countDistinct</span><span class="p">(</span><span class="s2">"description_clean"</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"desc_count"</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># fill null stddev with 0</span>
<span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">fillna</span><span class="p">({</span><span class="s2">"amount_stddev"</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">})</span>

<span class="c1"># add ym numeric for splitting and features</span>
<span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"ym"</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">"year"</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">col</span><span class="p">(</span><span class="s2">"month"</span><span class="p">))</span>

<span class="c1"># temporal features</span>
<span class="c1"># month cyclic</span>
<span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"month_sin"</span><span class="p">,</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">col</span><span class="p">(</span><span class="s2">"month"</span><span class="p">)</span> <span class="o">/</span> <span class="n">lit</span><span class="p">(</span><span class="mi">12</span><span class="p">)))</span>
<span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"month_cos"</span><span class="p">,</span> <span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">col</span><span class="p">(</span><span class="s2">"month"</span><span class="p">)</span> <span class="o">/</span> <span class="n">lit</span><span class="p">(</span><span class="mi">12</span><span class="p">)))</span>

<span class="c1"># normalized year (year - min_year)</span>
<span class="n">min_year</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">"year"</span><span class="p">:</span> <span class="s2">"min"</span><span class="p">})</span><span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"year_norm"</span><span class="p">,</span> <span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"year"</span><span class="p">)</span> <span class="o">-</span> <span class="n">lit</span><span class="p">(</span><span class="n">min_year</span><span class="p">))</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">DoubleType</span><span class="p">()))</span>

<span class="c1"># log target</span>
<span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"log_amount_sum"</span><span class="p">,</span> <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"amount_sum"</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">"amount_sum"</span><span class="p">))</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="mf">0.0</span><span class="p">))</span>
<span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"log_amount_sum"</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="s2">"log(1 + log_amount_sum)"</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"Monthly aggregated rows (before lag):"</span><span class="p">,</span> <span class="n">agg</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Monthly aggregated rows (before lag): 606168
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=1EfXi0PKL-cz">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># ----------------------</span>
<span class="c1"># 8. CREATE LAG FEATURES (historique)</span>
<span class="c1"># ----------------------</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Creating LAG features..."</span><span class="p">)</span>

<span class="c1"># Window sorted by period</span>
<span class="n">window_spec</span> <span class="o">=</span> <span class="n">Window</span><span class="o">.</span><span class="n">partitionBy</span><span class="p">(</span><span class="s2">"merchant_id"</span><span class="p">)</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">"ym"</span><span class="p">)</span>

<span class="c1"># LAG 1 month (M-1)</span>
<span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"tx_count_lag1"</span><span class="p">,</span> <span class="n">lag</span><span class="p">(</span><span class="s2">"tx_count"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window_spec</span><span class="p">))</span>
<span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"amount_avg_lag1"</span><span class="p">,</span> <span class="n">lag</span><span class="p">(</span><span class="s2">"amount_avg"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window_spec</span><span class="p">))</span>
<span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"amount_stddev_lag1"</span><span class="p">,</span> <span class="n">lag</span><span class="p">(</span><span class="s2">"amount_stddev"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window_spec</span><span class="p">))</span>
<span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"refund_rate_lag1"</span><span class="p">,</span> <span class="n">lag</span><span class="p">(</span><span class="s2">"refund_rate"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window_spec</span><span class="p">))</span>
<span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"desc_count_lag1"</span><span class="p">,</span> <span class="n">lag</span><span class="p">(</span><span class="s2">"desc_count"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window_spec</span><span class="p">))</span>
<span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"log_amount_sum_lag1"</span><span class="p">,</span> <span class="n">lag</span><span class="p">(</span><span class="s2">"log_amount_sum"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window_spec</span><span class="p">))</span>

<span class="c1"># LAG 2 Months</span>
<span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"tx_count_lag2"</span><span class="p">,</span> <span class="n">lag</span><span class="p">(</span><span class="s2">"tx_count"</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window_spec</span><span class="p">))</span>
<span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"amount_avg_lag2"</span><span class="p">,</span> <span class="n">lag</span><span class="p">(</span><span class="s2">"amount_avg"</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window_spec</span><span class="p">))</span>
<span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"log_amount_sum_lag2"</span><span class="p">,</span> <span class="n">lag</span><span class="p">(</span><span class="s2">"log_amount_sum"</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window_spec</span><span class="p">))</span>

<span class="c1"># LAG 3 Months</span>
<span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"tx_count_lag3"</span><span class="p">,</span> <span class="n">lag</span><span class="p">(</span><span class="s2">"tx_count"</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window_spec</span><span class="p">))</span>
<span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"amount_avg_lag3"</span><span class="p">,</span> <span class="n">lag</span><span class="p">(</span><span class="s2">"amount_avg"</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window_spec</span><span class="p">))</span>
<span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"log_amount_sum_lag3"</span><span class="p">,</span> <span class="n">lag</span><span class="p">(</span><span class="s2">"log_amount_sum"</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window_spec</span><span class="p">))</span>

<span class="c1"># Rolling average on 3 months</span>
<span class="n">window_rolling</span> <span class="o">=</span> <span class="n">Window</span><span class="o">.</span><span class="n">partitionBy</span><span class="p">(</span><span class="s2">"merchant_id"</span><span class="p">)</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">"ym"</span><span class="p">)</span><span class="o">.</span><span class="n">rowsBetween</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"amount_avg_roll3"</span><span class="p">,</span> <span class="n">_avg</span><span class="p">(</span><span class="s2">"amount_avg"</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window_rolling</span><span class="p">))</span>
<span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"tx_count_roll3"</span><span class="p">,</span> <span class="n">_avg</span><span class="p">(</span><span class="s2">"tx_count"</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window_rolling</span><span class="p">))</span>

<span class="c1"># Trend (gap between actual perio and previous month)</span>
<span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"amount_trend"</span><span class="p">,</span>
    <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"amount_avg_lag1"</span><span class="p">)</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">(),</span>
         <span class="n">col</span><span class="p">(</span><span class="s2">"amount_avg_lag1"</span><span class="p">)</span> <span class="o">-</span> <span class="n">lag</span><span class="p">(</span><span class="s2">"amount_avg"</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window_spec</span><span class="p">))</span>
    <span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="mf">0.0</span><span class="p">))</span>

<span class="c1"># Fill Null values</span>
<span class="n">lag_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">agg</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s2">"lag"</span> <span class="ow">in</span> <span class="n">c</span> <span class="ow">or</span> <span class="s2">"roll"</span> <span class="ow">in</span> <span class="n">c</span> <span class="ow">or</span> <span class="s2">"trend"</span> <span class="ow">in</span> <span class="n">c</span><span class="p">]</span>
<span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">lag_cols</span><span class="p">)</span>

<span class="c1"># cache</span>
<span class="n">agg</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Monthly aggregated rows (after lag):"</span><span class="p">,</span> <span class="n">agg</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>
Creating LAG features...
Monthly aggregated rows (after lag): 606168
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=i3kD1lH4L-aR">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># ----------------------</span>
<span class="c1"># 9. prepare splitting boundaries</span>
<span class="c1"># ----------------------</span>
<span class="n">last_ym</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">_max</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"ym"</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"last"</span><span class="p">))</span><span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Last ym available:"</span><span class="p">,</span> <span class="n">last_ym</span><span class="p">)</span>

<span class="n">split_years</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2015</span><span class="p">,</span> <span class="mi">2016</span><span class="p">,</span> <span class="mi">2017</span><span class="p">,</span> <span class="mi">2018</span><span class="p">]</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Last ym available: 201910
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=mo3IOKtvMqJL">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="%E2%9C%93-Machine-Learning"><b><span style="color:green;"></span> <u>Machine Learning</u></b><a class="anchor-link" href="#%E2%9C%93-Machine-Learning"></a></h3>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=ZJyBMjrCL-Xm">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># ----------------------</span>
<span class="c1"># 10. Loop over temporal splits</span>
<span class="c1"># ----------------------</span>

<span class="k">for</span> <span class="n">year_split</span> <span class="ow">in</span> <span class="n">split_years</span><span class="p">:</span>
    <span class="n">train_ym_max</span> <span class="o">=</span> <span class="n">year_split</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">12</span>
    <span class="n">test_ym_min</span> <span class="o">=</span> <span class="p">(</span><span class="n">year_split</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">test_ym_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">((</span><span class="n">year_split</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">12</span><span class="p">,</span> <span class="n">last_ym</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span> <span class="o">+</span> <span class="s2">"="</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Temporal split: train &lt;= </span><span class="si">{</span><span class="n">train_ym_max</span><span class="si">}</span><span class="s2"> | test: </span><span class="si">{</span><span class="n">test_ym_min</span><span class="si">}</span><span class="s2">..</span><span class="si">{</span><span class="n">test_ym_max</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"="</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>

    <span class="n">train_df</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"ym"</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">train_ym_max</span><span class="p">)</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
    <span class="n">test_df</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">filter</span><span class="p">((</span><span class="n">col</span><span class="p">(</span><span class="s2">"ym"</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">test_ym_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"ym"</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">test_ym_max</span><span class="p">))</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>

    <span class="n">train_count</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="n">test_count</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Train rows: </span><span class="si">{</span><span class="n">train_count</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> | Test rows: </span><span class="si">{</span><span class="n">test_count</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">train_count</span> <span class="o">&lt;</span> <span class="mi">50</span> <span class="ow">or</span> <span class="n">test_count</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Not enough data for this split, skipping."</span><span class="p">)</span>
        <span class="n">train_df</span><span class="o">.</span><span class="n">unpersist</span><span class="p">();</span> <span class="n">test_df</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>
        <span class="k">continue</span>

    <span class="c1"># ----------------------------------------------------</span>
    <span class="c1"># 11. Features and labels (AVEC LAG - pas de leakage)</span>
    <span class="c1"># ----------------------------------------------------</span>

    <span class="n">feature_cols</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1"># LAG features (historical - SAFE)</span>
        <span class="s2">"tx_count_lag1"</span><span class="p">,</span>
        <span class="s2">"tx_count_lag2"</span><span class="p">,</span>
        <span class="s2">"tx_count_lag3"</span><span class="p">,</span>
        <span class="s2">"amount_avg_lag1"</span><span class="p">,</span>
        <span class="s2">"amount_avg_lag2"</span><span class="p">,</span>
        <span class="s2">"amount_avg_lag3"</span><span class="p">,</span>
        <span class="s2">"amount_stddev_lag1"</span><span class="p">,</span>
        <span class="s2">"refund_rate_lag1"</span><span class="p">,</span>
        <span class="s2">"desc_count_lag1"</span><span class="p">,</span>
        <span class="s2">"log_amount_sum_lag1"</span><span class="p">,</span>
        <span class="s2">"log_amount_sum_lag2"</span><span class="p">,</span>
        <span class="s2">"log_amount_sum_lag3"</span><span class="p">,</span>

        <span class="c1"># Rolling features</span>
        <span class="s2">"amount_avg_roll3"</span><span class="p">,</span>
        <span class="s2">"tx_count_roll3"</span><span class="p">,</span>

        <span class="c1"># Trend</span>
        <span class="s2">"amount_trend"</span><span class="p">,</span>

        <span class="c1"># Temporal features (SAFE)</span>
        <span class="s2">"month_sin"</span><span class="p">,</span>
        <span class="s2">"month_cos"</span><span class="p">,</span>
        <span class="s2">"year_norm"</span>
    <span class="p">]</span>

    <span class="n">label_col</span> <span class="o">=</span> <span class="s2">"log_amount_sum"</span>

    <span class="c1"># Coverto to pandas</span>
    <span class="n">train_pd</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="o">*</span><span class="n">feature_cols</span><span class="p">,</span> <span class="n">label_col</span><span class="p">)</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">test_pd</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="o">*</span><span class="n">feature_cols</span><span class="p">,</span> <span class="n">label_col</span><span class="p">)</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">train_pd</span><span class="p">[</span><span class="n">feature_cols</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">train_pd</span><span class="p">[</span><span class="n">label_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">test_pd</span><span class="p">[</span><span class="n">feature_cols</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">test_pd</span><span class="p">[</span><span class="n">label_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Feature matrix shapes: X_train=</span><span class="si">{</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, X_test=</span><span class="si">{</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------</span>
    <span class="c1"># 12. Run OPTUNA Optimization</span>
    <span class="c1"># ----------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">objective</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"objective"</span><span class="p">:</span> <span class="s2">"regression"</span><span class="p">,</span>
            <span class="s2">"metric"</span><span class="p">:</span> <span class="s2">"rmse"</span><span class="p">,</span>
            <span class="s2">"verbosity"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="s2">"boosting_type"</span><span class="p">:</span> <span class="s2">"gbdt"</span><span class="p">,</span>
            <span class="s2">"learning_rate"</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s2">"learning_rate"</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="s2">"num_leaves"</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s2">"num_leaves"</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
            <span class="s2">"max_depth"</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s2">"max_depth"</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
            <span class="s2">"min_child_samples"</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s2">"min_child_samples"</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
            <span class="s2">"subsample"</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s2">"subsample"</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="s2">"colsample_bytree"</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s2">"colsample_bytree"</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="s2">"lambda_l1"</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s2">"lambda_l1"</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">),</span>
            <span class="s2">"lambda_l2"</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s2">"lambda_l2"</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="n">lgb_train</span> <span class="o">=</span> <span class="n">lgb</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        <span class="n">lgb_val</span> <span class="o">=</span> <span class="n">lgb</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="n">lgb_train</span><span class="p">)</span>

        <span class="n">model</span> <span class="o">=</span> <span class="n">lgb</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
            <span class="n">params</span><span class="p">,</span>
            <span class="n">lgb_train</span><span class="p">,</span>
            <span class="n">valid_sets</span><span class="o">=</span><span class="p">[</span><span class="n">lgb_val</span><span class="p">],</span>
            <span class="n">num_boost_round</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
            <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">lgb</span><span class="o">.</span><span class="n">early_stopping</span><span class="p">(</span><span class="n">stopping_rounds</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>
        <span class="p">)</span>

        <span class="n">preds</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">num_iteration</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">best_iteration</span><span class="p">)</span>

        <span class="c1"># Calculate RMSE using numpy</span>
        <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">preds</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">rmse</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Optimizing hyperparameters with Optuna..."</span><span class="p">)</span>
    <span class="n">study</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">create_study</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s2">"minimize"</span><span class="p">)</span>
    <span class="n">study</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">show_progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">best_params</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">best_params</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Best params for split"</span><span class="p">,</span> <span class="n">year_split</span><span class="p">,</span> <span class="s2">":"</span><span class="p">,</span> <span class="n">best_params</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------</span>
    <span class="c1"># 13. Train final model with best params</span>
    <span class="c1"># ----------------------------------------------------</span>

    <span class="n">final_params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"objective"</span><span class="p">:</span> <span class="s2">"regression"</span><span class="p">,</span>
        <span class="s2">"metric"</span><span class="p">:</span> <span class="s2">"rmse"</span><span class="p">,</span>
        <span class="s2">"verbosity"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="s2">"boosting_type"</span><span class="p">:</span> <span class="s2">"gbdt"</span><span class="p">,</span>
        <span class="o">**</span><span class="n">best_params</span>
    <span class="p">}</span>

    <span class="n">lgb_train</span> <span class="o">=</span> <span class="n">lgb</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">lgb_val</span> <span class="o">=</span> <span class="n">lgb</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="n">lgb_train</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Training final model..."</span><span class="p">)</span>
    <span class="n">final_model</span> <span class="o">=</span> <span class="n">lgb</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
        <span class="n">final_params</span><span class="p">,</span>
        <span class="n">lgb_train</span><span class="p">,</span>
        <span class="n">valid_sets</span><span class="o">=</span><span class="p">[</span><span class="n">lgb_val</span><span class="p">],</span>
        <span class="n">num_boost_round</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">lgb</span><span class="o">.</span><span class="n">early_stopping</span><span class="p">(</span><span class="n">stopping_rounds</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>
    <span class="p">)</span>

    <span class="c1"># Predictions</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">final_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">num_iteration</span><span class="o">=</span><span class="n">final_model</span><span class="o">.</span><span class="n">best_iteration</span><span class="p">)</span>
    <span class="n">y_true</span> <span class="o">=</span> <span class="n">y_test</span>

    <span class="c1"># Metrics</span>
    <span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse</span><span class="p">)</span>
    <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="si">{</span><span class="s1">'='</span><span class="o">*</span><span class="mi">60</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"METRICS FOR TEST YEAR </span><span class="si">{</span><span class="n">year_split</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="s1">'='</span><span class="o">*</span><span class="mi">60</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  RMSE: </span><span class="si">{</span><span class="n">rmse</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  MAE: </span><span class="si">{</span><span class="n">mae</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  R2: </span><span class="si">{</span><span class="n">r2</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="c1"># Feature importance</span>
    <span class="n">importance</span> <span class="o">=</span> <span class="n">final_model</span><span class="o">.</span><span class="n">feature_importance</span><span class="p">(</span><span class="n">importance_type</span><span class="o">=</span><span class="s1">'gain'</span><span class="p">)</span>
    <span class="n">feature_importance_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">'feature'</span><span class="p">:</span> <span class="n">feature_cols</span><span class="p">,</span>
        <span class="s1">'importance'</span><span class="p">:</span> <span class="n">importance</span>
    <span class="p">})</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">'importance'</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Top 10 Feature Importances:"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">feature_importance_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>

    <span class="c1"># Baseline comparison</span>
    <span class="n">baseline_pred</span> <span class="o">=</span> <span class="n">test_pd</span><span class="p">[</span><span class="s2">"log_amount_sum_lag1"</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">baseline_rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">y_true</span> <span class="o">-</span> <span class="n">baseline_pred</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">baseline_r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">baseline_pred</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Baseline (predict with lag1 only):"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  RMSE: </span><span class="si">{</span><span class="n">baseline_rmse</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  R2: </span><span class="si">{</span><span class="n">baseline_r2</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Model improvement: </span><span class="si">{</span><span class="p">((</span><span class="n">baseline_rmse</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">rmse</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">baseline_rmse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%"</span><span class="p">)</span>

    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s2">"year_train"</span><span class="p">:</span> <span class="n">year_split</span><span class="p">,</span>
        <span class="s2">"year_test"</span><span class="p">:</span> <span class="n">year_split</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">"rmse"</span><span class="p">:</span> <span class="n">rmse</span><span class="p">,</span>
        <span class="s2">"mae"</span><span class="p">:</span> <span class="n">mae</span><span class="p">,</span>
        <span class="s2">"r2"</span><span class="p">:</span> <span class="n">r2</span><span class="p">,</span>
        <span class="s2">"baseline_rmse"</span><span class="p">:</span> <span class="n">baseline_rmse</span><span class="p">,</span>
        <span class="s2">"baseline_r2"</span><span class="p">:</span> <span class="n">baseline_r2</span><span class="p">,</span>
        <span class="s2">"improvement_pct"</span><span class="p">:</span> <span class="p">((</span><span class="n">baseline_rmse</span> <span class="o">-</span> <span class="n">rmse</span><span class="p">)</span> <span class="o">/</span> <span class="n">baseline_rmse</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span>
        <span class="s2">"best_params"</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">best_params</span><span class="p">)</span>
    <span class="p">})</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="c1"># 14. Export predictions</span>
    <span class="c1"># -------------------------------------------------------------------------</span>

    <span class="c1"># Get additionnals columns from the dataset test</span>
    <span class="n">test_pd_full</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"merchant_id"</span><span class="p">,</span> <span class="s2">"year"</span><span class="p">,</span> <span class="s2">"month"</span><span class="p">,</span> <span class="s2">"ym"</span><span class="p">,</span> <span class="o">*</span><span class="n">feature_cols</span><span class="p">,</span> <span class="n">label_col</span><span class="p">)</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="n">predictions_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s2">"year_train"</span><span class="p">:</span> <span class="p">[</span><span class="n">year_split</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_true</span><span class="p">),</span>
        <span class="s2">"year_test"</span><span class="p">:</span> <span class="p">[</span><span class="n">year_split</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_true</span><span class="p">),</span>
        <span class="s2">"y_true"</span><span class="p">:</span> <span class="n">y_true</span><span class="p">,</span>
        <span class="s2">"y_pred"</span><span class="p">:</span> <span class="n">y_pred</span><span class="p">,</span>
        <span class="s2">"residual"</span><span class="p">:</span> <span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">,</span>
        <span class="s2">"abs_error"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="p">})</span>

    <span class="c1"># add features</span>
    <span class="n">predictions_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">test_pd_full</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">predictions_df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">output_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"predictions_lag_</span><span class="si">{</span><span class="n">year_split</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">.csv"</span>
    <span class="n">predictions_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Exported predictions for test year </span><span class="si">{</span><span class="n">year_split</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="c1"># Cleanup</span>
    <span class="n">train_df</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>
    <span class="n">test_df</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>
============================================================
Temporal split: train &lt;= 201512 | test: 201601..201612
============================================================
Train rows: 124,922 | Test rows: 125,226
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="application/vnd.jupyter.stderr" tabindex="0">
<pre>[I 2025-11-04 18:59:42,897] A new study created in memory with name: no-name-70781aa9-0406-4af0-adaf-463de495fd67
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Feature matrix shapes: X_train=(124922, 18), X_test=(125226, 18)

Optimizing hyperparameters with Optuna...
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>  0%|          | 0/25 [00:00&lt;?, ?it/s]</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>[I 2025-11-04 18:59:46,421] Trial 0 finished with value: 0.8860720699043582 and parameters: {'learning_rate': 0.23121119602523876, 'num_leaves': 94, 'max_depth': 5, 'min_child_samples': 7, 'subsample': 0.7028736026849369, 'colsample_bytree': 0.9075998352581536, 'lambda_l1': 8.965168121317209, 'lambda_l2': 6.708148345987354}. Best is trial 0 with value: 0.8860720699043582.
[I 2025-11-04 18:59:53,859] Trial 1 finished with value: 0.8830063814778332 and parameters: {'learning_rate': 0.04281710355863506, 'num_leaves': 250, 'max_depth': 8, 'min_child_samples': 22, 'subsample': 0.790692109024921, 'colsample_bytree': 0.9799316904444577, 'lambda_l1': 6.673055986360943, 'lambda_l2': 2.2462392014601162}. Best is trial 1 with value: 0.8830063814778332.
[I 2025-11-04 19:00:06,780] Trial 2 finished with value: 0.8847525693184185 and parameters: {'learning_rate': 0.05242172434710352, 'num_leaves': 191, 'max_depth': 4, 'min_child_samples': 36, 'subsample': 0.9073908627194596, 'colsample_bytree': 0.8336716796211465, 'lambda_l1': 1.911733321354413, 'lambda_l2': 9.994288519354923}. Best is trial 1 with value: 0.8830063814778332.
[I 2025-11-04 19:00:12,408] Trial 3 finished with value: 0.8832054942662009 and parameters: {'learning_rate': 0.1685353590588822, 'num_leaves': 99, 'max_depth': 10, 'min_child_samples': 20, 'subsample': 0.8629178758237794, 'colsample_bytree': 0.5178160770362589, 'lambda_l1': 6.1644127653911704, 'lambda_l2': 2.9320321320442613}. Best is trial 1 with value: 0.8830063814778332.
[I 2025-11-04 19:00:22,614] Trial 4 finished with value: 0.8846401562971721 and parameters: {'learning_rate': 0.04114749517325927, 'num_leaves': 223, 'max_depth': 4, 'min_child_samples': 6, 'subsample': 0.6840429611670296, 'colsample_bytree': 0.8548915100166432, 'lambda_l1': 3.3428148146205006, 'lambda_l2': 9.694619507362699}. Best is trial 1 with value: 0.8830063814778332.
[I 2025-11-04 19:00:31,780] Trial 5 finished with value: 0.883949048546266 and parameters: {'learning_rate': 0.050943497679213356, 'num_leaves': 203, 'max_depth': 14, 'min_child_samples': 9, 'subsample': 0.7346408806414471, 'colsample_bytree': 0.8760213125136787, 'lambda_l1': 5.294900267740754, 'lambda_l2': 5.999514776649758}. Best is trial 1 with value: 0.8830063814778332.
[I 2025-11-04 19:00:48,011] Trial 6 finished with value: 0.8827469935663462 and parameters: {'learning_rate': 0.018869195069560748, 'num_leaves': 188, 'max_depth': 7, 'min_child_samples': 28, 'subsample': 0.5354879360521119, 'colsample_bytree': 0.5917426362080341, 'lambda_l1': 1.0111498024718335, 'lambda_l2': 1.3801062072603731}. Best is trial 6 with value: 0.8827469935663462.
[I 2025-11-04 19:00:53,060] Trial 7 finished with value: 0.8848352273410743 and parameters: {'learning_rate': 0.2450824055271753, 'num_leaves': 202, 'max_depth': 13, 'min_child_samples': 22, 'subsample': 0.8474280757710699, 'colsample_bytree': 0.6708201277349002, 'lambda_l1': 9.017527749469409, 'lambda_l2': 0.2603092642832372}. Best is trial 6 with value: 0.8827469935663462.
[I 2025-11-04 19:00:56,864] Trial 8 finished with value: 0.8834100405795637 and parameters: {'learning_rate': 0.09882704960407923, 'num_leaves': 97, 'max_depth': 14, 'min_child_samples': 19, 'subsample': 0.6907501461270039, 'colsample_bytree': 0.7827971000920668, 'lambda_l1': 6.531019849492868, 'lambda_l2': 4.6063129870815125}. Best is trial 6 with value: 0.8827469935663462.
[I 2025-11-04 19:01:20,625] Trial 9 finished with value: 0.8831327134663294 and parameters: {'learning_rate': 0.010046173990831454, 'num_leaves': 71, 'max_depth': 6, 'min_child_samples': 7, 'subsample': 0.6782487914691925, 'colsample_bytree': 0.8342120050552584, 'lambda_l1': 2.7620000689132373, 'lambda_l2': 1.1399506849723262}. Best is trial 6 with value: 0.8827469935663462.
[I 2025-11-04 19:01:36,354] Trial 10 finished with value: 0.8838422375832038 and parameters: {'learning_rate': 0.016382536848412427, 'num_leaves': 28, 'max_depth': 9, 'min_child_samples': 46, 'subsample': 0.502948328444613, 'colsample_bytree': 0.6287458895786833, 'lambda_l1': 0.11816205551392567, 'lambda_l2': 3.825333982416547}. Best is trial 6 with value: 0.8827469935663462.
[I 2025-11-04 19:01:54,934] Trial 11 finished with value: 0.8827708400163379 and parameters: {'learning_rate': 0.02255636843784417, 'num_leaves': 255, 'max_depth': 8, 'min_child_samples': 32, 'subsample': 0.526716374781946, 'colsample_bytree': 0.9525197194299875, 'lambda_l1': 7.50402055453023, 'lambda_l2': 2.326010262971751}. Best is trial 6 with value: 0.8827469935663462.
[I 2025-11-04 19:02:13,566] Trial 12 finished with value: 0.8827815892724555 and parameters: {'learning_rate': 0.020840971368877997, 'num_leaves': 167, 'max_depth': 7, 'min_child_samples': 34, 'subsample': 0.5229565956189769, 'colsample_bytree': 0.514220228800793, 'lambda_l1': 0.12537461075625722, 'lambda_l2': 2.05388107484725}. Best is trial 6 with value: 0.8827469935663462.
[I 2025-11-04 19:02:28,588] Trial 13 finished with value: 0.8828347721635287 and parameters: {'learning_rate': 0.023495242339604136, 'num_leaves': 151, 'max_depth': 10, 'min_child_samples': 31, 'subsample': 0.5793943617086195, 'colsample_bytree': 0.6768752198298423, 'lambda_l1': 7.831202328750005, 'lambda_l2': 0.6368939862576484}. Best is trial 6 with value: 0.8827469935663462.
[I 2025-11-04 19:03:05,031] Trial 14 finished with value: 0.8844772425003735 and parameters: {'learning_rate': 0.010540781871394643, 'num_leaves': 253, 'max_depth': 11, 'min_child_samples': 42, 'subsample': 0.5992616818792255, 'colsample_bytree': 0.998387320386256, 'lambda_l1': 3.839442941288759, 'lambda_l2': 3.508328319143805}. Best is trial 6 with value: 0.8827469935663462.
[I 2025-11-04 19:03:18,011] Trial 15 finished with value: 0.8830645821042774 and parameters: {'learning_rate': 0.027933245566381763, 'num_leaves': 228, 'max_depth': 7, 'min_child_samples': 28, 'subsample': 0.5988116602037566, 'colsample_bytree': 0.6029221919896417, 'lambda_l1': 9.8191338103474, 'lambda_l2': 1.70128374759942}. Best is trial 6 with value: 0.8827469935663462.
[I 2025-11-04 19:03:41,137] Trial 16 finished with value: 0.8828703400564176 and parameters: {'learning_rate': 0.015318903815162039, 'num_leaves': 170, 'max_depth': 12, 'min_child_samples': 38, 'subsample': 0.5590210278669723, 'colsample_bytree': 0.7396873060493339, 'lambda_l1': 4.639389157096442, 'lambda_l2': 7.736148768821719}. Best is trial 6 with value: 0.8827469935663462.
[I 2025-11-04 19:03:50,274] Trial 17 finished with value: 0.8861841308677759 and parameters: {'learning_rate': 0.10159230535908494, 'num_leaves': 131, 'max_depth': 3, 'min_child_samples': 50, 'subsample': 0.6262692761498547, 'colsample_bytree': 0.9357348806685896, 'lambda_l1': 1.4230127788193587, 'lambda_l2': 4.942895481824418}. Best is trial 6 with value: 0.8827469935663462.
[I 2025-11-04 19:04:02,476] Trial 18 finished with value: 0.8829323940735062 and parameters: {'learning_rate': 0.030986713822873137, 'num_leaves': 226, 'max_depth': 7, 'min_child_samples': 27, 'subsample': 0.9894565007842612, 'colsample_bytree': 0.5817757322260313, 'lambda_l1': 7.848715497696757, 'lambda_l2': 2.8850949370280947}. Best is trial 6 with value: 0.8827469935663462.
[I 2025-11-04 19:04:07,926] Trial 19 finished with value: 0.8828761002646007 and parameters: {'learning_rate': 0.0756259047499105, 'num_leaves': 130, 'max_depth': 9, 'min_child_samples': 15, 'subsample': 0.6382944660625081, 'colsample_bytree': 0.7506141421883908, 'lambda_l1': 4.985645221446072, 'lambda_l2': 0.3393881737658515}. Best is trial 6 with value: 0.8827469935663462.
[I 2025-11-04 19:04:26,267] Trial 20 finished with value: 0.8827972652223057 and parameters: {'learning_rate': 0.01579805732044155, 'num_leaves': 174, 'max_depth': 6, 'min_child_samples': 27, 'subsample': 0.5442753269774512, 'colsample_bytree': 0.7099297730843879, 'lambda_l1': 7.370165445444686, 'lambda_l2': 1.494929881366886}. Best is trial 6 with value: 0.8827469935663462.
[I 2025-11-04 19:04:40,425] Trial 21 finished with value: 0.8826858473783205 and parameters: {'learning_rate': 0.021510979066762602, 'num_leaves': 165, 'max_depth': 8, 'min_child_samples': 34, 'subsample': 0.5260954688159794, 'colsample_bytree': 0.5016361171499412, 'lambda_l1': 0.5374906592966326, 'lambda_l2': 2.2716568599167184}. Best is trial 21 with value: 0.8826858473783205.
[I 2025-11-04 19:04:49,809] Trial 22 finished with value: 0.8827998088027136 and parameters: {'learning_rate': 0.03451247505083662, 'num_leaves': 145, 'max_depth': 8, 'min_child_samples': 40, 'subsample': 0.5029941375145552, 'colsample_bytree': 0.5534333952542707, 'lambda_l1': 1.3038301592560866, 'lambda_l2': 3.985203567779626}. Best is trial 21 with value: 0.8826858473783205.
[I 2025-11-04 19:05:06,899] Trial 23 finished with value: 0.8825876483212646 and parameters: {'learning_rate': 0.019775473071548144, 'num_leaves': 185, 'max_depth': 8, 'min_child_samples': 32, 'subsample': 0.5575643060007937, 'colsample_bytree': 0.5001876620542144, 'lambda_l1': 2.1268864918171198, 'lambda_l2': 2.744055773773753}. Best is trial 23 with value: 0.8825876483212646.
[I 2025-11-04 19:05:28,812] Trial 24 finished with value: 0.8821961909621001 and parameters: {'learning_rate': 0.013557647544613773, 'num_leaves': 187, 'max_depth': 10, 'min_child_samples': 30, 'subsample': 0.6423804144585605, 'colsample_bytree': 0.5530111897017383, 'lambda_l1': 0.9265360488690871, 'lambda_l2': 3.1447506683261954}. Best is trial 24 with value: 0.8821961909621001.

Best params for split 2015 : {'learning_rate': 0.013557647544613773, 'num_leaves': 187, 'max_depth': 10, 'min_child_samples': 30, 'subsample': 0.6423804144585605, 'colsample_bytree': 0.5530111897017383, 'lambda_l1': 0.9265360488690871, 'lambda_l2': 3.1447506683261954}

Training final model...

============================================================
METRICS FOR TEST YEAR 2016
============================================================
  RMSE: 0.8822
  MAE: 0.6461
  R2: 0.6257

Top 10 Feature Importances:
                feature    importance
9   log_amount_sum_lag1  2.437523e+06
10  log_amount_sum_lag2  9.402193e+05
12     amount_avg_roll3  5.080576e+05
11  log_amount_sum_lag3  3.866420e+05
13       tx_count_roll3  3.437883e+05
3       amount_avg_lag1  2.471451e+05
0         tx_count_lag1  1.455460e+05
4       amount_avg_lag2  1.042132e+05
1         tx_count_lag2  5.403018e+04
15            month_sin  4.954360e+04

Baseline (predict with lag1 only):
  RMSE: 1.5190
  R2: -0.1096
  Model improvement: 41.92%

Exported predictions for test year 2016 -&gt; predictions_lag_2016.csv

============================================================
Temporal split: train &lt;= 201612 | test: 201701..201712
============================================================
Train rows: 250,148 | Test rows: 125,659
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="application/vnd.jupyter.stderr" tabindex="0">
<pre>[I 2025-11-04 19:06:15,223] A new study created in memory with name: no-name-36c7d8ed-c272-4f3e-9651-f15bf4ac4057
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Feature matrix shapes: X_train=(250148, 18), X_test=(125659, 18)

Optimizing hyperparameters with Optuna...
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>  0%|          | 0/25 [00:00&lt;?, ?it/s]</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>[I 2025-11-04 19:06:22,769] Trial 0 finished with value: 0.857182825757689 and parameters: {'learning_rate': 0.1111019941922399, 'num_leaves': 126, 'max_depth': 11, 'min_child_samples': 34, 'subsample': 0.9535590450383958, 'colsample_bytree': 0.74639749242955, 'lambda_l1': 7.182026511228537, 'lambda_l2': 8.677778741738889}. Best is trial 0 with value: 0.857182825757689.
[I 2025-11-04 19:06:27,541] Trial 1 finished with value: 0.859168270071507 and parameters: {'learning_rate': 0.18302451112666362, 'num_leaves': 252, 'max_depth': 12, 'min_child_samples': 33, 'subsample': 0.9069251956570187, 'colsample_bytree': 0.8140259723299135, 'lambda_l1': 3.4498438259332644, 'lambda_l2': 4.150134118703679}. Best is trial 0 with value: 0.857182825757689.
[I 2025-11-04 19:06:47,572] Trial 2 finished with value: 0.8570571478843461 and parameters: {'learning_rate': 0.030158256252159198, 'num_leaves': 163, 'max_depth': 15, 'min_child_samples': 38, 'subsample': 0.8165050011327852, 'colsample_bytree': 0.8248088079131257, 'lambda_l1': 1.6263466664861526, 'lambda_l2': 7.645546260666062}. Best is trial 2 with value: 0.8570571478843461.
[I 2025-11-04 19:06:51,547] Trial 3 finished with value: 0.8589162742029747 and parameters: {'learning_rate': 0.2936096591935346, 'num_leaves': 160, 'max_depth': 8, 'min_child_samples': 29, 'subsample': 0.5662834323500084, 'colsample_bytree': 0.8927858098702076, 'lambda_l1': 7.5701483704506884, 'lambda_l2': 2.4871342250137096}. Best is trial 2 with value: 0.8570571478843461.
[I 2025-11-04 19:06:55,193] Trial 4 finished with value: 0.8599778065572874 and parameters: {'learning_rate': 0.295405464745368, 'num_leaves': 92, 'max_depth': 15, 'min_child_samples': 8, 'subsample': 0.8351909731697567, 'colsample_bytree': 0.8974082531237776, 'lambda_l1': 2.702565413272983, 'lambda_l2': 2.793405727592395}. Best is trial 2 with value: 0.8570571478843461.
[I 2025-11-04 19:07:35,576] Trial 5 finished with value: 0.8567398669277024 and parameters: {'learning_rate': 0.011048738644704547, 'num_leaves': 134, 'max_depth': 9, 'min_child_samples': 8, 'subsample': 0.9876425472161907, 'colsample_bytree': 0.7101835829670786, 'lambda_l1': 7.570721245973085, 'lambda_l2': 4.410024989565191}. Best is trial 5 with value: 0.8567398669277024.
[I 2025-11-04 19:07:45,335] Trial 6 finished with value: 0.8587119844277943 and parameters: {'learning_rate': 0.1445017533877062, 'num_leaves': 246, 'max_depth': 15, 'min_child_samples': 43, 'subsample': 0.7479444101563113, 'colsample_bytree': 0.9097187585705127, 'lambda_l1': 7.945375878874693, 'lambda_l2': 8.614400214185714}. Best is trial 5 with value: 0.8567398669277024.
[I 2025-11-04 19:07:57,793] Trial 7 finished with value: 0.8579008323615436 and parameters: {'learning_rate': 0.07696262508190554, 'num_leaves': 249, 'max_depth': 12, 'min_child_samples': 8, 'subsample': 0.6898946974081078, 'colsample_bytree': 0.748679772791072, 'lambda_l1': 1.830259764387031, 'lambda_l2': 3.4053233760889468}. Best is trial 5 with value: 0.8567398669277024.
[I 2025-11-04 19:08:02,908] Trial 8 finished with value: 0.857956445116947 and parameters: {'learning_rate': 0.17344362494664253, 'num_leaves': 181, 'max_depth': 7, 'min_child_samples': 43, 'subsample': 0.6873914932125633, 'colsample_bytree': 0.7585329021912764, 'lambda_l1': 8.15625894970021, 'lambda_l2': 8.05215022186583}. Best is trial 5 with value: 0.8567398669277024.
[I 2025-11-04 19:08:11,726] Trial 9 finished with value: 0.8591057346084354 and parameters: {'learning_rate': 0.2355748328377683, 'num_leaves': 228, 'max_depth': 10, 'min_child_samples': 49, 'subsample': 0.8097549740290135, 'colsample_bytree': 0.5003091632337724, 'lambda_l1': 8.136342870439636, 'lambda_l2': 3.4509426036423863}. Best is trial 5 with value: 0.8567398669277024.
[I 2025-11-04 19:08:25,567] Trial 10 finished with value: 0.8660356949780499 and parameters: {'learning_rate': 0.013029238763032351, 'num_leaves': 31, 'max_depth': 3, 'min_child_samples': 19, 'subsample': 0.9918850252963655, 'colsample_bytree': 0.6009683863357624, 'lambda_l1': 9.921936650688583, 'lambda_l2': 0.5978537934647052}. Best is trial 5 with value: 0.8567398669277024.
[I 2025-11-04 19:08:52,432] Trial 11 finished with value: 0.8571822914387186 and parameters: {'learning_rate': 0.01835426630989977, 'num_leaves': 96, 'max_depth': 6, 'min_child_samples': 19, 'subsample': 0.8783947058288453, 'colsample_bytree': 0.6458687446158137, 'lambda_l1': 0.518581807027263, 'lambda_l2': 6.163957439137451}. Best is trial 5 with value: 0.8567398669277024.
[I 2025-11-04 19:09:13,404] Trial 12 finished with value: 0.8580031857879865 and parameters: {'learning_rate': 0.0326786959321891, 'num_leaves': 190, 'max_depth': 5, 'min_child_samples': 17, 'subsample': 0.5017000184607305, 'colsample_bytree': 0.9763923157536348, 'lambda_l1': 5.424146135146132, 'lambda_l2': 6.074308042583605}. Best is trial 5 with value: 0.8567398669277024.
[I 2025-11-04 19:09:31,035] Trial 13 finished with value: 0.856832190039234 and parameters: {'learning_rate': 0.03455528422411264, 'num_leaves': 132, 'max_depth': 9, 'min_child_samples': 38, 'subsample': 0.7729979355666634, 'colsample_bytree': 0.629470951869382, 'lambda_l1': 5.15916434726412, 'lambda_l2': 6.663944746603864}. Best is trial 5 with value: 0.8567398669277024.
[I 2025-11-04 19:10:14,926] Trial 14 finished with value: 0.8570456970367979 and parameters: {'learning_rate': 0.010263436123622622, 'num_leaves': 115, 'max_depth': 9, 'min_child_samples': 25, 'subsample': 0.6241931587317661, 'colsample_bytree': 0.6366122265398022, 'lambda_l1': 5.171134057844251, 'lambda_l2': 5.592019139431871}. Best is trial 5 with value: 0.8567398669277024.
[I 2025-11-04 19:10:33,231] Trial 15 finished with value: 0.8565321803014649 and parameters: {'learning_rate': 0.04104366898612158, 'num_leaves': 60, 'max_depth': 9, 'min_child_samples': 5, 'subsample': 0.7609512172546619, 'colsample_bytree': 0.559470907748585, 'lambda_l1': 6.39760202429694, 'lambda_l2': 6.8686855508884666}. Best is trial 15 with value: 0.8565321803014649.
[I 2025-11-04 19:10:48,058] Trial 16 finished with value: 0.856864758891972 and parameters: {'learning_rate': 0.05364008411186189, 'num_leaves': 48, 'max_depth': 13, 'min_child_samples': 5, 'subsample': 0.9081302743782235, 'colsample_bytree': 0.5010113895318637, 'lambda_l1': 6.395736685082655, 'lambda_l2': 9.879156951840262}. Best is trial 15 with value: 0.8565321803014649.
[I 2025-11-04 19:11:05,882] Trial 17 finished with value: 0.8597033513579906 and parameters: {'learning_rate': 0.02142167971662684, 'num_leaves': 63, 'max_depth': 4, 'min_child_samples': 14, 'subsample': 0.9950099997497626, 'colsample_bytree': 0.574973001140006, 'lambda_l1': 9.984562553976655, 'lambda_l2': 4.825268363862525}. Best is trial 15 with value: 0.8565321803014649.
[I 2025-11-04 19:11:19,897] Trial 18 finished with value: 0.8574709523795754 and parameters: {'learning_rate': 0.05262718382466039, 'num_leaves': 15, 'max_depth': 7, 'min_child_samples': 12, 'subsample': 0.7089723661525843, 'colsample_bytree': 0.5508536250692895, 'lambda_l1': 3.8442566312952873, 'lambda_l2': 1.113302731000716}. Best is trial 15 with value: 0.8565321803014649.
[I 2025-11-04 19:11:54,689] Trial 19 finished with value: 0.8565975398757283 and parameters: {'learning_rate': 0.017512771642384874, 'num_leaves': 76, 'max_depth': 10, 'min_child_samples': 23, 'subsample': 0.5949932423391407, 'colsample_bytree': 0.7067837697959083, 'lambda_l1': 6.254103116409424, 'lambda_l2': 6.933446917652349}. Best is trial 15 with value: 0.8565321803014649.
[I 2025-11-04 19:12:29,336] Trial 20 finished with value: 0.856613090110424 and parameters: {'learning_rate': 0.018486781170290546, 'num_leaves': 67, 'max_depth': 11, 'min_child_samples': 24, 'subsample': 0.6191411900416735, 'colsample_bytree': 0.7081808858759157, 'lambda_l1': 5.908025820292302, 'lambda_l2': 7.081716177237795}. Best is trial 15 with value: 0.8565321803014649.
[I 2025-11-04 19:13:01,114] Trial 21 finished with value: 0.856553117939629 and parameters: {'learning_rate': 0.018590184229244883, 'num_leaves': 68, 'max_depth': 11, 'min_child_samples': 25, 'subsample': 0.6313621897925477, 'colsample_bytree': 0.6974201337891797, 'lambda_l1': 6.005055529260535, 'lambda_l2': 7.189338115254472}. Best is trial 15 with value: 0.8565321803014649.
[I 2025-11-04 19:13:21,855] Trial 22 finished with value: 0.8566821396634993 and parameters: {'learning_rate': 0.025565689550682048, 'num_leaves': 85, 'max_depth': 13, 'min_child_samples': 23, 'subsample': 0.6307018291712839, 'colsample_bytree': 0.6806330747805301, 'lambda_l1': 4.308711044606329, 'lambda_l2': 7.1543301899170615}. Best is trial 15 with value: 0.8565321803014649.
[I 2025-11-04 19:13:53,158] Trial 23 finished with value: 0.856899907136347 and parameters: {'learning_rate': 0.014591841494368424, 'num_leaves': 45, 'max_depth': 10, 'min_child_samples': 27, 'subsample': 0.5599617629850154, 'colsample_bytree': 0.8057089844239986, 'lambda_l1': 6.530071805712574, 'lambda_l2': 9.954310366606984}. Best is trial 15 with value: 0.8565321803014649.
[I 2025-11-04 19:14:08,388] Trial 24 finished with value: 0.8565858387138277 and parameters: {'learning_rate': 0.04169309945569654, 'num_leaves': 73, 'max_depth': 8, 'min_child_samples': 31, 'subsample': 0.6568869193750597, 'colsample_bytree': 0.6747614217751845, 'lambda_l1': 8.816830005641906, 'lambda_l2': 5.41261603996527}. Best is trial 15 with value: 0.8565321803014649.

Best params for split 2016 : {'learning_rate': 0.04104366898612158, 'num_leaves': 60, 'max_depth': 9, 'min_child_samples': 5, 'subsample': 0.7609512172546619, 'colsample_bytree': 0.559470907748585, 'lambda_l1': 6.39760202429694, 'lambda_l2': 6.8686855508884666}

Training final model...

============================================================
METRICS FOR TEST YEAR 2017
============================================================
  RMSE: 0.8565
  MAE: 0.6270
  R2: 0.6447

Top 10 Feature Importances:
                feature    importance
9   log_amount_sum_lag1  1.589728e+06
10  log_amount_sum_lag2  7.750725e+05
11  log_amount_sum_lag3  6.108063e+05
12     amount_avg_roll3  3.549256e+05
13       tx_count_roll3  1.598455e+05
3       amount_avg_lag1  1.201544e+05
4       amount_avg_lag2  5.666786e+04
0         tx_count_lag1  3.668019e+04
1         tx_count_lag2  3.432678e+04
5       amount_avg_lag3  2.570487e+04

Baseline (predict with lag1 only):
  RMSE: 1.4111
  R2: 0.0358
  Model improvement: 39.30%

Exported predictions for test year 2017 -&gt; predictions_lag_2017.csv

============================================================
Temporal split: train &lt;= 201712 | test: 201801..201812
============================================================
Train rows: 375,807 | Test rows: 125,625
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="application/vnd.jupyter.stderr" tabindex="0">
<pre>[I 2025-11-04 19:14:51,566] A new study created in memory with name: no-name-0688d5aa-fe4f-429a-a5dc-90e9b0d51208
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Feature matrix shapes: X_train=(375807, 18), X_test=(125625, 18)

Optimizing hyperparameters with Optuna...
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>  0%|          | 0/25 [00:00&lt;?, ?it/s]</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>[I 2025-11-04 19:15:09,043] Trial 0 finished with value: 0.8569957862906069 and parameters: {'learning_rate': 0.2968854492154463, 'num_leaves': 29, 'max_depth': 3, 'min_child_samples': 14, 'subsample': 0.9954226453802395, 'colsample_bytree': 0.5577154255337792, 'lambda_l1': 3.4772112534834108, 'lambda_l2': 2.6130221214811646}. Best is trial 0 with value: 0.8569957862906069.
[I 2025-11-04 19:15:18,566] Trial 1 finished with value: 0.8567626544410646 and parameters: {'learning_rate': 0.14493021492453936, 'num_leaves': 181, 'max_depth': 9, 'min_child_samples': 18, 'subsample': 0.9500963547176348, 'colsample_bytree': 0.8328812157890804, 'lambda_l1': 3.4592303973858165, 'lambda_l2': 2.7225015831669697}. Best is trial 1 with value: 0.8567626544410646.
[I 2025-11-04 19:15:57,291] Trial 2 finished with value: 0.8555555471154466 and parameters: {'learning_rate': 0.0179958079836969, 'num_leaves': 112, 'max_depth': 12, 'min_child_samples': 7, 'subsample': 0.5288090835958315, 'colsample_bytree': 0.5074311848081144, 'lambda_l1': 5.718193591656508, 'lambda_l2': 9.767120682419726}. Best is trial 2 with value: 0.8555555471154466.
[I 2025-11-04 19:16:19,767] Trial 3 finished with value: 0.8554242543180526 and parameters: {'learning_rate': 0.049622919485263525, 'num_leaves': 118, 'max_depth': 7, 'min_child_samples': 21, 'subsample': 0.594904490561392, 'colsample_bytree': 0.6206760636901222, 'lambda_l1': 5.566011340580021, 'lambda_l2': 6.919662597248671}. Best is trial 3 with value: 0.8554242543180526.
[I 2025-11-04 19:16:31,135] Trial 4 finished with value: 0.8564752087355973 and parameters: {'learning_rate': 0.16434780466005547, 'num_leaves': 219, 'max_depth': 6, 'min_child_samples': 43, 'subsample': 0.8596770523355644, 'colsample_bytree': 0.551023779548208, 'lambda_l1': 4.231562572144622, 'lambda_l2': 6.043002181914169}. Best is trial 3 with value: 0.8554242543180526.
[I 2025-11-04 19:16:52,656] Trial 5 finished with value: 0.8558217976637128 and parameters: {'learning_rate': 0.07904804647457449, 'num_leaves': 70, 'max_depth': 5, 'min_child_samples': 28, 'subsample': 0.7846796656686499, 'colsample_bytree': 0.7604035059612902, 'lambda_l1': 8.773023016624142, 'lambda_l2': 2.92165875551209}. Best is trial 3 with value: 0.8554242543180526.
[I 2025-11-04 19:17:06,603] Trial 6 finished with value: 0.8558282567649091 and parameters: {'learning_rate': 0.0742528099485024, 'num_leaves': 192, 'max_depth': 7, 'min_child_samples': 49, 'subsample': 0.9414710630210008, 'colsample_bytree': 0.5709480039724535, 'lambda_l1': 0.36643619120206417, 'lambda_l2': 5.726196761897757}. Best is trial 3 with value: 0.8554242543180526.
[I 2025-11-04 19:17:34,809] Trial 7 finished with value: 0.8556542115454846 and parameters: {'learning_rate': 0.02844384446141014, 'num_leaves': 201, 'max_depth': 11, 'min_child_samples': 28, 'subsample': 0.9656219325645222, 'colsample_bytree': 0.7543470918176542, 'lambda_l1': 5.625589298587576, 'lambda_l2': 1.8438129919293378}. Best is trial 3 with value: 0.8554242543180526.
[I 2025-11-04 19:17:41,965] Trial 8 finished with value: 0.8569205816440617 and parameters: {'learning_rate': 0.13836630313865536, 'num_leaves': 203, 'max_depth': 14, 'min_child_samples': 37, 'subsample': 0.909539832430386, 'colsample_bytree': 0.6841095670928535, 'lambda_l1': 9.517317649692389, 'lambda_l2': 5.78721033544642}. Best is trial 3 with value: 0.8554242543180526.
[I 2025-11-04 19:18:12,353] Trial 9 finished with value: 0.8554901890247484 and parameters: {'learning_rate': 0.027403856912657936, 'num_leaves': 57, 'max_depth': 9, 'min_child_samples': 5, 'subsample': 0.7747241791842854, 'colsample_bytree': 0.5543819422281355, 'lambda_l1': 7.858592570041319, 'lambda_l2': 4.982164945754252}. Best is trial 3 with value: 0.8554242543180526.
[I 2025-11-04 19:19:03,405] Trial 10 finished with value: 0.8560960116918027 and parameters: {'learning_rate': 0.01102465250694307, 'num_leaves': 134, 'max_depth': 15, 'min_child_samples': 18, 'subsample': 0.5663332404903085, 'colsample_bytree': 0.9540638457883903, 'lambda_l1': 1.1021378321847592, 'lambda_l2': 8.695007075681797}. Best is trial 3 with value: 0.8554242543180526.
[I 2025-11-04 19:19:28,403] Trial 11 finished with value: 0.8554174308493665 and parameters: {'learning_rate': 0.035596852405221785, 'num_leaves': 81, 'max_depth': 9, 'min_child_samples': 7, 'subsample': 0.65018642180776, 'colsample_bytree': 0.6384313542878047, 'lambda_l1': 7.462239055415456, 'lambda_l2': 7.802240139784682}. Best is trial 11 with value: 0.8554174308493665.
[I 2025-11-04 19:19:51,751] Trial 12 finished with value: 0.8552784114377061 and parameters: {'learning_rate': 0.04340774631214881, 'num_leaves': 99, 'max_depth': 8, 'min_child_samples': 13, 'subsample': 0.641651791370763, 'colsample_bytree': 0.6602582388492748, 'lambda_l1': 7.049708581832299, 'lambda_l2': 7.710248563306214}. Best is trial 12 with value: 0.8552784114377061.
[I 2025-11-04 19:20:13,169] Trial 13 finished with value: 0.8555534042161069 and parameters: {'learning_rate': 0.04086893605839974, 'num_leaves': 92, 'max_depth': 11, 'min_child_samples': 10, 'subsample': 0.6658336541478315, 'colsample_bytree': 0.6667762569273629, 'lambda_l1': 7.326638418455208, 'lambda_l2': 7.472314567805107}. Best is trial 12 with value: 0.8552784114377061.
[I 2025-11-04 19:20:48,488] Trial 14 finished with value: 0.8554856595192731 and parameters: {'learning_rate': 0.026993852631041388, 'num_leaves': 152, 'max_depth': 8, 'min_child_samples': 12, 'subsample': 0.6575812431624022, 'colsample_bytree': 0.8269911715034698, 'lambda_l1': 6.967103894106916, 'lambda_l2': 8.220308166347056}. Best is trial 12 with value: 0.8552784114377061.
[I 2025-11-04 19:21:11,709] Trial 15 finished with value: 0.860394639870501 and parameters: {'learning_rate': 0.014434720771622203, 'num_leaves': 23, 'max_depth': 4, 'min_child_samples': 23, 'subsample': 0.6968186908084687, 'colsample_bytree': 0.6743617757348039, 'lambda_l1': 9.958191955226571, 'lambda_l2': 4.193894484256004}. Best is trial 12 with value: 0.8552784114377061.
[I 2025-11-04 19:21:24,424] Trial 16 finished with value: 0.8558468181585779 and parameters: {'learning_rate': 0.06656458180437946, 'num_leaves': 75, 'max_depth': 11, 'min_child_samples': 34, 'subsample': 0.7166003129121575, 'colsample_bytree': 0.6236446853593814, 'lambda_l1': 6.747953122684818, 'lambda_l2': 0.2265348878029787}. Best is trial 12 with value: 0.8552784114377061.
[I 2025-11-04 19:21:45,108] Trial 17 finished with value: 0.855705081317758 and parameters: {'learning_rate': 0.04661867933047049, 'num_leaves': 47, 'max_depth': 13, 'min_child_samples': 13, 'subsample': 0.6267396034458361, 'colsample_bytree': 0.8146937706317797, 'lambda_l1': 8.771845109957901, 'lambda_l2': 9.311461726983703}. Best is trial 12 with value: 0.8552784114377061.
[I 2025-11-04 19:22:40,103] Trial 18 finished with value: 0.8558525837563088 and parameters: {'learning_rate': 0.020085595778724725, 'num_leaves': 253, 'max_depth': 9, 'min_child_samples': 5, 'subsample': 0.8264357774789908, 'colsample_bytree': 0.9972508445818231, 'lambda_l1': 8.454728737255673, 'lambda_l2': 7.909876126616567}. Best is trial 12 with value: 0.8552784114377061.
[I 2025-11-04 19:22:49,981] Trial 19 finished with value: 0.8561813366187313 and parameters: {'learning_rate': 0.10330077454067457, 'num_leaves': 158, 'max_depth': 10, 'min_child_samples': 16, 'subsample': 0.7344903479128361, 'colsample_bytree': 0.7153545568090949, 'lambda_l1': 2.111294513228485, 'lambda_l2': 6.776470653115433}. Best is trial 12 with value: 0.8552784114377061.
[I 2025-11-04 19:23:23,154] Trial 20 finished with value: 0.8553042382294662 and parameters: {'learning_rate': 0.03515144515250455, 'num_leaves': 90, 'max_depth': 7, 'min_child_samples': 10, 'subsample': 0.5182573155292942, 'colsample_bytree': 0.618343113473971, 'lambda_l1': 6.3368024245870584, 'lambda_l2': 8.898383471121956}. Best is trial 12 with value: 0.8552784114377061.
[I 2025-11-04 19:23:52,261] Trial 21 finished with value: 0.8553700904679512 and parameters: {'learning_rate': 0.03787805860451734, 'num_leaves': 97, 'max_depth': 7, 'min_child_samples': 10, 'subsample': 0.5139773828526584, 'colsample_bytree': 0.6190764817652042, 'lambda_l1': 6.333495762525951, 'lambda_l2': 8.8163004728009}. Best is trial 12 with value: 0.8552784114377061.
[I 2025-11-04 19:24:20,899] Trial 22 finished with value: 0.8557498408333142 and parameters: {'learning_rate': 0.031536530397857074, 'num_leaves': 101, 'max_depth': 6, 'min_child_samples': 10, 'subsample': 0.5100587221713498, 'colsample_bytree': 0.6045831936032628, 'lambda_l1': 6.5679388487819255, 'lambda_l2': 9.088333313970837}. Best is trial 12 with value: 0.8552784114377061.
[I 2025-11-04 19:24:39,437] Trial 23 finished with value: 0.8554802220764143 and parameters: {'learning_rate': 0.05553339139523381, 'num_leaves': 125, 'max_depth': 7, 'min_child_samples': 22, 'subsample': 0.5466497841212117, 'colsample_bytree': 0.7288870013450256, 'lambda_l1': 6.219067231494129, 'lambda_l2': 9.858046393144361}. Best is trial 12 with value: 0.8552784114377061.
[I 2025-11-04 19:25:06,724] Trial 24 finished with value: 0.8573202848061664 and parameters: {'learning_rate': 0.021190906051722976, 'num_leaves': 98, 'max_depth': 5, 'min_child_samples': 9, 'subsample': 0.5923099479112479, 'colsample_bytree': 0.5118146185492788, 'lambda_l1': 4.686345134230243, 'lambda_l2': 8.616657513465544}. Best is trial 12 with value: 0.8552784114377061.

Best params for split 2017 : {'learning_rate': 0.04340774631214881, 'num_leaves': 99, 'max_depth': 8, 'min_child_samples': 13, 'subsample': 0.641651791370763, 'colsample_bytree': 0.6602582388492748, 'lambda_l1': 7.049708581832299, 'lambda_l2': 7.710248563306214}

Training final model...

============================================================
METRICS FOR TEST YEAR 2018
============================================================
  RMSE: 0.8553
  MAE: 0.6245
  R2: 0.6473

Top 10 Feature Importances:
                feature    importance
9   log_amount_sum_lag1  2.544943e+06
10  log_amount_sum_lag2  1.507439e+06
11  log_amount_sum_lag3  5.958667e+05
12     amount_avg_roll3  4.874779e+05
3       amount_avg_lag1  1.586545e+05
13       tx_count_roll3  1.060768e+05
4       amount_avg_lag2  5.469385e+04
5       amount_avg_lag3  3.618367e+04
0         tx_count_lag1  3.470439e+04
6    amount_stddev_lag1  2.611761e+04

Baseline (predict with lag1 only):
  RMSE: 1.3556
  R2: 0.1139
  Model improvement: 36.91%

Exported predictions for test year 2018 -&gt; predictions_lag_2018.csv

============================================================
Temporal split: train &lt;= 201812 | test: 201901..201910
============================================================
Train rows: 501,432 | Test rows: 104,736
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="application/vnd.jupyter.stderr" tabindex="0">
<pre>[I 2025-11-04 19:26:04,197] A new study created in memory with name: no-name-ef2c02fc-d9c1-4590-90c0-d17fc2d21bfd
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Feature matrix shapes: X_train=(501432, 18), X_test=(104736, 18)

Optimizing hyperparameters with Optuna...
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>  0%|          | 0/25 [00:00&lt;?, ?it/s]</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>[I 2025-11-04 19:26:21,934] Trial 0 finished with value: 0.8517925850693299 and parameters: {'learning_rate': 0.07658544810896903, 'num_leaves': 247, 'max_depth': 15, 'min_child_samples': 31, 'subsample': 0.9057235481494827, 'colsample_bytree': 0.7603237675788115, 'lambda_l1': 2.0248835592148873, 'lambda_l2': 0.1896268338940299}. Best is trial 0 with value: 0.8517925850693299.
[I 2025-11-04 19:27:13,221] Trial 1 finished with value: 0.8507980247218723 and parameters: {'learning_rate': 0.015213352671695829, 'num_leaves': 168, 'max_depth': 14, 'min_child_samples': 34, 'subsample': 0.8873891488112247, 'colsample_bytree': 0.68934057030208, 'lambda_l1': 1.7380562394601562, 'lambda_l2': 9.211845332774924}. Best is trial 1 with value: 0.8507980247218723.
[I 2025-11-04 19:27:34,709] Trial 2 finished with value: 0.8546544908373014 and parameters: {'learning_rate': 0.039541779181063615, 'num_leaves': 150, 'max_depth': 3, 'min_child_samples': 11, 'subsample': 0.8795588648052812, 'colsample_bytree': 0.5623208787318222, 'lambda_l1': 6.544905140479704, 'lambda_l2': 7.003053206714556}. Best is trial 1 with value: 0.8507980247218723.
[I 2025-11-04 19:27:43,558] Trial 3 finished with value: 0.8527588588320769 and parameters: {'learning_rate': 0.2803414342776365, 'num_leaves': 205, 'max_depth': 6, 'min_child_samples': 20, 'subsample': 0.5926312103938203, 'colsample_bytree': 0.9450755072946481, 'lambda_l1': 3.9664964437150587, 'lambda_l2': 6.814929556039713}. Best is trial 1 with value: 0.8507980247218723.
[I 2025-11-04 19:27:58,714] Trial 4 finished with value: 0.8512162949394981 and parameters: {'learning_rate': 0.06801066059139525, 'num_leaves': 186, 'max_depth': 14, 'min_child_samples': 47, 'subsample': 0.6373158496999587, 'colsample_bytree': 0.5904305215615666, 'lambda_l1': 2.2919846981258543, 'lambda_l2': 7.234558540188255}. Best is trial 1 with value: 0.8507980247218723.
[I 2025-11-04 19:28:39,821] Trial 5 finished with value: 0.851113646594774 and parameters: {'learning_rate': 0.01861655476096533, 'num_leaves': 175, 'max_depth': 7, 'min_child_samples': 38, 'subsample': 0.7178249408509874, 'colsample_bytree': 0.6208166658906522, 'lambda_l1': 7.238816484759411, 'lambda_l2': 3.1861787814234055}. Best is trial 1 with value: 0.8507980247218723.
[I 2025-11-04 19:29:08,318] Trial 6 finished with value: 0.8512005786825378 and parameters: {'learning_rate': 0.039164996821696635, 'num_leaves': 193, 'max_depth': 15, 'min_child_samples': 26, 'subsample': 0.5553539379167839, 'colsample_bytree': 0.7515766887442854, 'lambda_l1': 4.4649742731111575, 'lambda_l2': 2.7589013181597224}. Best is trial 1 with value: 0.8507980247218723.
[I 2025-11-04 19:29:37,976] Trial 7 finished with value: 0.8505982666492318 and parameters: {'learning_rate': 0.03853929362445576, 'num_leaves': 134, 'max_depth': 14, 'min_child_samples': 40, 'subsample': 0.809892070582775, 'colsample_bytree': 0.5176864926407814, 'lambda_l1': 9.231892436500654, 'lambda_l2': 2.751135496708099}. Best is trial 7 with value: 0.8505982666492318.
[I 2025-11-04 19:30:46,145] Trial 8 finished with value: 0.851356711928765 and parameters: {'learning_rate': 0.013020716483459066, 'num_leaves': 173, 'max_depth': 11, 'min_child_samples': 46, 'subsample': 0.5696706610005324, 'colsample_bytree': 0.930033019741171, 'lambda_l1': 1.4681706330382305, 'lambda_l2': 8.420990372699668}. Best is trial 7 with value: 0.8505982666492318.
[I 2025-11-04 19:31:03,863] Trial 9 finished with value: 0.8539844315148623 and parameters: {'learning_rate': 0.049225031252825596, 'num_leaves': 240, 'max_depth': 3, 'min_child_samples': 13, 'subsample': 0.7637799585013193, 'colsample_bytree': 0.5350525490861943, 'lambda_l1': 0.3432543829849277, 'lambda_l2': 8.812309469868238}. Best is trial 7 with value: 0.8505982666492318.
[I 2025-11-04 19:31:14,446] Trial 10 finished with value: 0.8516141296080513 and parameters: {'learning_rate': 0.15251951898611793, 'num_leaves': 72, 'max_depth': 11, 'min_child_samples': 41, 'subsample': 0.7922561674661138, 'colsample_bytree': 0.828244827653926, 'lambda_l1': 9.933461278440182, 'lambda_l2': 4.1601389161713245}. Best is trial 7 with value: 0.8505982666492318.
[I 2025-11-04 19:32:03,121] Trial 11 finished with value: 0.8507989736068788 and parameters: {'learning_rate': 0.021050383962988438, 'num_leaves': 100, 'max_depth': 12, 'min_child_samples': 34, 'subsample': 0.9989673640979666, 'colsample_bytree': 0.7103307945415719, 'lambda_l1': 9.847738593130646, 'lambda_l2': 1.4039352939298189}. Best is trial 7 with value: 0.8505982666492318.
[I 2025-11-04 19:33:03,013] Trial 12 finished with value: 0.8514877122507369 and parameters: {'learning_rate': 0.010199816925860417, 'num_leaves': 123, 'max_depth': 13, 'min_child_samples': 27, 'subsample': 0.8915895353890816, 'colsample_bytree': 0.6708478307418427, 'lambda_l1': 7.590945021390971, 'lambda_l2': 5.496425493667977}. Best is trial 7 with value: 0.8505982666492318.
[I 2025-11-04 19:33:35,181] Trial 13 finished with value: 0.851111159082124 and parameters: {'learning_rate': 0.024696115817475044, 'num_leaves': 37, 'max_depth': 9, 'min_child_samples': 40, 'subsample': 0.8290255067612834, 'colsample_bytree': 0.5022533982204401, 'lambda_l1': 5.7791576979080075, 'lambda_l2': 5.581406276375487}. Best is trial 7 with value: 0.8505982666492318.
[I 2025-11-04 19:33:48,425] Trial 14 finished with value: 0.8514197075900791 and parameters: {'learning_rate': 0.109869731843808, 'num_leaves': 123, 'max_depth': 9, 'min_child_samples': 22, 'subsample': 0.983968440547575, 'colsample_bytree': 0.8414578554543651, 'lambda_l1': 8.446742375459666, 'lambda_l2': 9.976890976909228}. Best is trial 7 with value: 0.8505982666492318.
[I 2025-11-04 19:34:29,094] Trial 15 finished with value: 0.8506566228897663 and parameters: {'learning_rate': 0.027907389696880388, 'num_leaves': 85, 'max_depth': 13, 'min_child_samples': 34, 'subsample': 0.7068331669365681, 'colsample_bytree': 0.6520040693783385, 'lambda_l1': 3.3806403971401924, 'lambda_l2': 2.259475041094671}. Best is trial 7 with value: 0.8505982666492318.
[I 2025-11-04 19:35:04,414] Trial 16 finished with value: 0.8507517010529605 and parameters: {'learning_rate': 0.030026441654411186, 'num_leaves': 79, 'max_depth': 11, 'min_child_samples': 43, 'subsample': 0.6830567847266207, 'colsample_bytree': 0.6236606408748524, 'lambda_l1': 3.487957609483026, 'lambda_l2': 1.9095537933859577}. Best is trial 7 with value: 0.8505982666492318.
[I 2025-11-04 19:35:29,518] Trial 17 finished with value: 0.8515992789002254 and parameters: {'learning_rate': 0.033960507063229985, 'num_leaves': 22, 'max_depth': 13, 'min_child_samples': 5, 'subsample': 0.6845554306323269, 'colsample_bytree': 0.6367369598636126, 'lambda_l1': 5.426136204744452, 'lambda_l2': 0.19073283932256846}. Best is trial 7 with value: 0.8505982666492318.
[I 2025-11-04 19:35:53,832] Trial 18 finished with value: 0.8506380264788966 and parameters: {'learning_rate': 0.06284610807733688, 'num_leaves': 72, 'max_depth': 7, 'min_child_samples': 34, 'subsample': 0.8221935575086197, 'colsample_bytree': 0.5103750876608361, 'lambda_l1': 3.2818498683617623, 'lambda_l2': 3.5643540072381272}. Best is trial 7 with value: 0.8505982666492318.
[I 2025-11-04 19:36:11,000] Trial 19 finished with value: 0.8510103174483835 and parameters: {'learning_rate': 0.10662104689285033, 'num_leaves': 51, 'max_depth': 6, 'min_child_samples': 50, 'subsample': 0.839018148828396, 'colsample_bytree': 0.5036734115897981, 'lambda_l1': 8.520911183555233, 'lambda_l2': 4.502361380912701}. Best is trial 7 with value: 0.8505982666492318.
[I 2025-11-04 19:36:33,907] Trial 20 finished with value: 0.8507364391640561 and parameters: {'learning_rate': 0.05536266564359087, 'num_leaves': 144, 'max_depth': 7, 'min_child_samples': 37, 'subsample': 0.943103862782123, 'colsample_bytree': 0.5675077896122233, 'lambda_l1': 0.2743940411215213, 'lambda_l2': 3.220343328199012}. Best is trial 7 with value: 0.8505982666492318.
[I 2025-11-04 19:37:09,077] Trial 21 finished with value: 0.8505807245644074 and parameters: {'learning_rate': 0.028221378430824437, 'num_leaves': 97, 'max_depth': 10, 'min_child_samples': 30, 'subsample': 0.5052109644597409, 'colsample_bytree': 0.5545019989282791, 'lambda_l1': 3.085102436289876, 'lambda_l2': 1.728600792902937}. Best is trial 21 with value: 0.8505807245644074.
[I 2025-11-04 19:37:35,172] Trial 22 finished with value: 0.8505677083830455 and parameters: {'learning_rate': 0.04954078766165331, 'num_leaves': 107, 'max_depth': 8, 'min_child_samples': 29, 'subsample': 0.5023535038813072, 'colsample_bytree': 0.5436225269183038, 'lambda_l1': 2.8505187207585063, 'lambda_l2': 1.253981709069056}. Best is trial 22 with value: 0.8505677083830455.
[I 2025-11-04 19:38:02,431] Trial 23 finished with value: 0.8506261488773817 and parameters: {'learning_rate': 0.043683587270085866, 'num_leaves': 107, 'max_depth': 10, 'min_child_samples': 29, 'subsample': 0.5020873031566986, 'colsample_bytree': 0.5686057043757636, 'lambda_l1': 2.7072970060110944, 'lambda_l2': 1.0811536531759978}. Best is trial 22 with value: 0.8505677083830455.
[I 2025-11-04 19:38:17,200] Trial 24 finished with value: 0.8509658763358988 and parameters: {'learning_rate': 0.08728083712853787, 'num_leaves': 108, 'max_depth': 8, 'min_child_samples': 23, 'subsample': 0.5137099273103133, 'colsample_bytree': 0.6074666168134113, 'lambda_l1': 4.652248199623095, 'lambda_l2': 1.0192490440500648}. Best is trial 22 with value: 0.8505677083830455.

Best params for split 2018 : {'learning_rate': 0.04954078766165331, 'num_leaves': 107, 'max_depth': 8, 'min_child_samples': 29, 'subsample': 0.5023535038813072, 'colsample_bytree': 0.5436225269183038, 'lambda_l1': 2.8505187207585063, 'lambda_l2': 1.253981709069056}

Training final model...

============================================================
METRICS FOR TEST YEAR 2019
============================================================
  RMSE: 0.8506
  MAE: 0.6207
  R2: 0.6528

Top 10 Feature Importances:
                feature    importance
9   log_amount_sum_lag1  2.658133e+06
10  log_amount_sum_lag2  1.389141e+06
11  log_amount_sum_lag3  1.268433e+06
12     amount_avg_roll3  6.241993e+05
13       tx_count_roll3  2.323402e+05
3       amount_avg_lag1  1.724128e+05
4       amount_avg_lag2  1.075229e+05
5       amount_avg_lag3  6.847146e+04
1         tx_count_lag2  5.406741e+04
0         tx_count_lag1  4.724137e+04

Baseline (predict with lag1 only):
  RMSE: 1.3125
  R2: 0.1732
  Model improvement: 35.19%

Exported predictions for test year 2019 -&gt; predictions_lag_2019.csv
</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=Lh3osEYYL-Uc">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># -------------------------------------------------------------------------</span>
<span class="c1"># 15. Final Global Export</span>
<span class="c1"># -------------------------------------------------------------------------</span>

<span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="n">results_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">"monthly_merchant_results_lag.csv"</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span> <span class="o">+</span> <span class="s2">"="</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"SUMMARY OF ALL TEMPORAL SPLITS"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"="</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results_df</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Exported summary -&gt; monthly_merchant_results_lag.csv"</span><span class="p">)</span>

<span class="c1"># Stats</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span> <span class="o">+</span> <span class="s2">"="</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"GLOBAL STATISTICS"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"="</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Average RMSE: </span><span class="si">{</span><span class="n">results_df</span><span class="p">[</span><span class="s1">'rmse'</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Average MAE: </span><span class="si">{</span><span class="n">results_df</span><span class="p">[</span><span class="s1">'mae'</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Average R2: </span><span class="si">{</span><span class="n">results_df</span><span class="p">[</span><span class="s1">'r2'</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Average Baseline R2: </span><span class="si">{</span><span class="n">results_df</span><span class="p">[</span><span class="s1">'baseline_r2'</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Average Improvement: </span><span class="si">{</span><span class="n">results_df</span><span class="p">[</span><span class="s1">'improvement_pct'</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>
============================================================
SUMMARY OF ALL TEMPORAL SPLITS
============================================================
   year_train  year_test      rmse       mae        r2  baseline_rmse  \
0        2015       2016  0.882196  0.646131  0.625716       1.518965   
1        2016       2017  0.856532  0.626999  0.644736       1.411053   
2        2017       2018  0.855278  0.624514  0.647285       1.355602   
3        2018       2019  0.850568  0.620746  0.652778       1.312489   

   baseline_r2  improvement_pct  \
0    -0.109599        41.921222   
1     0.035838        39.298374   
2     0.113919        36.907848   
3     0.173237        35.194322   

                                         best_params  
0  {'learning_rate': 0.013557647544613773, 'num_l...  
1  {'learning_rate': 0.04104366898612158, 'num_le...  
2  {'learning_rate': 0.04340774631214881, 'num_le...  
3  {'learning_rate': 0.04954078766165331, 'num_le...  

Exported summary -&gt; monthly_merchant_results_lag.csv

============================================================
GLOBAL STATISTICS
============================================================
Average RMSE: 0.8611
Average MAE: 0.6296
Average R2: 0.6426
Average Baseline R2: 0.0533
Average Improvement: 38.33%
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=QEwCYeBPpkjR">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h1><b><span style="color:blue;">3. CONCLUSION<b></b></span></b></h1>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=SAPF7EFWGnU0">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h4><b>A time series machine learning algorithm has to be clearly thought out and prepared.</b></h4>
<p>The exercise was to create an algorithm that would fit the demand, which was to forecast data and trends monthly. So , I had to find the best algorithm and methodology to avoid data leakage, and the best hyperparameters using Optuna. Then , I will include the predictions in the Power BI report .</p>
<p>Reminder: Just like data in real-life production, the algorithm must also live and be updated depending on the initial demand. In this case , it could be updated once a month, for example.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=BXIhEJ8yN3PX">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h2 id="Author-:-Aurelien-Legendre"><strong>Author : Aurelien Legendre</strong><a class="anchor-link" href="#Author-:-Aurelien-Legendre"></a></h2>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=6RoJs72zVQzC">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In[]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span> 
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
<div class="jp-OutputPrompt jp-OutputArea-prompt">Out[]:</div>
<div class="jp-RenderedImage jp-OutputArea-output jp-OutputArea-executeResult" tabindex="0">
<img alt="No description has been provided for this image" class="" src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAeAB4AAD/2wBDAAIBAQIBAQICAgICAgICAwUDAwMDAwYEBAMFBwYHBwcGBwcICQsJCAgKCAcHCg0KCgsMDAwMBwkODw0MDgsMDAz/2wBDAQICAgMDAwYDAwYMCAcIDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAz/wAARCADNAM8DASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD997ZQY8kDOak2D0H5Uy2OIvxpxbmktipbi7R6CjYvoPypMEkGndKZImweg/KgoPQflSM+OKVDkUWABGB2FGweg/KlJxTWbHFAClVA6D8qNg9B+VIoJ69Kd0oATYPQUhVQegoZsUAZ5osAoQego2D0H5Uvem7+aADC5xgZ+lAjAPQflQoyc04nFACbB6D8qQhQeg/Kgvg0AEnntQAuweg/KjYPQflS55prPjIosBxvxD+PXhT4XfEDwZ4X1vU7ex1rx9eTWOiwOcG8mihaZ1H/AABD9TgdSK7FVU9h+VfzP/8ABef/AIKc638Vv+CpdjdeE9Se30b4EX8NroTwScPfwzCW4uMjqTIoj9NsQ9Tn+hj9kT9oTTv2q/2aPBPxE0p43s/FmlQ34CHIjcjEifVZAykeqmvVx+U1MLQpVpfbWvl2/A1nTcYp9z0rYPQflRtGfuj8qQvQoyc15RkLsH90flTFGLk/SpCcVGpzcn6VL6FISD/VfjUgXFMtv9X+NSU1sEtwpGySOtLQBimSIFpcYopCcEUAKaQpk0tec/tJ/tb/AA5/ZD8FHX/iJ4s0nwzp5yIftUw866YDJWKMfNIfZQauEJTkoQV2+iCx6NUF/qEGmWslxczRW8EKlnkkcIiAdSSeAK/Ff9tn/g63l+2XOjfAnwivkplP+Eg8Qpy59YrVTwPeRuf7or8uv2oP+Chfxs/bD1CWXx78Q/EmsWjsWGnJdtb2CfSCPbHx7gmvrMBwXjq6U6toLz3+7/M2jRb3P6Wvjt/wWI/Zs/Z0eaHxF8WPDL3sGd1ppsp1GfI7bYA2D9SK+Tvib/wdkfALwncyQ+HfC3xB8VFeFmS1gs4W/GWQMP8Avmv55mjI4OaaLJmYBFLMxwAOSa+lo8EYKmr1ZOX4f195usPHqft/4i/4PBdKjmI0r4IahInZrrxEik/8BWA/zrOsP+DwcCYG5+BpaPPPleJMH9YK/Ifwh+zD8SPHiK2ifD7xtrEbch7LQ7qdT+KoRXQXv7CPxo0yHzZ/hH8So0UZLHw1e4Hv/q63fDeTp2sv/An/AJj9lA/ZjwP/AMHePwx1GVF8Q/CjxzpKt1eyvLa9Vf8AvoxH9K+jPg1/wcb/ALKvxfkjhm8c3fhO5lwPK13TZrdQfTzFDJ+JIFfzM+K/A2teCLz7Nrej6po1xnHlX1rJbv8Ak4BrK+wnuDWc+DMvqr902vR3/O4PDwP7NvhL8f8AwN8etGGoeC/F3h3xTZkZMmmX8VyFz/eCklfxrsAcd+lfxbeA/iL4i+FuuRap4Z13WPD+pW53R3Wm3klrMh9mQg198fsif8HKn7Qn7Pc1nZeK7yx+J+gQkLJDrC+Xe7O4W5Qbs47uG+leBjeB8TDXDS5vJ6P/AC/Ixlh30P6UGOSMV8z/APBXL9tiL9gj9hTxr44hliXxDJbHTNAjc/fv5wUibHcJzIR3CEVxH7Df/Bdz4EfttCw0yHWz4J8X3hWMaJrzLC8kp/himz5cuT0wQx/u9q8//wCCyP8AwS0+Kn/BV74o+DPDdl4q0LwP8KfCULXlzdTq93eahfSnBKW67VKxxgAF5F5d6+cw+C9ji408cuRLV37L877aGcI2laZ/Mpq97c67qlze3c8lzd3cjTTyyNueV2OWYnuSSTX7s/8ABpJ+2ZNrXw+8ZfA7V79pm0KY+INAjlfJiglIW4iQH+ES4kx6yue9fmB/wUS/Yp8Nfsdft26j8IPDmtanr1joR0+0udRu1RJZ7iaKOSUhVGFAMm0Dn7vU1+on7Pn/AAb7/Ff/AIJ4ftc+BPjF8GfGum+M9H024jOq6Jqaf2ffSWEyhLmAOC0U37tmKk7MMqnBxmvv+IK+DrYFRlKzmrwuu1vu7HZVcXGze5+zijI5pw4FNibdEpKlSQCQeop2a/KzzxGyelRp/wAfB+lS45qNf+Pk/SpfQpdQtv8AVfjTi/NMt+YvxqTZxzTWwS3EA3d/rTqO1IaZIjPziob2/h0yymubmaO3t7dGllllYKkaAZLEngAAEkmuW+O/x28K/s1/C7VfGXjPV7XRPD+jxeZcXMzYyeioo6s7HACjkk1/Pf8A8FWv+C33jT9u/WtS8K+Fpbrwn8KlYxR2EbFLrWFHWS6YH7rdoxwB13HmvoMh4cxWa1eWkrQW8nsv835AfbX/AAUw/wCDlfw/8K/tnhD4ER2nijxAjNDc+I7hd+m2WOD5Cg/v39GOEH+1X4r/AB++Pvjb9qL4gXHinx74l1TxPrVzx597O0nkpnOyNeiIMnCqAPaul/Zf/Y2+In7Zfj5fDvw78NX2v34Aa4kjXbb2SE43zSn5UX6nntmv2T/YA/4Nk/BPwstLfXvjZqA8b+IGKyJo1mWg0ux/2Xb787Z7/IvbB61+myWS8OU+R+9U++T/AMl9xvGUUfip+zv+xz8S/wBrHxG+mfDzwbrfiieAgTyWluTb2uenmynCJn/aIr9HP2Uf+DU7x145a21D4teNdN8G2Bwz6bo8X2+/kH90yNtijPviT6V+4/w8+F/hz4QeEbbQvDGiaZ4f0ayGIbOwt0t4Y/faoAye56mvzE/4K7f8HFOkfszX2q/Dv4LGw8R+OrZ2tr7XHIm07RnBw6oAcTTA8ddikc7ulfLz4qzPMq3sMuhyJ/Npd29l9we1k9Edbrf/AARo/Yg/4J8eCI/E3xOFpNZRHYt14s1Yv9rkAztSFNodu+1VNeO+K/8Ag4X/AGT/ANkRJbH4I/BaHWry3+SO4sNMttCtpccZM/lvMw99hr8f/if8XvG/7YnxBuvE/wAQ/GOpa3eq8Yuby+kec2cDyBWaOMcBEyDtXHWtv4RfsyeLr/48SL8P207xJdeEL19StpZWigNzDaIbr7R5EzHKGKMttOR25rv/ANXfd58xrSqPe12o/f8A8N6FqN/idz7o8c/8HaPxp1TVHfw/8PPhzolkTlI7kXV7Mo9C/mRqfwQVQ0X/AIOz/j1ZXKm98F/DHUYc/Mn2W7hYj2Kz8fka+KtC+CGh/GDxbrJ1XxNB4RvYoNa1GWe4tWuItQmtkF1HDHHGB5W+JiMnIHlk98VQ8beF9T+KGo+K7mLQdS8S65Fb6fLHc2cUkkljbxWo8xmjjBXyxGi5ZhhQuc8muz+wMu29krdd/wA+pfJDsfrP8F/+Drn4d/Eu0XSfjB8Hb7SbafCSz6ddRaxaSerNBLHGyj2Bevo/4XfDT9gP/gqbBLF4W8O/DfUNdkiM0tlZWi6Pq0K928pNjHHdgCPevwi+Pun3Xjb4lWmr694bj0jw9pujC1t5bDT/AOz7fVVsoViZkYLtd2m2q7jJBfnkVwd18PdZ+EukaJ4y0fVm0u8gvfssclvqKxajBeRxpM8kcaESJEoljTfyC6uM/wAI4KnDVFpSws5U5Ps7q/5kumr+67H7a/tM/wDBp98N/GlrcXnwt8b654L1Llo7PVYxqVhIf7uQUlj/AN7L4/umvzb/AGsf+CFP7Q/7JFpd6hf+EJPFWhWYLvqXh0tfRqg6u0YAkUY5JK8V9d/8E7/+Di/xV+zr4p03wF+0Nfw+L/D9zawPB4kscS6ho5kUEJdAY80KD83G9T3boP25+H/j/RPix4J0zxF4e1Kz1nQtatkurK8tZBJFcxMMqykda8uWeZxlM1DEtTg9m9n6Pf7yHUnB66n8Zi2xEnQgqe3BBFfrx/wb3f8ABT/40+Lv2h9F+D+u6v8A8Jd4HFhcXMs+rO8l3o0EEZYNHNySudq7XyMHgiv0m/bQ/wCCLnwI/bXS9vda8MR+HfE90Gb+3NCCWl15h/jkUDZLz13KSfWvgmz/AOCeGof8EMf2Zv2hfiJq3iTTdf1nX9GTwr4L1C2iMEym6LLJI0ZJ2SL8rYDMP3fWvYxHEGX5vg3h3C1Z2UU1fVtK6flv0KdSMlrufnH8dvG7ftf/APBU3U9etmMy+MvH8MNo396NrxIoh/3yFr+r2ygW0tY4l+7GoUfQV/LD/wAEbvhB/wALZ/4Ka/CDT3UNbaZrqa5OSMgLYq12M+xaFR/wKv6GP2Nf+Cm/w1/bU8aeKfC3h+8ew8WeEb2e1vNKu2USzRxSGP7RERw8ZwOnK5wRXm8c4SUZ0qNKN404K/ld2V/uM6sr2t0Post1xQg5+lKF9cUoGK/PDEKjU5uT9KeSDmmIMXB+lS+hS6hbf6v8akqO2/1X404v+FNbBLcVjtFcX8f/AI/+F/2ZPhHrPjbxjqcGk6DokBmnlc/M56LGg6s7HACjkk10nibxJY+D/D19q2p3UNlp2mwPc3NxM4WOGNFLMzE9AACa/nW/4Kuf8FGfE/8AwVC/aMtPCPgy01GfwVpd79j8PaTbKzzavOTt+0ug6s3O0fwr7k19Hw5kE80xHK3y046yl2X+b/4JlOaijz//AIKe/wDBUXxf/wAFHfizLJM9zpHgXTJyuiaEkhKovQTSgcPM3XPRc4Hqfef+CYn/AAb0eK/2ojpXjT4rfbvB3gGfbcw6euI9U1iPqMAg+TG395huIPAGQa+w/wDgkl/wQN0X9naKw+IPxgs7TXvHDKs9joz4lstEPUFx0lmH/fK9snmv07RAoAHAAxgdq+szrjGjhKP9m5IuWEdOb/L/AOSfy7hFPdnFfAH9nHwT+zB4At/DPgTw7p3h3R7cD91axBWmYDG+R/vO3+0xJrtzwKANor5v/wCCqf7ctp+wT+yFr/i1THL4ivl/szQLYn/XXkgIVz/sxjLn/dx3r86o0q2KrqnG8pzdvVsptJXZ8K/8HA//AAWbu/hWNQ+Bvwr1UQ+IJkEfifWLWT59OjZc/ZImHSVgRvI5UfLwScfjr8NvDeo6P4P1nVZ4SbHWbc2r29xYs0up228GeW2lZSu+F1jLFTkbucjdWld+D9Y8badqHxD1nydfgvtTlTUk+3D7e80imRp2QHeFy2d5G3dgH0rvPg14Xvvif4PtPDWm6he3kGireapaXFzqMcMOnAIsjLEkm0QznYcrvKTg4GGUGv2zA5XQy3CqjTs9fefn/X4bEwqXZznwg/Zv1bSNf1bVtRF3Z+HtH09bhrv7CZor8XKsltA6FlIjnf8AdM/PllsnkV6vF+x34j8EfBrwr401J7Gwt/E7z2OhrJOGuNWhtS0sbSIDlWeJZrQq2N2YRj5mz7F8Pf2eviL8ami8P634t8Nrp8OgL4lkub29Sa3toShhW38xQWjEvlqpt3wUYAgdKb8I/AVjpXlTapJqN3eaVdQ3WkW9x/x7xzRyeYHGep82ND5fV5UliOA645q+Nk7tyTta6Wun/D7+R1Q2PH2/Zx8PWvwou/EVz4hvbXxQ+pQ2dtpK2e+O4tZ7WaxmleXI2sWhdgMdCv8Ae47bRfgcfhh8W303w34o8S+GtN8SeHdMW/1jVdOm023kintoY7lBt3GaDbJ95QckHjjNfQPxd8TfCG+8Y+I/EPxb8UaDpE+uWsWpw6boN1BbGO9i+ziJI4zu/dmNd7cDLNKAc1g/Df8A4KI+CrfXNNF34k8IePrXTNPttD03TNbkDwWcD2Foknlq205W4DZwScB8etcE8ZVqU7wTfddOmi01tbqbRjofK9l8O9W8b2Eelak2va9Y6JbvdR2tjbPcQr++EzggkeTDNdywxs56CFjjK4rkbv4OW/iTWr3XtV1vTLd9P0tbnQ7GeN3TUH818eYVG2IHEtztbgqVz98Z+6/gn8C9U8dWPxMtdHudY0xb/RZpbv8AsqQLEbBXDSRSOWGImV5Qp+b/AFrnB8qvH/i/4NuvAvwLN3d6FpUkGqyz2K3dyYlXTI0EUhCL/rYmBVMyn5m3eWi5RWPThscpVHTp77ffr+ImnHU+J/HPhvTdZ8DXeuX19Pp90pRNCthZbpNeJlxcXM0hYMi53bTgglCgxtY19nf8EZf+Cp/iT/gmr8R9E8IePLwah8KPGSCeW0W8W4m8NPJIyi4CKSYiSpLwtglWD4yRnzDRfgFJ8QPgNq3iLTb7SrLUvDxkvryy1FRD5dnGibb7lj5k+DIsduFGyNA21i28/Peq/DpNQ0fWNc/tKGzt7QRtbRag5F5rDM6q5hUKQcZLksQAoI3E8H05YGhjKU8NiNr280+lvzv+hzyndH9g+ia5Z+JdFtNR0+5hvLG/hWe3nicPHNG4DKykcEEEEH3r8Rf+DpD9sE+K/in4V+DWk3Ja08Mx/wBs60EbKtdSjEMZ90j3Mf8ArqK9L/4ILf8ABRbU/h1/wTp+JE/xE+2TeFvg4gk0rVZ2ysySKxTT1JOWcOAFAzgSAcYFfkR+0R8aNZ/aR+Nnibxz4glM2reJ7+W+m5+WPe3yoP8AZVcKPYV8xwhwvUp5tUlV1VHRPu3t+GvloYTmlsfdP/BtR8FL7xl+0V8Q/F9hbLcXfhTwrPb2O8hVN3dArGu49MhG/Cvj7xfpfxU/YZ/ajnvtUh1rwP8AELQtQe7Ep3RPuZixdG6SROCeRlWB71+43/Bub+yl/wAM+fsGW/iO/gMet/Eq9bWpiw+ZLVR5VtH9NqtJ9ZjX0b+3X/wT4+Hn7fnwwl0HxlpoXUIY2GmazbgLe6ZJ1DI3dc9UbKn071GI4tpUM6r+1hzUpWi+9o6ejV76Fbo8o/4JF/8ABWjQf+CiHw3Gl6p9m0f4l6Bbr/aunBwFvlHy/aoAeShONy9UJxyMGvs0nFfzG/tH/slfGL/gjX+1BpGsrcT2z2F19p0DxHY5+y6igPKN6MV4eNuxPUc1+8v/AATN/wCChfh7/goj+z9a+JdPEVh4j03ba69pW/LWNxt+8vcxvglT6ZHUGvA4lyCnQSx+AfNQn2+y+3p+WzJjO7s9z6Nx+tRr/wAfJ+lSE4qNTm5P0r419DVdRLf/AFX4048mktxmKvH/ANuz9qi2/Y8/Zu13xe1rJqOrhVsND06IZk1LUZj5dvCoHJzIwJxztBwCeK1oUp1ZRpwV29EKbtds/PD/AIL7/tza18V/Hul/swfCtrzV9b1iaIeIotOyZJpGOYrHI68YkkHQAqD/ABAfRn/BI3/gjr4f/YN8I23ijxNDZ678UdTgBuLooHi0ZWGTBb579mfqeQMCrP8AwSf/AOCaL/s7wXvxa+JG3WPjL48aS+v5pkDf2Msx3GCMnJ3kH524/ujgc/bwGK+lzLNo0cMsqwL/AHa+KS+3Lr/2727mEINvnkIExS0UZxXy5sNc5GPWvwO/4ObP2pT8Tv2vdJ+HGn3DPpfw709GvVB+Rr+5USMPfbCYh9WYdq/fGaQRRM56KCa/li/bP1/Vvjj+3N8Tdesopbu9ufEd3OgQBn2pMUQgd8BV4FffeHuCjVx8q8v+XcdPV6flc4MwrckEl1OI8K+EbfUdJ0/XbRNT8Owq2xrrf9otnKYD5dBvhJJ43qVOeuBX094t8W+HPGPgK08F+GNEtrHwlb6pLeWmpvp1u+qXLSxqrR3LQApLGSCQsee2VQjI8q8beG/svhHQ/FWsarqNt451ia4k1iK80OfTRbnzSItk8CAMXTDEsCMsR259M0LwdDo2n+H7SfwfqnhXVLC7c69rRlzDfRyFCittRUQIoJCyQNnOS4r9DxjU+Wct03byt66vyeu+xhQr2PW/2cdeh/Z/8LQ2Gl3uryaJ4mtWtvE6W7JLbukcpaIwykktgEExuN6gkDzFyleA/tk/tcXv7WPxd8S2Xw5vItF0iC2MxuLSza2vPE7QoiTmERqURxF5jlsruSP5mJCivZ/+Cr3xCtPBHwB0mPwvptloVv4zMWlx3dkXW5vrOOMebLIwAWYyAjJycBtuSCQPmrS/Hup/Amxt7XUvEwbw94S0yd9DuINtvJHazFpJIp4Y0lw10JRHlz/EiswwNvzdKMZ3xklZu+/4t97beh7dCSa1MK0/Zt0ManBY6zZ6bBpunaxLcRzajdE6pqyOY0FlcvbtIsBASVw5AAG45IIq3c/DHwt4v0DTNKuW8OWvha1ur2C2igUQX630dpFE9xLLHG0jQ+bGWVWPzBsgZ3Y4j4c/s+/Gz9v7wP4y8R/DbQ1h8I+AYBLfQ21ytsVVY5HUDcd8suwOcAkgcDgCvNv2RfDvxO+MXj/UvD/ge9s7nULLS7vVbq21e+jht3gj2GY5lOPM5UjHzHHFfP1eJ6SnyJNrv+qO5WPqL4H/ABg+If7J3xh1XUfAHiXw3Y+F7uG4mm8MnXprqFoEm8j7PFOw+eZwXaPaeQCeMV+tXw0/4JXW3i/4I3HjCK9Uan4o0c3KWksEbeW0igncHV1Mm35BkEIOFwfmr8Vf2cr2z+LFvZ39lpC21jctFFqlxMyTzWE0bK7CzgDKS5RQPdeMLiv11+Bn/BezwjN4T8NeD7nRdU02C502bTRqpgY20N5FH8sSNtAkLIA2Pl+8o75r08dSxFbDwxGX6yfxNW1jbT1e/mKo/d90+N/2kvg34C13wzqctvPZeE/E3hy4gs7HTrkTXyakGZhdTQxkkPIhUYBB5DZ38MPCvAvwN0n9ofxL4d+GGi6dcNr/AIg1+LGvzx/aNTCNhHBgjJbyVX5gH8sLyTX078ZPjyZ7Zng0HQ73SNC1H+1VtfFEckM/iU3Eqo0caoAZY1wrGNp3QBc9to6LwXdXH/BHz9mjWfif4jkWD4wfFS2ltPBnhdLaO2i8O2rt893LGjMCQuCpOWxsXIy2PWpYivSpqnFN1JO0Ffr/AJL4ne66Hj16iU32R5L/AMFZ/iR4d/Zi+GHhj9k34bXwutB8CuL/AMX6lGAG1rV2GSHIPPl5OV5Ckqv8FfLn7EP7MGpfti/tR+D/AIeaaHX+3r9FvJwMi0tVO6eU/wC7GGI9Tgd64HX9Xu/Fes3mo6hPLd39/M9xcTysWeaR2LMxJ6kkk1+3/wDwbif8E7H+C/wtu/jN4ntTFr/jWDyNFhkX5rTTsgmXno0rAH/dVfWvezTEwyDJ3aV6kr69ZTe7/X0sjhpVXWqH6X+BfBen/D7wdpeg6VAttpmjWkVlaxKMBI41CqPyFazKB60owOKWv58bbd2eocH+0R+zj4R/am+FOp+DfG2kW2saLqkZVkkUeZA38MsbdUdTyGHNfib4h+EXxF/4N6/25NM8V2bXviH4V67N9le6QER6jZs2Wt5h91bmMfMp6ErkcEgfvdXEftE/s+eFf2ovhHq/grxlpsWqaHrERjkjYfPE38MkbdVdTyGHSvcyfOpYTmoVVzUZ6Sj+q7NGdSF9Vua3wt+J2ifGj4daN4q8OX0eo6Jr1ql5Z3CHiSNxkfQ9iOxBFbicXB+lfn//AME2LDxV/wAE5/2gdS/Zp8aXM+peEdZafV/h1rcg+W6QfNPZk9BIow+zsQ5HBFfoCvNwfpXm5hhY0K3LB80XrF909v8AJ9mXSlzIbE2Ih9a4Dxz8NNI+JHxt8M3mtG3uf+EQhfU9MspRuzduTH9pweMxLwp6gy54wM99EMx/jXkn7YPgvxVd+AofFfgF4/8AhNvBch1Gxtpf9VqsIx9osn9pYwQPRwh461jhleaSdr6X9RV5cqcrXsewKBTicV5n+yl+1R4X/a7+FNt4n8N3C7lf7PqNhIw+06XcqPnglXqGHbjkEGvS36VNWlOnN05qzW4qdSM4qcHdMQvQuSR7UoXilxUFlfVCf7PuAP8Anm2Pyr+Vbxb4gtvB37QPiy/1DQdM8RJ9v1GE2moeZ5Qd2kUSfIytuQncOcZAyDX9VtwglRkPRhg1/ML+138KLvwb+298QfDqLbwXFr4lu1j+0ypDEAZWddzOQoG0jqea/TPDaUHVxFKfWK/B/wDBPAz6o6cYS8x2ieFNR+Htpo+s+Hr3Sbiyv7WO5e/0u61G3gtZjy9tI/yoZI+NwBI5HWvp+38ZWeueN/F/jzWdY+H/AI0vodKspLjWLi+fS763nnMaE2sYy0kkIBU8gEAnivnjwpcvZTz/ABFu/E/w8h1jQ9Tt5ItCOnpJ/aGckssUUYQxqVAYZHWvqj9hv9nrxB8W1h+IHia8s4vAy293cavqWu2T2Gn+H0BX5ooyR5srKS0brMFXjcpIAP12buEKXtK0tVpfq3o+VOy6Lpo30b0PLweLcp8sP6XcZ4i+CPiH/goH+1n4KvfCPjeOfwJ8MIb2LxB4+1C3gltrS12IDGBIGQsYt+1ZGbZuLHA4Px3/AMFVvgH4m/ZS0DWvh3quk2Oi2Udzaz2s1sjGPxIo+X7YkhAyW2qTECyoc4AOSfpD/gpL/wAFGR8evD1t8I/hQmoWHwu0krCZHkkkvfEUofIZyefL3Y2p1J5PZR3H7I/7QXg79tv4OJ8Bfj6bbTPF+kQyab4P8T36+TLGzrsWxuWb5h84UdV3DC8MoJ+fxeAx0MC604Wg4tcv2or+d231buraJ6a3PXwXEGGeI9jfTa/S/Y4n4V/Ay/8A2Kf2a/2evCuifF34WeAfE8moJ8QvG9h4k19tPu76K8gaCO28sKcoLV5U6rnOeDzXD/sz/sk+Fv2U/wDgtl8VPCl4dC17wbqXgDWtc0C4uI457WW3uYI5odm4FdyMxQEc/LkdRXyf/wAFGf2E/jn8F/2jdRh+IUOs+JtVuABaahJK11LfWsSxxo6ZyxiUMkYI4BGK4fw9o/x18Q6/oN9H/wAJZYTtpR0/Tb+5he232BAyiSFQZI9ozxu4BPavzZYOq5qNm+1uvofW+7a7eh0X/BOpItFk8Waxep4hVNNtFmWXT54IEhXDLIwklHyTAOoRkII3HrnB9c8LeGvEviz4l/CSy03R9T0vwZN4ntVmv4Jbl9M1PUC0ck0uHiKCdLcojFI34TOGHBt/CvR/B3hD9mez8P2FpHd63BdwveGKSRjrDyyR4a6jDfuoEG+I/K5LOuChGD9T/s0fsXWf/BPvVT8Z/wBoV/8AhHPD1te3V94P+GcF213LqV06FBIyMdoVY2VdzDJG3cQAAf0jLqbwOCjSlrU1Sj1b6JK/S++y6nl4zEQinKTsluz6I0T4L+Av2CvhfafGv4o6hd3MIDXek6I16WuL7UFeRYYUVbe33xMgjkO5Rhi2QVUFvyn/AGvP2pfFf7aXxw1Xxz4uumnvb4+XbWwYmHTrdSdkEQ7KoP4kknk13X7b/wC2h4v/AG6vicdd8SSC00ywDQ6No1v8tppMGeEReAWwBlup9hgCv+xZ+wj4n/bN+Iz2GmeXpfhrR1F1r+u3Py2mk2w5ZmY8FtoOFzzjsATX1+T5bHLqUsxzOS9pbV9Ir+Vefe258ZiM4+s1fZYdadPM6H/gmX+wzZ/tBeN9R8eePZBpHwc+HKHUfEeoynalzsG5bRCerOcZx0B9SK/cz/gl5+1c/wC2V+zpe+M4NOi0fQzr17p2h2KIF+y6fbsscCkDjO0ZOOATjtX5H/8ABR/9s3wt4c+E1r+z18FI/D9x8IbSxt57nUIN0t1ql8HDvM78YcFQCCDnOfTH6lf8EOvhi/wx/wCCafw7gkUpJq0U+qlSMcTzO6n8V2n8a+F40lVxOEWPxKceaVoRfSNm22v5m9+2iPby2pH2nsou9ldvzPrYDPsad0HNGOKDX5ie2MZs0L1pypg0MdoJ9KAOA/aF+B2kfGnwpai+l/s7U/Dt0msaNqyYEukXcPzJMpP8PUMp4ZSwPBrpvAXiE+LPC2nakWhc3tqkpeEkxuSB8yk/wnqPaviH9oD9rif9uf8Aa4039nj4bXUr+FLSc3HxA121f5ZLOJh5llCw7Of3bN33YGQDX3bpdhDpVvFa20SQ29tEsUUajCoqgAAewArtxmFqUKdONbRvVLsntf13t8+phQrxqyk4bLS/n/wCaBcxZ96GGQQRS23+q/GhxzXCtjolufmP+214O8U/8Eq/2qU+N3w4jkn8B+NbpU8S6KwP2ZZyTuHH3Q4yyN/C5Ycg4r70/Zd/ao8I/tc/C208U+EdQS5tpfkubZiBcWEoHzRSL1BHr0I5HFdD8V/hbonxp+Huq+F/EdjDqOj6zA1vcQyDIIPRh6MDggjkEA1+N3jjwR8Tf+CNf7ULXOg3ks+gX7mS1d8mz1q13f6qUdpFBwccg8jg19rl+GpZ3Q+rtqOJgvdb+3FdH5rv2Pjczx08lq/WGm8PJ62+w31Xkz9uM0E8V8XfAD9vnXfj/wCGJNa+Gaab4puLdfM1TwXq90LXV7A9zaz/AHZouuA4z0G4dK2Na/4K6+FvhvKbbx34E+IXg2/iOJIrvTg6A/7LhsMPccV4byHHe0dKMLyW6W6+W/z2PSjxNl7pqrOpaL2bvyv57fLfyPrg4Iwe9fix/wAF1f2JNbvP24tL13whoWp61J8S7KNjbWNs0zm9gAikACg8GMRMT67ia+wPFv8AwXv+FWlQN/ZWh+LNXmx8o8iOBCfqzZ/SvDPiL/wVP+PX7UV//ZPwp8B3eiwXOY0u7Kze+vQp9ZmXy4x74/GvqOGcpzjAYpYv2ahGzTc2oqz79d7PY+dzzivJq9H2EKrqSvooJyf+X4nj/wANP2BfDv7Imk6T4w/aM1PSvDMNnbKbHwhobCTWdckBJDzuGYxjkA7Co4HK9+V+Pf7SnxD/AOCkXi3T/ht8OvDE+jeDIJAumeGNLGVIB/1904wGP8RZsKPc8n0zVv8AgnTPpNw3jP8AaU+J1l4WWf8AfTWbXov9bvR12KuWwe3AbHpXZ6v+1ho3wR0vS/AnwA0bw/4OsPE9vbbvENxdRz6lc+ecKHcnCSc5IYnZ1O3ofqliIuoq1P8Af1le0rNUod7d2vK780fNTxlZxccR+4pae7dOpLtftfzsvU0v2ZP2Q/h3/wAEzNLbxJ4zudP8XfF1F3WdsImn0/RZ8ArEpUYa4AO85KkKM/Ivznm/21/2LtK/4KDeFpPit8KNM/sv4i2sXn+IvDpHktqygBhd26nGWIwQR98Ed8FvKfBvxQutB8fXFr4ru77WvD+nz3N5NbLeedbX16I2TdJ1Lxs+Edx80pOF4XA7TwH+03rvhOObxG/iK6sfF9jZR22mAQmSMQxuMxDnCwRxo5YtncUlHIAzwVcLjqWI+uqpzVdNfstP7PKunftuduGzrCVaf1aUOWnrp1Vut+/bvsee/Bf/AIKQCPwW3wz/AGg/CMvxB8L2ccljBdyDydd0PKmNwkpwxAGRgkMMdTjFdNqXwa/ZP+IOneH5dH+PvinwbpOhQXMMFhf6RLcahEswYFFmG0DYHKj5W4AHPJPp3xAs/gt/wUM0y1uPGgT4bfEeWNgPEVlABZajJGo3/aE6YyG+YkH5D83GK8G+LP8AwR0+Mnga6ZtB0az8c6UxJivtDu45lcepRiGB9sGuylQyuvU5qk3har3V1yvu1dOP3WfdGn9uZvg4f7KlXp9Hu15NLVfl5nXXP7ZXwH/YittRufgl4dv/AB98Qr92c+K/EltHDBbSME3PHDGiZGUVgoVRuAOSevxh8cfjH4u/aT8d3HiTxprV3rusXI2mWdvljXJIRFHCKCThQMc19GfDn/gkP8c/Hd3i68Ht4btF5ku9Zu4rWKJR1J+YtgfSvXdG/Y9+Bn7FEcesePNaHxj8YW4LweHdFO3TInUtnzJf+WhUq2Vz/CflNevh8Tk+Wyvhpe2rPs+aT+e0V9yPIrYvOcyfPi17Omu/ur7t2/vPmf8AY3/4Jn+KP2nVm8S6xPF4K+GekZm1TxJqS+VD5ScuId2BI2ARnO0Hqe1exftX/tc+GtL+D8vwh+CNleeFfh9pODqF5HEs0/iRtuGku0Kh/KY7cOCynIyAMCtP9rT9ty5/aN1jT9HsdQfTvBkNrs0rTdLCWlnbTBSphGM72U9pFAdXK4GUevmbxd4f07TtGudQ07xUbTU/Dt6I7LTFglCXIcnzJoCw/dLxlo37k44OBFOOIx1eNfHqyTvGGrS6Xlpq/NqyOqOOoYWDpYaV31ls36dl+LPO/Avw1u/j18WPC/hfRNItbXU9bu4dOxah8TySS48wqSQuFPIXAwmfWv6efhT8PrL4T/DLQPDGnKEsfD+nw6fAAMfLEgQH8cZr8sf+CAv7FM3iXx5qPxp8Q2pNpphks9D8xMCe5biWcf7gJUH1Y+lfrYX618Fx/mka+MjhKT92nv8A4nv92x91wtRn9WeIqbz29P8AgjqKao+aqviDxDY+FNFutR1K7t7Gws4zLPcTuEjiUdWJPAFfBJNuyPp5SSV3sW5JFijZmIVVGSScACvyz/4K4f8ABXO4vpLz4T/B+8ee6uJDZavrlmxZiT8ptrYr1JJwzj6D1rnf+CmX/BXy/wDi7HeeBvhfdXOm+GiWhv8AWF/dz6mOhSLukR9eC3sOuz/wRc/4Js/8JDq1n8YPG1gfsNo2/wAPWVwn/HxID/x9MD/Cp+56nnsK/QctyCllmG/tXNlr9iHVvpf/AC+b7HwWJ4leZYv+zcrd/wCafRLrb/Pr0PqD/gkR+wXH+xn+z3Hd6zaqPHfi0LeavI4y9suMx2wPooJJ9WY+gr6yUYuT9KfgKKYhzcH6V8LjsXUxVeWIrO8pO/8AXofc4WhCjSVKGyQkH+q/GpAtMtv9V+NSVzLY3luIU9K84/af/Zk8NftWfCy98L+JbUSRTDfa3SgedYzAfLLGexHcdCMg16RmkK5Fa0a06U1Upu0lqmjnxGHp16cqNZXjJWafU/CH4y/s9fED/gnz8cYh9qu9MvrSQy6VrFkSkd5GDwyn6Y3IfoeK+3f2Q/8Agrr4b+LlraeFvjBY6dY6iwEcWrSwK9jdHp+8Ug+Wx9fu/Svsb9oH9nnwz+0r8Pbnw54osVurWUboZVws1pJ2eNuqkfke9fkd+13/AME+/FP7J3iSZ7iKXVvC0smLPVok+Qg9FlH8D/oe1frWW5hl3ElKOFzBcmIW0lo36f8AyL+R/PvEWCzrg2vLMMsbqYSXxReqXlJdu0l8/P8AXTRvgh8PNTt4dQsfCnhGeK4USRTw6dbsJAeQQwXmuu07RbTRrUQ2lrb2sI6RwxhFH4AYr8YP2Yv27viD+yvKltpGoHUtD37n0q+ZpIAO+znMZ/3ePY1+in7Nn/BUT4d/Hi2t7TULr/hE9ecBXtNQcLE7f9M5fukfXB9q+Vz7g3M8BeWtSmuqu/vW6/I+x4Q8U+H82tSbVCs/sysk3/dls/wfkfOf/BYX/gnDf+M9Ruvip4JtZr67CA67p0ZLuyqMfaIl9gPmUfUd6/Ojwd4dXxP4htra506+1FLe2lEVtZ7Y2BVGYMxxwgIy567QeR1r+jRGiu7dWRkkjkXIIIZWB/mK+Fv28v8AgkpbfES5v/GHwv8AK0bxJNvkutKVvJtr/cDuMZHEbnnI+6cnpXtcKcZxpUll+PdktIy7eT8vM5eN+CKtSbzPLFzN6yh384/5fcfnb8K/iXF8O/Eeo3MKQPJFYSxx3DxJJBHIwCtKY3UhgsZZYl4wxU9zRe+JdM8faNo9mmj2ugjRrR7vVriBpHN8gbfEkmScO+2GMbRgeb7GsXxN4G1/4UeILnw54o0O402dbiKW7tLqDyp5EQn5VfGQjZPK5BwDzitTwn4ikms9U0FLawSLxNcwGa4lO17dI5N+1WJAC8c5/uiv0argqUv39JX21T0t3+5t2PxyhxFVo/7LWbT1umtU+i+bSVzs9U8ZTeKPC8mt2ieGYdS8FWdtpqaVaWjedqCFds1zImCrLmZ9xJHA5HU10k3x08Q+GPEtv4i03xC2/XPPubu00G5msYNPkkupEEbBdqqVEkZwMjjrXkfhPw5q7aBqviO3e5s9MudSh0+7uo5dgVZN7MjbTkqVHIxg1f0jXNN07wbq2nXyanNJqySxWLWc6xRrOLiKRXl3D5k+XoMHJFcc8rpNbcyTtbyaV18nr3PSjxbUjb3uVtXvfs9H89ux2fxX/aW8YfEDw9onh/U9QnkvtPlJku576aZ7t7hFkjimy5QosqyRHjo3pmsTUfiB4X8O6lqGiW1rY+Jb28sZYPt1zI62EN4VHkTW4UI6OqBULPnMiKx4BNc18St2keK73Sr/AE6ztLrSrf7AXsZg4nlWYyLO7AsrNhsHbgYrlPGVvb3XiSW5sXaSO52TH92UxIwBdQO+GJGe9bYfJqDjGy5U03ptfR3uvyuRU4urOUlzc0k0td+1rP8AMgvfM07wTKPsmm/ZbrUgb+CQKt9FOqEboj95Y8c9MB8g5BxXqf7Fn7GviP8Ab9+LOn2ItEsfD2igDW9ZEZVnjDFgCejzspCjGOFBPcn2X9lL/gl144/a78WQ+JfG1ofCHhaRIjI4tFt575URUAiiAG3cFBLsOSScEmv1W+C/wS8Nfs+/D+y8M+FdLt9L0uxXASNfmlbu7t1Zj3J5r5PiLiyhgoOhg2pVXu1qo38+r/pn6Nwpwxi8wnHE41ONFbJ6OXy6L+kX/hp8NdH+EXgTS/DWgWcWn6Po1uttawRjARVHU+pPUnuSTW4FHWuV+Kfxw8J/BPRDqPinXNP0eDBKieUB5cdlT7zH6CvhT9qf/gszeailxpPwusGtIiCh1m+jBkb3ii6D6tk+wr85yrIMwzOp/s8G77yei+b/AKZ+gcRcbZLkFK2NrJNbQWsn6Lp6uyPsT9pn9sTwP+yn4Ze+8T6ogvGQtbabbkSXd2ewVOwz/EcAetfkh+2//wAFDPG37Y2qPZSyNofhGFybfSLZziTnhp2/5aN7fdHYd68y8Za9rHxG8S3Ora1f3urapfPuluLiQySSE+57egFfZX7AH/BJm9+I13a+LfiTaT6foCFZbPSn+SfUO4aTukft1PsK/UsJkOV8N0PruPlz1Onr2iv1f4H4ZX42zvjPGf2dlMOSl19O85dvJfieff8ABMn/AIJg3X7RviC18ZeMrWa08DWEokhhdSj6y4P3R/0yB6t36DuR+v2laVbaJpsFnZwRW1raxiKGKNQqRoBgKAOgApNH0e18P6Xb2Vlbw2tpaxrFDDEoVI0AwFAHAAFWa/Lc/wA/xGa4j21XSK2j0S/z7s/feF+GcPkuEVCl7038Uurf+XZCNzTEGLg/SpKjX/j5P0rwX0Pp11C2/wBV+NOL4zTLf/Vd+tSbaa2CW4mNxHFOo6UGmSMfBNUPEXhqw8XaJc6ZqlnbahYXkZint54xJHKp4IIPBFaAAOe9KV9KabTuiZwjOLjNXT6H58/tbf8ABIIpNNrnwyfcrEvNotw+Nv8A1xc/+gt+B7V8T+JfhxqXgTXZ9N1awutO1C1bbLBPGY3Q/Q9vev3bK4NcR8Z/2cfCHx90wW3ibR7e9eNSsVwBsngz/dccj6dK/SuHvEbE4VKjj17SHf7S/wA/n95/PXHfgLg8xcsXkU1QqvXlf8N/rH5XXkflL8E/2xviR8AIY7fQvEF0+nRniwu2+0W6+wVvuj/dxX1d8Gv+CyFpeJHbeOvDU1nJ0N7pb+ZG3uYmwV/Bm+lc58cv+CRes6FdTXvgfU49XsjlhZXmI7mP2D/df8QD9a+YviB8FfEXwr1IWniHRdQ0iYkhftEJVZP91ujD6GvuPqfDPEC5ocvO+3uy+a6/cz8Fr8Q+IvAc/Z4lTVKO3MvaUmvJ6pfJpn6M+JvjN+z5+134fjsfEV/4c1BRnyl1MC2ntyeux2wVP0NeL/ET/gir4E+IMLX/AIE8aXOlJLlo45VTULVvYMrKwHvk/Q18Yx6XnqDj6Vp6HeX/AIcuPO06+vLCX+/bzNE35qQawpcDYnBP/hMxkoLs1df5fgddT6QmBzFW4gyunVf80JOEvyb/ABPWPEH/AART+KekPJHp+peFdThz8rJdyRFvqGTg/iay7f8A4I0/GbUY4raeTw5DbRMzIsmps0aFsZIUKcZwM4Hasix/aB+IemgCHxp4nQD1v5G/mTVuT9p74lvHtPjfxJj2u2Fdv9ncSJWVem/NxZxPxJ4Bk+aWCxC8lUjb8dT074Z/8EINTnuUm8YeOLCyhBBe30m1aZ3H/XWTaF/74NfRPw2/ZA/Z9/Y5uYNQvJNCbWLXDx3ut3cc1wjD+JEbhT7qua+Ctf8Ai7418SRtHf8AizxJdRv95H1CUqR7jdiuSk0wvIWYszMclickmuHEcJ5tjfdx2N93tCNl+n6no4fx04byxc2TZSnNbSqT5n91n+DR+mHxJ/4Kl/Cz4fwuljd3/iK5QYWPT7f5CfTe5VcV8u/Gb/grj4/8cedB4YsLLwpZPlVkU/abrHrvYBQfovHrXzc2jA12/wAKv2T/ABx8aZUPh/w/fXVq5x9rePy7cf8AA24P4ZrfC8FZFlkfbYr3rdZvT7tEeVjvHDjTiSp9Ty1OPN9mjF8336y+5o8s8ceIdZ+I3iCbVde1PUNY1Cc5e4u5mlc+wJ6Aeg4rY+Df7OPiv4+eIxpnhfSLjUZQR5soG2G3B7u/Rf5193/AH/gkNpmleXqHj/UjqM4IZdOsSUgX2eQ/M30AA9zX2D4E+HWifDLw9DpWgaZZ6VYQ/dht4wik+px1Puea8zOPEbB4WDoZXHma0TtaK9Fu/wAEfdcG+A2d5lUWN4lqOlB6uN+apL1eqj8235HzZ+x5/wAEufC/wHFlrnicW/iXxVFiVfMTdaWL9vLU/eYf3j35AFfVoAUYAwB2oC4oJ/Wvx/MczxOOrOvipuUn+Houh/WeQ8PZfk2FWDy6moQXbdvu3u35sRn9KFOT7UoTilAxXAe0B4qNebk/SnsCcUxBi4P0qX0KXULb/VfjUlR23+q/GnF+cU1sEtxxOKKaDk9Kd0FMkKTcM0jNnikX2oAfRRmm78mgBxqjr3hnT/FGnPaalY2l/ayD5oriISI34EYq4BzTulOMmndbkVKcKkXCaun0ex4p41/4J+fC/wAaMznQBpsrfx2MrQ4P0HH6V5b4p/4JK6HcyM2jeK9Ssh2S6tkuAPbKlD/OvrsvRjdXvYTinNsMrUq8rebv+dz88znwj4PzRuWLy+nd9Yrkf3w5T4R1T/gkz4khc/ZPEuizL28yKSMn+dZ4/wCCUvjQtg6xoAHruk/+Jr9AKaW2mvXj4hZ0lb2if/bq/wAj4qp9GvgSUrrDzXpUn/mfCWmf8ElPEE8gF74p0iBO/lW8kpH4HbXe+D/+CTHhTTmV9b8QavqrDqkCJbRn/wBCb9a+sB8zHNO6Vy4jjjOqys6zXokvyVz18s8AeBcFJTjglNr+eU5fg3b8DyzwD+xd8Nvh26PZeGLGeePkS3Y+0Nn1+bI/SvT7e3jtIVjijSONBhVVcAD0FOZ/ShRjvXzeJxdfES5683J+bbP1HLMly/LafscvoQpR7Rio/khwGKKKazdRXOemLuGaWmKMmnnpQAUZxTd/PpQvIoAdUa/8fJ+lSVGv/HyfpUvoUuolv/q/xqQL3plsMx/jUlNbBLcAMUHpRRTJGhM+tOAwKKM80AIRmmyusMbPI6qiDJZjgAetPAxXM/GZ/L+EviVhwRps5/8AIZrSjT56kYd2kcuOxP1fDVMRa/JFu3eyuaX/AAmmjqOdV07/AMCE/wAaD410dumq6cf+3hP8a/Pv9kr9lJf2mNI1i4n1260s6ZMkQCR+YJAwJ7kV7Cn/AAS0tY2H/FZX+B/06r/8VX2mP4dyfB15YbEY1qcd17Nvz7n4Pw54ocaZ5l9LNMuyOMqNTWL+sRV7NrZxT3R9EfED45eE/hZPZxa/rlnpr6gpe3EmT5oGASMA8cj866qyu4r+0inhdZIZlDow6MCMg18zftiaB8NdD/4Q2x8cNrsk9rZtbWb2AGGVfLDF/cnFeq/FP4++HP2b/hzo+o6ml++m3AjtrcQxeZIPkyM8jsK8SrlSlQoPCxnKdRyWq0dnpy9/M+/wXGNSnmGYQzapRp0MMqbuptzhzRu/ap6R1+G26PST0poXdya+dPFv/BTj4feF/sogg1rVTcRLK4toUxb7hnaxZgNw7gZr1j4JfHzw58f/AAs2q+Hrp5Y4m2TwyLsmt29GX+vSubFZJj8NRWIr0ZRg+rWh6+U8dcP5pi3gcvxlOpVSvyxkm7eXe3W23U6Dxt4z0z4deENU17WbqOx0nRrWS9vLh87YYo1LOxxzwAelY3wU+OHhr9oj4e2nirwhqP8AauhXzukF0InjEhRirYDgHggjOO1fNH/BcH4sS+Af2HtS0azkZdQ8a3sOkRIhw7xk75APqqYP+9XuH7FvwkT9n79lTwR4WkVYZNI0mL7TnjErLvkJ/wCBMaueXwhlkcbNvmnNxiulorV/e0vvPUhmU55nLBQXuwgpN+bei+5NnoOs+MNI8OXEcWo6rp1hJKNyLc3KRM49QGIzWjFIkyBlZWVgCCDkEetfzv8A/BRrxV49/wCCo/7Zvxc8S+CDNfeGfg9o7/ZY4ZCoFjaygSMmOGkd3ml9SqY5wBX6y/8ABE39saP9r/8AYV8Oz3tx5nijweo0HWVLZZniAEU30ki2HP8Ae3jtXqZtwtUwOBp4xz5m7c8baw5leN/VfidtHFKpNxS9PM+sNY8S6foCob++s7IS52+fMse7HXGSM1ahdJo1dWVlYZUg5BFfkR/wdRahPZaf8GhDNNFvudQ3bHK54h9K/U/4HH/iy3g8kk50SyOf+2CV5eLyv2OBoY3mv7Xm0ttyu2/mbxneTj2OsAxQelGaMZryDQaF/X2p1FJnFACkVGv/AB8n6VJUa/8AHyfpUspdQtv9V+NOL5plv/qvxqQJTWwS3EUk040YxTWNMkC/tQDlulKEyO9KBigArlfjbKF+EHif20y4/wDRZrqWGRXP/FPQp/Evw213T7NRJdXtjNBEpONzshAGfrW+Fko1oN7XX5nm5zTlUwFeEFduEkl3fK7H5/8A7LHw1+J3jzQdVl8A66NJt4J0W6T7UYd7lcg8Kc8V7DofwC/aGt9Ys3u/GQe2jmRpl/tEncgYFh9z0zXffsBfAjxH8DPC2vW3iK0S1mvrpJYgsgfKhMHpX0A65Nfe8R8Wz+v1YYeNOcOkuRNvRdep/Onhf4M0Hw7g6+Z1cTRr2blTVWcEnzOy5Oias7eZ8Wf8FVA0HibwMw7R3APv80Vbn/BSabP7OXhHjrdRD/yCa3/2+/2dPFXxz1zwrN4es47qLTFmFxulVNu5kI69fumtT9tj4B+IvjD8F/D+k6DaR3N/YTxyTI0oQKBGVPJ963yvMsLCOVc9RLklPm1+G70v2OTinhjNqtfix0cPOSrwoKnaL99xirqPe3WxP+zp+zl4Mk/Zg0pbrw9pd3Lq+m/aLuee3V5ZHZSc7iMjHbHTFeM/8EsZzYfFvxxp0LsLWOAHYT3WYqD9cE19Y/BnwpfeE/gfoWjX8Qjv7LTUt5kDAhXC4IzXgv7E37N/if8AZ++JPjHXPEdpDaade2zmOQTK+QJC5yB0+WvPpZpGphMxp1qt3NpxTd7+90+X4H09fhSphc14br4PC8ioxkqjjG3KvZJWm0tNb79bnjv7bl2f2pf+CrXwi+Fa/wCkaJ4MQa7q0XVWfPmlWHpsjjX/ALaGvZP+Cy37Xkn7HP7CfirV9Lmjh8TeII/7D0Yk4Mc04KtKPeOPe4/2gvavHP8AgknD/wANO/ta/Gz473CF7W81FtG0h2GcRZDHafaNYR/wKsL/AILE/sI/Gv8A4KD/ALTfw+0DRdMtLX4TeHGh+230t6iu000oFzP5edxEcIUKOpO/1Fa1qOHjmeFy/FSUaeHgnO/83xyXm23y/I/T8ilOph6+YRV5Vpu3+Fe7H5WV/mfNX/BE39sz9nb9iz9mfxPF8RPFjr4z8fXUo1K3GnTTfZrNVMccJcKQxbLyHH/PQDtXI/8ABEn9r/w/+zT/AMFM/EngjS9W+2fDb4lX02m6VdspijWUSM9nIVbBXcCYvq4r9TbP/gjX+zRa2UETfCbw1MYo1QySLIWfAxuPzdT3r5H/AOCov/BDKfV9b8A+Jf2ZvCeh+HNY0K6ZtQt4rr7KpKsskM4Lk5ZWUjj1HpXpUc9ybG1sRRqOcfrCs3Nx5Ytaxemqtsj3oYetTjHZ8vY5b/g6xl8qy+C+P+fnUP5QV+qvwMOfgn4O45/sOy/9EJX55/8ABZT9gT40/t//AAi+CZ0HQNPbxP4ftpJPEUE2oRxpbTyRwhgrHhhvR+ntX6NfC/RLjwz8NfDum3ShLrT9MtrWZQchXSJVYA/UGvlc0xFJ5ThKEZJyi6l0ntd6fedsIv2kpd7G8o54p1AGKRhk18ubiFuooXJoC5+tOAxQAdKjQ5uD9KkNRoMXB+lS+hS6jIZVRMHOaf8AaV96Psq+rUfZV9WpLmG+Vh9qX3o+0J7/AJUfZV9Wo+yr6tR7we6H2lfeg3S+9H2VfVqPsq+rUe8HugLlfej7SvvR9lX1aj7Kvq1HvB7ofaV96PtKe/5UfZV9Wo+yr6tR7we6H2lfej7Qnv8AlR9lX1aj7Kvq1HvB7owzqexrN8YeHLXxx4T1PRrxriO01a1ktJmhfZIEkUq21uxwTzWr9lX1aj7Kvq1NSmndEyjCScXszzv9mL9mXwf+yJ8MY/CXgu0ubTSEuJLoieYzSvI5yzMx5PQfgK9BaZSeM0/7Kvq1H2VfVq0rV61ao6tV80nq292yKNCjRpqlSVorRJbIaJlHrQ0ynpmnfZV9Wo+yr6tWXvGvukfmLnvT1nUev5Uv2VfVqPsq+rUe8Huh9pX3o+0p7/lR9lX1aj7Kvq1HvB7ofaV9/wAqPtK+9H2VfVqPsq+rUe8Huh9pX3pI3Dzkj0pfsq+rUscIjbIzRr1DTof/2Q==
"/>
</div>
</div>
</div>
</div>
</div>
</main>
</body>
</html>
